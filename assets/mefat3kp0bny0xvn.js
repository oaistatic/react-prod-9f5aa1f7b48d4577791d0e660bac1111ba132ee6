const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j0yo6uv6652vva62.js","assets/i8clt0mfz495j7ii.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/oeixl5q8jy2znlfi.js","assets/e216z3zqjas1rma2.js","assets/fg1cwp14kl8llosr.js","assets/rsi9kppw43ykrsgk.js"])))=>i.map(i=>d[i]);
var K=Object.defineProperty,Z=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var O=(e,s,a)=>s in e?K(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,y=(e,s)=>{for(var a in s||(s={}))R.call(s,a)&&O(e,a,s[a]);if(v)for(var a of v(s))L.call(s,a)&&O(e,a,s[a]);return e},_=(e,s)=>Z(e,J(s));var b=(e,s)=>{var a={};for(var n in e)R.call(e,n)&&s.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&v)for(var n of v(e))s.indexOf(n)<0&&L.call(e,n)&&(a[n]=e[n]);return a};import{e as T,j as t,r as l,_ as x,M as F}from"./i8clt0mfz495j7ii.js";import{p7 as Q,b_ as B,hY as X,bU as ee,p8 as te,p9 as se,pa as P,iw as ne,pb as U,aH as q,it as ae,iu as re,E as ie,pc as oe,ix as le,pd as ce,cc as de,iz as D,pe as ue,iq as me}from"./j0yo6uv6652vva62.js";import{C as xe,a as fe,S as pe}from"./h2fsh6u947t1mvet.js";import{d as w,aW as z,aV as $,o as f,O as A,L as p,T as he,cH as ge,bO as je,e as ye,bT as _e}from"./ghewn7l2ynbm32fm.js";import"./owvt7s3ln6qx5fou.js";import"./ksuwacyo5m7qmkk7.js";import"./dwikchly7agkd2y3.js";import"./hk7ym2rzlomukbdz.js";import"./pbvsc3do5o365cxq.js";import"./bbipyj9bituayr8q.js";import"./o2ch1u40q6bs5ljp.js";import"./fy1n36to2eb0czaf.js";import"./nvrhbbc4qxooogd5.js";import"./l3jkxavl2du23cqn.js";function be({label:e,tab:s,activeTab:a,setActiveTab:n,caterpillarHeaderRef:r}){const o=l.useCallback(()=>{n(s),r.current&&r.current.scrollIntoView({behavior:"instant",block:"center"})},[n,s,r]),d=a===s;return t.jsx("button",{onClick:o,className:w("btn text-token-text-primary min-h-[36px]! min-w-[100px] rounded-full px-2 py-1 select-none",d?"bg-token-main-surface-primary shadow-sm":"bg-token-main-surface-tertiary!"),children:e})}function Ne({activeTab:e,setActiveTab:s,sourcesCount:a,showAuxTab:n=!1,caterpillarHeaderRef:r}){const o=T(),d=[{tab:"activity",label:o.formatMessage({id:"9lnBJU",defaultMessage:"Activity"})},{tab:"sources",label:a>1?o.formatMessage({id:"/Ucokx",defaultMessage:"{sourcesCount} Sources"},{sourcesCount:a}):a===1?o.formatMessage({id:"CCF0z+",defaultMessage:"1 Source"}):o.formatMessage({id:"twjHy3",defaultMessage:"Sources"})}];return n&&d.unshift({tab:"report",label:o.formatMessage({id:"zF7Fu5",defaultMessage:"Report"})}),t.jsx("div",{className:w("border-token-main-surface-tertiary bg-token-main-surface-tertiary flex items-center rounded-full border-[4px] transition-all"),children:d.map(({tab:c,label:i})=>t.jsx(be,{activeTab:e,tab:c,setActiveTab:s,label:i,caterpillarHeaderRef:r},c))})}const I=({children:e,icon:s,fillIcon:a,className:n})=>t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:w("mt-[3px] inline-flex h-5 w-5 shrink-0 items-center justify-center gap-2.5 rounded-[30px]",a&&"border border-black/10 bg-white",n),children:s}),e]}),Me=f(()=>x(()=>import("./j0yo6uv6652vva62.js").then(e=>e.yo),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),we=f(()=>x(()=>import("./oeixl5q8jy2znlfi.js").then(e=>e._),__vite__mapDeps([5,1])),{loading:e=>p(e)}),Se=f(()=>x(()=>import("./j0yo6uv6652vva62.js").then(e=>e.yv),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),ve=f(()=>x(()=>import("./e216z3zqjas1rma2.js").then(e=>e._),__vite__mapDeps([6,1])),{loading:e=>p(e)});function N({icon:e,message:s,iconClassName:a}){return t.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:t.jsx(I,{fillIcon:!1,icon:e,className:a,children:t.jsx("div",{className:"mt-[.5px] flex h-10",children:s})})})}const Ie=({finalRow:e})=>{var n;const s=T(),a=e.type==="fileOpen"?(n=Q[e.iconType])!=null?n:ve:null;return t.jsx(z,{children:t.jsx($.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?t.jsx(N,{icon:t.jsx(Me,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:s.formatMessage({id:"f9wsyE",defaultMessage:"Searching…"})}):e.type==="websiteOpen"?t.jsx(N,{icon:t.jsx(Se,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"8L6BBp",defaultMessage:"Reading…"})}):e.type==="fileOpen"?t.jsx(N,{icon:t.jsx(a,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"h5M4/O",defaultMessage:"Reading file…"})}):e.type==="pythonAnalysis"?t.jsx(N,{icon:t.jsx(we,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzing…"})}):t.jsx(N,{icon:t.jsx(A,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"bSPYmC",defaultMessage:"Thinking…"})})})})},Ee=f(()=>x(()=>import("./oeixl5q8jy2znlfi.js").then(e=>e._),__vite__mapDeps([5,1])),{loading:e=>p(e)}),ke=({children:e})=>t.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[t.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:t.jsx(Ee,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Te=({row:e})=>t.jsx(ke,{children:t.jsx("div",{className:"text-token-text-primary flex text-base",children:e.analysisSummary})}),Ae=f(()=>x(()=>import("./j0yo6uv6652vva62.js").then(e=>e.yo),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),Ce=({children:e,showIcon:s})=>t.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[t.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:s&&t.jsx(Ae,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Oe=({row:e,showIcon:s})=>{const a=e.query;return a?t.jsx(Ce,{showIcon:s,children:t.jsx("div",{className:"text-token-text-primary flex text-base",children:a})}):null};function Re({children:e,showIcon:s=!0}){return t.jsx(I,{fillIcon:!1,icon:s?t.jsx(A,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}):null,children:e})}const Le={strong:e=>{const r=e,{node:s,children:a}=r,n=b(r,["node","children"]);return t.jsx("strong",_(y({},n),{className:w(n.className,"text-token-text-primary font-semibold"),children:a}))},p:e=>{const r=e,{node:s,children:a}=r,n=b(r,["node","children"]);return t.jsx("p",_(y({},n),{className:w(n.className,"mb-0! text-base"),children:a}))}};function Fe(e){return e.replace(/^#+\s*.*$/gm,"").replace(/^\*\*.*\*\*$/gm,"").trim()}function Pe({row:e,showIcon:s=!0}){const a=e.summary;if(!a)return null;const n=Fe(a);return n.length===0?null:t.jsx(Re,{showIcon:s,children:t.jsx(B,{componentOverrides:Le,className:"w-0! flex-1 leading-6",children:n})})}const De=f(()=>x(()=>import("./fg1cwp14kl8llosr.js"),__vite__mapDeps([7,1])),{loading:e=>p(e)});function Ve(e){try{const{hostname:s}=new URL(e);return s}catch(s){return null}}const Be={p:e=>{const r=e,{node:s,children:a}=r,n=b(r,["node","children"]);return t.jsx("p",_(y({},n),{className:"text-token-text-primary text-start text-base",children:a}))},a:e=>{const r=e,{node:s,children:a}=r,n=b(r,["node","children"]);return t.jsx("a",_(y({},n),{className:"text-blue! text-base leading-6",children:a}))}},Ue=({website:e})=>{const s=Ve(e.url);return s?t.jsxs("div",{className:"flex items-start justify-start gap-2",children:[t.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:t.jsx(he,{label:s,className:"bg-token-main-surface-primary mt-[3px] flex h-5 w-5 shrink-0 cursor-pointer items-center justify-center",children:t.jsx(X,{url:e.url,size:"xsmall",className:"h-5 w-5",fallback:t.jsx(ee,{url:e.url,className:"h-5 w-5 rounded-2xl border-[.5px] border-black/25",fallback:t.jsx(De,{className:"icon-sm text-token-text-quaternary"})})})})}),t.jsx("div",{className:"text-token-text-primary mt-[1px] flex flex-col text-base",children:t.jsx(B,{componentOverrides:Be,children:e.rowText})})]}):null};function M({children:e}){return t.jsx($.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e})}const qe=({previousRow:e,currentRow:s})=>t.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:s.type==="search"?t.jsx(M,{children:t.jsx(Oe,{row:s,showIcon:!e||e.type!=="search"})},"search_".concat(s.id)):s.type==="summary"?t.jsx(M,{children:t.jsx(Pe,{row:s,showIcon:!e||e.type!=="summary"})},"summary_".concat(s.id)):s.type==="websiteOpen"?t.jsx(M,{children:t.jsx(Ue,{website:s})},"website_".concat(s.id)):s.type==="fileOpen"?t.jsx(M,{children:t.jsx(te,{row:s})},"file_".concat(s.id)):s.type==="pythonAnalysis"?t.jsx(M,{children:t.jsx(Te,{row:s})},"python_".concat(s.id)):null}),ze=f(()=>x(()=>import("./rsi9kppw43ykrsgk.js").then(e=>e._),__vite__mapDeps([8,1])),{loading:e=>p(e)}),$e=120,We=1e3*60*2;function V(e){e==null||e.scrollIntoView({block:"center",behavior:"smooth"})}function He({caterpillarStatusMessageTexts:e}){return t.jsx("div",{className:"p-4",children:t.jsx(q,{type:"error",title:e.failureMessage,content:e.failureBannerContentMessage})})}function Ye({caterpillarStatusMessageTexts:e}){return t.jsx("div",{className:"p-4",children:t.jsx(q,{title:e.cancelledMessage,content:""})})}function Ge({sourcesCount:e,taskInfo:s}){const a=ge(s.originalConversationId,r=>{var o,d;return(d=(o=je.findNode(r,c=>{var i,u;return((i=c.message.metadata)==null?void 0:i.b1de6e2_s)===!0&&((u=c.message.metadata)==null?void 0:u.async_task_id)===s.taskId}))==null?void 0:o.message.metadata)==null?void 0:d.async_task_status_messages}),n=l.useMemo(()=>{var r;return a!=null&&a.completed_no_time?t.jsxs(t.Fragment,{children:[(r=a==null?void 0:a.completed_with_time)!=null?r:a==null?void 0:a.completed_no_time,t.jsx(F,{id:"zxfmo/",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:e}})]}):t.jsx(F,{id:"YG7a0T",defaultMessage:"Completed · {sourcesCount} sources",values:{sourcesCount:e}})},[e,a]);return!s.updatedAt&&!(a!=null&&a.completed)?null:t.jsx(I,{icon:t.jsx(ze,{className:"text-token-text-secondary"}),fillIcon:!1,children:t.jsx("div",{className:"text-token-text-tertiary",children:n})})}function Ke({taskInfo:e,caterpillarStatusMessageTexts:s,sourcesCount:a,caterpillarHeaderRef:n}){const[r,o]=l.useState(!1),d=l.useRef(!1),c=l.useRef(null),i=l.useMemo(()=>{var m;return d.current=!!c.current&&se(c.current,$e),(m=e.rows)!=null?m:[]},[e.rows]);l.useEffect(()=>{if(i.length===0){const m=new Date(e.createdAt).getTime(),h=Date.now()-m,S=We-h;if(S>0){const k=setTimeout(()=>{o(!0)},S);return()=>clearTimeout(k)}else o(!0)}else o(!1)},[i,e.createdAt]),l.useEffect(()=>{d.current&&V(c.current)},[i]),l.useEffect(()=>{P(e)||setTimeout(()=>{c.current&&V(c.current)},100)},[]);const u=P(e)||ne(e),j=U(),E=l.useMemo(()=>i.length&&!u&&!j?i.slice(0,i.length-1):i,[i,u,j]);return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:n},"task-header"),t.jsxs("div",{className:"flex w-full flex-col gap-4",children:[t.jsx("div",{className:"text-base font-medium",children:e.title}),i.length?t.jsxs(z,{initial:!1,children:[E.map((m,h)=>t.jsx(qe,{previousRow:h>0?i[h-1]:null,currentRow:m},m.id)),!u&&t.jsx(Ie,{finalRow:i[i.length-1]})]}):r?t.jsx(I,{fillIcon:!1,icon:t.jsx(A,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:s.waitingInQueueMessage}):t.jsx(xe,{}),e.status==="failed"?t.jsx(He,{caterpillarStatusMessageTexts:s}):e.status==="cancelled"?t.jsx(Ye,{caterpillarStatusMessageTexts:s}):e.status==="completed"?t.jsx(Ge,{caterpillarStatusMessageTexts:s,taskInfo:e,sourcesCount:a}):null]}),t.jsx("div",{ref:c},"task-footer")]})}function ut({taskId:e,setWidth:s=void 0,initialTab:a}){const n=ae(g=>re.getTask(e,g)),{closeThreadSidebar:r}=ie(),[o,d]=l.useState(a),c=oe(),i=l.useRef(null),u=!1;l.useEffect(()=>{d(a)},[a]),l.useEffect(()=>{},[n==null?void 0:n.taskId,n==null?void 0:n.status,u]),l.useEffect(()=>{},[n==null?void 0:n.taskId,n==null?void 0:n.status,o]),l.useEffect(()=>{},[s,n,u]);const j=T(),E=ye(),m=U(),h=le({taskId:n==null?void 0:n.taskId,intl:j,toaster:E}),S=()=>h.mutate(),k=()=>{n&&_e(n.originalConversationId,g=>{g.steeringAsyncTaskId=n.taskId})},{uniqueSources:W,totalSources:C}=l.useMemo(()=>{if(!(n!=null&&n.rows))return{uniqueSources:[],totalSources:0};const g=ce(n.rows),H=g.reduce((Y,G)=>Y+G.count,0);return{uniqueSources:g,totalSources:H}},[n==null?void 0:n.rows]);return t.jsx(de,{ariaLabel:j.formatMessage({id:"region.sidebar.caterpillar",defaultMessage:"Tasks"}),handleClose:r,trailing:n&&m&&D(n)&&t.jsx(pe,{onAddContext:k,onStopTask:S,taskIsFinalizing:n.status===me.FINALIZING}),leading:t.jsx("div",{className:"flex w-full justify-center",children:t.jsx(Ne,{activeTab:o,setActiveTab:d,showAuxTab:u,sourcesCount:C,caterpillarHeaderRef:i})}),children:n&&t.jsxs(fe,{children:[!1,o==="activity"&&t.jsx(Ke,{taskInfo:n,caterpillarStatusMessageTexts:c,sourcesCount:C,caterpillarHeaderRef:i}),o==="sources"&&t.jsx(ue,{taskIsPending:D(n),finalMessage:n.finalMessage,sources:W,caterpillarHeaderRef:i})]})})}export{ut as CaterpillarSidebar};
//# sourceMappingURL=mefat3kp0bny0xvn.js.map
