var M=Object.defineProperty,W=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var g=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t);var S=(t,e,o)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,b=(t,e)=>{for(var o in e||(e={}))k.call(e,o)&&S(t,o,e[o]);if(u)for(var o of u(e))O.call(e,o)&&S(t,o,e[o]);return t},h=(t,e)=>W(t,j(e));var p=function(t,e){this[0]=t,this[1]=e},x=(t,e,o)=>{var a=(s,m,l,d)=>{try{var r=o[s](m),f=(m=r.value)instanceof p,C=r.done;Promise.resolve(f?m[0]:m).then(i=>f?a(s==="return"?s:"next",m[1]?{done:i.done,value:i.value}:i,l,d):l({value:i,done:C})).catch(i=>a("throw",i,l,d))}catch(i){d(i)}},c=s=>n[s]=m=>new Promise((l,d)=>a(s,m,l,d)),n={};return o=o.apply(t,e),n[g("asyncIterator")]=()=>n,c("next"),c("throw"),c("return"),n};var y=(t,e,o)=>(e=t[g("asyncIterator")])?e.call(t):(t=t[g("iterator")](),e={},o=(a,c)=>(c=t[a])&&(e[a]=n=>new Promise((s,m,l)=>(n=c.call(t,n),l=n.done,Promise.resolve(n.value).then(d=>s({value:d,done:l}),m)))),o("next"),o("return"),e);import{an as _}from"./ghewn7l2ynbm32fm.js";import{dV as A,dW as D}from"./j0yo6uv6652vva62.js";import"./i8clt0mfz495j7ii.js";function P(t){var e,o,a;return((a=(o=(e=t.modelPreferences)==null?void 0:e.hints)==null?void 0:o[0])==null?void 0:a.name)||"unknown-model"}function w(t,e,o){var s;const a=window.location.origin+"/backend-api/ecosystem/completion",c=new AbortController,n=A(a,{ctx:_(),method:"POST",body:{method:"sampling/createMessage",params:{messages:t.messages,modelPreferences:t.modelPreferences,systemPrompt:t.systemPrompt,metadata:h(b({},(s=t.metadata)!=null?s:{}),{app_uri:e})}},signal:c.signal,accessToken:o});return{stream:N(D(n)),controller:c}}function N(t){return x(this,null,function*(){try{for(var e=y(t),o,a,c;o=!(a=yield new p(e.next())).done;o=!1){const n=a.value;n&&typeof n=="object"&&"data"in n&&n.data&&typeof n.data=="object"&&"content"in n.data&&(yield n.data.content)}}catch(a){c=[a]}finally{try{o&&(a=e.return)&&(yield new p(a.call(e)))}finally{if(c)throw c[0]}}})}function z(t,e,o){return x(this,null,function*(){const a=P(t),{stream:c,controller:n}=w(t,e,o);try{try{for(var s=y(c),m,l,d;m=!(l=yield new p(s.next())).done;m=!1){const r=l.value;r.type==="text"&&(yield{content:{type:"text",text:r.text},model:a,role:"assistant"})}}catch(l){d=[l]}finally{try{m&&(l=s.return)&&(yield new p(l.call(s)))}finally{if(d)throw d[0]}}}finally{try{n.abort("Widget canceled reading completion stream")}catch(r){}}})}async function B(t,e,o){const a=P(t),{stream:c,controller:n}=w(t,e,o);try{let r="";try{for(var s=y(c),m,l,d;m=!(l=await s.next()).done;m=!1){const f=l.value;f.type==="text"&&(r=f.text)}}catch(l){d=[l]}finally{try{m&&(l=s.return)&&await l.call(s)}finally{if(d)throw d[0]}}return{content:{type:"text",text:r},model:a,role:"assistant"}}finally{try{n.abort("Widget canceled reading completion call stream")}catch(r){}}}export{B as callCompletion,z as completionStream};
//# sourceMappingURL=om87g1p3w7uzy3ym.js.map
