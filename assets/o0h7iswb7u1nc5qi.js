var E=Object.defineProperty,k=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var m=(e,t,a)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,R=(e,t)=>{for(var a in t||(t={}))U.call(t,a)&&m(e,a,t[a]);if(_)for(var a of _(t))w.call(t,a)&&m(e,a,t[a]);return e},S=(e,t)=>k(e,T(t));import{A as $,ab as A,h as L,r as c}from"./i8clt0mfz495j7ii.js";import{e as y,f0 as f,f1 as p,R as P}from"./ghewn7l2ynbm32fm.js";import{a as G}from"./ci57adu98ddr6ebh.js";async function I(e,t,a,o){const n=await P.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:e},query:{code:t,redirect_uri:a,state:o}}});return S(R({},n),{redirect_path:G(n.redirect_path).toString()})}const H=$(function(){const{pluginId:t}=A(),a=L(),o=c.useRef(!1),[n,C]=c.useState(""),{code:i,error:u,error_description:r,state:h}=Object.fromEntries(new URLSearchParams(n.substring(1)).entries());c.useEffect(()=>{C(window.location.hash)},[]),c.useEffect(()=>{if(o.current)return;if(t&&i&&h)o.current=!0;else{a("/");return}async function b(){var g;const O=window.location.origin+"/ccc/".concat(t,"/oauth/callback");if(!(!t||!i||!h))try{const s=await I(t,i,O,h);if(s.success){const l=new URL(f(p.OAUTH_SUCCESS,s.redirect_path),location.origin);l.searchParams.set("oauth_success","true"),a(l.pathname+l.search+l.hash)}else a(f(p.CUSTOM_ERROR,s.redirect_path,(g=s.error)!=null?g:s.message))}catch(s){a(f(p.CUSTOM_ERROR))}}b()},[t,i,h,a]);const d=y();return c.useEffect(()=>{u&&d.danger("".concat(u).concat(r?": ".concat(r):""),{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:u,loggingDescription:r!=null?r:""})},[u,r,d]),null});export{H as default};
//# sourceMappingURL=o0h7iswb7u1nc5qi.js.map
