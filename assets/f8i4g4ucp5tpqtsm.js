import{e as y,r as S,u as L,j as e,M as c}from"./i8clt0mfz495j7ii.js";import{u as O,e as U,P as g,fZ as D,C as W,b0 as G,aY as v,bF as E,jD as Q,J as z}from"./ghewn7l2ynbm32fm.js";import{dA as K,dD as Y,bK as q,a_ as R}from"./j0yo6uv6652vva62.js";import{a as J,A as Z,T as H,P as V}from"./fe1zgnccg3ea7jld.js";import{u as X}from"./bjlbvo9rov23708i.js";import"./ji1868fe7hk3rgcl.js";import"./izvx0vf35f3cqx26.js";import"./o1s10g7vrpyumh3e.js";import"./e2bky2k6amgws3b2.js";import"./kplnfohfof8ely0n.js";import"./kgnykbdth8mb50na.js";import"./g8i6bixylsxyemsr.js";import"./iej0cupg2dqkmejt.js";import"./n8tfpmgkqe98i7yl.js";import"./mq11hu99eist2abq.js";import"./mtmwfv9ttg0ed53k.js";function he({onClose:o,onBackButtonClicked:i,account:t}){const d=O(),a=y(),s=U(),[r,l]=S.useState(!1);S.useEffect(()=>{g.logEventWithStatsig("Claim Subscription Cancellation Promotion Modal Shown","chatgpt_claim_subscription_cancellation_promotion_modal_shown")},[]);const u=()=>{g.logEventWithStatsig("Claim Subscription Cancellation Promotion Modal Close","chatgpt_claim_subscription_cancellation_promotion_modal_close"),o()},h=()=>{g.logEventWithStatsig("Claim Subscription Cancellation Promotion Modal Back Button Clicked","chatgpt_claim_subscription_cancellation_promotion_modal_back_button_clicked"),i()},p=K(t.id),{cancellationPromoMetadata:n,isCancelPromoLoading:C}=X(t.id,t.isEligibleForCancellationPromotion()),{data:M,isError:P,isLoading:m}=Y(t.id,void 0,void 0,n==null?void 0:n.campaign_id),f=t.mustGetSubscriptionBillingCurrency("GlobalSettingsModal"),{data:N,isLoading:k,error:w}=q({currency:f,ctx:d});(P||w)&&(s.warning(a.formatMessage({id:"cancelPromoClaimModal.errorFetchingPreview",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),o());const j=L(),I=async x=>{var b;g.logEventWithStatsig("Claim Subscription Cancellation Promotion Pay Now Button Clicked","chatgpt_claim_subscription_cancellation_promotion_modal_pay_now_button_clicked"),l(!0);try{await p.mutateAsync({accountId:t.id,updatedPromoId:x.campaign_id}),s.success(a.formatMessage({id:"cancelPromoClaimModal.successfullyClaimedPromotion",defaultMessage:"You've successfully claimed your promotion"}),{hasCloseButton:!0}),g.logEventWithStatsig("Claim Subscription Cancellation Promotion Success","chatgpt_claim_subscription_cancellation_promotion_success",{promo_id:x.campaign_id}),j.invalidateQueries(Q()),j.invalidateQueries({queryKey:["cancellationPromotion"]}),o()}catch(_){g.logEventWithStatsig("Claim Subscription Cancellation Promotion Error","chatgpt_claim_subscription_cancellation_promotion_error",{promo_id:x.campaign_id}),((b=_==null?void 0:_.detail)==null?void 0:b.error_type)==="card_declined"?s.warning(a.formatMessage({id:"cancelPromoClaimModal.cardDeclinedError",defaultMessage:"Payment error. Your card may be invalid or authentication may be needed."}),{hasCloseButton:!0}):s.warning(a.formatMessage({id:"cancelPromoClaimModal.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),z.addError(_),o()}finally{l(!1)}},B=D(f),{goCost:F,plusCost:T,proCost:A}=J(f,N);return e.jsx(W,{testId:"modal-subscription-claim-cancel-promo",type:"success",isOpen:!0,onClose:u,size:"custom",noPadding:!0,className:"max-w-xl",showCloseButton:!0,title:a.formatMessage({id:"cancelPromoClaimModal.title",defaultMessage:"Confirm changes"}),removePopoverStyling:!0,children:m||C||k?e.jsx($,{}):n!=null&&n.campaign_id&&M?e.jsx(oe,{account:t,promoData:n,previewData:M,plusCost:T,goCost:F,proCost:A,currencySymbol:B,onBack:h,handleUpdate:()=>I(n),isUpdating:r}):null})}function $(){return e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx(G,{})})}function ee({subscriptionPreviewdata:o,promoData:i,intl:t,planName:d,currencySymbol:a}){var r,l;const s=(l=(r=i.duration)==null?void 0:r.num_periods)!=null?l:1;return[{adjustmentMessage:e.jsx(c,{id:"cancelPromoClaimModal.adjustment",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(c,{id:"cancelPromoClaimModal.proratedCredit",defaultMessage:"-{currencySign}{adjustment}",values:{currencySign:t.formatMessage(a.sign),adjustment:(-o.negative_line_item_total/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(c,{id:"cancelPromoClaimModal.proratedCreditInfo",defaultMessage:"Prorated credit for the remainder of your {planName} subscription",values:{planName:d}}),value:o.negative_line_item_total},{adjustmentMessage:e.jsx(c,{id:"cancelPromoClaimModal.discount",defaultMessage:"Discount"}),proratedCreditMessage:e.jsx(c,{id:"cancelPromoClaimModal.discountAmount",defaultMessage:"-{currencySign}{discount}",values:{currencySign:t.formatMessage(a.sign),discount:(-o.discount_amount/100).toFixed(2)}}),proratedCreditInfoMessage:"percentage"in i.discount?e.jsx(c,{id:"cancelPromoClaimModal.percentageDiscountInfo",defaultMessage:"{discountPercentage}% off for {numPeriods, plural, one {1 month} other {{numPeriods} months}}",values:{discountPercentage:i.discount.percentage,numPeriods:s}}):e.jsx(c,{id:"cancelPromoClaimModal.valueDiscountInfo",defaultMessage:"{valueOff} off for {numPeriods, plural, one {1 month} other {{numPeriods} months}}",values:{valueOff:t.formatNumber(i.discount.value,{style:"currency",currency:i.discount.currency_code,minimumFractionDigits:0,maximumFractionDigits:2}),numPeriods:s}}),value:o.discount_amount}]}function te({subscriptionPreviewData:o,promoData:i,planName:t,planCost:d,currencySymbol:a}){var l,u;const s=y(),r=(u=(l=i.duration)==null?void 0:l.num_periods)!=null?u:1;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(c,{id:"cancelPromoClaimModal.subscription",defaultMessage:"ChatGPT {planName} for {numPeriods, plural, one {1 month} other {{numPeriods} months}}",values:{planName:t,numPeriods:r}})}),e.jsx("span",{className:"font-semibold",children:e.jsx(c,{id:"cancelPromoClaimModal.subscriptionCost",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:s.formatMessage(a.sign),totalCost:(o.positive_line_item_total_excluding_tax/100).toFixed(2)}})})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(c,{id:"cancelPromoClaimModal.billingCycle",defaultMessage:"One-time payment, then {currencySign}{planCost}/month after {numPeriods, plural, one {1 month} other {{numPeriods} months}}",values:{currencySign:s.formatMessage(a.sign),planCost:s.formatMessage(d),numPeriods:r}})})]})}function oe({account:o,promoData:i,previewData:t,plusCost:d,goCost:a,proCost:s,currencySymbol:r,onBack:l,handleUpdate:u,isUpdating:h}){const p=y(),n=o.data.subscriptionStatus.planType,C=R(n.toLowerCase()),M=n===v.PRO?s:n===v.GO?a:d,P=ee({subscriptionPreviewdata:t,promoData:i,intl:p,planName:C,currencySymbol:r});return e.jsxs("div",{className:"p-6",children:[e.jsx(te,{subscriptionPreviewData:t,promoData:i,planName:C,planCost:M,currencySymbol:r}),P.filter(m=>m.value!==0).map((m,f)=>e.jsx(Z,{adjustmentMessage:m.adjustmentMessage,proratedCreditMessage:m.proratedCreditMessage,proratedCreditInfoMessage:m.proratedCreditInfoMessage},f)),e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(H,{data:t,currencySymbol:r}),t.default_payment_method&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(V,{defaultPaymentMethod:t.default_payment_method})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(E,{title:p.formatMessage({id:"cancelPromoClaimModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:l}),e.jsx(E,{title:p.formatMessage({id:"cancelPromoClaimModal.payNow",defaultMessage:"Pay now"}),color:"primary",onClick:u,loading:h})]})]})}export{he as SubscriptionClaimCancelPromoModal};
//# sourceMappingURL=f8i4g4ucp5tpqtsm.js.map
