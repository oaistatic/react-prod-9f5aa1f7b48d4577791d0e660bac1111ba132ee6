const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/e6eptpe9toj61kmv.js","assets/i8clt0mfz495j7ii.js"])))=>i.map(i=>d[i]);
var V=Object.defineProperty,Y=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var L=(e,n,r)=>n in e?V(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,l=(e,n)=>{for(var r in n||(n={}))B.call(n,r)&&L(e,r,n[r]);if(x)for(var r of x(n))R.call(n,r)&&L(e,r,n[r]);return e},k=(e,n)=>Y(e,J(n));var h=(e,n)=>{var r={};for(var c in e)B.call(e,c)&&n.indexOf(c)<0&&(r[c]=e[c]);if(e!=null&&x)for(var c of x(e))n.indexOf(c)<0&&R.call(e,c)&&(r[c]=e[c]);return r};import{e as F,r as p,j as t,M as u,_ as $,b as j,u as E,a as D}from"./i8clt0mfz495j7ii.js";import{bj as X,np as Z,b7 as H,mb as G,b5 as ee,b6 as te}from"./j0yo6uv6652vva62.js";import{$ as v,R as m,e as ne,o as re,L as se,C as ce,d as ae,b0 as oe}from"./ghewn7l2ynbm32fm.js";import{m as o}from"./bw334685wo6mbjqy.js";import{T as f}from"./zm1ki9l766pgg0bx.js";function ie({setEnabled:e,isLoading:n,isEnabled:r}){const c=F(),[a,s]=p.useState(!1),d=()=>{s(!0)},i=y=>{s(!1),y&&e(!1)};return t.jsx("div",{className:"pt-1.5",children:r?t.jsxs(t.Fragment,{children:[t.jsx(v,{disabled:n,color:"danger",onClick:()=>{n||d()},children:t.jsx(u,l({},o.deleteDirectorySyncConnectionButton))}),t.jsx(X,{title:c.formatMessage(o.deleteDirectorySyncConnectionModalHeader),description:c.formatMessage(o.deleteDirectorySyncConnectionModalExplanation),confirmText:c.formatMessage(o.deleteDirectorySyncConnectionModalConfirmButton),cancelText:c.formatMessage(o.deleteDirectorySyncConnectionModalCancelButton),isOpen:a,primaryButtonColor:"danger",onClose:()=>i(!1),onConfirm:()=>i(!0)})]}):t.jsx(t.Fragment,{children:t.jsx(v,{disabled:n,color:"primary",onClick:()=>{n||e(!0)},children:t.jsx(u,l({},o.enableDirectorySyncButton))})})})}class S{static async getWorkspaceDirectorySyncSettings(n){return m.safeGet("/accounts/{account_id}/scim",{parameters:{path:{account_id:n}}})}static async setWorkspaceDirectorySyncEnabled(n,r){return m.safePost("/accounts/{account_id}/scim/set_enabled",{parameters:{path:{account_id:n}},requestBody:{enabled:r}})}static async setWorkspaceDirectorySyncEmailInvitesEnabled(n,r){return m.safePost("/accounts/{account_id}/scim/set_email_invites_enabled",{parameters:{path:{account_id:n}},requestBody:{enabled:r}})}static async getWorkspaceDirectorySyncPortalUrl(n){return m.safeGet("/accounts/{account_id}/scim/portal_link",{parameters:{path:{account_id:n}}})}static async getWorkspaceDirectorySyncFailedEvents(n){return m.safeGet("/accounts/{account_id}/scim/failed_events",{parameters:{path:{account_id:n}}})}static async retryWorkspaceDirectorySyncFailedEvent(n,r){return m.safePost("/accounts/{account_id}/scim/failed_events/{event_id}/retry",{parameters:{path:{account_id:n,event_id:r}}})}static async retryAllWorkspaceDirectorySyncFailedEvents(n){return m.safePost("/accounts/{account_id}/scim/failed_events/retry_all",{parameters:{path:{account_id:n}}})}static async discardWorkspaceDirectorySyncFailedEvent(n,r){return m.safeDelete("/accounts/{account_id}/scim/failed_events/{event_id}",{parameters:{path:{account_id:n,event_id:r}}})}static async getWorkspaceDirectorySyncProgressUsers(n){return m.safeGet("/accounts/{account_id}/scim/sync_progress_users",{parameters:{path:{account_id:n}}})}static async getWorkspaceDirectorySyncProgressGroups(n){return m.safeGet("/accounts/{account_id}/scim/sync_progress_groups",{parameters:{path:{account_id:n}}})}}const le=re(()=>$(()=>import("./e6eptpe9toj61kmv.js").then(e=>e._),__vite__mapDeps([0,1])),{loading:e=>se(e)});function de({isLoading:e,workspaceId:n,isDirectoryConnectionConfigured:r}){const[c,a]=p.useState(!1),s=ne(),d=F(),i=async()=>{try{a(!0);const y=await S.getWorkspaceDirectorySyncPortalUrl(n);a(!1),y!=null&&y.portal_link?window.open(y.portal_link,"_blank"):s.danger(d.formatMessage({id:"directorySync.portalLinkNotFound",defaultMessage:"Portal link not found."}),{toastId:"directory_sync_management_portal_button",loggingTitle:"Portal link not found.",loggingDescription:"Error message shown when directory sync portal link is missing"})}catch(y){y instanceof Error?s.danger(y.message,{toastId:"directory_sync_management_portal_button",loggingTitle:y.message,loggingDescription:"Generic error message for unexpected failures when opening the directory sync portal"}):s.danger(d.formatMessage({id:"directorySync.unexpectedError",defaultMessage:"An unexpected error occurred."}),{toastId:"directory_sync_management_portal_button",loggingTitle:"An unexpected error occurred.",loggingDescription:"Generic error message for unexpected failures when opening the directory sync portal"})}};return t.jsxs(v,{disabled:e||c,color:"secondary",className:"mt-3",onClick:i,children:[r?t.jsx(u,l({},o.launchDirectorySyncManagementPortalText)):t.jsx(u,l({},o.launchDirectorySyncSetupPortalText)),t.jsx(le,{className:"icon-sm ms-1"})]})}function U(e){switch(e){case"dsync.user.created":return o.directorySyncEventTypeUserCreated;case"dsync.user.updated":return o.directorySyncEventTypeUserUpdated;case"dsync.user.deleted":return o.directorySyncEventTypeUserDeleted;case"dsync.group.created":return o.directorySyncEventTypeGroupCreated;case"dsync.group.updated":return o.directorySyncEventTypeGroupUpdated;case"dsync.group.deleted":return o.directorySyncEventTypeGroupDeleted;case"dsync.group.user_added":return o.directorySyncEventTypeGroupUserAdded;case"dsync.group.user_removed":return o.directorySyncEventTypeGroupUserRemoved;case"dsync.activated":return o.directorySyncEventTypeActivated;case"dsync.deleted":return o.directorySyncEventTypeDeleted;case"dsync.deactivated":return o.directorySyncEventTypeDeleted}}function ue({isLoading:e,failedEvents:n,retryEventWithId:r,retryAllFailedEvents:c,discardFailedEventWithId:a}){const[s,d]=p.useState(!1),[i,y]=p.useState(),C=F();return t.jsxs(t.Fragment,{children:[i&&t.jsx(ce,{testId:"modal-directory-sync-failed-events",isOpen:s,onClose:d,title:C.formatMessage(U(i.event.event)),description:i.failure_reason,type:"success",showCloseButton:!0,isScrollable:!0,children:t.jsx("pre",{children:JSON.stringify(i.event,null,2)})}),n.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs(Z,{className:"flex items-center space-x-4",children:[t.jsx(u,l({},o.failedDirectorySyncEventsTableHeader)),t.jsx(v,{disabled:e,color:"secondary",size:"small",className:"ms-auto",onClick:()=>{c()},children:t.jsx(u,l({},o.retryAllFailedDirectorySyncEventsButton))})]}),t.jsxs(f.Root,{className:"w-full table-auto",children:[t.jsxs(f.Header,{children:[t.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:t.jsx(u,l({},o.directorySyncEventsTableFailureEventTypeColumnHeader))}),t.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:t.jsx(u,l({},o.directorySyncEventsTableFailureReasonColumnHeader))}),t.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:t.jsx(u,l({},o.directorySyncEventsTableActionsColumnHeader))})]}),t.jsx(f.Body,{children:n.map((g,M)=>t.jsxs("tr",{children:[t.jsx(f.Cell,{children:t.jsx(u,l({},U(g.event.event)))}),t.jsx(f.Cell,{children:g.failure_reason}),t.jsxs(f.Cell,{children:[t.jsx("div",{children:t.jsx(v,{disabled:e,color:"secondary",size:"small",onClick:()=>{y(g),d(!0)},children:t.jsx(u,l({},o.showEventDirectorySyncEventButton))})}),t.jsx("div",{className:"ms-2",children:t.jsx(v,{disabled:e,color:"secondary",size:"small",onClick:()=>{r(g.event.id)},children:t.jsx(u,l({},o.retryDirectorySyncEventButton))})}),t.jsx("div",{className:"ms-2",children:a&&t.jsx(v,{disabled:e,color:"secondary",size:"small",onClick:()=>{a(g.event.id)},children:t.jsx(u,l({},o.discardDirectorySyncEventButton))})})]})]},g.event.id))})]})]})]})}function ye({isLoading:e,numUsersSynced:n,numUsersInDirectory:r,numGroupsSynced:c,numGroupsInDirectory:a,failedEvents:s,retryEventWithId:d,retryAllFailedEvents:i,discardFailedEventWithId:y}){return t.jsxs(t.Fragment,{children:[t.jsxs(H,{className:"my-2",children:[t.jsxs("div",{children:[t.jsx(u,k(l({},o.directorySyncUserSyncStatus),{values:{numUsersSynced:n,numUsersInDirectory:r}})),t.jsx(G,{percentage:n/(r||1)*100})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsx(u,k(l({},o.directorySyncGroupSyncStatus),{values:{numGroupsSynced:c,numGroupsInDirectory:a}}))}),t.jsx(G,{percentage:c/(a||1)*100})]})]}),t.jsx("div",{className:"mt-4",children:t.jsx(ue,{isLoading:e,failedEvents:s,retryEventWithId:d,retryAllFailedEvents:i,discardFailedEventWithId:y})})]})}const b=2e3;function T(e,n){const[r,c]=p.useState(!1),d=j({queryKey:["workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncSettings(e)},enabled:!!e,refetchInterval:r?b:!1}),{data:a}=d,s=h(d,["data"]);return p.useEffect(()=>{a!=null&&a.enabled&&(a==null?void 0:a.directory_connection)==null?c(!0):c(!1)},[a]),l({data:a},s)}function w(e,n){const[r,c]=p.useState(!1),{data:a}=T(e),i=j({queryKey:["workspace/directorySyncStatus/progressUsers","workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncProgressUsers(e)},enabled:!!e&&!!(a!=null&&a.directory_connection),refetchInterval:r?b:!1}),{data:s}=i,d=h(i,["data"]);return p.useEffect(()=>{(s==null?void 0:s.synced_scim_users)===0||(s==null?void 0:s.synced_scim_users)!==(s==null?void 0:s.total_scim_users)?c(!0):c(!1)},[s,a==null?void 0:a.directory_connection]),l({isLoadingUsers:r,data:s},d)}function me(e,n){const[r,c]=p.useState(!1),{data:a}=T(e),i=j({queryKey:["workspace/directorySyncStatus/progressGroups","workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncProgressGroups(e)},enabled:!!e&&!!(a!=null&&a.directory_connection),refetchInterval:r?b:!1}),{data:s}=i,d=h(i,["data"]);return p.useEffect(()=>{(s==null?void 0:s.synced_scim_groups)===0||(s==null?void 0:s.synced_scim_groups)!==(s==null?void 0:s.total_scim_groups)?c(!0):c(!1)},[s,a==null?void 0:a.directory_connection]),l({isLoadingGroups:r,data:s},d)}function pe(e,n){const{isLoadingUsers:r}=w(e);return j({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncFailedEvents(e)},enabled:!!e,refetchInterval:r?b:!1})}function fe(e){const n=E();return D({mutationFn:r=>S.retryWorkspaceDirectorySyncFailedEvent(e,r),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function Se(e){const n=E();return D({mutationFn:()=>S.retryAllWorkspaceDirectorySyncFailedEvents(e),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function ge(e){const n=E();return D({mutationFn:r=>S.discardWorkspaceDirectorySyncFailedEvent(e,r),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents"]})}})}function ve(e){const n=E();return D({mutationFn:r=>S.setWorkspaceDirectorySyncEnabled(e,r),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySync",e]})}})}function be({workspaceId:e}){var W,N,q,A,P;const{data:n,isLoading:r}=T(e),{data:c,isLoading:a}=w(e),{data:s,isLoading:d}=me(e),{data:i,isLoading:y}=pe(e),{mutateAsync:C,status:g}=ve(e),{mutateAsync:M,status:O}=fe(e),{mutateAsync:K,status:Q}=Se(e),{mutateAsync:z,status:I}=ge(e),_=g==="pending"||O==="pending"||Q==="pending"||I==="pending"||r||a||d||y;return t.jsxs(ee,{className:ae("ps-6",_&&"text-token-text-secondary"),children:[t.jsx(te,{children:t.jsxs("div",{className:"flex flex-row",children:[t.jsx("div",{children:t.jsx(u,l({},o.directorySyncTitle))}),t.jsx("div",{className:"ms-2 mt-1",children:_&&t.jsx(oe,{})})]})}),t.jsx(H,{children:t.jsx(u,l({},o.directorySyncInfoText))}),(n==null?void 0:n.directory_connection)&&t.jsx("div",{children:t.jsx(ye,{isLoading:_,numUsersSynced:(W=c==null?void 0:c.synced_scim_users)!=null?W:0,numUsersInDirectory:(N=c==null?void 0:c.total_scim_users)!=null?N:0,numGroupsSynced:(q=s==null?void 0:s.synced_scim_groups)!=null?q:0,numGroupsInDirectory:(A=s==null?void 0:s.total_scim_groups)!=null?A:0,failedEvents:i!=null?i:[],retryEventWithId:M,retryAllFailedEvents:K,discardFailedEventWithId:z})}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(ie,{setEnabled:C,isLoading:_,isEnabled:(P=n==null?void 0:n.enabled)!=null?P:!0}),(n==null?void 0:n.enabled)&&t.jsx(t.Fragment,{children:t.jsx(de,{isLoading:_,workspaceId:e,isDirectoryConnectionConfigured:!!(n!=null&&n.directory_connection)})})]})]})}export{be as DirectorySyncSection};
//# sourceMappingURL=en2c1ntlk6a9o1f0.js.map
