import{am as U,jG as T,kh as w,J as s,or as B,R as M}from"./ghewn7l2ynbm32fm.js";import{f$ as O,dF as x}from"./j0yo6uv6652vva62.js";import{T as p}from"./kplnfohfof8ely0n.js";const D=U(e=>({abortController:null,setAbortController:t=>e({abortController:t}),isRunningServerUpdate:!1,setIsRunningServerUpdate:t=>e({isRunningServerUpdate:t}),subscribeButtonContainer:null,setSubscribeButtonContainer:t=>e({subscribeButtonContainer:t}),celebrationBannerText:null,setCelebrationBannerText:t=>e({celebrationBannerText:t}),checkoutSessionUpdateError:null,setCheckoutSessionUpdateError:t=>e({checkoutSessionUpdateError:t})}));var P={};function N({amountMinorUnits:e,currency:t}){const n=B(t),r=e/Math.pow(10,n);return new Intl.NumberFormat(void 0,{style:"currency",currency:t}).format(r)}var f=(e=>(e.SORA="oiw216z",e.OPERATOR="vza493q",e.STUDENTS="students",e))(f||{}),m;const j={oiw216z:"".concat((m=P.VITE_OIW216Z_SERVICE_URL)!=null?m:"https://sora.com","/subscription"),vza493q:T,students:O(!0)};function F(e){return typeof e!="string"?!1:Object.values(f).includes(e)}async function V({checkout:e,processorEntity:t,planName:n,priceInterval:r,seatQuantity:o,promoCode:h,promoCampaign:y,annualBillingPlan:b,intl:a,currency:C}){if(!e)return;const{setIsRunningServerUpdate:l,abortController:c,setAbortController:_,setCelebrationBannerText:v,setCheckoutSessionUpdateError:d}=D.getState();d(null),s.addAction("update-business-checkout-session.initiated"),c==null||c.abort();const i=new AbortController;_(i);try{await e.runServerUpdate(async()=>{l(!0),await M.safePost("/payments/checkout/update",{requestBody:{checkout_session_id:e.id,processor_entity:t,plan_name:n,price_interval:r,seat_quantity:o,promo_code:h,promo_campaign:y},signal:i.signal})});const u=R=>a.formatNumber(R,{style:"currency",currency:C,currencyDisplay:"narrowSymbol",trailingZeroDisplay:"stripIfInteger"}),{monthlyCost:S,discountedMonthlyCost:E,currencySign:k,currencyCode:A}=b,g=(S-E)*o;v(r==="year"?a.formatMessage(x.businessAnnualPlanSavingsAmount,{currencyCode:a.formatMessage(A),currencySign:a.formatMessage(k),savingsAmountMonthly:u(g),savingsAmountYearly:u(g*12)}):null),s.addAction("update-business-checkout-session.success")}catch(u){i.signal.aborted||(s.addAction("update-business-checkout-session.error"),d(!0),s.addError("[Checkout] could not update checkout session",{error:u}))}finally{i.signal.aborted||l(!1)}}const I=(e,t)=>{var o;const n=w(e),r=t==null?void 0:t[0];if(!((o=r==null?void 0:r.recurring)!=null&&o.interval)){s.addError(new Error("CheckoutDisclaimer: missing first line item recurring interval"),{feature:"checkout",component:"CheckoutDisclaimer",message:"Expected first Stripe line item with a recurring interval but none was found.",checkout_has_line_items:!!(t!=null&&t.length),checkout_line_item_keys:r?Object.keys(r):void 0}),n.danger("Weâ€™re having trouble initializing your checkout right now. Please refresh the page and try again, or contact support if the problem persists.",{toastId:"checkout_disclaimer_missing_interval"});return}return{interval:r.recurring.interval==="month"?p.FLEXIBLE:p.ANNUAL,quantity:r.quantity}};export{j as C,f as a,D as b,N as f,I as g,F as i,V as u};
//# sourceMappingURL=e2bky2k6amgws3b2.js.map
