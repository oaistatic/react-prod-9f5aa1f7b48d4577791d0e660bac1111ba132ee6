const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j0yo6uv6652vva62.js","assets/i8clt0mfz495j7ii.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/ooz2slmm8agf6bjp.js","assets/gsyp9a9fup59ufmh.js","assets/n53zal3iykc1f21d.js","assets/lpw5mdsz36c07yc8.js","assets/c4ehfopmq8xhdt1q.js","assets/lt4xepsyd5h5p2k6.js","assets/7q3lthb03see7bq6.js","assets/m3rv0ba6uyyiphmo.js","assets/n9d2wxqrbrlf3kez.js","assets/kjtc3j1fwe13dpfg.js","assets/mf92tcvl1cj0iqby.js","assets/bci083mws0hai8bl.js","assets/d69imh1iyv32gaf9.js","assets/jgvrewhnjcf398o6.js","assets/2uk20wu2pu1737un.js","assets/d63jm146253lx3xq.js"])))=>i.map(i=>d[i]);
var Ze=Object.defineProperty,et=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var Re=(t,a)=>(a=Symbol[t])?a:Symbol.for("Symbol."+t);var Ie=(t,a,s)=>a in t?Ze(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,z=(t,a)=>{for(var s in a||(a={}))st.call(a,s)&&Ie(t,s,a[s]);if(Te)for(var s of Te(a))at.call(a,s)&&Ie(t,s,a[s]);return t},$=(t,a)=>et(t,tt(a));var be=(t,a,s)=>(a=t[Re("asyncIterator")])?a.call(t):(t=t[Re("iterator")](),a={},s=(n,r)=>(r=t[n])&&(a[n]=o=>new Promise((i,m,f)=>(o=r.call(t,o),f=o.done,Promise.resolve(o.value).then(h=>i({value:h,done:f}),m)))),s("next"),s("return"),a);import{e as k,j as e,M as u,r as c,_ as N,b as nt,f as De,k as rt,d as ot}from"./i8clt0mfz495j7ii.js";import{o as E,L as C,$ as q,B as it,C as We,d as Be,u as Se,h as ce,T as le,jk as qe,j as lt,J as ct,cF as He,aV as mt,ay as dt,af as ut,ag as ft,e as ht,d_ as pt,a5 as gt,et as xt}from"./ghewn7l2ynbm32fm.js";import{R as vt,u as bt,A as wt,a as jt,N as yt,I as St,b as Mt}from"./oivsnq7jwiwk2uhr.js";import{u as kt}from"./k0yjsblyrvonk8x1.js";import{o as te,x as y,mZ as Nt,kG as Et,dV as ze,aF as Ct,dp as Le}from"./j0yo6uv6652vva62.js";import{F as P}from"./hp8el4cmh5hx2ts0.js";import{W as Ue,j as _t}from"./g5lgy1otfli5p2x7.js";import{S as $e}from"./mq11hu99eist2abq.js";import{A as ye}from"./zul7780usssm7kro.js";import{i as Ge}from"./o6tyvbjf9zh9qku3.js";import{u as At}from"./mqebxepg7t6q2tie.js";import{u as Vt}from"./on3wbdiot3wz4dn8.js";import{b as Tt}from"./lptwpbjabrvjmhsj.js";import{u as Rt}from"./kzwmj5bk0a8ido2q.js";import{u as It,a as Lt,b as F}from"./kmbpv6g63y0ugt37.js";function Ft({onChange:t,value:a}){const s=k();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.descriptionSection.label",defaultMessage:"Description"})}),e.jsx("textarea",{name:"description","aria-label":s.formatMessage({id:"wham.environment.descriptionSection.description",defaultMessage:"Environment Description"}),placeholder:s.formatMessage({id:"wham.environment.descriptionSection.descriptionPlaceholder",defaultMessage:"1-2 sentence description"}),className:"border-token-border-heavy focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary h-16 max-h-48 w-full resize-none rounded-md border px-3 py-2 text-sm shadow-none focus-within:ring-1",value:a,onChange:n=>t(n.target.value)})]})}function Ot({repositoryId:t,existingEnvironment:a,setRepositoryName:s}){var r;const n=(r=a.repo_map)==null?void 0:r[t];return c.useEffect(()=>{n&&s(n.name)},[n,s]),n?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.repositorySection.label",defaultMessage:"Repository"})}),e.jsx("div",{className:"border-token-border-heavy bg-token-bg-primary pointer-events-none rounded-lg border p-3",children:e.jsx(vt,{repository:n,className:"pointer-events-none p-1",isSelected:!0})})]}):e.jsx("div",{className:"text-token-text-secondary flex h-full items-center text-sm",children:e.jsx(u,{id:"wham.createEnvironments.repositorySection.unavailable",defaultMessage:"Repository unavailable"})})}function Xe(t,a,s,n,r){const o=t.clipboardData.getData("text/plain"),i=Wt(o);if(i.length!==0){t.preventDefault(),s(a,r(i[0]));for(const m of i.slice(1))n(r(m))}}function Pt(t,a,s,n){Xe(t,a,s,n,r=>r)}function Dt(t,a,s,n){Xe(t,a,s,n,r=>$(z({},r),{isEditing:!1}))}function Wt(t){const a=[];for(let s of t.split(/\r?\n/)){if(s=s.trim(),!s||s.startsWith("#")||s.startsWith(";"))continue;s.startsWith("export ")&&(s=s.slice(7).trim());let n=!1,r=!1,o=!1,i=-1;for(let x=0;x<s.length;x++){const d=s[x];if(o){o=!1;continue}if(d==="\\"){o=!0;continue}if(d==="'"&&!r){n=!n;continue}if(d==='"'&&!n){r=!r;continue}if(d==="#"&&!n&&!r){i=x;break}}if(i!==-1&&(s=s.slice(0,i).trim()),!s)continue;n=r=o=!1;let m=-1;for(let x=0;x<s.length;x++){const d=s[x];if(o){o=!1;continue}if(d==="\\"){o=!0;continue}if(d==="'"&&!r){n=!n;continue}if(d==='"'&&!n){r=!r;continue}if(d==="="&&!n&&!r){m=x;break}}if(m===-1)continue;const f=s.slice(0,m).trim();if(!f)continue;let h=s.slice(m+1).trim();(h.startsWith('"')&&h.endsWith('"')||h.startsWith("'")&&h.endsWith("'"))&&(h=h.slice(1,-1)),a.push({key:f,value:h})}return a}const Bt=E(()=>N(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yq),__vite__mapDeps([0,1,2,3,4])),{loading:t=>C(t)});function qt({pushValue:t,removeValue:a,changeValue:s,values:n}){const r=k();return e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.envVarsSection.label",defaultMessage:"Environment variables"})}),n.map((o,i)=>o.key.startsWith("CODEX_ENV_")?null:e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsx("div",{className:"flex w-full flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx(te,{name:"envVars[".concat(i,"].key"),color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:o.key,onPaste:m=>Pt(m,i,s,t),onChange:m=>{s(i,$(z({},o),{key:m.target.value}))},placeholder:r.formatMessage({id:"wham.envVarsSection.keyPlaceholder",defaultMessage:"Key"}),ariaLabel:r.formatMessage({id:"wham.envVarsSection.keyAria",defaultMessage:"Environment variable key"})}),e.jsx(te,{name:"envVars[".concat(i,"].value"),className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",containerInputClassName:"w-full",color:"search",value:o.value,onChange:m=>{s(i,$(z({},o),{value:m.target.value}))},placeholder:r.formatMessage({id:"wham.envVarsSection.value",defaultMessage:"Value"}),ariaLabel:r.formatMessage({id:"wham.envVarsSection.environmentVariableValue",defaultMessage:"Environment variable value"})}),e.jsx(q,{type:"button",size:"small",color:"secondary",onClick:()=>a(i),"aria-label":r.formatMessage({id:"wham.createEnvironments.envVarsSection.deleteAriaLabel",defaultMessage:"Button to remove environment variable"}),children:e.jsx(u,{id:"wham.createEnvironments.envVarsSection.delete",defaultMessage:"Delete"})})]})})},i)),e.jsx("div",{className:"pt-2",children:e.jsx(q,{color:"secondary",size:"small",onClick:()=>{t({key:"",value:""})},type:"button",className:"w-fit","aria-label":r.formatMessage({id:"wham.createEnvironments.envVarsSection.addAriaLabel",defaultMessage:"Button to add another environment variable"}),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{id:"wham.createEnvironments.envVarsSection.add",defaultMessage:"Add"}),e.jsx(Bt,{className:"icon-sm"})]})})})]})}const Ht=c.memo(qt);function zt({value:t=[],onChange:a,onBlur:s,disabled:n}){const r=k(),o=c.useMemo(()=>t==null?void 0:t.join("\n"),[t]);return e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironment.shareTargets.label",defaultMessage:"Add additional editors"})}),e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironment.shareTargets.helper",defaultMessage:"Add one email per line. Users will be able to edit or delete this environment, or add and remove editors. The environment creator, and ChatGPT Workspace Admins, always have edit access."})})]}),e.jsx("textarea",{name:"shareTargets","aria-label":r.formatMessage({id:"wham.createEnvironment.shareTargets.ariaLabel",defaultMessage:"Environment share target emails"}),placeholder:r.formatMessage({id:"wham.createEnvironment.shareTargets.placeholder",defaultMessage:"user@example.com"}),className:"border-token-border-heavy focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary h-20 resize-y rounded-md border px-3 py-2 text-sm shadow-none focus-within:ring-1",value:o,onChange:i=>{a(i.target.value.split(/\r?\n/))},onBlur:s,disabled:n})]})}const Ut=E(()=>N(()=>import("./ooz2slmm8agf6bjp.js").then(t=>t._),__vite__mapDeps([5,1])),{loading:t=>C(t)}),$t=E(()=>N(()=>import("./gsyp9a9fup59ufmh.js").then(t=>t._),__vite__mapDeps([6,1])),{loading:t=>C(t)});function Gt({value:t,onChange:a}){const s=k(),n=it(),r=n==null?void 0:n.name,o=r!=null?r:s.formatMessage({id:"wham.createEnvironment.workspaceName",defaultMessage:"Workspace"});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironment.environmentVisibility",defaultMessage:"Sharing"})}),e.jsxs(y.Root,{value:t,onValueChange:a,children:[e.jsx(y.Trigger,{className:"border-token-border-heavy bg-token-bg-primary flex w-fit rounded-md border","aria-label":s.formatMessage({id:"wham.createEnvironment.openVisibilityMenu",defaultMessage:"Open sharing menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(y.Value,{placeholder:s.formatMessage({id:"wham.createEnvironment.selectVisibility",defaultMessage:"Select visibility"})})}),e.jsx(y.Icon,{})]})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{align:"start",children:[e.jsx(y.Item,{value:"private",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ut,{"aria-hidden":!0,className:"icon-sm me-1.5"}),e.jsx(u,{id:"wham.createEnvironment.private",defaultMessage:"Only you"})]})}),e.jsx(y.Item,{value:"workspace",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($t,{"aria-hidden":!0,className:"icon-sm me-1.5"}),e.jsx(u,{id:"wham.createEnvironment.sharedWithWorkspace",defaultMessage:"Shared with {workspaceName}",values:{workspaceName:o}})]})})]})})]}),t==="workspace"&&e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironments.workspace.onlyYouCanEdit",defaultMessage:"Workspace members can launch tasks with this environment. Only you, ChatGPT Workspace Admins, and any additional editors can make changes."})})]})}const Xt=c.memo(Gt);function Yt({onChange:t,value:a}){const s=k();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.label",defaultMessage:"Name"})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(te,{name:"label",ariaLabel:s.formatMessage({id:"wham.labelSection.envAria",defaultMessage:"Environment name"}),placeholder:s.formatMessage({id:"wham.labelSection.namePlaceholder",defaultMessage:"Name"}),containerInputClassName:"w-full",className:"flex h-8 w-full items-center rounded-md!",inputClassName:"w-full text-sm",color:"search",value:a,onChange:n=>t(n.target.value)})})]})}const Kt=c.memo(Yt),Jt=E(()=>N(()=>import("./n53zal3iykc1f21d.js"),__vite__mapDeps([7,1])),{loading:t=>C(t)}),Qt=E(()=>N(()=>import("./lpw5mdsz36c07yc8.js"),__vite__mapDeps([8,1])),{loading:t=>C(t)}),Zt=E(()=>N(()=>import("./c4ehfopmq8xhdt1q.js"),__vite__mapDeps([9,1])),{loading:t=>C(t)}),es=E(()=>N(()=>import("./lt4xepsyd5h5p2k6.js"),__vite__mapDeps([10,1])),{loading:t=>C(t)}),ts=E(()=>N(()=>import("./7q3lthb03see7bq6.js"),__vite__mapDeps([11,1])),{loading:t=>C(t)}),ss=E(()=>N(()=>import("./m3rv0ba6uyyiphmo.js"),__vite__mapDeps([12,1])),{loading:t=>C(t)}),as=E(()=>N(()=>import("./n9d2wxqrbrlf3kez.js"),__vite__mapDeps([13,1])),{loading:t=>C(t)}),ns=E(()=>N(()=>import("./kjtc3j1fwe13dpfg.js"),__vite__mapDeps([14,1])),{loading:t=>C(t)}),rs=E(()=>N(()=>import("./mf92tcvl1cj0iqby.js"),__vite__mapDeps([15,1])),{loading:t=>C(t)}),Ye=[{key:"python",icon:es,label:"Python",envVar:"CODEX_ENV_PYTHON_VERSION",versions:["3.13","3.12","3.11","3.10"],defaultVersion:"3.12"},{key:"nodejs",icon:ss,label:"Node.js",envVar:"CODEX_ENV_NODE_VERSION",versions:["22","20","18"],defaultVersion:"20"},{key:"ruby",icon:Zt,label:"Ruby",envVar:"CODEX_ENV_RUBY_VERSION",versions:["3.2.3","3.3.8","3.4.4"],defaultVersion:"3.4.4"},{key:"rust",icon:Qt,label:"Rust",envVar:"CODEX_ENV_RUST_VERSION",versions:["1.89.0","1.88.0","1.87.0","1.86.0","1.85.1","1.84.1","1.83.0"],defaultVersion:"1.89.0"},{key:"go",icon:ns,label:"Go",envVar:"CODEX_ENV_GO_VERSION",versions:["1.24.3","1.23.8","1.22.12"],defaultVersion:"1.24.3"},{key:"bun",icon:rs,label:"Bun",envVar:"CODEX_ENV_BUN_VERSION",versions:["1.2.14"],defaultVersion:"1.2.14"},{key:"php",icon:ts,label:"PHP",envVar:"CODEX_ENV_PHP_VERSION",versions:["8.4","8.3","8.2"],defaultVersion:"8.4"},{key:"java",icon:as,label:"Java",envVar:"CODEX_ENV_JAVA_VERSION",versions:["21"],defaultVersion:"21"},{key:"swift",icon:Jt,label:"Swift",envVar:"CODEX_ENV_SWIFT_VERSION",versions:["6.1","5.10"],defaultVersion:"6.1"}],ra=Ye.map(t=>({key:t.envVar,value:t.defaultVersion}));function os({selectedVersion:t,setSelectedVersion:a,versions:s,defaultVersion:n}){const r=k();return e.jsxs(y.Root,{value:t!=null?t:"",onValueChange:a,children:[e.jsx(y.Trigger,{className:"border-token-border-default bg-token-bg-primary! w-48 rounded-md! border","aria-label":r.formatMessage({id:"wham.createEnvironments.languageSelector.openVersionMenu",defaultMessage:"Open version menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(y.Value,{placeholder:r.formatMessage({id:"wham.createEnvironments.languageSelector.selectVersion",defaultMessage:"Select version"})}),e.jsx(y.Icon,{})]})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{align:"start",children:[s.map(o=>e.jsx(y.Item,{value:o,children:e.jsx("p",{className:Be("text-token-text-primary text-sm",o===n?"font-semibold":"font-normal"),children:o})},o)),s.length===1&&e.jsx("div",{className:"flex w-full items-center justify-center p-4",children:e.jsx("p",{className:"text-token-text-primary text-sm",children:r.formatMessage({id:"wham.createEnvironments.languageSelector.noVersions",defaultMessage:"No other versions available"})})})]})})]})}function is({icon:t,language:a,versions:s,defaultVersion:n,selectedVersion:r,setSelectedVersion:o}){return e.jsxs("div",{className:"flex items-center justify-between gap-2 pe-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"icon"}),e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:a})]}),e.jsx(os,{defaultVersion:n,selectedVersion:r,setSelectedVersion:o,versions:s})]})}function ls(t,a){var r,o;const s=t.split(".").map(Number),n=a.split(".").map(Number);for(let i=0;i<Math.max(s.length,n.length);i++){const m=(r=s[i])!=null?r:0,f=(o=n[i])!=null?o:0;if(m!==f)return f-m}return 0}function cs({onClose:t,envVars:a,pushValue:s,replaceValue:n}){const r=o=>i=>{const m=a.findIndex(f=>f.key===o);m!==-1?n(m,$(z({},a[m]),{value:i})):s({key:o,value:i})};return e.jsx(We,{isOpen:!0,onClose:t,type:"success",testId:"modal-language-selector-modal",showCloseButton:!0,className:"max-w-screen-xs",title:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(u,{id:"wham.languageModal.languageSelector.title",defaultMessage:"Preinstalled packages"}),e.jsx("p",{className:"text-token-text-secondary text-sm font-normal",children:e.jsx(u,{id:"wham.languageModal.languageSelector.description",defaultMessage:"Configure your own packages in the setup script."})})]}),children:e.jsx("div",{className:"flex flex-col gap-4",children:Ye.map(o=>{var f;const i=[...o.versions],m=(f=a.find(h=>h.key===o.envVar))==null?void 0:f.value;return m&&!i.includes(m)&&i.push(m),i.sort(ls),e.jsx(is,{icon:o.icon,language:o.label,versions:i,selectedVersion:m!=null?m:o.defaultVersion,defaultVersion:o.defaultVersion,setSelectedVersion:h=>r(o.envVar)(h)},o.envVar)})})})}const ie=64,we=512,ms="<REDACTED>",Fe=[{id:"wham-public/wham-universal",label:"universal"}];function ds({selectedMachineId:t,setSelectedMachineId:a}){const s=k(),{data:n}=nt({queryKey:["wham","machines"],queryFn:()=>Ue.getMachines()}),r=c.useMemo(()=>{const i=Array.isArray(n)?n:[],m=new Set(Fe.map(h=>h.id));return[...i.filter(h=>!m.has(h.id)),...Fe]},[n]);c.useEffect(()=>{!t&&r.length&&a(r[0].id)},[t,a,r]);const o=i=>{a(i)};return e.jsxs(y.Root,{value:t!=null?t:"",onValueChange:o,children:[e.jsx(y.Trigger,{className:"border-token-border-default! bg-token-bg-primary! w-48 rounded-md! border","aria-label":s.formatMessage({id:"wham.machineSelectorPopover.openMachineMenu",defaultMessage:"Open machine menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(y.Value,{placeholder:s.formatMessage({id:"wham.machineSelectorPopover.selectMachine",defaultMessage:"Select machine"})}),e.jsx(y.Icon,{})]})}),e.jsx(y.Portal,{children:e.jsx(y.Content,{align:"start",className:"bg-token-bg-primary",children:e.jsx(us,{machines:r})})})]})}function us({machines:t}){return e.jsxs("div",{className:"bg-token-bg-primary flex max-h-[400px] w-full flex-col gap-2 overflow-y-auto rounded-lg p-2",children:[t.length>0?t.map(a=>e.jsx(y.Item,{value:a.id,children:a.label},a.id)):e.jsx("div",{className:"p-2 text-center",children:e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(u,{id:"wham.createEnvironments.machineSelector.noMatchesFound",defaultMessage:"No matches found"})})}),t.length===1&&e.jsx("div",{className:"p-2 text-start",children:e.jsx("p",{className:"text-token-text-tertiary ps-2 text-xs",children:e.jsx(u,{id:"wham.createEnvironments.machineSelector.noMachinesFound",defaultMessage:"Custom images coming soon"})})})]})}const fs=E(()=>N(()=>import("./bci083mws0hai8bl.js").then(t=>t._),__vite__mapDeps([16,1])),{loading:t=>C(t)});function hs({selectedMachineId:t,setSelectedMachineId:a,envVars:s,pushValue:n,replaceValue:r}){const o=k(),[i,m]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.machineSelector",defaultMessage:"Container image"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ds,{selectedMachineId:t,setSelectedMachineId:a}),e.jsx(q,{color:"secondary",size:"medium",type:"button",icon:fs,onClick:()=>{m(!0)},"aria-label":o.formatMessage({id:"wham.createEnvironments.languageSelector.titleAriaLabel",defaultMessage:"Button to open preinstalled packages modal"}),className:"w-fit",children:e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.languageSelector.title",defaultMessage:"Preinstalled packages"})})})]})]}),i&&e.jsx(cs,{onClose:()=>m(!1),envVars:s,pushValue:n,replaceValue:r})]})}const ps=c.memo(hs),fe=De({toggleOffLabel:{id:"wham.postSetupCaching.off",defaultMessage:"Off"},toggleOnLabel:{id:"wham.postSetupCaching.on",defaultMessage:"On"},toggleOffAriaLabel:{id:"wham.postSetupCaching.offAriaLabel",defaultMessage:"Toggle to turn off post setup caching"},toggleOnAriaLabel:{id:"wham.postSetupCaching.onAriaLabel",defaultMessage:"Toggle to turn on post setup caching"}});function gs({cacheSettings:t,onChange:a}){const s=k();return e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.postSetupCaching.title",defaultMessage:"Container Caching"})}),e.jsx("p",{className:"text-token-text-tertiary mb-1 text-xs",children:e.jsx(u,{id:"wham.postSetupCaching.description",defaultMessage:"Speed up container start by caching state after running the setup script. Maintenance scripts are run before every task."})}),e.jsx($e,{className:"max-w-32",ariaLabel:s.formatMessage({id:"wham.postSetupCachingToggle.label",defaultMessage:"Container Caching"}),value:t!=null&&t.post_setup_cache_enabled?"on":"off",onChange:n=>a({post_setup_cache_enabled:n==="on"}),leftItem:{ariaLabel:s.formatMessage(fe.toggleOffAriaLabel),label:s.formatMessage(fe.toggleOffLabel),value:"off"},rightItem:{ariaLabel:s.formatMessage(fe.toggleOnAriaLabel),label:s.formatMessage(fe.toggleOnLabel),value:"on"}})]})}const xs=c.memo(gs),vs=E(()=>N(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yq),__vite__mapDeps([0,1,2,3,4])),{loading:t=>C(t)});function bs({value:t,index:a,pushValue:s,changeValue:n,removeValue:r}){const o=k();return e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsx("div",{className:"flex w-full flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx(te,{name:"secrets[".concat(a,"].key"),color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:t.key,onPaste:i=>Dt(i,a,n,s),onChange:i=>{n(a,$(z({},t),{key:i.target.value}))},placeholder:o.formatMessage({id:"wham.secretsSection.keyPlaceholder",defaultMessage:"Key"}),ariaLabel:o.formatMessage({id:"wham.secretsSection.keyAria",defaultMessage:"Secret Key"})}),e.jsx(te,{name:"secrets[".concat(a,"].value"),className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",containerInputClassName:"w-full",color:"search",type:"password",value:t.value,onChange:i=>{n(a,$(z({},t),{value:i.target.value}))},placeholder:o.formatMessage({id:"wham.secretsSection.value",defaultMessage:"Value"}),ariaLabel:o.formatMessage({id:"wham.secretsSection.secretValue",defaultMessage:"Secret Value"})}),e.jsx(q,{type:"button",size:"small",color:"secondary",onClick:()=>r(a),"aria-label":o.formatMessage({id:"wham.createEnvironments.secretsSection.deleteAriaLabel",defaultMessage:"Button to remove secret"}),children:e.jsx(u,{id:"wham.createEnvironments.secretsSection.delete",defaultMessage:"Delete"})})]})})})}function ws({pushValue:t,removeValue:a,changeValue:s,values:n}){const r=k();return e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.secretsSection",defaultMessage:"Secrets"})}),n.map((o,i)=>e.jsx(bs,{value:o,index:i,pushValue:t,changeValue:s,removeValue:a},i)),e.jsx("div",{className:"pt-2",children:e.jsx(q,{color:"secondary",size:"small",onClick:()=>{t({key:"",value:"",isEditing:!1})},type:"button",className:"w-fit","aria-label":r.formatMessage({id:"wham.createEnvironments.secretsSection.addAriaLabel",defaultMessage:"Button to add another secret"}),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{id:"wham.createEnvironments.secretsSection.add",defaultMessage:"Add"}),e.jsx(vs,{className:"icon-sm"})]})})})]})}const js=c.memo(ws),ys="# e.g.\npip install -r requirements.txt\nnpm install\n./run/maintenance_setup.sh\n";function Ss({script:t,onChange:a}){const s=k(),n=Math.min(10,Math.max(4,t.split("\n").length));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.maintenanceSetupCommandsSection",defaultMessage:"Maintenance script"})})}),e.jsx("div",{className:"flex items-center gap-2 pt-2",children:e.jsx("textarea",{name:"setupCommands",className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary min-h-32 w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:t,rows:n,onChange:r=>{a(r.target.value)},placeholder:ys,"aria-label":s.formatMessage({id:"wham.maintenanceSetupCommandsSection.maintenanceSetupCommand",defaultMessage:"Maintenance Setup Command"})})}),e.jsx("p",{className:"text-token-text-tertiary pt-2 text-xs",children:e.jsx(u,{id:"wham.createEnvironments.maintenanceSetupCommandsSection.description",defaultMessage:"The maintenance script is run in containers that were resumed from the cache, after checking out the branch.{br}<strong>Network access is always enabled for this step.</strong>",values:{br:e.jsx("br",{}),strong:r=>e.jsx("span",{className:"font-semibold",children:r})}})})]})}const Ms=c.memo(Ss),Oe=E(()=>N(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yq),__vite__mapDeps([0,1,2,3,4])),{loading:t=>C(t)}),ks="# e.g.\npip install -r requirements.txt\nnpm install\n./run/setup.sh\n",he=De({toggleAutomaticLabel:{id:"wham.autoSetup.automatic",defaultMessage:"Automatic"},toggleManualLabel:{id:"wham.autoSetup.manual",defaultMessage:"Manual"},toggleAutomaticAriaLabel:{id:"wham.autoSetup.automaticAriaLabel",defaultMessage:"Toggle to turn on automatic setup"},toggleManualAriaLabel:{id:"wham.autoSetup.manualAriaLabel",defaultMessage:"Toggle to turn on auto setup"}});function Ns({value:t,onChangeAutoSetupSettings:a}){const s=k();return e.jsx($e,{className:"max-w-64",ariaLabel:s.formatMessage({id:"wham.autoSetup.label",defaultMessage:"Auto setup"}),value:t?"on":"off",onChange:n=>{a(n==="off"?{use_auto_setup:!0}:{use_auto_setup:!1})},leftItem:{ariaLabel:s.formatMessage(he.toggleAutomaticAriaLabel),label:s.formatMessage(he.toggleAutomaticLabel),value:"off"},rightItem:{ariaLabel:s.formatMessage(he.toggleManualAriaLabel),label:s.formatMessage(he.toggleManualLabel),value:"on"}})}function Es({setupScript:t,maintenanceScript:a,onSetupScriptChange:s,onMaintenanceScriptChange:n,setupScriptChildren:r,maintenanceScriptChildren:o,onClickAppendReplHistory:i,inputRef:m,replCommandHistory:f,suggestedCommand:h,onClickAcceptSuggestedCommand:x,autoSetupSettings:d,onChangeAutoSetupSettings:M,postSetupCacheEnabled:T}){var b;const w=Se(),R=k(),D=ce(w,"1535847699"),j=ce(w,"3899518838"),_=t===""&&d==null,S=(b=D&&(d==null?void 0:d.use_auto_setup))!=null?b:_;return e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.setupCommandsSection",defaultMessage:"Setup script"})}),!S&&e.jsx(e.Fragment,{children:h?e.jsx(le,{className:"-my-2.5 block",label:R.formatMessage({id:"wham.createEnv.terminal.addCommandSuggestion",defaultMessage:"Add suggestion to setup script"}),children:e.jsx(q,{type:"button",color:"secondary",size:"small",onClick:x,icon:Oe,children:e.jsx("span",{className:"max-w-[200px] truncate font-mono text-xs",children:h.trimEnd().replace("\n","; ")})})}):f.length>0?e.jsx(le,{className:"-my-2.5 block",label:R.formatMessage({id:"wham.createEnv.terminal.addCommands",defaultMessage:"Add commands you've run to the setup script"}),children:e.jsx(q,{type:"button",color:"secondary",size:"small",onClick:i,icon:Oe,children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.addToSetupScript",defaultMessage:"New commands ({count})",values:{count:f.length}})})}):null})]}),D&&e.jsx(Ns,{value:!S,onChangeAutoSetupSettings:M}),S&&e.jsx("p",{className:"text-token-text-tertiary mb-1 text-xs",children:e.jsx(u,{id:"wham.autoSetup.description",defaultMessage:"Runs the install commands like npm install for common package managers. <docs>Learn more.</docs>",values:{docs:A=>e.jsx("a",{href:"https://platform.openai.com/docs/codex/overview#setup-scripts",target:"_blank",rel:"noopener noreferrer",className:"underline",children:A})}})}),!S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 pt-2",children:e.jsx("textarea",{ref:m,name:"setupCommands",className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary min-h-32 w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:t,rows:Math.min(10,Math.max(4,t.split("\n").length)),onChange:A=>{s(A.target.value)},placeholder:ks,"aria-label":R.formatMessage({id:"wham.setupCommandsSection.setupCommand",defaultMessage:"Setup Command"})})}),e.jsx("p",{className:"text-token-text-tertiary pt-2 text-xs",children:T?e.jsx(u,{id:"wham.createEnvironments.setupCommandsSection.withCachingDescription",defaultMessage:"The setup script is run after creating new containers, after the repo is cloned.{br}<strong>Network access is always enabled for this step.</strong>",values:{br:e.jsx("br",{}),strong:A=>e.jsx("span",{className:"font-semibold",children:A})}}):e.jsx(u,{id:"wham.createEnvironments.setupCommandsSection.description",defaultMessage:"The setup script is run at the start of every task, after the repo is cloned.{br}<strong>Network access is always enabled for this step.</strong>",values:{br:e.jsx("br",{}),strong:A=>e.jsx("span",{className:"font-semibold",children:A})}})}),r]}),j&&T&&!S&&e.jsxs(e.Fragment,{children:[e.jsx(Ms,{script:a,onChange:n}),o]})]})}const Cs=c.memo(Es);function _s(t,a){const s={};for(const{key:n,value:r}of t){const o=a[n];o===void 0?r!==""&&(s[n]=r):r!==ms&&r!==o&&(s[n]=r)}for(const n of Object.keys(a))t.some(r=>r.key===n)||(s[n]=null);return s}function As({onSuggestCommand:t}){const a=k(),[s,n]=c.useState([]),[r,o]=c.useState(null),[i,m]=c.useState(!1),[f,h]=c.useState(null),x=c.useRef(null),d=c.useCallback(async w=>{try{try{for(var R=be(w),D,j,_;D=!(j=await R.next()).done;D=!1){const S=j.value;const b=Ke(S);if(!b)continue;const A=b.type;switch(A){case"client_error":case"server_error":o(b.message);break;case"log":{if(b.key==="heartbeat")break;if(b.key==="suggest_command")t(b.line);else if(b.key.startsWith("userscript_")){const[,V]=b.key.split("_"),I=Number(V);if(!Number.isFinite(I))return;b.line.startsWith("+ ")?n(p=>[...p,{messageType:"user",line:b.line.slice(2),scriptIndex:I}]):n(p=>[...p,{messageType:"output",line:b.line,scriptIndex:I}])}else b.line.startsWith("+ ")?n(V=>[...V,{messageType:"server",line:b.line.slice(2)}]):n(V=>[...V,{messageType:"output",line:b.line}]);break}case"test_session_started":h(b.test_session_id);break;default:qe(A)}}}catch(j){_=[j]}finally{try{D&&(j=R.return)&&await j.call(R)}finally{if(_)throw _[0]}}}catch(S){if(Ge(S))return;if(S instanceof lt&&S.status===429){o(a.formatMessage({id:"wham.useStreamTestEnv.errorRateLimited",defaultMessage:"Too many requests: Your environment didn't start because we're at capacity. Try again soon."}));return}o(a.formatMessage({id:"wham.useStreamTestEnv.errorConnecting",defaultMessage:"Error connecting to the test environment"}))}finally{m(!1)}},[a,t]),M=async(w,R,D={})=>{x.current=new AbortController,n([]),m(!0),o(null),h(null);const _="".concat(window.location.origin+"/backend-api","/wham/environments/test"),S=_s(w.secrets,D),b=w.envVars.reduce((p,W)=>(p[W.key]=W.value,p),{}),A=await Nt("codex_environment_test").catch(p=>{ct.addError(p)}),V=z($(z({},He({isAuthOptional:!1})),{"Content-Type":"application/json"}),Et(null,null,null,A)),I=ze(_,{method:"POST",body:{environment_id:R,machine_id:w.machine,repos:[w.repositoryId],setup:[w.setupCommands],maintenance_setup:[w.maintenanceSetupCommands],workspace_dir:w.workspaceDirectory,agent_network_access:w.agentNetworkAccess,secrets:S,env_vars:b,auto_setup_settings:w.autoSetupSettings},signal:x.current.signal,headers:V,observer:{onClose:(p,W)=>{m(!1),p==="error"&&W instanceof Error&&o(W.message)}}});(async()=>await d(I))()},T=c.useCallback(()=>{var w;(w=x.current)==null||w.abort(),n(R=>[...R,{messageType:"output",line:"Test cancelled"}])},[]);return c.useEffect(()=>()=>{var w;(w=x.current)==null||w.abort()},[]),{messages:s,error:r,setError:o,isStreaming:i,startTestEnvironment:M,abortTestEnvironment:T,testSessionId:f,setTestSessionId:h}}function Ke(t){return!("data"in t)||!t.data?null:t.data}function Vs({testSessionId:t,replOutput:a,inputRef:s,setReplOutput:n,setError:r,onSetConnected:o,onSubmitCommand:i}){const m=k(),[f,h]=c.useState(""),x=c.useCallback(({command:j})=>{t&&Ue.runEnvironmentTestCommand({command:j,testSessionId:t})},[t]),d=c.useCallback(async j=>{try{try{for(var _=be(j),S,b,A;S=!(b=await _.next()).done;S=!1){const V=b.value;const I=Ke(V);if(!I)continue;const p=I.type;switch(p){case"client_error":case"server_error":r(I.message);break;case"log":{const G=Ls(I.line).replace(/\x1b\].*?\x07/g,"").replace(/\x1b\[\?2004[hl]/g,"");n(se=>[...se,G]);break}case"test_session_started":break;default:qe(p)}}}catch(b){A=[b]}finally{try{S&&(b=_.return)&&await b.call(_)}finally{if(A)throw A[0]}}}catch(V){if(Ge(V))return;r(m.formatMessage({id:"wham.envTestRepl.error",defaultMessage:"Error connecting to the test environment"}))}},[m,r,n]),{connected:M}=Rs({testSessionId:t,processStream:d,setError:r});c.useEffect(()=>{o(M)},[M,o,n]),c.useEffect(()=>{t||n([])},[t,n]);const T=c.useRef(null),w=a.map((j,_)=>e.jsx(ye,{children:j.replace(/\x1b\].*?\x07/g,"")},_)),[R,D]=c.useState(!1);return t?e.jsxs("div",{className:"flex w-full flex-col whitespace-pre",children:[w,e.jsxs("div",{className:"relative w-full p-0 text-[12px] leading-4 focus:ring-0",children:[e.jsxs("span",{"aria-hidden":!0,className:"flex min-h-4 min-w-2",children:[f,e.jsx("span",{className:"inline-block h-auto w-2",children:R?e.jsx("div",{className:"bg-token-text-primary h-full w-full"}):e.jsx(mt.div,{className:"bg-token-text-primary h-full w-full",animate:{opacity:[0,1,0]},transition:{type:"tween",ease:"easeInOut",duration:2,repeat:1/0}})})]}),e.jsx("input",{type:"text",className:"absolute h-[1px] w-[1px] opacity-0",disabled:!M,onChange:j=>h(j.target.value),onFocus:()=>D(!0),onBlur:()=>D(!1),onKeyDown:j=>{const _=Ts(j);if(_){j.preventDefault(),h(""),x({command:_});return}if(j.key==="Enter"){j.preventDefault(),h("");const S=f+"\n";i(S),x({command:S})}},value:f,ref:Ct(s,T)})]})]}):null}function Ts(t){return t.ctrlKey?t.key==="c"?"":t.key==="d"?"":null:null}function Rs({testSessionId:t,processStream:a,setError:s}){const[n,r]=c.useState(!1),o=c.useCallback(i=>{const f="".concat(window.location.origin+"/backend-api","/wham/environments/test/").concat(t,"/stream"),h=ze(f,{method:"POST",signal:i.signal,headers:$(z({},He({isAuthOptional:!1})),{"Content-Type":"application/json"}),observer:{onOpen:()=>{r(!0)},onClose:(x,d)=>{r(!1),x==="error"&&d instanceof Error&&s(d.message)}}});(async()=>await a(h))()},[t,a,s]);return c.useEffect(()=>{if(!t)return;const i=new AbortController;return o(i),()=>{i.abort()}},[t,o]),{connected:n}}const Is=new TextDecoder("utf-8");function Ls(t){const a=atob(t),s=a.length,n=new Uint8Array(s);for(let r=0;r<s;r+=1)n[r]=a.charCodeAt(r);return Is.decode(n)}const Fs=E(()=>N(()=>import("./d69imh1iyv32gaf9.js").then(t=>t._),__vite__mapDeps([17,1])),{loading:t=>C(t)}),Os=E(()=>N(()=>import("./jgvrewhnjcf398o6.js").then(t=>t._),__vite__mapDeps([18,1])),{loading:t=>C(t)}),Ps=E(()=>N(()=>import("./2uk20wu2pu1737un.js").then(t=>t._),__vite__mapDeps([19,1])),{loading:t=>C(t)});function Ds({formValues:t,initialSecrets:a,environmentId:s,onConnectedChange:n,onSubmitCommand:r,onSuggestCommand:o}){const i=k(),{messages:m,error:f,setError:h,abortTestEnvironment:x,isStreaming:d,startTestEnvironment:M,testSessionId:T,setTestSessionId:w}=As({onSuggestCommand:o}),[R,D]=c.useState([]),j=c.useRef(null),_=c.useRef(null),[S,b]=c.useState(!1);c.useEffect(()=>{b(!0)},[t]);const A=Se(),V=ce(A,"392240685")||!1,[I,p]=c.useState(!0);c.useEffect(()=>{if(j.current&&_.current&&I){const v=j.current,L=_.current;L.scrollTop=v.offsetTop-L.offsetTop-L.clientHeight/2+v.clientHeight/2}},[m,R,I]);const W=()=>{const v=_.current;if(!v)return;const L=Math.abs(v.scrollTop+v.clientHeight-v.scrollHeight)<2;p(L)},[G,se]=c.useState(!1),[X,me]=c.useState(!1),ae=()=>{se(!0),b(!1),w(null),M(t,s,a)},pe=v=>{me(v),n(v)};c.useEffect(()=>()=>n(!1),[]);const de=c.useRef(null),Y=!X&&!d,H=!Y&&S,Q=Y&&!G||H,K=!t.repositoryId,[J,U]=c.useState(!1),ge=e.jsx("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/20 dark:bg-white/5",onMouseUp:v=>v.stopPropagation(),onClick:async()=>{H&&(b(!1),U(!0),await new Promise(v=>setTimeout(v,3e3)),U(!1))},children:e.jsx(le,{open:K||H?void 0:!1,label:K?i.formatMessage({id:"wham.createEnv.terminal.selectRepo",defaultMessage:"Please select a repository"}):H?i.formatMessage({id:"wham.createEnv.terminal.restartTooltip",defaultMessage:"Changes will only be reflected after a restart."}):void 0,children:e.jsx(q,{onClick:ae,disabled:!t.repositoryId,type:"button",color:"primary-inverse",icon:Ps,children:H?e.jsx(u,{id:"wham.createEnvironments.terminalSection.reRunSetupScript",defaultMessage:"Re-run setup script"}):e.jsx(u,{id:"wham.createEnvironments.terminalSection.runSetupScript",defaultMessage:"Connect interactive terminal"})})})}),[{height:Z},ee]=At();return e.jsxs("div",{onMouseUp:v=>{var L,ne;(L=document.getSelection())!=null&&L.toString()||((ne=de.current)==null||ne.focus(),v.preventDefault())},className:"dark focus-within:ring-primary relative flex h-full w-full flex-col overflow-hidden rounded-xl ring-offset-2 focus-within:ring-2",children:[e.jsxs("div",{ref:ee,className:"bg-token-bg-tertiary flex shrink-0 flex-row justify-between p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection",defaultMessage:"Terminal"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[(X||!!f||G&&!d)&&e.jsx(le,{className:"flex",open:J?!0:void 0,label:i.formatMessage({id:"wham.createEnvironments.terminalSection.restartSessionTooltip",defaultMessage:"Restart terminal session"}),children:e.jsx(Le,{icon:e.jsx(Os,{className:"icon-sm"}),className:"-m-1 h-6! w-6!",onClick:ae,onMouseEnter:()=>U(!1),label:i.formatMessage({id:"wham.createEnvironments.terminalSection.restartSession",defaultMessage:"Restart session"})})}),d&&e.jsx(le,{className:"flex",open:J?!0:void 0,label:i.formatMessage({id:"wham.createEnvironments.terminalSection.cancelSessionTooltip",defaultMessage:"Cancel terminal session"}),children:e.jsx(Le,{icon:e.jsx(Fs,{className:"icon-sm"}),className:"-m-1 h-6! w-6!",onClick:x,label:i.formatMessage({id:"wham.createEnvironments.terminalSection.cancelSession",defaultMessage:"Cancel session"})})}),X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.connected",defaultMessage:"Connected"})}),e.jsx(je,{color:"#52EA00"})]}):d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.initializing",defaultMessage:"Initializing"})}),e.jsx(je,{color:"#FF9800"})]}):G?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.disconnected",defaultMessage:"Disconnected"})}),e.jsx(je,{color:"#FF0000"})]}):null]})]}),f&&e.jsxs("div",{style:{top:Z},className:"bg-token-bg-status-error text-token-text-status-error absolute start-0 end-0 top-0 z-20 flex flex-col gap-2 px-4 py-3 text-sm",children:[e.jsx("p",{className:"font-medium",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.error",defaultMessage:"Terminal errored"})}),e.jsx("p",{className:"font-mono text-xs",children:f})]}),Q&&ge,e.jsxs("div",{className:"bg-token-bg-secondary relative flex flex-1 flex-col overflow-y-auto p-4 font-mono text-xs text-white",onScroll:W,ref:_,children:[m.length===0&&!d&&e.jsx("p",{className:"text-token-text-tertiary",children:"".concat(t.workspaceDirectory," $")}),m.map((v,L)=>v.messageType==="user"?e.jsx(ye,{className:"text-token-text-tertiary",children:"â†’ "+v.line},L):v.messageType==="server"?e.jsx("p",{className:"text-token-text-tertiary",children:v.line}):e.jsx(ye,{children:v.line},L)),V&&e.jsx(Vs,{inputRef:de,testSessionId:T,replOutput:R,setReplOutput:D,setError:h,onSetConnected:pe,onSubmitCommand:r}),e.jsx("div",{ref:j})]})]})}function je({color:t}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"6",height:"6",viewBox:"0 0 6 6",fill:"none",className:"animate-pulse",children:e.jsx("circle",{cx:"3",cy:"3",r:"3",fill:t})})}function Ws({workspaceDirectory:t,repositoryName:a,onChange:s,onClose:n,errors:r}){const o=k(),[i,m]=c.useState(t),[f]=c.useState(t!=null?t:"/workspace"),h=o.formatMessage({id:"wham.createEnvironments.workspaceEditorModal.defaultRepositoryName",defaultMessage:"repository"}),x=o.formatMessage({id:"wham.editWorkspace.modal.title",defaultMessage:"Edit workspace"}),d=({forceClear:M}={})=>{(r.length>0||M)&&s(f),n()};return e.jsxs(We,{isOpen:!0,onClose:()=>d(),type:"success",testId:"modal-workspace-editor-modal",children:[e.jsxs(dt,{children:[e.jsx(ut,{children:x}),e.jsx(ft,{children:x})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-primary text-xl font-medium",children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.title",defaultMessage:"Edit workspace directory"})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(te,{name:"workspaceDirectory",value:i,onChange:M=>{m(M.target.value),s(M.target.value)},inputClassName:"w-full",containerInputClassName:"w-full",color:"quaternary",ariaLabel:o.formatMessage({id:"wham.createEnvironments.workspaceEditorModal.inputAriaLabel",defaultMessage:"Workspace directory"})})}),r.length>0&&e.jsx("div",{className:"flex flex-col gap-2",children:r.map(M=>e.jsx("div",{className:"text-token-text-status-error text-xs",children:M},M))}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.description",defaultMessage:"The repository will be cloned to {workspaceDirectory}/{repositoryName}. You only need to adjust this if your code requires an absolute install path.",values:{repositoryName:a!=null?a:h,workspaceDirectory:t!=null?t:f}})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{color:"secondary",onClick:()=>d({forceClear:!0}),children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.cancelButton",defaultMessage:"Cancel"})}),e.jsx(q,{onClick:()=>n(),disabled:r.length>0,children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.saveButton",defaultMessage:"Save"})})]})]})]})}const Bs=c.memo(Ws),qs=E(()=>N(()=>import("./d63jm146253lx3xq.js").then(t=>t._),__vite__mapDeps([20,1])),{loading:t=>C(t)});function Pe({current:t,max:a,className:s}){return e.jsx("span",{className:"text-xs ".concat(t>a?"text-token-text-status-error":"text-token-text-tertiary"," ").concat(s!=null?s:"").trim(),children:e.jsx(u,{id:"wham.characterCount.display",defaultMessage:"{current}/{max}",values:{current:t,max:a}})})}function oa({initialEnvironmentId:t,initialValues:a,primaryButtonText:s,onSubmit:n,isPending:r,existingEnvironment:o}){var ke,Ne,Ee,Ce,_e,Ae,Ve;const[i,m]=c.useState(null),[f,h]=c.useState(null),{data:x}=_t(),d=k(),M=ht(),T=c.useRef(null),[w,R]=c.useState(!1),D=kt(),j=Vt(),[_,S]=c.useState(null),b=rt(),A=Se(),V=ce(A,"2134057841"),I=ce(A,"3899518838"),p=It({defaultValues:a,validators:{onSubmit:({value:l})=>{var B,oe;l.machine||(l.machine=a.machine);const g={};if(l.label.trim()||(g.label=d.formatMessage({id:"wham.environmentsForm.labelIsRequired",defaultMessage:"Label is required"})),l.label.length>ie&&(g.label=d.formatMessage({id:"wham.environmentsForm.labelMaxChars",defaultMessage:"Label must be at most {max} characters"},{max:ie})),x!=null&&x.find(O=>O.label===l.label&&O.id!==t)&&(g.label=d.formatMessage({id:"wham.environmentsForm.labelAlreadyExistsInYourAccountPleaseChooseAnotherName",defaultMessage:"An environment with this name already exists. Try choosing another name."})),l.repositoryId.trim()||(g.repositoryId=d.formatMessage({id:"wham.environmentsForm.repositoryRequired",defaultMessage:"Repository is required"})),l.machine.trim()||(g.machine=d.formatMessage({id:"wham.environmentsForm.machineRequired",defaultMessage:"Machine is required"})),l.description&&l.description.length>we&&(g.description=d.formatMessage({id:"wham.environmentsForm.descriptionMaxChars",defaultMessage:"Description must be at most {max} characters"},{max:we})),l.secrets.some(O=>O.value===""||O.key==="")&&(g.secrets=d.formatMessage({id:"wham.environmentsForm.secretRequired",defaultMessage:"Secret value is required"})),j){const O=((B=l.share_targets)!=null?B:[]).map(Qe=>Qe.trim()).filter(Boolean);l.share_targets=O,O.length>0&&l.share_settings==="private"&&(g.share_targets=d.formatMessage({id:"wham.environmentsForm.shareTargetsRequiresVisibility",defaultMessage:"Share targets require workspace or public visibility."}))}else delete l.share_targets;return l.envVars.some(O=>O.key===""||O.value==="")&&(g.envVars=d.formatMessage({id:"wham.environmentsForm.valueRequired",defaultMessage:"Environment variable value is required"})),l.secrets.some(O=>O.isEditing)&&(g.secrets=d.formatMessage({id:"wham.environmentsForm.editingSecrets",defaultMessage:"Secrets are being edited"})),V&&((oe=l.agentNetworkAccess)==null?void 0:oe.mode)==="on"&&l.agentNetworkAccess.preset_allowlist===Tt&&(!l.agentNetworkAccess.allowlist_domains||l.agentNetworkAccess.allowlist_domains.length===0)&&(g.agentNetworkAccess=d.formatMessage({id:"wham.environmentsForm.agentNetworkAccessAllowlistRequired",defaultMessage:"At least one domain is required"})),Object.keys(g).length>0&&M.danger(ot({id:"wham.environmentsForm.validationError",defaultMessage:"Please address the validation issues in the form."}),{toastId:"wham_environments_form_validation_error"}),{fields:g}}},onSubmit:({value:l})=>{n(l)}}),W=Lt(p.store,l=>l.isDirty),[G,se]=c.useState(!1),[X,me]=c.useState([]),ae=c.useRef(null),pe=Rt(ae);c.useEffect(()=>!W&&!G&&!X.length?void 0:pt(window,{beforeunload:g=>{g.preventDefault(),g.returnValue=d.formatMessage({id:"wham.environmentsForm.unsavedChanges",defaultMessage:"You have unsaved changes to your environment. Are you sure you want to leave?"})}}),[d,W,G,X]),c.useEffect(()=>{b.hash==="#setup-script"&&setTimeout(()=>{T.current&&(T.current.scrollIntoView({behavior:"smooth",block:"center"}),T.current.focus())},0)},[b.hash]);const de=l=>{l.preventDefault(),l.stopPropagation(),p.handleSubmit()},Y=F({name:"label",form:p,validators:{onChange:({value:l})=>{if(l.length>ie)return d.formatMessage({id:"wham.environmentsForm.labelMaxChars",defaultMessage:"Label must be at most {max} characters"},{max:ie});if(x!=null&&x.find(g=>g.label===l&&g.id!==t))return d.formatMessage({id:"wham.environmentsForm.labelAlreadyExistsInYourAccountPleaseChooseAnotherName",defaultMessage:"An environment with this name already exists. Try choosing another name."})}}}),H=F({name:"repositoryId",form:p}),Q=F({name:"description",form:p}),K=F({name:"secrets",form:p,mode:"array"}),J=F({name:"share_settings",form:p}),U=F({name:"share_targets",form:p,mode:"array"}),ge=l=>{J.handleChange(l),j&&l==="private"&&U.handleChange([])},Z=F({name:"agentNetworkAccess",form:p}),ee=F({name:"cacheSettings",form:p}),v=F({name:"envVars",form:p,mode:"array"}),L=F({name:"machine",form:p}),ne=F({name:"autoSetupSettings",form:p}),re=F({name:"setupCommands",form:p,mode:"array"}),xe=F({name:"maintenanceSetupCommands",form:p,mode:"array"}),ue=F({name:"workspaceDirectory",form:p,validators:{onChange:({value:l})=>{if(l)if(l.includes("/")){if(l==="/")return d.formatMessage({id:"wham.environmentsForm.workspaceDirectoryCannotBeRoot",defaultMessage:"Workspace directory cannot be root"})}else return d.formatMessage({id:"wham.environmentsForm.workspaceDirectoryMustContainASlash",defaultMessage:"Workspace directory must contain a slash"});else return d.formatMessage({id:"wham.environmentsForm.workspaceDirectoryRequired",defaultMessage:"Workspace directory is required"})}}}),Me=gt(),Je=!!Me&&xt(Me),ve=bt();return e.jsx("form",{ref:ae,onSubmit:de,className:Be("mx-auto flex min-h-0 w-full grow flex-col items-center overflow-y-auto px-8",pe&&"border-t"),children:e.jsxs("div",{className:"flex w-full max-w-screen-2xl flex-col",children:[e.jsxs("div",{className:"flex flex-col overflow-clip rounded-xl border bg-[#F7F7F7] dark:bg-[#1E1E1E]",children:[e.jsx("div",{className:"bg-token-bg-primary w-full border-b p-4 text-xl font-medium",children:e.jsx(u,{id:"wham.environmentsForm.basic",defaultMessage:"Basic"})}),e.jsxs("div",{className:"flex w-full flex-col p-4 md:max-w-[50%]",children:[!o&&e.jsx(wt,{className:"mb-4",selectedInstallationId:(ke=i==null?void 0:i.id)!=null?ke:null,setSelectedInstallation:m}),o?e.jsx(Ot,{repositoryId:H.state.value,existingEnvironment:o,setRepositoryName:h}):e.jsx(jt,{selectedRepository:H.state.value,onSelect:(l,g,B)=>{H.handleChange(l),Y.handleChange(g),h(B)},installationId:(Ne=i==null?void 0:i.id)!=null?Ne:null,installationAccountLogin:(Ee=i==null?void 0:i.account_login)!=null?Ee:null,installationAccountType:(Ce=i==null?void 0:i.account_type)!=null?Ce:null}),e.jsx(P,{className:"mb-4",field:H}),e.jsx(Kt,{onChange:Y.handleChange,value:Y.state.value}),e.jsxs("div",{className:"flex flex-row justify-between pt-1",children:[e.jsx(P,{field:Y}),e.jsx(Pe,{current:Y.state.value.length,max:ie})]}),e.jsx(Ft,{onChange:Q.handleChange,value:Q.state.value}),e.jsxs("div",{className:"flex flex-row justify-between pt-1",children:[D&&e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironments.descriptionSection.description",defaultMessage:"Explain to members of your organization what this environment is for."})}),e.jsx(Pe,{current:Q.state.value.length,max:we})]}),e.jsx(P,{className:"mb-4",field:Q}),j&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Xt,{value:J.state.value,onChange:ge}),e.jsx(P,{field:J}),J.state.value!=="private"&&e.jsxs(e.Fragment,{children:[e.jsx(zt,{value:U.state.value,onChange:U.handleChange,onBlur:U.handleBlur}),e.jsx(P,{className:"mb-4",field:U})]})]})]}),e.jsxs("div",{className:"bg-token-bg-primary flex w-full items-baseline justify-between gap-1.5 border-y p-4",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"shrink-0 text-xl font-medium",children:e.jsx(u,{id:"wham.environmentsForm.advanced",defaultMessage:"Code execution"})}),e.jsx("span",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.environmentsForm.advancedSubtitle",defaultMessage:"Set up dependencies, lint, and tests."})})]}),e.jsx("a",{href:"https://platform.openai.com/docs/codex/overview#environment-configuration",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 py-2 ps-2 hover:underline","aria-label":d.formatMessage({id:"wham.environmentsForm.learnMoreAriaLabel",defaultMessage:"Link to learn more about code execution"}),children:e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[e.jsx(qs,{className:"icon-sm"}),e.jsx(u,{id:"wham.environmentsForm.learnMore",defaultMessage:"Learn more"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col p-4",children:[e.jsx(ps,{selectedMachineId:L.state.value,setSelectedMachineId:l=>L.handleChange(l),envVars:v.state.value,pushValue:v.pushValue,replaceValue:v.replaceValue}),e.jsx(P,{className:"mb-1",field:L}),e.jsxs("p",{className:"text-token-text-tertiary mb-4 text-xs",children:[e.jsx(u,{id:"wham.createEnvironments.machineSelector.description",defaultMessage:"Universal is an image based on Ubuntu 24.04 - see <dockerfile>openai/codex-universal</dockerfile> to learn more. {br} The repository will be cloned to {workspaceDirectory}/{repo_name}. <EditWorkspace>Edit workspace directory.</EditWorkspace>",values:{br:e.jsx("br",{}),repo_name:f!=null?f:"",workspaceDirectory:(_e=ue.state.value)!=null?_e:"/workspace",dockerfile:l=>e.jsx("a",{href:"https://github.com/openai/codex-universal",target:"_blank",rel:"noopener noreferrer",className:"underline",children:l}),EditWorkspace:l=>e.jsx("button",{className:"underline",type:"button",onClick:()=>{R(!0)},children:l})}}),w&&e.jsx(Bs,{onChange:l=>ue.handleChange(l),repositoryName:f,workspaceDirectory:ue.state.value,errors:ue.state.meta.errors.filter(l=>!!l),onClose:()=>R(!1)})]}),e.jsx(Ht,{pushValue:v.pushValue,removeValue:v.removeValue,changeValue:v.replaceValue,values:v.state.value}),e.jsx(P,{className:"mb-4",field:v}),e.jsx(js,{pushValue:K.pushValue,removeValue:K.removeValue,changeValue:K.replaceValue,values:K.state.value}),e.jsx(P,{className:"mb-4",field:K}),I&&e.jsxs(e.Fragment,{children:[e.jsx(xs,{cacheSettings:ee.state.value,onChange:ee.handleChange}),e.jsx(P,{className:"mb-4",field:ee})]}),e.jsx(Cs,{onClickAppendReplHistory:()=>{const l=d.formatMessage({id:"wham.createEnv.terminal.recentCommands",defaultMessage:"Recent commands"}),g=re.state.value,B="".concat(g?"\n\n":"","# ").concat(l,":\n")+X.join("");p.setFieldValue("setupCommands",g+B),me([]),setTimeout(()=>{if(T.current){const oe=T.current;oe.scrollTop=oe.scrollHeight}},1)},replCommandHistory:X,suggestedCommand:_,onClickAcceptSuggestedCommand:()=>{_&&p.setFieldValue("setupCommands",re.state.value+_),S(null)},setupScript:re.state.value,onSetupScriptChange:re.handleChange,maintenanceScript:xe.state.value,onMaintenanceScriptChange:xe.handleChange,setupScriptChildren:e.jsx(P,{className:"mb-4",field:re}),maintenanceScriptChildren:e.jsx(P,{className:"mb-4",field:xe}),inputRef:T,autoSetupSettings:ne.state.value,onChangeAutoSetupSettings:ne.handleChange,postSetupCacheEnabled:!!((Ae=ee.state.value)!=null&&Ae.post_setup_cache_enabled)}),V&&ve!=null&&e.jsxs(e.Fragment,{children:[e.jsx(yt,{disabledByWorkspaceSettings:ve,agentNetworkAccess:Z.state.value,onChange:Z.handleChange}),e.jsx(P,{className:"mb-4",field:Z}),Je&&e.jsx(St,{className:"mb-4"}),!ve&&((Ve=Z.state.value)==null?void 0:Ve.mode)==="on"&&e.jsx(Mt,{className:"mb-4"})]})]}),e.jsx("div",{className:"flex h-[650px] p-3",children:e.jsx(p.Subscribe,{selector:l=>l.values,children:l=>e.jsx(Ds,{formValues:l,environmentId:t,onConnectedChange:se,initialSecrets:a.secrets.reduce((g,B)=>(g[B.key]=B.value,g),{}),onSuggestCommand:g=>{S(g)},onSubmitCommand:g=>{g.trim()&&me(B=>[...B,g])}})})})]})]}),e.jsx("div",{className:"mb-12 flex w-full items-end pt-4",children:e.jsx(p.Subscribe,{selector:l=>l.values,children:l=>e.jsx(q,{color:"primary",size:"medium",type:"button",className:"ms-auto",loading:r,disabled:!l.repositoryId,onClick:g=>{g.preventDefault(),g.stopPropagation(),p.handleSubmit()},children:s})})})]})})}export{ra as D,oa as E,Fe as P,ms as R,_s as g};
//# sourceMappingURL=nu0omb1rb0kisooc.js.map
