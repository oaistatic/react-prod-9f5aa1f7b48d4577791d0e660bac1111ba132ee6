import{A as E,r as p,k as R,ab as k,e as A,j as v,f as T}from"./i8clt0mfz495j7ii.js";import{g as h}from"./gqr8p5z5sixn79h1.js";import{u as x,z as I,mU as O,mV as l,ep as _,mW as b}from"./ghewn7l2ynbm32fm.js";const P="oauthRedirectUri",W=E(function(){const d=p.useRef(!1),{hash:C}=R(),{code:a,error:i,error_description:m,state:s,[P]:M}=Object.fromEntries(new URLSearchParams(C.substring(1)).entries()),e=k().pluginId,c=A(),D=x(),u=I(D);return p.useEffect(()=>{if(d.current)return;e&&a&&s&&(d.current=!0);async function w(){var f,g;if(i&&e&&(l({success:!1,pluginId:e,error:i,errorType:i,errorDesc:m}),window.close()),!(!e||!a||!s)){if(s.startsWith("v2__"))try{const r=await _.user_connection_oauth_callback(e,a,s);l({success:!0,pluginId:e,redirectTo:(f=r.redirect_to)!=null?f:void 0}),window.close()}catch(r){const t=h(r);let o=c.formatMessage(y.connectedDriveErrorDesc),n="unknown";t&&(n=t.error_type,o=c.formatMessage({id:"Xjmi4X",defaultMessage:"Failed to connect your account: {error}"},{error:t.message})),b.postMessage({success:!1,pluginId:e,errorType:n,error:o}),window.close();return}else if(s.startsWith("aqs__")&&u)try{const r=await _.admin_connect_and_quickstart(u.id,e,a,s);l({success:!0,pluginId:e,redirectTo:(g=r.redirect_to)!=null?g:void 0}),window.close()}catch(r){const t=h(r);let o=c.formatMessage(y.connectedDriveErrorDesc),n="unknown";t&&(n=t.error_type,o=c.formatMessage({id:"Xjmi4X",defaultMessage:"Failed to connect your account: {error}"},{error:t.message})),b.postMessage({success:!1,pluginId:e,errorType:n,error:o}),window.close();return}}}w()},[e,a,s,c,M,i,m,u]),v.jsx(O,{className:"icon-xl"})}),y=T({connectedDriveSyncDesc:{id:"CACallback.connectedDriveSyncDesc.1",defaultMessage:"Your account has been connected."},connectedDriveErrorDesc:{id:"CACallback.connectedDriveErrorDesc.1",defaultMessage:"We encountered an issue. Please retry and contact your admin if this issue persists."},emailNotMatchDesc:{id:"CACallback.emailNotMatchDesc.1",defaultMessage:"The account you're trying to connect to doesn't match your ChatGPT account"}});export{W as default};
//# sourceMappingURL=lrwj8a71fve0ws67.js.map
