var v=Object.defineProperty;var E=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var _=(i,e,t)=>e in i?v(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,f=(i,e)=>{for(var t in e||(e={}))F.call(e,t)&&_(i,t,e[t]);if(E)for(var t of E(e))H.call(e,t)&&_(i,t,e[t]);return i};var o=(i,e,t)=>_(i,typeof e!="symbol"?e+"":e,t);import{eb as h,e8 as n,e9 as s,hm as c,hl as l,gE as k,ea as P,bK as V,s as a,b8 as p,c7 as S,R as Y}from"./ghewn7l2ynbm32fm.js";const Z=["AF","AL","DZ","AS","AD","AO","AI","AQ","AG","AR","AM","AW","AU","AT","AZ","BS","BH","BD","BB","BY","BE","BZ","BJ","BM","BT","BO","BQ","BA","BW","BV","BR","IO","BN","BG","BF","BI","CV","KH","CM","CA","KY","CF","TD","CL","CN","CX","CC","CO","KM","CD","CG","CK","CR","HR","CU","CW","CY","CZ","CI","DK","DJ","DM","DO","EC","EG","SV","GQ","ER","EE","SZ","ET","FK","FO","FJ","FI","FR","GF","PF","TF","GA","GM","GE","DE","GH","GI","GR","GL","GD","GP","GU","GT","GG","GN","GW","GY","HT","HM","VA","HN","HK","HU","IS","IN","ID","IR","IQ","IE","IM","IL","IT","JM","JP","JE","JO","KZ","KE","KI","KP","KR","KW","KG","LA","LV","LB","LS","LR","LY","LI","LT","LU","MO","MG","MW","MY","MV","ML","MT","MH","MQ","MR","MU","YT","MX","FM","MD","MC","MN","ME","MS","MA","MZ","MM","NA","NR","NP","NL","NC","NZ","NI","NE","NG","NU","NF","MP","NO","OM","PK","PW","PS","PA","PG","PY","PE","PH","PN","PL","PT","PR","QA","MK","RO","RU","RW","RE","BL","SH","KN","LC","MF","PM","VC","WS","SM","ST","SA","SN","RS","SC","SL","SG","SX","SK","SI","SB","SO","ZA","GS","SS","ES","LK","SD","SR","SJ","SE","CH","SY","TW","TJ","TZ","TH","TL","TG","TK","TO","TT","TN","TR","TM","TC","TV","UG","UA","AE","GB","UM","US","UY","UZ","VU","VE","VN","VG","VI","WF","EH","YE","ZM","ZW","AX","XK"],w=h(Z,null),W=["stripe"],J=["card"],x=["terms_of_use","privacy_policy","seller_shop_policies"],Q=["missing","invalid","out_of_stock","payment_declined","requires_sign_in","requires_3ds"],q=["items_base_amount","items_discount","subtotal","discount","fulfillment","tax","fee","total"],b=["not_ready_for_payment","ready_for_payment","completed","canceled"],G=n({id:s,item:n({id:s,quantity:l}),base_amount:l,discount:l,subtotal:l,tax:l,total:l}),K=n({type:h(q),display_text:s,amount:l}),X=n({id:s,type:()=>"shipping",title:s,subtitle:s,subtotal:l,tax:l,total:l,carrier_info:s,earliest_delivery_time:s,latest_delivery_time:s}),j=n({id:s,type:()=>"digital",title:s,subtitle:s,subtotal:l,tax:l,total:l}),R=i=>{var t;switch(k((t=P(i))==null?void 0:t.type,["shipping","digital"])){case"shipping":return X(i);case"digital":return j(i)}},z=n({type:()=>"info",param:s,content_type:s,content:s}),I=n({type:()=>"error",code:h(Q),param:s,content_type:s,content:s}),N=i=>{var t;switch(k((t=P(i))==null?void 0:t.type,["info","error"])){case"info":return z(i);case"error":return I(i)}},L=n({type:h(x),value:s}),B=n({name:s,line_one:s,line_two:s,city:s,state:s,country:i=>{var e;return(e=w(i))!=null?e:"US"},postal_code:s}),ee=n({id:s,checkout_session_id:s,permalink_url:s}),O=n({merchant_id:s,provider:h(W),supported_payment_methods:c(h(J))}),ie=n({id:s,payment_provider:O,status:h(b),currency:s,line_items:c(G),totals:c(K),fulfillment_options:c(R),fulfillment_address:B,messages:c(N),links:c(L)}),ne=n({id:s,buyer:n({email:s,phone_number:s}),status:h(b),currency:s,line_items:c(G),totals:c(K),fulfillment_options:c(R),fulfillment_address:B,fulfillment_option_id:s,messages:c(N),links:c(L),order:ee});class te{constructor(e){o(this,"checkoutPromise$",a(null));o(this,"chatSDK$",a(null));o(this,"isCheckoutOpen$",p(()=>!!this.chatSDK$()));o(this,"isLoadingPayment$",a(!0));o(this,"checkoutSession$",a(null));o(this,"grandTotal$",p(()=>{var e;return(e=this.checkoutSession$())==null?void 0:e.totals.find(t=>t.type==="total")}));o(this,"shippingRates$",p(()=>{var e,t;return(t=(e=this.checkoutSession$())==null?void 0:e.fulfillment_options.map(({id:r,total:d,title:u})=>({id:r,amount:d,displayName:u})))!=null?t:[]}));o(this,"status$",a("idle"));o(this,"messages$",a([]));o(this,"errorMessages$",p(()=>this.messages$().filter(e=>e.type==="error")));o(this,"paymentDetails$",a(null));o(this,"paymentTypes$",a([]));o(this,"allowedCountries$",a([]));o(this,"publishableKey$",a(null));o(this,"customerId$",a(null));o(this,"billingAddress$",a(null));o(this,"billingAddressComplete$",p(()=>{var e,t,r,d,u,m;return this.billingAddress$()?!!((e=this.billingAddress$())!=null&&e.name)&&!!((t=this.billingAddress$())!=null&&t.line_one)&&!!((r=this.billingAddress$())!=null&&r.city)&&!!((d=this.billingAddress$())!=null&&d.state)&&!!((u=this.billingAddress$())!=null&&u.country)&&!!((m=this.billingAddress$())!=null&&m.postal_code):!1}));o(this,"openCheckout",(e,t)=>new Promise((r,d)=>{S(()=>{var u;this.checkoutPromise$.set({resolve:r,reject:d}),this.chatSDK$.set(e),this.checkoutSession$.set(t),this.billingAddress$.set((u=t.fulfillment_address)!=null?u:null)})}));o(this,"closeCheckout",()=>S(()=>{this.chatSDK$.set(null),this.checkoutSession$.set(null),this.billingAddress$.set(null),this.checkoutPromise$.set(null),this.status$.set("idle")}));o(this,"cancelCheckout$",()=>{var e;(e=this.checkoutPromise$())==null||e.reject(),this.closeCheckout()});o(this,"completeCheckout$",e=>{var t,r;this.status$.set("complete"),(r=(t=this.checkoutPromise$())==null?void 0:t.resolve)==null||r.call(t,e)});o(this,"addErrorMessage$",e=>{this.messages$.set([...this.messages$(),I({code:"invalid",content:e})])});o(this,"fetchStripeSession$",async()=>{var C,$,T,M,A,g;const e=window.location.href,t=e.includes("/share/"),r=this.ctx.serverId$(),d=O(($=(C=this.checkoutSession$())==null?void 0:C.payment_provider)!=null?$:{}),{customer_id:u,customer_session_client_secret:m,publishable_key:y,payment_types:D,allowed_countries:U}=await Y.safePost("/shopping/ecosystem/checkout/{checkout_session_id}",{parameters:{path:{checkout_session_id:(M=(T=this.checkoutSession$())==null?void 0:T.id)!=null?M:""}},requestBody:f({payment_provider:d,ecosystem_app_uri:(g=(A=this.chatSDK$())==null?void 0:A.widgetParent)!=null?g:""},t?{sharedConversationUrl:e}:{conversationId:r})});return S(()=>{this.publishableKey$.set(y),this.customerId$.set(u),this.paymentTypes$.set(D),this.allowedCountries$.set(U)}),{client_secret:m,publishable_key:y}});this.ctx=e}}const le=V(i=>new te(i));export{N as a,w as b,ie as c,le as g,ne as t};
//# sourceMappingURL=f1fdbkaiwy5lnpwz.js.map
