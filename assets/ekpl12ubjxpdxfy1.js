const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jl0gmzdyiwz0e04r.js","assets/i8clt0mfz495j7ii.js","assets/ceivmd4pm4umbvdn.js","assets/mjnk1x5y7ytu1o7k.js","assets/fg7gn2618r3hvum8.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/bgxcag65uz54fc39.js","assets/gr73ffwzttzymtep.js","assets/kaxn2bizrxslkpa3.js"])))=>i.map(i=>d[i]);
var ke=Object.defineProperty,we=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var ne=(s,n,t)=>n in s?ke(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,l=(s,n)=>{for(var t in n||(n={}))Ee.call(n,t)&&ne(s,t,n[t]);if(te)for(var t of te(n))Le.call(n,t)&&ne(s,t,n[t]);return s},_=(s,n)=>we(s,Me(n));import{j as e,M as x,h as Re,v as ae,_ as M,r as N,e as ce,u as Ae}from"./i8clt0mfz495j7ii.js";import{o as E,u as B,z as de,aY as O,$ as ue,L as S,gQ as me,kT as G,d as oe,b0 as De,dj as Se,f4 as Ue,a as pe,pg as Oe,e as ze,oi as Ge,oj as Be,gf as xe,ok as Ve,P as He,iw as Qe,k7 as qe,ph as H,pi as Q,jx as Ke,k8 as Ze,fF as $e,fH as Xe,cK as We,ek as Ye,C as Je,T as es}from"./ghewn7l2ynbm32fm.js";import{ai as d,iB as ss,iC as D,aR as ts,bA as fe,iD as ge,iE as he,iF as je,iG as ns,iH as os,dv as is,fm as ie,dw as ls,bC as rs,bB as as,fu as cs,iI as A}from"./j0yo6uv6652vva62.js";import{g as ds,D as le}from"./ktw3b87sujui39wx.js";import{F as us}from"./h1jbqtena24viel6.js";import{f as ms}from"./m89x2zftpo6hrypr.js";import{u as ps}from"./nrrhfi0a0bbsg9w2.js";import{CustomInstructionsModal as xs}from"./dujttbag0lb0tmgz.js";const fs=E(()=>M(()=>import("./jl0gmzdyiwz0e04r.js").then(s=>s._),__vite__mapDeps([0,1])),{loading:s=>S(s)}),gs=E(()=>M(()=>import("./ceivmd4pm4umbvdn.js").then(s=>s._),__vite__mapDeps([2,1])),{loading:s=>S(s)}),hs=E(()=>M(()=>import("./mjnk1x5y7ytu1o7k.js").then(s=>s._),__vite__mapDeps([3,1])),{loading:s=>S(s)}),re=E(()=>M(()=>import("./fg7gn2618r3hvum8.js"),__vite__mapDeps([4,1,5,6])).then(s=>s.FilePreviewModal));function js({gizmoId:s,gizmoName:n,canEdit:t,pendingFiles:a,files:o,interpreterOnlyFileIds:c,onAddFiles:f,removePendingFile:u,pendingFileUpsertMutationsRef:i}){return a.length===0&&o.length===0?e.jsx("div",{className:"h-full pb-4",children:e.jsx(Fs,{gizmoName:n,onAddFiles:f,canEdit:t})}):e.jsxs("div",{className:"pb-6",children:[e.jsx(ys,{numFiles:o.length+a.length}),e.jsx(vs,{canEdit:t,projectId:s,files:o,pendingFiles:a,interpreterOnlyFileIds:c,removePendingFile:u,pendingFileUpsertMutationsRef:i})]})}function ys({numFiles:s}){const n=B(),t=de(n),a=Re();if(!ss({accountPlanType:t==null?void 0:t.planType,numFiles:s}))return null;let o;return(t==null?void 0:t.planType)===O.FREE?o=e.jsx(x,_(l({},d.projectFileRateLimitBannerPlusDescription),{values:{freeFileLimit:D(O.FREE),paidFileLimit:D(O.PLUS)}})):o=e.jsx(x,_(l({},d.projectFileRateLimitBannerProDescription),{values:{paidFileLimit:D(O.PLUS),proFileLimit:D(O.PRO),planType:t==null?void 0:t.planType.valueOf()}})),e.jsxs("div",{className:"bg-token-bg-tertiary mb-3 flex flex-row items-center justify-between gap-3 rounded-xl p-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(x,l({},d.projectFileRateLimitBannerTitle))}),e.jsx("span",{className:"text-token-text-secondary",children:o})]}),e.jsx(ue,{color:"secondary",className:"bg-token-bg-tertiary",onClick:()=>{ts(a,"projects file upsell banner")},children:e.jsx(x,l({},d.upgradeToPlus))})]})}function vs({projectId:s,files:n,pendingFiles:t,interpreterOnlyFileIds:a,removePendingFile:o,pendingFileUpsertMutationsRef:c,canEdit:f}){const u=fe();return n.length===0&&t.length===0?null:e.jsxs("div",{className:"border-token-border-light overflow-hidden rounded-lg border",children:[n.map(i=>e.jsx(bs,{gizmoId:s,gizmoFile:i,interpreterOnly:a.includes(i.file_id),canEdit:f,onDelete:()=>{const m=new Promise(C=>{c.current.push({id:s,mutationId:ae(),update:h=>{const F=h.files.filter(j=>j.file_id!==i.file_id);return _(l({},h),{files:F})},onSuccess:C})});return ge(s)({projectId:s,upsertProjectMutation:u,pendingFileUpsertMutationsRef:c}),m}},i.file_id)),t.map(i=>e.jsx(_s,{canEdit:f,interpreterOnly:a.includes(i.tempId),pendingFile:i,onDelete:async()=>o(i.tempId)},i.tempId))]})}function ye(){return e.jsx("div",{className:"truncate",children:e.jsx(x,l({},d.interpreterOnlyLabel))})}function _s({pendingFile:s,onDelete:n,interpreterOnly:t,canEdit:a}){var u,i,m;const o=s.file.name,f=(ns(s.file)&&((u=s.file)==null?void 0:u.type.startsWith("image/"))||me(o))&&e.jsx(he,{file:s.file,fileName:o,fileId:(i=s.fileId)!=null?i:void 0,gizmoId:(m=s.gizmoId)!=null?m:void 0});return e.jsx(ve,{interpreterOnly:t,onDelete:n,canEdit:a,children:e.jsx(je,{icon:f,fileName:s.file.name,loadingPercentage:s.status===G.Uploading?s.progress:void 0,customFileDescription:t?e.jsx(ye,{}):void 0})})}function bs({gizmoFile:s,gizmoId:n,interpreterOnly:t,onDelete:a,canEdit:o}){const c=s.name,u=me(c)&&s.file_id!=null&&e.jsx(he,{fileName:c,fileId:s.file_id,gizmoId:n}),i=B(),m=()=>{const r=s.file_id;r&&Se(i,re,{gizmoId:n,fileId:r,fileName:s.name,onClose:()=>Ue(i,re)})};return e.jsx(ve,{interpreterOnly:t,onDelete:a,canEdit:o,children:e.jsx("div",{className:"cursor-pointer",onClick:m,children:e.jsx(je,{icon:u,fileName:s.name,customFileDescription:t?e.jsx(ye,{}):void 0})})})}function ve({children:s,onDelete:n,canEdit:t,interpreterOnly:a}){const[o,c]=N.useState(!1);return e.jsxs("div",{className:oe("group/file-row border-token-border-light flex w-full items-center justify-between border-b p-3 text-sm last:border-b-0",t?"hover:bg-token-interactive-bg-primary-selected/5":"hover:bg-transparent",a),children:[e.jsx("div",{className:"can-hover:w-full w-10/12 group-hover:w-11/12",children:s}),t&&e.jsx("button",{onClick:async()=>{n&&(c(!0),await n(),c(!1))},className:oe("group/file-layout -m-2 flex aspect-square shrink-0 grow-0 items-center justify-center bg-transparent p-2",!o&&"can-hover:opacity-0 group-hover/file-row:opacity-100 focus-visible:opacity-100"),children:e.jsx("div",{className:"group-hover/file-layout:bg-token-interactive-bg-primary-selected/5 group-active/file-layout:bg-token-interactive-bg-primary-selected/15 rounded-md p-[5px]",children:o?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(De,{})}):e.jsx(gs,{className:"icon-sm text-token-secondary"})})})]})}function Fs({gizmoName:s,onAddFiles:n,canEdit:t}){return e.jsx("div",{className:"border-token-border-default active:bg-token-bg-tertiary flex h-full cursor-pointer items-center justify-center rounded-lg border px-4 py-3 pb-6",onClick:n,children:e.jsxs("div",{className:"text-token-text-secondary flex flex-col items-center gap-2 py-4 text-sm",children:[t?e.jsx(fs,{}):e.jsx(hs,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-token-text-secondary max-w-100",children:e.jsx(x,_(l({},d.emptyFileInstructions),{values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(x,_(l({},d.emptyFileGizmoName),{values:{gizmoName:s}}))},"gizmoNameText")}}))})})]})})}const Is=E(()=>M(()=>import("./bgxcag65uz54fc39.js").then(s=>s._),__vite__mapDeps([7,1])),{loading:s=>S(s)}),Ns=E(()=>M(()=>import("./gr73ffwzttzymtep.js").then(s=>s._),__vite__mapDeps([8,1])),{loading:s=>S(s)});function Ps({ctx:s,gizmoId:n,gizmoName:t,canEdit:a,gizmoEditorData:o,openFileDialog:c,pendingFiles:f,setVersion:u,pendingFileUpsertMutationsRef:i,currentModelConfig:m}){var L;const r=(L=o==null?void 0:o.files)!=null?L:[],C=Array.from(f.current.values()).filter(p=>r.every(P=>P.file_id!==p.fileId)),h=C.filter(p=>m!=null&&H(m,p.file.type,p.file.name)===Q.CodeInterpreter),F=r.filter(p=>m!=null&&p.type!=null&&H(m,p.type,p.name)===Q.CodeInterpreter),j=[...h.map(p=>p.tempId),...F.map(p=>p.file_id)];return e.jsx(js,{gizmoId:n,gizmoName:t,canEdit:a,pendingFiles:C,pendingFileUpsertMutationsRef:i,files:r,interpreterOnlyFileIds:j,onAddFiles:c,removePendingFile:p=>{f.current.delete(p),A({ctx:s,id:n,pendingFiles:{key:p,value:null}}),u(P=>P+1)}})}const Ts=N.forwardRef(function({gizmo:n,accountPlanType:t,showInstructions:a=!0},o){var W,Y;const c=D(t),f=ce(),[u,i]=N.useState(!1),m=fe(),r=os(n),C=is(r),h=B(),F=pe(()=>Xe(h,{isGizmo:!1})),j=(W=F.models.get(Oe))!=null?W:F&&ms(F.models.values(),R=>R.tags.includes($e.GPT_4o)),L=ze(),[p,P]=N.useState(0),I=N.useRef(new Map),V=N.useRef([]),_e=Ge(j,void 0),be=R=>{R.some(({errors:b})=>{var T;return b.length!==1||((T=b[0])==null?void 0:T.code)!==ie.TooManyFiles})?L.danger(d.unknownError,{duration:2,toastId:"snorlax_handle_file_rejected"}):L.danger(f.formatMessage(d.dragTooManyFilesError,{maxFileLimit:c}),{duration:2,toastId:"snorlax_handle_file_rejected",loggingTitle:"drag_too_many_files_error"})},Fe=async R=>{He.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const b=r.id;R.length>0&&await Promise.all(R.map(T=>{const z=Qe(T),J={tempId:z,gizmoId:b,file:T,status:G.Uploading,progress:1,fileId:null,cdnUrl:null};I.current.set(z,J),A({ctx:h,id:b,pendingFiles:{key:z,value:J}}),qe(z,T,f,L,{kind:Ze.Gizmo,gizmoId:b},{onFileUploaded:async(g,k,w,y)=>{const v=I.current.get(g);v!=null&&v.fileId&&v!=null&&v.fileId&&(V.current.push({id:n.gizmo.id,mutationId:ae(),update:U=>{var ee,se;if(!v.fileId)return U;const Ce=[...(ee=U.files)!=null?ee:[],{file_id:v.fileId,name:v.file.name,size:v.file.size,type:(se=y==null?void 0:y.mimeType)!=null?se:Ke(v.file),last_modified:v.file.lastModified,file_size_tokens:y==null?void 0:y.fileTokenSize}];return _(l({},U),{files:Ce})},onSuccess:()=>{I.current.delete(g),A({ctx:h,id:b,pendingFiles:{key:g,value:null}}),P(U=>U+1)}}),ge(n.gizmo.id)({projectId:n.gizmo.id,upsertProjectMutation:m,pendingFileUpsertMutationsRef:V}))},onFileCreated:(g,k,w)=>{const y=_(l({tempId:g,gizmoId:b,file:T,status:G.Uploading,progress:1},I.current.get(g)),{fileId:k,cdnUrl:w});I.current.set(g,y),A({ctx:h,id:b,pendingFiles:{key:g,value:y}}),P(v=>v+1)},onFileUploadProgress:(g,k)=>{const w=I.current.get(g);if((w==null?void 0:w.status)===G.Uploading){const y=_(l({},w),{progress:k>95?95:k});I.current.set(g,y),A({ctx:h,id:b,pendingFiles:{key:g,value:y}})}P(y=>y+1)},onError:g=>{I.current.delete(g),A({ctx:h,id:b,pendingFiles:{key:g,value:null}}),P(k=>k+1)}},{usesRetrievalIndex:j!=null&&H(j,T.type,T.name)===Q.Retrieval})}))},q=Be(_e),K=ds(q),Z=I.current.size+r.files.length,{canEdit:$}=xe(n),{open:X,getInputProps:Ie,getRootProps:Ne,isDragAccept:Pe,isDragReject:Te}=ps(l({noClick:!0,noKeyboard:!0,noDragEventsBubbling:!0,onDropAccepted:Fe,onDropRejected:be,multiple:!0,maxSize:Ve,maxFiles:c-Z,validator:()=>Z>=c?{code:ie.TooManyFiles,message:"Too many files"}:null,disabled:!$},q));return N.useImperativeHandle(o,()=>({openFileDialog:X})),e.jsxs("div",_(l({},Ne({className:"h-full px-4 min-w-0"})),{children:[e.jsx("input",l({},Ie())),a&&e.jsxs(us,{children:[e.jsx("button",{className:"w-full",onClick:()=>i(!0),children:e.jsx("div",{className:"border-token-border-default w-full rounded-lg border text-start text-sm",children:(Y=r==null?void 0:r.instructions)!=null&&Y.length?e.jsx("div",{className:"mx-4 my-3 line-clamp-4",children:r.instructions}):e.jsxs("div",{className:"text-token-text-secondary flex h-full w-full items-center px-4 py-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(x,l({},d.addCustomInstructions))}),e.jsx(Is,{className:"icon-sm"})]})})}),C.includes(ls.GizmoInstructionsTooLong)?e.jsx(rs,{className:"mt-1",children:e.jsx(x,_(l({},d.instructionsTooLong),{values:{length:as}}))}):null]}),u&&e.jsx(xs,{gizmo:n,onClose:()=>{i(!1)}}),e.jsx(Ps,{ctx:h,gizmoId:n.gizmo.id,gizmoName:n.gizmo.display.name,canEdit:$,gizmoEditorData:r,openFileDialog:X,pendingFiles:I,pendingFileUpsertMutationsRef:V,setVersion:P,currentModelConfig:j}),Pe&&e.jsxs(le,{children:[e.jsx(cs,{}),e.jsx("h3",{children:e.jsx(x,l({},d.dragInstructions))}),e.jsx("h4",{className:"w-2/3 text-center",children:K.length>0?K.join(", "):e.jsx(x,l({},d.dragAllAccepted))})]}),Te&&e.jsxs(le,{children:[e.jsx(Ns,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(x,l({},d.dragTooManyFiles))}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(x,_(l({},d.dragTooManyFilesDescription),{values:{maxFileLimit:c}}))})]})]}))}),Cs=E(()=>M(()=>import("./kaxn2bizrxslkpa3.js").then(s=>s._),__vite__mapDeps([9,1])),{loading:s=>S(s)});function Os({gizmo:s,onClose:n,project:t}){var F;const a=ce(),o=N.useRef(null),c=N.useCallback(()=>{var j;(j=o.current)==null||j.openFileDialog()},[o]),f=B(),u=de(f),i=Ae(),{data:m}=We(s.gizmo.id),r=m!=null?m:s,{canEdit:C}=xe(r),h=pe(()=>{var j;return(j=t==null?void 0:t.filesCount$())!=null?j:0});return N.useEffect(()=>{i.invalidateQueries({queryKey:Ye(i,r.gizmo.id).queryKey})},[r.gizmo.id,i]),e.jsx(e.Fragment,{children:e.jsx(Je,{testId:"modal-project-files",className:"min-h-72 max-w-[820px]",isOpen:!0,showCloseButton:!0,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",headerAccessory:C?e.jsx(ue,{color:"secondary",onClick:c,disabled:(F=u&&h>=D(u.planType))!=null?F:!1,children:e.jsx(x,l({},d.addFilesButtonLabel))}):e.jsx(es,{label:a.formatMessage(d.viewOnlyCustomInstructionsModalHeaderTooltip),side:"left",align:"center",children:e.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center gap-1.5 text-sm",children:[e.jsx(Cs,{className:"icon"}),e.jsx(x,l({},d.viewOnlyCustomInstructionsModalHeaderLabel))]})}),title:e.jsx(x,l({},d.projectFilesModalTitle)),onClose:()=>{n()},children:e.jsx("div",{className:"grid min-h-[50dvh] grow overflow-y-auto pt-0",children:u&&e.jsx(Ts,{ref:o,gizmo:r,showInstructions:!1,accountPlanType:u.planType})})})})}export{Os as SnorlaxFileModal};
//# sourceMappingURL=ekpl12ubjxpdxfy1.js.map
