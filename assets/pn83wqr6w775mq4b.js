const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j0yo6uv6652vva62.js","assets/i8clt0mfz495j7ii.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/jyroje0qaxw6h3z1.js","assets/m7ju152dn5ab1rui.js","assets/gzqz4f2udyfpzx6a.js","assets/e6eptpe9toj61kmv.js","assets/ftisxkx60sryd8hn.js","assets/bci083mws0hai8bl.js","assets/oz2w8uv2a0ics46w.js"])))=>i.map(i=>d[i]);
var ze=Object.defineProperty,$e=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var Ce=(n,e,s)=>e in n?ze(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,xe=(n,e)=>{for(var s in e||(e={}))ye.call(e,s)&&Ce(n,s,e[s]);if(me)for(var s of me(e))Re.call(e,s)&&Ce(n,s,e[s]);return n},pe=(n,e)=>$e(n,Xe(e));var Ie=(n,e)=>{var s={};for(var r in n)ye.call(n,r)&&e.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&me)for(var r of me(n))e.indexOf(r)<0&&Re.call(n,r)&&(s[r]=n[r]);return s};import{_ as G,j as t,e as de,r as g,o as Ye,M as H,l as Ze,c as Je,h as Qe}from"./i8clt0mfz495j7ii.js";import{o as U,L as K,T as fe,d as oe,b0 as Ee,ky as et,se as tt,sf as nt,ct as De,cw as st,sg as rt,sh as ot,oz as at,hr as Se,aU as it,sd as lt,$ as ge}from"./ghewn7l2ynbm32fm.js";import{mi as ct,aI as dt,aC as Te,aD as Oe,tn as Fe,bL as ut,kl as mt,o as qe,L as ft,to as ht,tp as xt,tq as pt}from"./j0yo6uv6652vva62.js";import{C as Ve}from"./chs4g5r39qlnqw6r.js";import{I as gt}from"./nzsqhqpna1ee8hwf.js";import{u as We}from"./ivhm4b1s5w1b1cuw.js";import{l as he,R as vt,S as bt,W as wt,T as jt,U as Et,j as _t}from"./g5lgy1otfli5p2x7.js";const Nt=U(()=>G(()=>import("./j0yo6uv6652vva62.js").then(n=>n.yA),__vite__mapDeps([0,1,2,3,4])),{loading:n=>K(n)});function He({triggerText:n,toolTip:e,ariaLabel:s,Icon:r,truncate:i=!0,isLoading:l=!1}){return t.jsx(ct,{className:"composer-btn px-2","aria-label":s,"aria-busy":l,children:t.jsx(fe,{label:e,className:"text-sm font-medium",children:t.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-1",children:[r,t.jsx("span",{className:oe("hidden sm:block",i?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:n}),l&&t.jsx(Ee,{"aria-hidden":!0,className:"icon-sm"}),t.jsx(Nt,{"aria-hidden":!0,className:"icon-sm"})]})})})}const Mt=U(()=>G(()=>import("./jyroje0qaxw6h3z1.js").then(n=>n._),__vite__mapDeps([5,1])),{loading:n=>K(n)}),kt=U(()=>G(()=>import("./m7ju152dn5ab1rui.js").then(n=>n._),__vite__mapDeps([6,1])),{loading:n=>K(n)});function ae(N){var u=N,{children:n,className:e,onClick:s,isSelected:r,isActive:i,isVirtualHover:l=!1,label:w,isDisabled:d,tooltipLabel:o,isSubMenuTrigger:c,noDefaultHoverState:b,as:a="button",truncateLabel:_,infoIcon:j,infoLink:v,icon:x}=u,p=Ie(u,["children","className","onClick","isSelected","isActive","isVirtualHover","label","isDisabled","tooltipLabel","isSubMenuTrigger","noDefaultHoverState","as","truncateLabel","infoIcon","infoLink","icon"]);const E=de();let y=t.jsx(t.Fragment,{});n?y=t.jsx("div",{className:"flex flex-1 items-center gap-4",children:n}):w&&(y=t.jsxs("div",{className:oe("flex items-center gap-3",_?"w-0 flex-1":"w-full"),children:[x&&(g.isValidElement(x)?x:t.jsx(Ct,{icon:x})),w&&t.jsx("div",{className:oe("flex flex-col items-start py-1",d&&"text-token-text-quaternary pointer-events-none",_&&"w-[100%]"),children:t.jsx("div",{className:oe("flex items-center text-start text-sm",_&&"w-full"),children:t.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:w})})})]}),o&&(y=t.jsx(fe,{sideOffset:-10,label:o,className:"w-full",children:y})));const R=t.jsxs("div",{className:oe("flex items-center justify-center",(r||j&&v||c)&&"min-w-5"),children:[r&&t.jsx(kt,{className:"icon color:var(--tint-color,#0285FF) icon-sm","aria-label":E.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),j&&v&&t.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",children:j}),c&&t.jsx(Mt,{className:"icon text-token-text-tertiary w-7","aria-label":E.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),M=oe("flex cursor-pointer items-center rounded-[10px] px-2.5 py-1",(r||j&&v||c)&&"gap-4",i&&"bg-black/5 dark:bg-white/5",!b&&"hover:bg-black/5 dark:hover:bg-white/5",l&&"bg-black/5 dark:bg-white/5",e);if(a==="div"){const m=p;return t.jsxs("div",pe(xe({},m),{className:M,children:[y,R]}))}const B=p;return t.jsxs("button",pe(xe({type:"button"},B),{onClick:m=>{m.persist(),requestAnimationFrame(()=>{s==null||s(m)})},className:M,children:[y,R]}))}function Ct({icon:n}){const e=n;return t.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:t.jsx(e,{className:"h-5 w-5 shrink-0","aria-label":""})})}const ve="wham-environment-popover-event";function Ge(n,e,s){g.useEffect(()=>{function i(l){l.detail.popover!==n&&s()}return window.addEventListener(ve,i),()=>{window.removeEventListener(ve,i)}},[n,s]);const r=g.useCallback(i=>{window.dispatchEvent(new CustomEvent(ve,{detail:{popover:i}}))},[]);g.useEffect(()=>{e&&r(n)},[e,r,n])}const Ue=({items:n,onSelect:e,keyExtractor:s})=>{const[r,i]=g.useState(null),[l]=g.useState(new Map);return{hoveredId:r,setHoveredId:i,getItemRef:d=>o=>{const c=s(d);return o&&l.set(c,o),()=>{l.delete(c)}},itemRefs:l,onKeyDown:d=>{var j;const o=d.key==="ArrowDown"||d.key==="n"&&d.ctrlKey,c=d.key==="ArrowUp"||d.key==="p"&&d.ctrlKey;if(!(o||c||d.key==="Enter"))return;if(d.preventDefault(),d.key==="Enter"){r&&e(r);return}const b=n.findIndex(v=>s(v)===r),a=dt(b-(c?1:-1),0,n.length-1),_=s(n[a]);(j=l.get(_))==null||j.scrollIntoView({behavior:"instant",block:"nearest"}),i(_)}}},yt=U(()=>G(()=>import("./gzqz4f2udyfpzx6a.js"),__vite__mapDeps([7,1])),{loading:n=>K(n)});function Rt({environment:n,repository:e}){var v,x,p,N;const s=de(),{branch:r,setBranch:i}=he(),[l,w]=g.useState(""),[d,o]=g.useState(!1),c=g.useRef(null),b=()=>o(!1),a=(p=(x=(v=n==null?void 0:n.repos)==null?void 0:v[0])!=null?x:e==null?void 0:e.id)!=null?p:null,_=g.useRef(a),j=n?St(n):(N=e==null?void 0:e.default_branch)!=null?N:"main";return g.useEffect(()=>{const u=_.current;if(_.current=a,!a){i(null);return}const E=vt(a);if(u!==a){if(E){i(E);return}i(j);return}r||i(E!=null?E:j)},[r,a,j,i]),Ge("branch",d,()=>o(!1)),We([{key:"whamBranches",action:()=>o(!0),actionMessageDescriptor:s.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:Oe.Chat,keyboardBinding:[Te.Mod,"b"]}]),t.jsx("div",{className:"items-center rounded-full",children:t.jsxs(Fe,{open:d,onOpenChange:o,children:[t.jsx(He,{triggerText:r!=null?r:s.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:r===""||d?"":r!=null&&r.length?r:s.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:s.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:t.jsx(yt,{"aria-hidden":!0,className:"icon-sm"})}),t.jsx(Ve,{align:"start",isOpen:d,closePopover:b,popoverContentRef:c,children:t.jsx(It,{defaultBranch:j,repoId:a,searchQuery:l,setSearchQuery:w,setBranch:i,selectedBranch:r!=null?r:"",closePopover:b})})]})})}function It({repoId:n,defaultBranch:e,setBranch:s,selectedBranch:r,searchQuery:i,setSearchQuery:l,closePopover:w}){const d=de(),o=g.useRef(null),c=ut(i,300),b=g.useMemo(()=>n?bt(n):[],[n]),{data:a,isLoading:_,fetchNextPage:j,hasNextPage:v,isFetchingNextPage:x,error:p}=Ye({queryKey:["searchBranches",n,c],enabled:!!n,initialPageParam:null,queryFn:({pageParam:m})=>wt.searchBranchesByRepository(n!=null?n:"",c,mt,m!=null?m:null),getNextPageParam:m=>{var C;return(C=m==null?void 0:m.cursor)!=null?C:null}}),N=g.useMemo(()=>{var z,f,P;const m=(P=(f=(z=a==null?void 0:a.pages)==null?void 0:z.flat().map(S=>S.items.flatMap(O=>O.branch)))==null?void 0:f.flat())!=null?P:[],C=new Set,D=[];e&&!C.has(e)&&(C.add(e),D.push(e));for(const S of b)C.has(S)||(C.add(S),D.push(S));for(const S of m)C.has(S)||(C.add(S),D.push(S));return D},[a,e,b]),u=m=>{s(m),w()},E=g.useMemo(()=>i!=null&&i.trim()?N.filter(m=>m.toLowerCase().includes(i.toLowerCase())):N!=null?N:[],[i,N]),{hoveredId:y,setHoveredId:R,onKeyDown:M,getItemRef:B}=Ue({items:E,keyExtractor:m=>m,onSelect:u});return g.useEffect(()=>{o.current&&o.current.focus()},[]),t.jsxs("div",{className:"gap flex max-h-[280px] w-90 flex-col rounded-lg p-0 md:max-h-[360px]",onClick:m=>{m.stopPropagation()},children:[t.jsx(qe,{ref:o,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",type:"text",autoComplete:"off",inputClassName:"text-sm",name:"search-branch",value:i,suppressFocus:!0,onKeyDown:M,onChange:m=>l(m.target.value),placeholder:d.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Search branches…"}),ariaLabel:d.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),t.jsx("div",{className:"bg-token-border-default h-px w-full"}),t.jsxs("div",{className:"min-h-18 w-full overflow-y-auto p-1.5",children:[E==null?void 0:E.map(m=>{const C=m===r;return t.jsx(ae,{className:"w-full max-w-full whitespace-nowrap",as:"button",onMouseEnter:()=>R(m),isVirtualHover:y===m,ref:B(m),onClick:()=>{u(m)},isSelected:C,label:m,truncateLabel:!0},m)}),p?t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(H,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,t.jsx(gt,{bgColor:"dark:bg-token-bg-secondary",hasNextPage:v,fetchNextPage:j,isFetchingNextPage:x||_})]})]})}function St(n){var e;for(const s of n.repos){const r=(e=n.repo_map)==null?void 0:e[s];if(r!=null&&r.default_branch)return r.default_branch}return"main"}function Lt({repository:n,disabledRepositoryIds:e,isCreating:s,creatingRepositoryId:r,isSelected:i,onSelect:l}){var b,a;const w=(a=(b=n.repository_full_name)!=null?b:n.name)!=null?a:"",d=r===n.id,c=!!(e==null?void 0:e.has(n.id))||!!s&&!d||!!d;return t.jsx(ae,{as:"button",className:"w-full",onClick:()=>{c||l(n)},isSelected:i,isDisabled:c,label:w})}const Pt=U(()=>G(()=>import("./e6eptpe9toj61kmv.js").then(n=>n._),__vite__mapDeps([8,1])),{loading:n=>K(n)});function At({repositories:n,isLoading:e,isError:s,search:r,onSelectRepository:i,existingEnvironmentRepositoryIds:l,showRepositoriesHeader:w}){"use no forget";const d=et("installations/select_target"),o=he(a=>a.selectedRepositoryId),c=he(a=>a.useRepositoryAsEnvironment),b=g.useMemo(()=>n.length?n.filter(a=>{var v,x,p,N,u;if(!a.id||l.has(a.id))return!1;if(!r)return!0;const _=((x=(v=a.repository_full_name)!=null?v:a.name)!=null?x:"").toLowerCase(),j=(u=(N=(p=a.owner)==null?void 0:p.login)==null?void 0:N.toLowerCase())!=null?u:"";return _.includes(r)||j.includes(r)}).sort((a,_)=>{var x,p,N,u;const j=(p=(x=a.repository_full_name)!=null?x:a.name)!=null?p:"",v=(u=(N=_.repository_full_name)!=null?N:_.name)!=null?u:"";return j.localeCompare(v)}):[],[l,r,n]);return t.jsxs("div",{className:"text-token-text-primary flex flex-col gap-0.5",children:[w&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-token-border-default mt-2 h-px w-full"}),t.jsx("div",{className:"px-1.5",children:t.jsx(ae,{as:"div",className:"text-token-text-tertiary pointer-events-none w-full text-sm",label:t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(H,{id:"wham.codexEnvironmentPopover.repositoriesWithoutEnvironments",defaultMessage:"Repositories"})})})})]}),t.jsx("div",{className:"px-1.5",children:e?t.jsx("div",{className:"flex w-full items-center justify-center py-2",children:t.jsx(Ee,{className:"ms-2"})}):s?t.jsx("div",{className:"p-5 text-center",children:t.jsx("p",{className:"text-token-text-tertiary text-sm",children:t.jsx(H,{id:"wham.codexEnvironmentPopover.repositoriesWithoutEnvironmentsError",defaultMessage:"Failed to load repositories"})})}):b.length===0?t.jsx("div",{className:"p-5 text-center",children:t.jsx("p",{className:"text-token-text-tertiary text-sm",children:t.jsx(H,{id:"wham.environmentPopover.noRepositories",defaultMessage:"No repositories found"})})}):b.map(a=>t.jsx(Lt,{repository:a,isSelected:c&&o===a.id,onSelect:i},a.id))}),t.jsx("div",{className:"bg-token-border-default mt-1 h-px w-full"}),t.jsx("div",{className:"px-1.5 pb-1.5",children:t.jsx(ae,{as:"button",className:"mt-1 w-full",onClick:()=>{window.open(d,"_blank")},icon:t.jsx(Pt,{className:"icon-sm inline-block"}),label:t.jsx("div",{className:"flex items-center gap-2 text-sm",children:t.jsx(H,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"})})})})]})}function Ke({className:n}){return t.jsx(ft,{className:oe("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",n)})}var be,Le;function Bt(){if(Le)return be;Le=1;var n=tt(),e=nt(),s=ot(),r=De(),i=st(),l=rt(),w=Math.min;function d(o,c,b){for(var a=b?s:e,_=o[0].length,j=o.length,v=j,x=Array(j),p=1/0,N=[];v--;){var u=o[v];v&&c&&(u=r(u,i(c))),p=w(u.length,p),x[v]=!b&&(c||_>=120&&u.length>=120)?new n(v&&u):void 0}u=o[0];var E=-1,y=x[0];e:for(;++E<_&&N.length<p;){var R=u[E],M=c?c(R):R;if(R=b||R!==0?R:0,!(y?l(y,M):a(N,M,b))){for(v=j;--v;){var B=x[v];if(!(B?l(B,M):a(o[v],M,b)))continue e}y&&y.push(M),N.push(R)}}return N}return be=d,be}var we,Pe;function Dt(){if(Pe)return we;Pe=1;var n=ht();function e(s){return n(s)?s:[]}return we=e,we}var je,Ae;function Tt(){if(Ae)return je;Ae=1;var n=De(),e=Bt(),s=xt(),r=Dt(),i=s(function(l){var w=n(l,r);return w.length&&w[0]===l[0]?e(w):[]});return je=i,je}var Ot=Tt();const Ft=Ze(Ot),qt=U(()=>G(()=>import("./ftisxkx60sryd8hn.js"),__vite__mapDeps([9,1])),{loading:n=>K(n)}),Vt=U(()=>G(()=>import("./bci083mws0hai8bl.js").then(n=>n._),__vite__mapDeps([10,1])),{loading:n=>K(n)}),Wt=U(()=>G(()=>import("./oz2w8uv2a0ics46w.js").then(n=>n._),__vite__mapDeps([11,1])),{loading:n=>K(n)});function Ht(){const{data:n,isError:e}=Et(),{data:s,isLoading:r,isError:i}=_t();return{environments:s!=null?s:n,fullEnvironmentsLoading:r,isErrorEnvironments:i&&e}}function Gt({onCreateEnvironment:n,showBranchSelector:e=!0,allowRepositorySelection:s=!0,filters:r=null}={}){"use no forget";var re,k,X,ue;const i=de(),{environmentId:l,setEnvironmentId:w,selectedRepositoryId:d,setSelectedRepositoryId:o,setBranch:c,setUseRepositoryAsEnvironment:b,useRepositoryAsEnvironment:a}=he(),[_,j]=g.useState(!1),v=g.useRef(null),[x,p]=g.useState(!1),N=g.useRef(l),[u,E]=g.useState(null),[y,R]=g.useState(""),{data:M,isLoading:B,isError:m}=jt(y),{environments:C,fullEnvironmentsLoading:D,isErrorEnvironments:z}=Ht(),f=g.useMemo(()=>r!=null&&r.repos?C==null?void 0:C.filter(h=>Ft(h.repos,r.repos).length>0):C,[C,r]),P=f==null?void 0:f.find(h=>h.id===l),S=g.useCallback(h=>{var T,F;if(!h)return null;const I=(F=h.repos)!=null?F:Object.keys((T=h.repo_map)!=null?T:{});if(!I.length)return null;const[L]=I;return L!=null?L:null},[]);Ge("environment",_,()=>j(!1)),g.useEffect(()=>{N.current!==l&&(N.current=l,l!=null&&(p(!1),E(null)))},[l]),g.useEffect(()=>{if(!a){E(null);return}},[a]),g.useEffect(()=>{if(x||D)return;if(l&&!P){w(null),o(null);return}else if(!l&&(f!=null&&f.length)){const L=pt(f,[F=>{var W;return!((W=F.is_pinned)!=null&&W)},F=>{var W;return-((W=F.task_count)!=null?W:0)}])[0];w(L.id);const T=S(L);o(T!=null?T:null);return}const h=S(P);h!=null&&h!==d?o(h):P&&h==null&&d!=null&&o(null)},[D,l,P,f,w,d,o,S,x]),g.useEffect(()=>{var I;if(z||x||D||((I=f==null?void 0:f.length)!=null?I:0)>0||!(M!=null&&M.repositories.length))return;const[h]=M.repositories;if(h!=null&&h.id&&s&&!l){if(d===h.id&&a){(u==null?void 0:u.id)!==h.id&&E(h);return}b(!0),o(h.id),E(h),c(null)}},[M,z,a,l,d,c,o,b,E,x,D,f==null?void 0:f.length,u==null?void 0:u.id,s]),We([{key:"whamEnvironments",action:()=>j(!0),actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:Oe.Chat,keyboardBinding:[Te.Mod,"e"]}]);const O=g.useCallback(()=>j(!1),[]),Y=g.useCallback(h=>{h!=null&&h.id&&(p(!0),w(null),b(!0),o(h.id),E(h),c(null),O())},[O,c,w,o,b]),Z=i.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),J=i.formatMessage({id:"wham.codexEnvironmentPopover.selectRepository",defaultMessage:"Select repository"}),ie=i.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),A=P==null?void 0:P.label,Q=((re=A==null?void 0:A.length)!=null?re:0)>16,q=s&&(a||(f==null?void 0:f.length)===0&&!D),V=(X=(k=u==null?void 0:u.repository_full_name)!=null?k:u==null?void 0:u.name)!=null?X:J,ee=V.length>16,te=q?V:A!=null?A:Z,le=q?ee?V:"":Q?A!=null?A:"":A||_?"":ie,ne=q?t.jsx(Wt,{"aria-hidden":!0,className:"icon-sm"}):t.jsx(qt,{"aria-hidden":!0,className:"icon-sm"}),ce=g.useMemo(()=>{const h=new Set;return f==null||f.forEach(I=>{var T,F;((F=I.repos)!=null?F:Object.keys((T=I.repo_map)!=null?T:{})).forEach(W=>{W&&h.add(W)})}),h},[f]),$=s&&a&&u?u:null,se=e&&!!(P||$);return D&&!(f!=null&&f.length)?t.jsx("div",{className:"flex items-center gap-3 rounded-full",children:t.jsx(Ke,{})}):t.jsxs("div",{className:"flex items-center gap-2 rounded-full",children:[t.jsxs(Fe,{open:_,onOpenChange:j,children:[t.jsx(He,{triggerText:te,toolTip:le,ariaLabel:i.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:ne}),t.jsx(Ve,{align:"start",isOpen:_,closePopover:O,popoverContentRef:v,children:t.jsx(Ut,{searchTerm:y,setSearchTerm:R,repositories:(ue=M==null?void 0:M.repositories)!=null?ue:[],isLoadingRepositories:B,isErrorRepositories:m,isLoading:D,environments:f!=null?f:[],environmentId:l,setEnvironmentId:h=>{w(h);const I=f==null?void 0:f.find(T=>T.id===h),L=S(I);o(L!=null?L:null)},closePopover:O,onSelectRepository:Y,disabledRepositoryIds:ce,onCreateEnvironment:n,allowRepositorySelection:s})})]}),se&&t.jsx(Rt,{environment:P,repository:$})]})}function Ut(n){"use forget";const e=Je.c(77),{searchTerm:s,setSearchTerm:r,repositories:i,isLoadingRepositories:l,isErrorRepositories:w,isLoading:d,environments:o,environmentId:c,setEnvironmentId:b,closePopover:a,onSelectRepository:_,disabledRepositoryIds:j,onCreateEnvironment:v,allowRepositorySelection:x}=n,p=de(),N=g.useRef(null);let u;e[0]!==a||e[1]!==b?(u=k=>{b(k),a()},e[0]=a,e[1]=b,e[2]=u):u=e[2];const E=u,y=Qe(),R=o.length>0;let M;if(e[3]!==c||e[4]!==o||e[5]!==s){e:{let k;e[7]!==c?(k=I=>I.slice().sort((L,T)=>{var Me,ke;if(L.id===c)return-1;if(T.id===c)return 1;const F=!!L.is_pinned,W=!!T.is_pinned;if(F!==W)return F?-1:1;const _e=(Me=L.task_count)!=null?Me:0,Ne=(ke=T.task_count)!=null?ke:0;return _e!==Ne?Ne-_e:L.label.localeCompare(T.label)}),e[7]=c,e[8]=k):k=e[8];const X=k,ue=s.trim().toLowerCase();if(!ue){let I;e[9]!==o||e[10]!==X?(I=X(o),e[9]=o,e[10]=X,e[11]=I):I=e[11],M=I;break e}const h=o.filter(I=>{var L;return((L=I.label)!=null?L:"").toLowerCase().includes(ue)});M=X(h)}e[3]=c,e[4]=o,e[5]=s,e[6]=M}else M=e[6];const B=M;let m;e[12]!==B||e[13]!==E?(m={items:B,keyExtractor:zt,onSelect:E},e[12]=B,e[13]=E,e[14]=m):m=e[14];const{hoveredId:C,setHoveredId:D,onKeyDown:z,getItemRef:f}=Ue(m);let P,S;e[15]===Symbol.for("react.memo_cache_sentinel")?(P=()=>{var k;(k=N.current)==null||k.focus()},S=[],e[15]=P,e[16]=S):(P=e[15],S=e[16]),g.useEffect(P,S);let O;e[17]!==r?(O=k=>r(k.target.value),e[17]=r,e[18]=O):O=e[18];let Y;e[19]!==x||e[20]!==o.length||e[21]!==p?(Y=x?o.length>0?p.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.envless",defaultMessage:"Search environments and repos…"}):p.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.envlessRepos",defaultMessage:"Search repositories…"}):p.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.environmentsOnly",defaultMessage:"Search environments…"}),e[19]=x,e[20]=o.length,e[21]=p,e[22]=Y):Y=e[22];let Z;e[23]!==x||e[24]!==p?(Z=x?p.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria.envless",defaultMessage:"Search environments and repos"}):p.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria.environmentsOnly",defaultMessage:"Search environments"}),e[23]=x,e[24]=p,e[25]=Z):Z=e[25];let J;e[26]!==z||e[27]!==s||e[28]!==O||e[29]!==Y||e[30]!==Z?(J=t.jsx(qe,{ref:N,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",type:"text",autoComplete:"off",name:"branch-to-add",value:s,onChange:O,onKeyDown:z,suppressFocus:!0,placeholder:Y,ariaLabel:Z}),e[26]=z,e[27]=s,e[28]=O,e[29]=Y,e[30]=Z,e[31]=J):J=e[31];let ie;e[32]===Symbol.for("react.memo_cache_sentinel")?(ie=t.jsx("div",{className:"bg-token-border-default h-px w-full"}),e[32]=ie):ie=e[32];let A;e[33]!==J?(A=t.jsxs("div",{className:"contents",onClick:Kt,children:[J,ie]}),e[33]=J,e[34]=A):A=e[34];let Q;e[35]!==o.length?(Q=o.length>0&&t.jsx(ae,{as:"div",className:"text-token-text-tertiary pointer-events-none w-full text-sm",label:t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(H,{id:"wham.codexEnvironmentPopover.envlessModeRepositories",defaultMessage:"Environments"})})}),e[35]=o.length,e[36]=Q):Q=e[36];let q;e[37]!==Q?(q=t.jsx("div",{className:"px-1.5 pt-1.5",children:Q}),e[37]=Q,e[38]=q):q=e[38];let V;e[39]!==c||e[40]!==o.length||e[41]!==B||e[42]!==f||e[43]!==E||e[44]!==C||e[45]!==d||e[46]!==D?(V=d?t.jsx("div",{className:"px-1.5",children:t.jsx("div",{className:"flex w-full items-center justify-center py-2",children:t.jsx(Ee,{className:"ms-2"})})}):o.length>0?B.length>0?t.jsx("div",{className:"px-1.5",children:B.map(k=>{const X=c===k.id;return t.jsx(ae,{as:"button",ref:f(k),onMouseEnter:()=>D(k.id),className:"w-full",truncateLabel:!0,onClick:()=>{E(k.id)},isVirtualHover:C===k.id,isSelected:X,label:k.label},k.id)})}):t.jsx("div",{className:"p-1.5 text-center",children:t.jsx("p",{className:"text-token-text-tertiary text-sm",children:t.jsx(H,{id:"wham.environmentPopover.noMatches",defaultMessage:"No environments found"})})}):null,e[39]=c,e[40]=o.length,e[41]=B,e[42]=f,e[43]=E,e[44]=C,e[45]=d,e[46]=D,e[47]=V):V=e[47];let ee;e[48]!==x||e[49]!==j||e[50]!==o.length||e[51]!==w||e[52]!==l||e[53]!==_||e[54]!==i||e[55]!==s?(ee=x?t.jsx(At,{onSelectRepository:_,existingEnvironmentRepositoryIds:j,showRepositoriesHeader:o.length>0,search:s.trim().toLowerCase(),repositories:i,isLoading:l,isError:w}):null,e[48]=x,e[49]=j,e[50]=o.length,e[51]=w,e[52]=l,e[53]=_,e[54]=i,e[55]=s,e[56]=ee):ee=e[56];let te;e[57]!==q||e[58]!==V||e[59]!==ee?(te=t.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-y-auto",children:[q,V,ee]}),e[57]=q,e[58]=V,e[59]=ee,e[60]=te):te=e[60];let le;e[61]===Symbol.for("react.memo_cache_sentinel")?(le=t.jsx("div",{className:"bg-token-border-default h-px w-full"}),e[61]=le):le=e[61];let ne;e[62]!==R||e[63]!==y||e[64]!==v?(ne=()=>{!R&&v?v():y("/codex/settings/environments")},e[62]=R,e[63]=y,e[64]=v,e[65]=ne):ne=e[65];let ce;e[66]===Symbol.for("react.memo_cache_sentinel")?(ce=t.jsx(Vt,{className:"icon-sm"}),e[66]=ce):ce=e[66];let $;e[67]!==R||e[68]!==p?($=R?p.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"}):p.formatMessage({id:"wham.codexEnvironmentPopover.createEnvironment",defaultMessage:"Create environment"}),e[67]=R,e[68]=p,e[69]=$):$=e[69];let se;e[70]!==ne||e[71]!==$?(se=t.jsx("div",{className:"bg-token-bg-tertiary flex flex-shrink-0 flex-col gap-1 px-2 py-1.5",children:t.jsx(ae,{className:"w-full",noDefaultHoverState:!0,onClick:ne,isSelected:!1,icon:ce,label:$},"environment-action")}),e[70]=ne,e[71]=$,e[72]=se):se=e[72];let re;return e[73]!==A||e[74]!==te||e[75]!==se?(re=t.jsxs("div",{className:"flex max-h-[280px] w-80 flex-col overflow-y-auto rounded-lg md:max-h-[360px]",children:[A,te,le,se]}),e[73]=A,e[74]=te,e[75]=se,e[76]=re):re=e[76],re}function Kt(n){n.stopPropagation()}function zt(n){return n.id}const $t=U(()=>G(()=>import("./ftisxkx60sryd8hn.js"),__vite__mapDeps([9,1])),{loading:n=>K(n)}),Be=U(()=>G(()=>import("./gzqz4f2udyfpzx6a.js"),__vite__mapDeps([7,1])),{loading:n=>K(n)});function sn({onCreateEnvironment:n,showBranchSelector:e,filters:s,allowRepositorySelection:r}={}){const i=de(),{isConnected:l,isLoading:w,openGithubModal:d,error:o,refetch:c}=at(it.GITHUB_CONNECTOR,"github","/codex",Se.CODEX),{enabled:b}=lt(Se.CODEX);return w?t.jsx(Ke,{className:"h-9"}):o?t.jsx(fe,{label:i.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:t.jsx(ge,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:c,children:t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx($t,{"aria-hidden":!0,className:"icon-sm"}),t.jsx(H,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):b?t.jsx(t.Fragment,{children:t.jsx("div",{className:"z-0 flex w-full justify-between",children:l?t.jsx("div",{className:"flex gap-4",children:t.jsx(Gt,{onCreateEnvironment:n,showBranchSelector:e!=null?e:!0,allowRepositorySelection:r!=null?r:!0,filters:s!=null?s:null})}):t.jsx("div",{className:"flex gap-2",children:t.jsxs(ge,{type:"button",color:"secondary",size:"small",onClick:d,children:[t.jsx(Be,{"aria-hidden":!0,className:"icon-sm me-1.5"}),t.jsx(H,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):t.jsx(fe,{label:i.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:t.jsxs(ge,{type:"button",color:"secondary",onClick:d,disabled:!0,children:[t.jsx(Be,{"aria-hidden":!0,className:"icon-sm me-1.5"}),t.jsx(H,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}export{He as C,sn as W,ae as a,St as g,Ft as i};
//# sourceMappingURL=pn83wqr6w775mq4b.js.map
