const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gsas8pb1acnf7jnd.js","assets/i8clt0mfz495j7ii.js","assets/rsi9kppw43ykrsgk.js","assets/fobvway9e4v0s6vc.js","assets/hkdu34erhu96s165.js","assets/3j20em1lilnrpdcm.js","assets/d63jm146253lx3xq.js","assets/gw7tjih2pjgna9ex.js","assets/opdg2x67e4phtvxr.js","assets/cv4rvmad80hmdgot.js","assets/j0yo6uv6652vva62.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/df0d69i3ij9twqsj.js","assets/hj7440dgahtucv4l.js"])))=>i.map(i=>d[i]);
var Ze=Object.defineProperty,$e=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var he=(t,s,o)=>s in t?Ze(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,D=(t,s)=>{for(var o in s||(s={}))pe.call(s,o)&&he(t,o,s[o]);if(J)for(var o of J(s))je.call(s,o)&&he(t,o,s[o]);return t},L=(t,s)=>$e(t,Je(s));var ne=(t,s)=>{var o={};for(var n in t)pe.call(t,n)&&s.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&J)for(var n of J(t))s.indexOf(n)<0&&je.call(t,n)&&(o[n]=t[n]);return o};import{j as e,r as m,_ as I,e as P,b as K,M as l,a as Ae,f as ae}from"./i8clt0mfz495j7ii.js";import{d$ as oe,kl as Xe,kk as Qe,dx as De,dt as Le,m as Ke}from"./j0yo6uv6652vva62.js";import{si as et,sj as tt,sk as st,sl as ve,sm as nt,sn as at,so as ot,sp as it,sq as rt,sr as lt,ss as dt,st as ct,su as ut,sv as gt,sw as mt,sx as xt,sy as ft,sz as _t,sA as ht,sB as pt,sC as jt,sD as vt,sE as yt,sF as kt,sG as bt,sH as wt,sI as Mt,sJ as Ct,sK as Nt,sL as ye,sM as St,sN as Et,sO as It,P as O,o as T,L as A,e as W,C as R,l$ as H,h7 as ie,T as Oe,sP as F,$ as k,ep as M,hK as Tt,b0 as Z,u as G,z as V,rm as Pe,sQ as Q,d as re,sR as At,rn as Dt,a5 as Lt,sS as Ot,sT as Pt,sU as ke,sV as Rt,a4 as Wt}from"./ghewn7l2ynbm32fm.js";import{g as Ft}from"./gqr8p5z5sixn79h1.js";import{a as be,b as we,c as Me}from"./c0ls495fz2t1hbyy.js";import{I as Ce,U as Ne}from"./s7nhmyc9nrsk1i39.js";import{S as Gt}from"./mq11hu99eist2abq.js";import{I as Ut}from"./izvx0vf35f3cqx26.js";const $={isOpen:!0,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,shouldIgnoreClickOutside:!0,hideSeparator:!0,noPadding:!0},Ht={google_drive:e.jsx(It,{}),slack:e.jsx(Et,{}),github:e.jsx(St,{}),sharepoint:e.jsx(ye,{}),sharepoint_admin:e.jsx(ye,{}),confluence:e.jsx(Nt,{}),dropbox:e.jsx(Ct,{}),box:e.jsx(Mt,{}),linear:e.jsx(wt,{}),intercom:e.jsx(bt,{}),hubspot:e.jsx(kt,{}),notion:e.jsx(yt,{}),aha:e.jsx(vt,{}),asana:e.jsx(jt,{}),azure_devops:e.jsx(pt,{}),basecamp:e.jsx(ht,{}),clickup:e.jsx(_t,{}),freshdesk:e.jsx(ft,{}),freshservice:e.jsx(xt,{}),front:e.jsx(mt,{}),gitlab:e.jsx(gt,{}),gorgias:e.jsx(ut,{}),help_scout:e.jsx(ct,{}),ironclad:e.jsx(dt,{}),jira:e.jsx(lt,{}),jira_servicemanagement:e.jsx(rt,{}),pipedrive:e.jsx(it,{}),salesforce_service_cloud:e.jsx(ot,{}),shortcut:e.jsx(at,{}),teamwork:e.jsx(nt,{}),teams:e.jsx(ve,{}),teams_admin:e.jsx(ve,{}),zendesk:e.jsx(st,{}),zoho:e.jsx(tt,{}),zoho_desk:e.jsx(et,{})},B=Object.fromEntries(Object.entries(Ht).map(([t,s])=>[t,L(D({},$),{title:s})])),q=B.google_drive,Fs=B.slack;B.github;B.sharepoint;B.dropbox;B.box;B.linear;const le=({link:t,location:s})=>{O.logEventWithStatsig("Contextual Answers Help Link Clicked","chatgpt_contextual_answers_help_link_clicked",{link:t,location:s})},de=m.createContext({triggerLocation:"admin_settings"});de.Provider;const z=()=>{const t=m.useContext(de);if(!t)throw new Error("useTriggerLocation must be used within a TriggerLocationProvider");return t},Vt=T(()=>I(()=>import("./gsas8pb1acnf7jnd.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>A(t)}),Bt=T(()=>I(()=>import("./rsi9kppw43ykrsgk.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>A(t)});function qt({accountId:t,connectionId:s,onClose:o,onNext:n,secondaryButton:r,footerContent:a}){const i=P(),d=W(),g=m.useId(),[u,h]=m.useState(""),[x,j]=m.useState(null),[b,_]=m.useState(!1),{triggerLocation:w}=z(),{isLoading:v,refetch:f,data:y}=K({queryKey:["admin:connection_instance",s],queryFn:async()=>await M.admin_get_connection_instance(t,s)});m.useEffect(()=>{var p;(y==null?void 0:y.connection_config.knowledge_connector_type)==="google_drive_dwd"&&h((p=y.connection_config.admin_email_address)!=null?p:"")},[y]);const c=(y==null?void 0:y.connection_config.knowledge_connector_type)==="google_drive_dwd"?y.connection_config.service_account_credential_id:void 0,N=u.trim().length>0&&(!!x||c),C=async()=>{if(!(!N||!t||b)){_(!0);try{let p;x&&(p=await x.text()),await M.admin_connection_update_credential(t,s,{admin_email:u,new_service_credential_content:p,credential_id:c&&!p?c:void 0}),d.success(i.formatMessage({id:"q/AX/d",defaultMessage:"Credentials successfully updated."})),n()}catch(p){let S=i.formatMessage({id:"qbD4Az",defaultMessage:"Failed to update credentials."});const E=Ft(p);E&&(S=i.formatMessage({id:"pzfjhv",defaultMessage:"Failed to update credentials: {error}"},{error:E.message})),O.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_dwd",error:E==null?void 0:E.error_type,triggerLocation:w}),d.danger(S,{toastId:"gdrive_dwd_credentials_modal",loggingTitle:"Failed to update credentials",loggingDescription:"Failed to update credentials"})}finally{f(),_(!1)}}};return e.jsx(R,L(D({},q),{onClose:o,testId:"modal-gdrive-dwd-credentials",children:v?e.jsx(H,{lines:4,className:"px-6 pt-4 pb-10"}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:p=>{p.preventDefault(),N&&C()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("button",{type:"submit",className:"display-none"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"qq+Txa",defaultMessage:"Setup a new connection"})}),e.jsx("div",{className:"text-token-text-secondary mt-2",children:e.jsx(l,{id:"oXAF7U",defaultMessage:"First, read the <link>setup instructions</link>, then upload the service account key provided by Google.",values:{link:p=>e.jsx(ie,{href:be,className:"underline",onClick:()=>le({link:be,location:"admin_onboarding_dwd_credentials"}),children:p})}})})]}),e.jsx(zt,{existingServiceKeyId:c,serviceKeyFile:x,setServiceKeyFile:j}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsxs("label",{htmlFor:g,className:"flex flex-row items-center gap-2 text-base font-medium",children:[e.jsx("span",{children:e.jsx(l,{id:"sPqjJA",defaultMessage:"Google Workspace admin email address"})}),e.jsx(Oe,{withArrow:!0,side:"top",label:e.jsx("p",{className:"p-1 text-sm",children:e.jsx(l,{id:"4xWSaU",defaultMessage:"Your workspace admin’s email address is required to configure user access and select which shared drives you’d like to sync."})}),children:e.jsx(Vt,{className:"icon text-token-text-tertiary"})})]}),e.jsx("input",{type:"text",value:u,onChange:p=>h(p.target.value),placeholder:i.formatMessage({id:"+zP1RE",defaultMessage:"admin@example.com"}),id:g,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"})]})]})]}),e.jsx(F,{primaryButton:e.jsx(k,{loading:b,color:"primary",disabled:!N||b,onClick:C,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:r,footerContent:a})]})}))}function zt({existingServiceKeyId:t,serviceKeyFile:s,setServiceKeyFile:o}){const n=m.useRef(null),r=m.useId();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-base font-medium",children:e.jsx(l,{id:"gI0O53",defaultMessage:"Service account key"})}),!!t&&!s&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(Bt,{className:"icon-sm"}),e.jsx(l,{id:"B+/4/L",defaultMessage:"Service account key already exists."})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary",children:s.name}),e.jsxs("div",{className:"flex flex-row gap-2",children:[!t&&!s&&e.jsx(k,{color:"primary",type:"button",onClick:()=>{var a;return(a=n.current)==null?void 0:a.click()},children:e.jsx(l,{id:"4GjErm",defaultMessage:"Upload key"})}),(!!t&&!s||!t&&!!s)&&e.jsx(k,{color:"secondary",type:"button",onClick:()=>{var a;return(a=n.current)==null?void 0:a.click()},children:e.jsx(l,{id:"qV3zuG",defaultMessage:"Replace key"})}),!!t&&!!s&&e.jsx(k,{color:"danger-outline",type:"button",onClick:()=>o(null),children:e.jsx(l,{id:"NFpNok",defaultMessage:"Clear"})})]}),e.jsx("input",{type:"file",className:"hidden",id:r,ref:n,onChange:a=>{a.target.files&&a.target.files.length>0?o(a.target.files[0]):o(null)},accept:".json"})]})}const Se=T(()=>I(()=>import("./fobvway9e4v0s6vc.js").then(t=>t._),__vite__mapDeps([3,1])),{loading:t=>A(t)}),Yt=T(()=>I(()=>import("./hkdu34erhu96s165.js").then(t=>t._),__vite__mapDeps([4,1])),{loading:t=>A(t)});function Zt({isOpen:t,onClose:s,connectionId:o,accountId:n,primaryButton:r,secondaryButton:a,footerContent:i}){const{refetch:d,data:g,error:u,isLoading:h}=K({queryFn:()=>Jt({accountId:n,connectionId:o}),queryKey:["admin_connection_list_item_scopes",o,"shared_drive"]});return e.jsxs(R,L(D({},q),{isOpen:t,onClose:s,testId:"modal-gdrive-dwd-shared-drive-picker",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:h?e.jsx(H,{lines:4}):u?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(k,{color:"secondary",icon:Yt,onClick:()=>d(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsx(e.Fragment,{children:g&&e.jsx($t,{accountId:n,connectionId:o,sharedDriveDefaultScope:g.default_selection,sharedDriveScopes:g.object_selections,refetch:d})})}),e.jsx(F,{primaryButton:r,secondaryButton:a,footerContent:i})]}))}function $t({refetch:t,accountId:s,connectionId:o,sharedDriveDefaultScope:n,sharedDriveScopes:r}){const a=P(),i=W(),{isPending:d,mutate:g}=Ae({mutationFn:async u=>await M.admin_connection_update_item_default_scope(s,o,"shared_drive",u),mutationKey:["admin_connection_update_item_default_scope",o,"shared_drive"],onError:()=>{i.danger(a.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to update policy",loggingDescription:"Failed to update policy"})},onSettled:()=>{t()}});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"CIWfUm",defaultMessage:"How do you want to handle Shared Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"BXG6kp",defaultMessage:"Add any Shared Drives you’d like to exclude or include by default."})}),e.jsx(Gt,{ariaLabel:a.formatMessage({id:"ca.scope-selector.aria-label",defaultMessage:"Select whether Shared drives are included or excluded from syncing by default."}),onChange:u=>{d||g(u)},value:n,leftItem:{ariaLabel:a.formatMessage(X.includeToggleLabel),label:a.formatMessage(X.includeToggleLabel),value:"include"},rightItem:{ariaLabel:a.formatMessage(X.excludeToggleLabel),label:a.formatMessage(X.excludeToggleLabel),value:"exclude"}}),d?e.jsx(H,{lines:3}):n==="include"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"dmDuO6",defaultMessage:"All Shared drives will be synced except for ones you choose to exclude."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"buyi/M",defaultMessage:"Excluded Shared drives"})}),e.jsx("ul",{children:r.filter(u=>u.selection==="exclude").map(u=>e.jsx(Ce,{objectHandle:u.object_handle,objectType:"shared_drive",accountId:s,connectionId:o,scopeChangeIcon:Se,scopeChangeLabel:a.formatMessage({id:"NLi7nF",defaultMessage:"Remove exclusion"}),scopeChangeTarget:"include",onError:()=>{i.danger(a.formatMessage({id:"tdBT+A",defaultMessage:"Failed to remove exclusion. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to remove exclusion",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to un-exclude from syncing was unable to be un-excluded."})},onScopeUpdated:()=>{i.success(a.formatMessage({id:"AC/4a7",defaultMessage:"Sucessfully removed exclusion."})),t()}},u.object_handle))}),e.jsx(Ne,{objectType:"shared_drive",targetScopeSelection:"exclude",accountId:s,connectionId:o,buttonLabel:a.formatMessage({id:"ThGxVh",defaultMessage:"Exclude"}),onSuccess:()=>{i.success(a.formatMessage({id:"1hsj8s",defaultMessage:"Shared drive has been excluded."})),t()},onError:()=>{i.danger(a.formatMessage({id:"4JkX1y",defaultMessage:"Failed to exclude Shared drive. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to exclude Shared drive",loggingDescription:"Toast message shown an admin tries to exclude a Google Drive Shared drive from being synced, but the operation failed."})}})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Pa+iyD",defaultMessage:"Only the Shared drives you select will be synced."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"e4EV27",defaultMessage:"Included Shared drives"})}),e.jsx("ul",{children:r.filter(u=>u.selection==="include").map(u=>e.jsx(Ce,{objectHandle:u.object_handle,objectType:"shared_drive",accountId:s,connectionId:o,scopeChangeIcon:Se,scopeChangeLabel:a.formatMessage({id:"/oSk2L",defaultMessage:"Remove inclusion"}),scopeChangeTarget:"exclude",onError:()=>{i.danger(a.formatMessage({id:"JhaVH0",defaultMessage:"Failed to remove inclusion. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to remove inclusion",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to un-include from syncing was unable to be un-included."})},onScopeUpdated:()=>{i.success(a.formatMessage({id:"m6h3gf",defaultMessage:"Sucessfully removed inclusion."})),t()}},u.object_handle))}),e.jsx(Ne,{objectType:"shared_drive",targetScopeSelection:"include",accountId:s,connectionId:o,buttonLabel:a.formatMessage({id:"At82Iq",defaultMessage:"Include"}),onSuccess:()=>{i.success(a.formatMessage({id:"IMoGWZ",defaultMessage:"Shared drive has been included."})),t()},onError:()=>{i.danger(a.formatMessage({id:"De2z4Y",defaultMessage:"Failed to include Shared drive. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to include Shared drive",loggingDescription:"Toast message shown an admin tries to include a Google Drive Shared drive for syncing, but the operation failed."})}})]})]})}const X=ae({includeToggleLabel:{id:"ca.scope-selection.include-by-default",defaultMessage:"Include by default"},excludeToggleLabel:{id:"ca.scope-selection.exclude-by-default",defaultMessage:"Exclude by default"},includeUserDrivesLabel:{id:"pDGrBu",defaultMessage:"Include user-owned files?"}});async function Jt({accountId:t,connectionId:s}){const o=[];let n=await M.admin_connection_list_item_scopes(t,s,"shared_drive",null);for(o.push(n);n.page_token!=null;)n=await M.admin_connection_list_item_scopes(t,s,"shared_drive",n.page_token),o.push(n);return{object_type:"shared_drive",default_selection:o[0].default_selection,object_selections:o.flatMap(a=>a.object_selections)}}const Xt=T(()=>I(()=>import("./3j20em1lilnrpdcm.js").then(t=>t._),__vite__mapDeps([5,1])),{loading:t=>A(t)}),Qt=T(()=>I(()=>import("./d63jm146253lx3xq.js").then(t=>t._),__vite__mapDeps([6,1])),{loading:t=>A(t)}),Kt=T(()=>I(()=>import("./gw7tjih2pjgna9ex.js").then(t=>t._),__vite__mapDeps([7,1])),{loading:t=>A(t)}),es=T(()=>I(()=>import("./rsi9kppw43ykrsgk.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>A(t)}),ts=T(()=>I(()=>import("./hkdu34erhu96s165.js").then(t=>t._),__vite__mapDeps([4,1])),{loading:t=>A(t)});function ss({isOpen:t,onClose:s,connectionId:o,accountId:n,isPostActivation:r,footerContent:a,primaryButton:i,secondaryButton:d}){const g=P(),u=W(),{refetch:h,data:x,error:j,isLoading:b}=K({queryFn:async()=>await M.admin_connection_list_item_scopes(n,o,"user_drive"),queryKey:["admin_connection_list_item_scopes",o,"user_drive"]}),{isPending:_,mutate:w}=Ae({mutationFn:async f=>await M.admin_connection_update_item_default_scope(n,o,"user_drive",f?"include":"exclude"),mutationKey:["admin_connection_update_item_default_scope",o,"user_drive"],onError:()=>{u.danger(g.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}),{toastId:"gdrive_dwd_user_drives_modal",loggingTitle:"Failed to update policy",loggingDescription:"Failed to update policy"})},onSettled:()=>{h()}}),v=(x==null?void 0:x.default_selection)==="include";return e.jsxs(R,L(D({},q),{isOpen:t,onClose:s,testId:"modal-gdrive-dwd-user-drives",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:b?e.jsx(H,{lines:4}):j?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(k,{color:"secondary",icon:ts,onClick:()=>h(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):r?e.jsx("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:v?e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"rWqZ31",defaultMessage:"User owned files in My Drives are being synced."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Kt,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"/dUChW",defaultMessage:"User owned files in My Drives are not being synced."})})]})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"K4ZFoX",defaultMessage:"How do you want to handle My Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"kAW/VW",defaultMessage:"Choose whether you want to sync the My Drive folder for your users."})}),e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(Tt,{checked:v,disabled:_,"aria-label":g.formatMessage(Ee.includeUserDrivesLabel),onCheckedChange:()=>{!_&&w(!v)}}),e.jsx("p",{children:e.jsx(l,D({},Ee.includeUserDrivesLabel))}),_&&e.jsx(Z,{}),e.jsx("div",{className:"grow"}),e.jsx(Oe,{label:e.jsx("p",{children:e.jsx(l,{id:"xJvlxk",defaultMessage:"Enable this setting to sync files in users' individual My Drives."})}),children:e.jsx(Qt,{className:"icon-lg text-token-text-tertiary"})})]}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(Xt,{className:"icon-lg"}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"4vN9WK",defaultMessage:"You will not be able to change whether user My Drives are included once the connection starts syncing data."})})]})]})}),e.jsx(F,{footerContent:a,primaryButton:i,secondaryButton:d})]}))}const Ee=ae({includeUserDrivesLabel:{id:"75ojp7",defaultMessage:"Include user My Drives?"}}),ns=T(()=>I(()=>import("./3j20em1lilnrpdcm.js").then(t=>t._),__vite__mapDeps([5,1])),{loading:t=>A(t)}),as=T(()=>I(()=>import("./opdg2x67e4phtvxr.js").then(t=>t._),__vite__mapDeps([8,1])),{loading:t=>A(t)}),os=T(()=>I(()=>import("./cv4rvmad80hmdgot.js").then(t=>t._),__vite__mapDeps([9,1])),{loading:t=>A(t)}),is=T(()=>I(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yo),__vite__mapDeps([10,1,11,12,13])),{loading:t=>A(t)}),rs=T(()=>I(()=>import("./df0d69i3ij9twqsj.js").then(t=>t._),__vite__mapDeps([14,1])),{loading:t=>A(t)}),ls=T(()=>I(()=>import("./hj7440dgahtucv4l.js").then(t=>t._),__vite__mapDeps([15,1])),{loading:t=>A(t)});function Re({onClose:t,footerContent:s,primaryButton:o,secondaryButton:n,pageSize:r=Xe,accountId:a,connectionId:i,connectorType:d,fallbackEstimatedMaxNumUsers:g}){var ue,ge,me,xe,fe;const u=P(),h=G(),x=V(h),[j,b]=m.useState(""),[_,w]=m.useState(0),v=Pe(h),{data:f,isLoading:y}=oe(x==null?void 0:x.getWorkspaceId(),_*r,j,r),{data:c,isLoading:N,refetch:C,error:p}=K({queryKey:["admin_connection_get_access_policy",i],queryFn:()=>M.admin_connection_get_access_policy(a,i)}),S=Math.ceil(((ue=f==null?void 0:f.total)!=null?ue:0)/r);_>=S&&S!==0&&w(Math.max(S-1,0));const[E,He]=m.useState(!1),[Ve,Be]=m.useState(0),ee=Ve>0||E,ce=N||y||ee,te=(me=(ge=c==null?void 0:c.limits)==null?void 0:ge.max_allowed_users)!=null?me:g,se=te===-1,qe=!v&&(se||((xe=c==null?void 0:c.allowed_users.length)!=null?xe:0)<te);return d==="google_drive_dwd"?c==null?e.jsx(R,L(D({},$),{title:Q(d),onClose:t,testId:"modal-allowed-users-picker",children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(Z,{})})})):e.jsx(gs,{accountId:a,connectorType:d,connectionId:i,areAllUsersAllowed:c==null?void 0:c.allow_all_in_workspace,allowedUserIds:c==null?void 0:c.allowed_users,onClose:t,numWorkspaceMembers:f==null?void 0:f.total,refetch:C,primaryButton:o,secondaryButton:n,footerContent:s}):e.jsxs(R,L(D({},$),{title:Q(d),onClose:t,testId:"modal-allowed-users-picker",children:[e.jsxs("div",{className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("div",{className:"mb-3 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsx("div",{className:"text-token-text-secondary mb-4",children:se?e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}):N?e.jsx(H,{lines:1,className:"w-full"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}),e.jsx("p",{children:e.jsx(us,{numSelectedUsers:(fe=c==null?void 0:c.allowed_users.length)!=null?fe:0,maxAllowedUsers:te})})]})}),e.jsxs("div",{className:"mb-4 flex flex-row items-center",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("input",{type:"text",value:j,onChange:Y=>{b(Y.target.value),w(0)},disabled:!!(c!=null&&c.allow_all_in_workspace),placeholder:u.formatMessage({id:"RWqomV",defaultMessage:"Search"}),className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid ps-10"}),e.jsx("div",{className:"absolute start-2 top-0 flex h-full w-8 items-center justify-center",children:e.jsx(is,{className:"icon text-token-text-tertiary group-focus-within:text-token-text-secondary"})})]}),ce&&e.jsx(Z,{className:"ms-4 h-4 w-4"})]}),p&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(ns,{className:"icon inline"}),e.jsx(l,{id:"ZhxtEO",defaultMessage:"Failed to load allowed users."}),e.jsx("button",{onClick:()=>C(),className:"underline",children:e.jsx(l,{id:"y/IEAC",defaultMessage:"Try again"})})]}),e.jsx("div",{className:re("h-[200px] max-h-[600px] overflow-y-auto px-2",(c==null?void 0:c.allow_all_in_workspace)&&"opacity-50"),children:e.jsx("table",{children:e.jsx("tbody",{children:f!=null&&f.items.length?f.items.map(({id:Y,name:ze,email:Ye})=>{const _e=!!(c!=null&&c.allowed_users.includes(Y));return e.jsx("tr",{className:"mb-2",children:e.jsx("td",{children:e.jsx(ds,{controlDisabled:!_e&&!qe||!!(c!=null&&c.allow_all_in_workspace)||E,userId:Y,isUserEnabled:_e||!!(c!=null&&c.allow_all_in_workspace),accountId:a,connectionId:i,refetch:C,setNumPendingUserOperations:Be,name:ze,email:Ye})})},Y)}):e.jsx("tr",{children:e.jsx("td",{children:e.jsx(l,{id:"n3uhaN",defaultMessage:"No users found"})})})})})}),S>1&&e.jsx("div",{className:"my-4",children:e.jsx(Qe,{currentPage:_,onChangeIndex:w,length:S})}),se&&e.jsx(cs,{allowAllInWorkspace:!!(c!=null&&c.allow_all_in_workspace),controlDisabled:ce||v&&!(c!=null&&c.allow_all_in_workspace),refetch:C,accountId:a,connectionId:i,setShouldBlockOtherInteractions:He})]}),e.jsx(F,{footerContent:s,primaryButton:ee&&o?m.cloneElement(o,{disabled:!0,onClick:()=>{}}):o,secondaryButton:ee&&n?m.cloneElement(n,{disabled:!0,onClick:()=>{}}):n})]}))}function ds({userId:t,controlDisabled:s,isUserEnabled:o,refetch:n,setNumPendingUserOperations:r,accountId:a,connectionId:i,name:d,email:g}){const u=P(),h=W(),[x,j]=m.useState(!1),b=async v=>{if(!s){j(!0),r(f=>f+1);try{await M.admin_connection_allow_user(a,i,v),await n()}catch(f){h.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Admin connection allow user error"})}finally{j(!1),r(f=>f-1)}}},_=async v=>{j(!0),r(f=>f+1);try{await M.admin_connection_disallow_user(a,i,v),await n()}catch(f){h.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Admin connection disallow user error"})}finally{j(!1),r(f=>f-1)}},w=e.jsxs("p",{children:[e.jsx("span",{className:"text-token-text-primary",children:d}),e.jsx("span",{className:"text-token-text-tertiary ms-2",children:g})]});return e.jsx(We,{isLoading:x,id:"is-user-enabled--".concat(t),disabled:s,checked:o,onChange:v=>{s||x||(v.currentTarget.checked?b(t):_(t))},label:w})}function cs({allowAllInWorkspace:t,controlDisabled:s=!1,accountId:o,connectionId:n,refetch:r,setShouldBlockOtherInteractions:a}){const i=P(),d=W(),[g,u]=m.useState(!1),h=async x=>{if(!s){u(!0),a(!0);try{await M.admin_connection_update_access_policy(o,n,x),await r()}catch(j){await r(),d.danger(i.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Access error"})}finally{u(!1),a(!1)}}};return e.jsx(We,{isLoading:g,id:"enabled-for-everyone-checkbox",checked:t,disabled:s,onChange:x=>{s||h(x.currentTarget.checked)},label:e.jsx("span",{className:"text-token-text-primary ms-2",children:e.jsx(l,{id:"MsFKpF",defaultMessage:"Enable for everyone"})})})}function We(o){var n=o,{isLoading:t}=n,s=ne(n,["isLoading"]);return t?e.jsxs("div",{className:"form-check flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("div",{className:"form-check-label text-token-text-primary",children:s.label})]}):e.jsx(Ke,D({},s))}function us({maxAllowedUsers:t,numSelectedUsers:s}){return s>=t?e.jsx(l,{id:"JWJ5gc",defaultMessage:"{numSelectedUsers, plural,\n          =0 {No users}\n          one {# user}\n          other {# users}\n        } selected. You cannot select any more.",values:{numSelectedUsers:s}}):s>0?e.jsx(l,{id:"dYtUgP",defaultMessage:"{numSelectedUsers, plural,\n          =0 {No users}\n          one {# user}\n          other {# users}\n        } selected. You can select up to {remainingAllowedUsers} more.",values:{numSelectedUsers:s,remainingAllowedUsers:t-s}}):e.jsx(l,{id:"nVfqBL",defaultMessage:"Select up to {maxAllowedUsers, plural,\n          =0 {No users}\n          one {# user}\n          other {# users}\n        }.",values:{maxAllowedUsers:t}})}function gs({connectionId:t,connectorType:s,accountId:o,onClose:n,refetch:r,numWorkspaceMembers:a,areAllUsersAllowed:i,allowedUserIds:d,primaryButton:g,secondaryButton:u,footerContent:h}){const x=P(),[j,b]=m.useState(i?"allow_all":"allow_admins"),[_,w]=m.useState(!1),v=W(),{data:f}=oe(o,0,void 0,100,void 0,["account-owner","account-admin"]),y=f==null?void 0:f.items,c=async()=>{if(!(y!=null&&y.length)||_)return;i!==!1&&await M.admin_connection_update_access_policy(o,t,!1);const p=new Set(y.map(E=>E.id));await Promise.all(y.map(E=>M.admin_connection_allow_user(o,t,E.id)));const S=(d!=null?d:[]).filter(E=>!p.has(E));await Promise.all(S.map(E=>M.admin_connection_disallow_user(o,t,E)))},N=async()=>{_||i||await M.admin_connection_update_access_policy(o,t,!0)},C=async()=>{w(!0);try{await(j==="allow_admins"?c():N()),await r()}catch(p){v.danger(x.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Error saving"})}finally{w(!1)}};return e.jsxs(R,L(D({},$),{title:Q(s),onClose:n,testId:"modal-dwd-allowed-users-picker",children:[e.jsx("div",{className:"px-6 py-4 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsxs(De,{value:j,onValueChange:p=>b(p),className:"flex w-full flex-col gap-2 px-6 py-4",children:[e.jsx(Ie,{optionValue:"allow_all",Icon:ls,optionName:x.formatMessage({id:"vtytpk",defaultMessage:"Everyone"}),subtitle:a!=null?x.formatMessage({id:"15cHOa",defaultMessage:"{count} members"},{count:a}):e.jsx(H,{lines:1}),isSelected:j==="allow_all"}),e.jsx("div",{className:"border-token-border-default border-t"}),e.jsx(Ie,{optionValue:"allow_admins",Icon:as,subtitle:y!=null?y.length>3?x.formatList([...y.slice(3).map(p=>{var S;return(S=p.name)!=null?S:p.email}),x.formatMessage({id:"zb4UOk",defaultMessage:"{count} more"},{count:y.length-3})]):x.formatList(y.map(p=>{var S;return(S=p.name)!=null?S:p.email})):e.jsx(H,{lines:1}),optionName:x.formatMessage({id:"l0D/jy",defaultMessage:"Admins only"}),isSelected:j==="allow_admins"})]}),e.jsx(F,{footerContent:h,primaryButton:g?m.cloneElement(g,{disabled:_,loading:_,onClick:async p=>{var S,E;await C(),(E=(S=g.props).onClick)==null||E.call(S,p)}}):e.jsx(k,{color:"primary",onClick:C,loading:_,disabled:_,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:_&&u?m.cloneElement(u,{disabled:!0,onClick:()=>{}}):u})]}))}function Ie({optionName:t,optionValue:s,subtitle:o,Icon:n,isSelected:r,disabled:a}){const i=r?rs:os;return e.jsxs(Le,{value:s,id:"dwd-allowed-users-option-".concat(s),className:re("flex w-full items-center justify-start gap-4",a&&"opacity-50"),disabled:a,children:[e.jsx("div",{className:"bg-token-bg-tertiary flex h-[40px] w-[40px] items-center justify-center rounded-xl",children:e.jsx(n,{className:"icon-lg"})}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"text-token-text-primary text-start",children:t}),e.jsx("div",{className:"text-token-text-secondary mt-1 text-start text-sm text-wrap",children:o})]}),e.jsx(i,{className:"icon-lg shrink-0"})]})}function ms({connectionDisplayInfo:t}){return e.jsxs("span",{className:"bg-token-main-surface-secondary rounded-xl px-2 py-1 font-bold whitespace-nowrap",children:[t.icon_url&&e.jsx("img",{src:t.icon_url,alt:"",className:"icon-sm me-2 inline"}),t.display_name]})}function xs({isOpen:t,onClose:s,onActivate:o,connectionId:n,accountId:r,connectionDisplayInfo:a,footerContent:i,secondaryButton:d,connectorType:g}){const u=P(),h=W(),x=G(),j=Pe(x),{triggerLocation:b}=z(),[_,w]=m.useState(!1),v=()=>{w(!0),M.admin_activate_connection_instance(r,n).then(()=>{O.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:g,triggerLocation:b}),h.success(u.formatMessage({id:"y5DD0Z",defaultMessage:"Connection successfully activated."})),o==null||o(),s==null||s()}).catch(()=>{h.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"review_and_activate_modal",loggingTitle:"Failed to activate connection",loggingDescription:"Failed to activate connection"})}).finally(()=>{w(!1)})},f=e.jsx(k,{color:"primary",loading:_,onClick:v,disabled:j,children:e.jsx(l,{id:"C2dZRO",defaultMessage:"Done"})});return e.jsxs(R,L(D({},$),{testId:"modal-review-and-activate",isOpen:t,onClose:s,title:Q(g),children:[e.jsxs("div",{className:"flex flex-col gap-3 px-6 pt-4 pb-10",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"38WXzu",defaultMessage:"Review"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"yQhjtE",defaultMessage:"Confirm everything looks good to you, then click the button to activate the connection and start syncing. "})}),e.jsx(ms,{connectionDisplayInfo:a})]}),e.jsx(F,{primaryButton:j?e.jsx(At,{children:f}):f,secondaryButton:d,footerContent:i})]}))}function Fe({steps:t,onClose:s}){var g,u;const o=t.length,[n,r]=m.useState(0),a=(g=t[0])==null?void 0:g.connectorType,i=(u=t[0])==null?void 0:u.name;m.useEffect(()=>{!a||!i||O.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:a,stepName:i})},[a,i]);const d=h=>{r(h),!(h<0||h>=t.length)&&O.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:t[h].connectorType,stepName:t[h].name})};return n<t.length?t[n].fn({goForward:n<o-1?()=>d(n+1):void 0,goBackward:n>0?()=>d(n-1):void 0,close:s,stepNumber:n,totalSteps:o}):null}const fs=-1;function Ge(t){return Ue(t.knowledge_connector_type)}function Ue(t){return t?t==="google_drive_oauth"?25:t==="sharepoint"?10:fs:0}const Gs={max_instances:0};function _s({onClose:t,backButton:s}){const[o,n]=m.useState(),r=G(),a=V(r);return a?o?e.jsx(ps,{accountId:a.id,connection:o,onClose:()=>t(!0)}):e.jsx(hs,{onClose:t,backButton:s,setConnection:n}):null}function hs({onClose:t,setConnection:s,backButton:o}){const n=P(),r=W(),a=G(),i=V(a),d=m.useId(),{triggerLocation:g}=z();m.useEffect(()=>{O.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_dwd",stepName:"basic_info",triggerLocation:g})},[g]);const[u,h]=m.useState(""),x=u.length>128,j=u.trim().length>0&&!x,[b,_]=m.useState(!1),w=m.useCallback(()=>{!j||!i||b||(_(!0),M.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_dwd",connection_config_id:"--fake-local-id"},u.trim()).then(v=>{s(v)}).catch(()=>{r.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"gdrive_dwd_setup_flow",loggingTitle:"Failed to create connection",loggingDescription:"Failed to create connection"})}).finally(()=>{_(!1)}))},[i,u,n,j,b,s,r]);return e.jsxs(R,L(D({},q),{onClose:()=>t==null?void 0:t(),testId:"modal-gdrive-dwd-basic-info",children:[e.jsxs("form",{onSubmit:v=>{v.preventDefault(),j&&w()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:d,className:"text-xl font-medium",children:e.jsx(l,{id:"+wLWeZ",defaultMessage:"Enter display name"})}),e.jsx("input",{type:"text",value:u,onChange:v=>h(v.target.value),id:d,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(l,{id:"CPXVQO",defaultMessage:"This is the name your members will see in their ChatGPT connectors."})}),x?e.jsx("p",{className:"text-red-500",children:e.jsx(l,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(F,{secondaryButton:o,primaryButton:e.jsx(k,{color:"primary",disabled:!j||b,loading:b,onClick:w,children:e.jsx(l,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]}))}function ps({connection:t,accountId:s,onClose:o}){return e.jsx(Fe,{onClose:o,steps:[{connectorType:"google_drive_dwd",name:"credential",fn:({goForward:n,close:r,stepNumber:a,totalSteps:i})=>e.jsx(qt,{onClose:()=>r==null?void 0:r(),accountId:s,connectionId:t.connection_config.connection_config_id,onNext:n!=null?n:(()=>null),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:a+1,totalSteps:i}})})})},{connectorType:"google_drive_dwd",name:"user_drives",fn:({goForward:n,goBackward:r,close:a,stepNumber:i,totalSteps:d})=>e.jsx(ss,{onClose:()=>a==null?void 0:a(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n&&e.jsx(k,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:r&&e.jsx(k,{color:"secondary",onClick:r,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:d}})}),isOpen:!0,isPostActivation:!1})},{connectorType:"google_drive_dwd",name:"shared_drives",fn:({goForward:n,goBackward:r,close:a,stepNumber:i,totalSteps:d})=>e.jsx(Zt,{onClose:()=>a==null?void 0:a(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n&&e.jsx(k,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:r&&e.jsx(k,{color:"secondary",onClick:r,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:d}})}),isOpen:!0})},{connectorType:"google_drive_dwd",name:"allowed_users",fn:({goForward:n,goBackward:r,close:a,stepNumber:i,totalSteps:d})=>e.jsx(Re,{connectorType:"google_drive_dwd",fallbackEstimatedMaxNumUsers:Ge(t.connection_config),onClose:()=>a==null?void 0:a(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n&&e.jsx(k,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:r&&e.jsx(k,{color:"secondary",onClick:r,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:d}})})})},{connectorType:"google_drive_dwd",name:"review_and_activate",fn:({goBackward:n,close:r,stepNumber:a,totalSteps:i})=>e.jsx(xs,{isOpen:!0,onClose:()=>r==null?void 0:r(),accountId:s,connectorType:"google_drive_dwd",connectionId:t.connection_config.connection_config_id,connectionDisplayInfo:t.display_info,secondaryButton:n&&e.jsx(k,{color:"secondary",onClick:n,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:a+1,totalSteps:i}})})})}]})}const js=({domainName:t,intl:s})=>t.trim().toLocaleLowerCase()==="gmail.com"?{valid:!1,errorType:"domainChecker.error.gmail",error:s.formatMessage({id:"domainChecker.error.gmail",defaultMessage:"Personal Google Accounts (e.g. gmail.com) are not supported"})}:{valid:!0},vs=({domainName:t,intl:s})=>{const o=t.trim();if(/^https?:\/\//i.test(o))return{valid:!1,errorType:"domainChecker.error.noHttp",error:s.formatMessage({id:"domainChecker.error.noHttp",defaultMessage:"Do not include http:// or https:// in the domain."})};if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return{valid:!1,errorType:"domainChecker.error.noEmail",error:s.formatMessage({id:"domainChecker.error.noEmail",defaultMessage:"Do not use an email address. Use only the domain name."})};if(/[^a-zA-Z0-9.-]/.test(o))return{valid:!1,errorType:"domainChecker.error.invalidCharacters",error:s.formatMessage({id:"domainChecker.error.invalidCharacters",defaultMessage:"Domain contains invalid characters. Only letters, numbers, hyphens, and dots are allowed."})};const n=o.split(".");if(n.length<2)return{valid:!1,errorType:"domainChecker.error.missingDot",error:s.formatMessage({id:"domainChecker.error.missingDot",defaultMessage:"Domain must include at least one dot (e.g., example.com)."})};for(const a of n){if(!a)return{valid:!1,errorType:"domainChecker.error.emptySection",error:s.formatMessage({id:"domainChecker.error.emptySection",defaultMessage:"Domain has empty sections between dots (e.g., '..' or '.com.')."})};if(a.length>63)return{valid:!1,errorType:"domainChecker.error.labelTooLong",error:s.formatMessage({id:"domainChecker.error.labelTooLong",defaultMessage:"Each part of the domain must be 63 characters or less."})};if(!/^[a-zA-Z0-9-]+$/.test(a))return{valid:!1,errorType:"domainChecker.error.invalidLabelCharacters",error:s.formatMessage({id:"domainChecker.error.invalidLabelCharacters",defaultMessage:'Domain label "{label}" has invalid characters.'},{label:a})};if(/^-|-$/.test(a))return{valid:!1,errorType:"domainChecker.error.hyphenPosition",error:s.formatMessage({id:"domainChecker.error.hyphenPosition",defaultMessage:'Domain label "{label}" cannot start or end with a hyphen.'},{label:a})}}const r=n[n.length-1];return r.length<2||!/^[a-zA-Z]+$/.test(r)?{valid:!1,errorType:"domainChecker.error.invalidTLD",error:s.formatMessage({id:"domainChecker.error.invalidTLD",defaultMessage:"Top-level domain must be at least 2 letters."})}:{valid:!0}},ys=T(()=>I(()=>import("./gsas8pb1acnf7jnd.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>A(t)});function ks({onClose:t,backButton:s}){const[o,n]=m.useState(),r=G(),a=V(r);return a?o?e.jsx(Ms,{accountId:a.id,connection:o,onClose:t}):e.jsx(bs,{onClose:t,backButton:s,setConnection:n}):null}function bs({onClose:t,setConnection:s,backButton:o}){const n=P(),r=W(),a=G(),i=V(a),d=m.useId(),{triggerLocation:g}=z();m.useEffect(()=>{O.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"basic_info",triggerLocation:g})},[g]);const u=Lt(),h=m.useMemo(()=>{var N;const c=(N=u==null?void 0:u.email)==null?void 0:N.split("@")[1];return c&&u.email_domain_type!=="social"?c:""},[u]),[x,j]=m.useState(h),[b,_]=m.useState(""),w=m.useCallback(c=>{let{valid:N,error:C,errorType:p}=js({domainName:c,intl:n});return N&&({valid:N,error:C,errorType:p}=vs({domainName:c,intl:n})),C&&O.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_oauth",stepName:"basic_info",error:"invalid_domain-".concat(p),triggerLocation:g}),{valid:N,error:C}},[n,g]),[v,f]=m.useState(!1),y=m.useCallback(async()=>{if(!x||!i)return;const{valid:c,error:N}=w(x);if(_(N!=null?N:""),!!c){f(!0);try{const C=await M.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_oauth",domain_name:x,connection_config_id:"--fake-local-id"});u&&await M.admin_connection_allow_user(i.id,C.connection_config.connection_config_id,u.id),await M.admin_activate_connection_instance(i.id,C.connection_config.connection_config_id),O.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:C.connection_config.connection_config_id,triggerLocation:g}),s(C)}catch(C){r.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"gdrive_oauth_setup_flow",loggingTitle:"Failed to create connection",loggingDescription:"Failed to create connection"})}finally{f(!1)}}},[i,x,n,s,r,u,w,g]);return e.jsxs(R,L(D({},q),{onClose:()=>t==null?void 0:t(),testId:"modal-gdrive-basic-info",children:[e.jsxs("form",{onSubmit:c=>{c.preventDefault(),y()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("label",{htmlFor:d,children:[e.jsx("div",{className:"mb-4 text-xl font-medium",children:e.jsx(l,{id:"EbU972",defaultMessage:"Enter your Google Workspace domain"})}),e.jsx("div",{className:"text-token-text-secondary mb-4 text-sm font-normal",children:e.jsx(l,{id:"i83LbI",defaultMessage:"Only users from this Google Workspace domain will be able to connect their account. You domain name should look like example.com"})})]}),e.jsx(Ut,{type:"text",value:x,placeholder:"example.com",onChange:c=>{j(c.target.value),_("")},onBlur:()=>{const{error:c}=w(x);_(c!=null?c:"")},name:d,ariaLabel:"Domain name",className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid",error:b}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary mt-6 flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(ys,{className:"icon-lg"}),e.jsx("div",{children:e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:e.jsx(l,{id:"N7rcxx",defaultMessage:"<link>Read our guide</link> to ensure you’ve added the correct domain name.",values:{link:c=>e.jsx(ie,{href:we,className:"text-token-text-secondary text-sm underline",onClick:()=>le({link:we,location:"admin_onboarding_basic_info"}),children:c})}})})})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(F,{primaryButton:e.jsx(k,{color:"primary",disabled:x.trim()===""||!!b,loading:v,onClick:y,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:o})]}))}function ws({onClose:t,onSuccess:s,connection:o,accountId:n}){const{triggerLocation:r}=z();m.useEffect(()=>{O.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"quickstart",triggerLocation:r})},[r]);const a=async()=>{await M.admin_activate_connection_instance(n,o.connection_config.connection_config_id),O.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:o.connection_config.connection_config_id,adminQuickstart:!0,triggerLocation:r}),s()};return e.jsx(Dt,{connectionId:o.connection_config.connection_config_id,location:"admin_connection_quickstart",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>{t==null||t()},onSuccess:a,accountId:n})}function Ms({connection:t,accountId:s,onClose:o,hasAdminAlreadyConnected:n=!1}){const r=P(),a=[{connectorType:"google_drive_oauth",name:"allowed_users",fn:({goForward:i,close:d})=>e.jsx(Re,{connectorType:"google_drive_oauth",fallbackEstimatedMaxNumUsers:Ge(t.connection_config),onClose:()=>d==null?void 0:d(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n?e.jsx(k,{color:"primary",onClick:()=>o(),children:r.formatMessage(U.finish)}):i&&e.jsx(k,{color:"primary",onClick:i,children:r.formatMessage(U.continue)})})}];return n||a.push({connectorType:"google_drive_oauth",name:"admin_oauth_disclaimer",fn:({goForward:i,goBackward:d,close:g})=>e.jsx(Ot,{isOpen:!0,onClose:()=>g==null?void 0:g(),isAdminFlow:!0,isAdminQuickstartFlow:!1,secondaryButton:d&&e.jsx(k,{color:"secondary",onClick:d,children:r.formatMessage(U.back)}),primaryButton:e.jsx(k,{color:"primary",onClick:i,children:r.formatMessage(U.continue)})})},{connectorType:"google_drive_oauth",name:"admin_oauth_cta",fn:({goForward:i,goBackward:d,close:g})=>e.jsx(Pt,{isOpen:!0,onClose:()=>g==null?void 0:g(),secondaryButton:d&&e.jsx(k,{color:"secondary",onClick:d,children:r.formatMessage(U.back)}),primaryButton:e.jsx(ke,{onSuccess:()=>g==null?void 0:g(!0),onError:()=>i==null?void 0:i(),label:r.formatMessage(U.loginWithGoogle),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow"})})},{connectorType:"google_drive_oauth",name:"admin_oauth_error",fn:({close:i})=>e.jsx(Rt,{isOpen:!0,onClose:()=>i==null?void 0:i(),primaryButton:e.jsx(ke,{onSuccess:()=>i==null?void 0:i(),label:r.formatMessage(U.reconnect),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow",isReconnect:!0})})}),e.jsx(Fe,{onClose:o,steps:a})}const U=ae({back:{id:"RDaXnk",defaultMessage:"Back"},cancel:{id:"CfN1/v",defaultMessage:"Cancel"},continue:{id:"XGnWba",defaultMessage:"Continue"},loginWithGoogle:{id:"9ImAmL",defaultMessage:"Log in with Google"},reconnect:{id:"0qUCBD",defaultMessage:"Reconnect"},finish:{id:"5Wpd39",defaultMessage:"Finish"}}),Cs=T(()=>I(()=>import("./cv4rvmad80hmdgot.js").then(t=>t._),__vite__mapDeps([9,1])),{loading:t=>A(t)}),Ns=T(()=>I(()=>import("./rsi9kppw43ykrsgk.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>A(t)});function Us(o){var n=o,{triggerLocation:t}=n,s=ne(n,["triggerLocation"]);var g;const r=G(),a=V(r),{data:i,isLoading:d}=oe(a==null?void 0:a.getWorkspaceId(),0,void 0,1);return i||!d?e.jsx(de.Provider,{value:{triggerLocation:t},children:e.jsx(Ss,D({numUsersInWorkspace:(g=i==null?void 0:i.total)!=null?g:0},s))}):e.jsx(R,L(D({testId:"modal-gdrive-add-workspace-loader"},q),{isOpen:!0,onClose:s.onClose,children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(Z,{})})}))}function Ss({onClose:t,numUsersInWorkspace:s,isDwdEnabled:o}){const n=s>=Ue("google_drive_oauth")&&o,[r,a]=m.useState(n?"gdrive-dwd":"gdrive-oauth"),[i,d]=m.useState(!0),[g,u]=m.useState(),[h,x]=m.useState(!1),j=i&&o&&!g,b=G(),_=V(b),w=async()=>{const f=Wt(b,"516806730").get("quickstart_enabled");if(!(r==="gdrive-oauth"&&f)){d(!1);return}if(!(!(_!=null&&_.id)||g))try{x(!0),u(await M.admin_create_connection_instance(_.id,{knowledge_connector_type:"google_drive_oauth",domain_name:"",connection_config_id:"--fake-local-id"}))}catch(y){t()}finally{x(!1)}},{triggerLocation:v}=z();return m.useEffect(()=>{O.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive",stepName:"options",triggerLocation:v})},[v]),e.jsxs(e.Fragment,{children:[e.jsxs(R,L(D({testId:"modal-gdrive-add-workspace"},q),{isOpen:j,onClose:t,children:[e.jsx("div",{className:"px-6 pt-4 pb-10",children:e.jsx(Es,{preferDwd:n,selectedConnector:r,setSelectedConnector:a})}),e.jsx(F,{footerContent:e.jsx(ie,{href:Me,className:"text-token-text-secondary text-sm underline",onClick:()=>le({link:Me,location:"admin_onboarding_gdrive_options"}),children:e.jsx(l,{id:"ADGK4d",defaultMessage:"Which option is right for my team?"})}),primaryButton:e.jsx(k,{color:"primary",onClick:w,loading:h,disabled:h,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:e.jsx(k,{color:"secondary",onClick:()=>t(),disabled:h,children:e.jsx(l,{id:"5Oo8TW",defaultMessage:"Cancel"})})})]})),!j&&(g&&_?e.jsx(ws,{onClose:()=>{d(!0),u(void 0),t()},onSuccess:()=>{d(!0),u(void 0),t(!0)},connection:g,accountId:_.id}):r==="gdrive-oauth"?e.jsx(ks,{onClose:f=>{t(f),d(!0)},backButton:o&&e.jsx(k,{color:"secondary",onClick:()=>d(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):r==="gdrive-dwd"?e.jsx(_s,{onClose:f=>{t(f),d(!0)},backButton:e.jsx(k,{color:"secondary",onClick:()=>d(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):null)]})}function Es({selectedConnector:t,setSelectedConnector:s,preferDwd:o}){const n=P(),r=e.jsx(Te,{optionValue:"gdrive-oauth",optionName:n.formatMessage({id:"vIdj3/",defaultMessage:"Self-service setup"}),isSelected:t==="gdrive-oauth",checkedBulletPoints:[n.formatMessage({id:"hXiuKC",defaultMessage:"Each member must authenticate their account"})]}),a=e.jsx(Te,{optionValue:"gdrive-dwd",optionName:n.formatMessage({id:"ZNfVoO",defaultMessage:"Admin-managed setup"}),isSelected:t==="gdrive-dwd",checkedBulletPoints:[n.formatMessage({id:"A/omIq",defaultMessage:"Recommended for large teams"}),n.formatMessage({id:"1W662S",defaultMessage:"Centralized setup with service account credentials"})]});return e.jsxs("div",{children:[e.jsx("div",{className:"-mt-2 mb-6 text-start text-lg font-medium",children:e.jsx(l,{id:"JKSyU3",defaultMessage:"Choose how your team connects Google Drive"})}),e.jsx(De,{value:t,onValueChange:i=>s(i),className:"flex w-full flex-col gap-4",children:o?e.jsxs(e.Fragment,{children:[a,r]}):e.jsxs(e.Fragment,{children:[r,a]})})]})}function Te({optionName:t,optionValue:s,isSelected:o,checkedBulletPoints:n,disabled:r}){const a=o?Ns:Cs;return e.jsxs(Le,{value:s,id:"connector-group-option-".concat(s),className:re("border-token-border-heavy flex w-full justify-between rounded-xl border border-solid p-4",r&&"opacity-50",o&&"border-token-text-primary"),disabled:r,children:[e.jsxs("div",{className:"max-w-96 shrink-0",children:[e.jsx("div",{className:"text-start font-medium",children:t}),e.jsx("div",{className:"font-tertiary mt-1 text-start text-sm",children:n.length&&e.jsx("ul",{className:"text-token-text-secondary mt-1 mb-2 flex-1 list-inside list-disc",children:n.map((i,d)=>e.jsx("li",{className:"text-sm",children:i},d))})})]}),e.jsx(a,{className:"icon-lg shrink-0"})]})}export{Re as A,B as C,Gs as D,Us as G,Fe as M,xs as R,fs as S,$ as a,Fs as b,qt as c,ss as d,Zt as e,ms as f,Ge as g,le as t,z as u};
//# sourceMappingURL=ol66fkh2eqwvqlft.js.map
