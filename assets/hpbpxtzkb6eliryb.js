const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/c1l8fjfcsh4r8b9b.js","assets/i8clt0mfz495j7ii.js","assets/jyroje0qaxw6h3z1.js"])))=>i.map(i=>d[i]);
var St=Object.defineProperty;var tt=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var et=(t,s,i)=>s in t?St(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,z=(t,s)=>{for(var i in s||(s={}))Pt.call(s,i)&&et(t,i,s[i]);if(tt)for(var i of tt(s))vt.call(s,i)&&et(t,i,s[i]);return t};import{j as e,_ as mt,e as ut,M as it,r as h}from"./i8clt0mfz495j7ii.js";import{u as D,h as w,aN as Et,d as j,o as pt,L as xt,cO as Ct,$ as It,a as At,bM as Ot,bR as $t,cE as zt,bX as Dt,e as Lt,P as at,bT as rt,bY as nt,R as Bt,bO as Ft,bQ as Rt,cH as Ht}from"./ghewn7l2ynbm32fm.js";import{ig as ft,ih as ht,mb as kt,g_ as Wt,mc as Gt,ir as Qt,is as Vt,it as qt,iu as Kt,li as st,md as Xt,me as Yt,fk as Jt,iz as ot,iv as Zt,mf as Ut,iA as Mt}from"./j0yo6uv6652vva62.js";import{CoT as te}from"./ijctvkapujvvau9j.js";import{M as lt}from"./olrcssu7duieo6m7.js";import"./gla0jqw9ed8nrnoj.js";import"./hk7ym2rzlomukbdz.js";import"./pbvsc3do5o365cxq.js";import"./owvt7s3ln6qx5fou.js";import"./ksuwacyo5m7qmkk7.js";import"./dwikchly7agkd2y3.js";import"./bbipyj9bituayr8q.js";import"./ivb8c1xam3e690hh.js";import"./o2ch1u40q6bs5ljp.js";import"./k1t8elp5z7nmkg2d.js";import"./gdq1l97elemowxcc.js";import"./pbl95wx6493wq92j.js";import"./o56jrqjpjpipvc65.js";import"./lktqd4c5dfo8cx5l.js";import"./ov015nmz1yxh95ok.js";function dt({message:t,isCircular:s=!1}){var m,k,x;const i=5.333333333333334;let r=(k=(m=t==null?void 0:t.metadata)==null?void 0:m.pro_progress)!=null?k:0;const p=((x=t==null?void 0:t.metadata)==null?void 0:x.model_slug)==="o1-pro"?480*1e3:1200*1e3,o=t!=null&&t.create_time?t.create_time*1e3:Date.now(),u=ft(o,p);r=Math.max(u,r);const n=D(),d=w(n,"3208967109");return d&&(r=Math.max(r,i)),s?e.jsx(ht,{percentage:r,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(kt,{percentage:r,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:d?4:8})}function ct({message:t,simulatedDuration:s=480*1e3,maxFill:i=100,isCircular:r=!1}){var d;((d=t==null?void 0:t.metadata)==null?void 0:d.model_slug)!=="o1-pro"&&(s=1200*1e3);const p=t!=null&&t.create_time?new Date(t.create_time*1e3):Date.now(),o=ft(+p,s),u=D(),n=w(u,"3208967109");return r?e.jsx(ht,{percentage:o,className:"me-4 w-full!",transitionDuration:"".concat((100-o)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(kt,{percentage:Math.min(o,i),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-o)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:n?4:8})}const ee=pt(()=>mt(()=>import("./c1l8fjfcsh4r8b9b.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>xt(t)});function ie({title:t,content:s,buttons:i,time:r,icon:p,size:o="default",progressBar:u,disabled:n=!1,onClick:d}){const m=o==="small"?"w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ".concat(n?"":"gap-4"):"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",k=d?"cursor-pointer":"",x=o==="small"?"text-[15px]":"",g=Et(Ct);return e.jsxs("div",{className:j("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!g&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",m,k,x),onClick:d,children:[e.jsxs("div",{className:j("flex flex-col items-start justify-start self-stretch",o!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:j("inline-flex items-start justify-start self-stretch",o!=="small"&&"gap-2"),children:[e.jsx("div",{className:j("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:t}),e.jsx("div",{className:"relative h-6 w-6"}),!n&&(p||e.jsx(ee,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:j("flex w-full flex-col items-start justify-start",o==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:j("inline-flex w-full items-start justify-start self-stretch rounded-sm",o==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:j("w-full leading-relaxed font-normal",n?"text-token-text-tertiary":"text-token-text-secondary"),children:s})})})]}),u?e.jsxs("div",{className:j("mb-2 inline-flex items-center justify-between self-stretch",(i==null?void 0:i.length)&&"mt-[-10px]"),children:[u,i]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[r&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:r}),e.jsx("div",{className:"flex gap-2",children:i})]})]})}const ae=pt(()=>mt(()=>import("./jyroje0qaxw6h3z1.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>xt(t)});function re({errorNotice:t,onOpenSidebarSummarizer:s,isReceivingUpdates:i,lastMessage:r,latestTitle:p,summarizationHeadline:o,handleSkipClick:u}){var P,_,I,A,a,O,y;const n=D(),d=ut(),m=w(n,"4094234945"),k=w(n,"3208967109"),x=w(n,"3327816228"),g=m?dt:ct,S=i&&x&&((P=r==null?void 0:r.metadata)==null?void 0:P.pro_progress),C=(((_=r==null?void 0:r.metadata)==null?void 0:_.pro_skipped)||((I=r==null?void 0:r.clientMetadata)==null?void 0:I.proSkipPending))&&i;if(k){if(C)return e.jsx("span",{className:"result-streaming pulse relative pt-1",children:e.jsx("span",{})});const b=(a=i?p:(A=r==null?void 0:r.metadata)==null?void 0:A.finished_text)!=null?a:d.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return e.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("button",{type:"button",onClick:s,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:e.jsxs("span",{className:i?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[b,e.jsx(ae,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap transition-opacity duration-1000 ease-out ".concat(S?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!S,tabIndex:S?0:-1,children:e.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:e.jsx(it,{id:"xMM6dg",defaultMessage:"Answer now"})})}),i&&e.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:e.jsx(g,{message:r,isCircular:!0})})]})]}),i&&e.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:e.jsx("div",{className:"w-full max-w-[150px]",children:e.jsx(g,{message:r,isCircular:!1})})})]}),t]})}return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(ie,{buttons:i?[e.jsx(It,{onClick:b=>{b.stopPropagation(),s()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(it,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:o,icon:i?e.jsx("div",{className:""}):null,content:i?"".concat(p,"..."):(y=(O=r==null?void 0:r.metadata)==null?void 0:O.finished_text)!=null?y:"",size:"small",disabled:!i,onClick:s,progressBar:i?m?e.jsx(dt,{message:r}):e.jsx(ct,{message:r}):null}),t]})}const ne=/\*\*(.*?)(?:\*\*|\n|$)/g,se=t=>{let s=null,i;for(;(i=ne.exec(t))!=null;)s=i[1].trim();return s};function ve({messages:t,isStreaming:s,isCompletionRequestInProgress:i,hasActiveRequest:r,isLastMessage:p,isFinalTurn:o,isFeedbackEnabled:u,conversation:n,currentGroupedMessageIndex:d,turnIndex:m}){var G,Q,V,q,K,X,Y,J,Z,U,M;const[k,x]=h.useState(""),[g,S]=h.useState(!1),[C,P]=h.useState(!1),_=At(n.serverId$),I=((G=Wt(n.id))==null?void 0:G.value)===Ot.STREAMING,A=Gt($t(n.id)),a=zt(t),O=a==null?void 0:a.id,y=(Q=a==null?void 0:a.metadata)==null?void 0:Q.initial_text,b=(V=a==null?void 0:a.metadata)==null?void 0:V.summarization_headline,$=t.map(l=>Dt(l)).join("\n\n"),L=ut(),B=Lt(),f=(q=a==null?void 0:a.metadata)==null?void 0:q.async_task_id;Qt(f,a,n.id),Vt(f);const c=qt(l=>Kt.getTask(f!=null?f:"",l)),R=h.useCallback(()=>{f?st(n,{type:"cot",turnIndex:m,reasoningGroupIndex:d}):st(n,{type:"summarizer",currentGroupedMessageIndex:d,turnIndex:m})},[n,d,m,f]),bt=Xt(),jt=(K=c==null?void 0:c.taskId)==null?void 0:K.startsWith("thinking"),H=bt&&c&&ot(c)&&!jt;h.useEffect(()=>{if(!H){P(!1);return}C||(Mt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:d}),P(!0))},[n,H,R,C,d,m]);const gt=h.useCallback(()=>{if(!_||!(a!=null&&a.id))return;at.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:_,messageId:a.id});const l=a.id,T=a.clientMetadata?z({},a.clientMetadata):void 0,v=a.metadata?z({},a.metadata):void 0;rt(n.id,F=>{nt.updateTree(F,E=>{E.updateNodeMetadata(l,{proSkipPending:!0}),E.updateNodeMessageMetadata(l,{pro_skipped:!0})})}),Bt.safePost("/pro_mode/{conversation_id}/skip",{parameters:{path:{conversation_id:_}}}).catch(()=>{B.danger(L.formatMessage({id:"summmarizer.skip.toast",defaultMessage:"Failed to answer now. Please try again."}),{hasCloseButton:!0,toastId:"summarizer_skip_failed"}),rt(n.id,F=>{nt.updateTree(F,E=>{E.updateNodeMetadata(l,{proSkipPending:T==null?void 0:T.proSkipPending}),E.updateNodeMessageMetadata(l,{pro_skipped:v==null?void 0:v.pro_skipped})})})})},[n.id,_,L,a,B]),_t=D(),W=w(_t,"3208967109"),yt=Yt({taskId:c==null?void 0:c.taskId,intl:L,toaster:B});h.useEffect(()=>{const l=se($);if(l){x(l);return}if(W&&b!=null){x(b);return}y!=null&&x(y)},[$,b,W,y]),h.useEffect(()=>{$.length>0&&S(!0)},[$]),h.useEffect(()=>{g&&at.logEvent("Tool: Received a8km123 message",{client_thread_id:n.id,message_id:O,conversationId:n.serverId$()})},[g]);const Nt=o&&p&&(I||s),Tt=Ft.isLastActorMessage(Rt(n.id),t[0].id),wt=!!Ht(n.id,l=>l==null?void 0:l.sharedConversationMetadata),N=Jt(t[0],Tt,i||r,wt);if(f){const l=c?ot(c):!1,T=f.startsWith("thinking")&&l,v=()=>{yt.mutate()};return e.jsx(te,{isStreaming:l,isFinalAssistantTurn:o,isAgentTurn:!1,taskType:c?Ut(c):void 0,messageGroups:Zt((X=c==null?void 0:c.rows)!=null?X:[]).groups,conversation:n,turnIndex:m,currentGroupedMessageIndex:d,latestError:N?z({messageId:t[0].id,conversation:n},N):void 0,isAutoswitchOptOutEnabled:T,handleSkipClick:T?v:void 0})}return!A&&((J=(Y=a==null?void 0:a.metadata)==null?void 0:Y.finish_details)==null?void 0:J.type)==="interrupted"&&((U=(Z=a==null?void 0:a.metadata)==null?void 0:Z.finish_details)==null?void 0:U.reason)!=="server_timeout"||(M=a==null?void 0:a.clientMetadata)!=null&&M.err?e.jsx("div",{children:N&&e.jsx(lt,{errorState:N,nodeId:t[0].id,isFeedbackEnabled:u,conversation:n,isUserTurn:!1})}):e.jsx(re,{errorNotice:N&&e.jsx(lt,{errorState:N,nodeId:t[0].id,isFeedbackEnabled:u,conversation:n,isUserTurn:!1}),onOpenSidebarSummarizer:R,isReceivingUpdates:Nt,lastMessage:a,latestTitle:k,summarizationHeadline:b,handleSkipClick:gt})}export{ve as default};
//# sourceMappingURL=hpbpxtzkb6eliryb.js.map
