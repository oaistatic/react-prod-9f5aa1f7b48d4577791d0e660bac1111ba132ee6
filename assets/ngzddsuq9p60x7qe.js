const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mbhfxri3syrb9rbq.js","assets/i8clt0mfz495j7ii.js","assets/j4nmkdkymh0gf9lt.js"])))=>i.map(i=>d[i]);
var we=Object.defineProperty,_e=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var se=(s,t,a)=>t in s?we(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,P=(s,t)=>{for(var a in t||(t={}))ve.call(t,a)&&se(s,a,t[a]);if(ee)for(var a of ee(t))ke.call(t,a)&&se(s,a,t[a]);return s},ae=(s,t)=>_e(s,je(t));import{e as y,j as e,f as Me,_ as H,r as g,M as G,R as Ce}from"./i8clt0mfz495j7ii.js";import{e4 as C,b0 as oe,P as B,o as J,L as O,e as Se,u as ie,z as re,bQ as X,bO as q,bR as be,d as R,aW as Ee,aR as Ie,R as Le,J as V}from"./ghewn7l2ynbm32fm.js";import{h as Ne,h8 as Pe,aL as Re,h9 as x,ha as A,d7 as Ae}from"./j0yo6uv6652vva62.js";import{X as Be,L as De,R as Te}from"./jq6zcafi39e65jll.js";import{u as We}from"./k5zh2h7fpzx4n2oe.js";import{d as te}from"./kl7c6054usfnqmd4.js";import{g as Ue}from"./k97n0y6ba9c9h39c.js";const $e=J(()=>H(()=>import("./mbhfxri3syrb9rbq.js").then(s=>s._),__vite__mapDeps([0,1])),{loading:s=>O(s)}),F=Me({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),ze=({downloading:s,onOdysseyFileDownload:t,disabled:a,icon:r,label:m,odysseyShareIntent:n})=>{const d=y();return n.fileName.endsWith("md")?e.jsxs(C.Root,{open:!a&&!s?void 0:!1,children:[e.jsx(C.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{B.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:a,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:s?e.jsx(oe,{}):r})}),e.jsx("div",{className:"w-full text-center text-xs",children:m})]})}),e.jsx(C.Portal,{children:e.jsxs(C.Content,{align:"end",children:[e.jsx(C.Item,{onClick:i=>{i.preventDefault(),t==null||t(n.fileName,n.fileId,n.messageId,"pdf")},children:d.formatMessage(F.downloadPdfButtonMenu)}),e.jsx(C.Item,{onClick:i=>{i.preventDefault(),t==null||t(n.fileName,n.fileId,n.messageId,"docx")},children:d.formatMessage(F.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{t==null||t(n.fileName,n.fileId,n.messageId,null),B.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:a,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx($e,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:d.formatMessage(F.download)})]},"download")},Ge=J(()=>H(()=>import("./j4nmkdkymh0gf9lt.js").then(s=>s._),__vite__mapDeps([2,1])),{loading:s=>O(s)}),ne=J(()=>H(()=>import("./mbhfxri3syrb9rbq.js").then(s=>s._),__vite__mapDeps([0,1])),{loading:s=>O(s)});function Ve({showLinkCopied:s,isGeneratingShareLink:t,onClick:a,postText:r,showDownloadButton:m,odysseyShareIntent:n,isDownloadingOdyssey:d,onOdysseyFileDownload:i,disabled:f}){const h=y(),I=ie(),S=re(I),L=S==null?void 0:S.isWorkspaceAccount();let w=[{id:"copy",icon:t?e.jsx(oe,{}):e.jsx(Ge,{}),label:s?h.formatMessage(x.linkCopied):h.formatMessage(x.copyLink),action:"copy"}];L?m&&w.push({id:"download",icon:e.jsx(ne,{}),label:h.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):w=w.concat({id:"x",href:l=>"https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(l),"&text=").concat(r?encodeURIComponent(r):""),icon:e.jsx(Be,{initialFillColor:"var(--text-primary)"}),label:h.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:l=>"https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(l),"&text=").concat(r?encodeURIComponent(r):""),icon:e.jsx(De,{initialFillColor:"var(--text-primary)"}),label:h.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:l=>"https://www.reddit.com/submit?url=".concat(encodeURIComponent(l),"&title=").concat(r?encodeURIComponent(r):""),icon:e.jsx(Te,{initialFillColor:"var(--text-primary)"}),label:h.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...m?[{id:"download",icon:e.jsx(ne,{}),label:h.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}]:[]);const _=!!d;return e.jsx(e.Fragment,{children:w.map(l=>l.id==="download"&&n?e.jsx(ze,{downloading:_,onOdysseyFileDownload:i,disabled:f!=null?f:!1,icon:l.icon,label:l.label,odysseyShareIntent:n},l.id):e.jsxs("button",{onClick:()=>{a(l),B.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:l.id})},disabled:f,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:l.icon})}),e.jsx("div",{className:"w-full text-center text-xs",children:l.label})]},l.id))})}function Fe(s,t){const a=X(s);return a?{id:"tmp",kind:"message_slice",messages:t.map(m=>{const n=q.findNode(a,({message:d})=>d.id===m);return n?n.message:null}).filter(Boolean)}:null}function Xe(s){return{id:"tmp",kind:"message_slice",messages:[s.previewMessage]}}function es({postSharingData:s,onClose:t}){const{clientThreadId:a,postText:r,generateShareLinkFn:m,coverImageUrl:n,messageSliceIds:d,odysseyShareIntent:i}=s,f=g.useRef(void 0),[h,I]=g.useState(!1),[S,L]=g.useState(!1),w=y(),_=Se(),[l,Q]=g.useState(!0),le=ie(),D=re(le),T=D==null?void 0:D.isWorkspaceAccount();g.useEffect(()=>{B.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),g.useEffect(()=>{f.current=void 0},[a]);const b=g.useMemo(()=>i?Xe(i):n||!d||d.length===0?null:Fe(a,d),[n,a,d,i]),W=g.useMemo(()=>{const c=X(a);return c?q.getConversationTurns(c).flatMap(u=>u.messages):[]},[a]);g.useEffect(()=>{if(!d||d.length===0)return;const c=X(a);d.filter(p=>!q.findNode(c,({message:j})=>j.id===p)).length>0&&Ne(a)},[a,d]);const{hasImage:ce,hasScreenshot:de}=g.useMemo(()=>{let c=!1,u=!1;if(W.length){const p=W,j=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,E=v=>{if(!Array.isArray(v))return!1;for(const o of v)if(o.type==="image_inline"&&o.clicked_from_url&&(u=!0),o.type==="file"&&"file_name"in o){const M=o.file_name.toLowerCase();(M.endsWith(".pptx")||j.test(M))&&(c=!0)}};p.forEach(v=>{var N,K,Y,Z;const o=v.metadata;if(!o)return;const M=[...Object.values((N=o.n7jupd_crefs_by_file)!=null?N:{}).flat(),...Object.values((K=o.content_references_by_file)!=null?K:{}).flat()],z=[...(Y=o.n7jupd_crefs)!=null?Y:[],...(Z=o.content_references)!=null?Z:[]];E(M),E(z)})}return{hasImage:c,hasScreenshot:u}},[W]),U=be(a),me=async(c,u)=>{if(!(h||!U)&&U){if(!f.current){I(!0);try{const p=await m();p&&(f.current=p)}catch(p){_.danger(x.failedToGenerateShareLink,{toastId:"failed_to_generate_share_link"})}finally{I(!1)}}if(f.current){if(c.action==="copy")navigator.clipboard.writeText(f.current),L(!0),_.success(w.formatMessage(x.linkCopied)),setTimeout(()=>{L(!1)},3e3);else if(c.action==="share"&&c.href)window.open(c.href(f.current),"_blank","noopener,noreferrer");else if(c.action==="download"){if(!n)return;Ae({url:n,fileName:"".concat(r,".png")})}}}},fe=e.jsx("div",{className:R("flex w-full justify-center rounded-xl",n||b&&(i!=null&&i.isStandaloneAttachment)?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!n&&!(i!=null&&i.isStandaloneAttachment)&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:n?e.jsx("img",{src:n,alt:r}):i!=null&&i.isStandaloneAttachment&&b?e.jsx(Pe,{attachments:[b],variant:"unfurl",className:"h-full w-full",clientThreadId:a}):b?e.jsx(Re,{attachments:[b],clientThreadId:a,className:"h-full"}):null}),he="normal",[ge,$]=g.useState(!1),{presentationMap:ue}=We(),k=w.formatMessage(x.downloadFileError),pe=async(c,u,p,j)=>{var v;const E=U;if(!(!c||!u||!E))if($(!0),c.endsWith("md")){if(!j)return;try{const o=await Le.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:E,message_id:p,file_id:u,export_type:j},skipJsonTransform:!0});o.ok||(_.danger(k,{toastId:"post_sharing_modal_download_error",loggingTitle:k,loggingDescription:"Error message when a file download fails"}),V.addError("post_sharing_modal_download_error",{statusText:o.statusText,status:o.status}));const M=await o.blob(),z=o.headers.get("Content-Disposition"),N=(v=Ue(z))!=null?v:"Agent.".concat(j);te(M,N)}catch(o){_.danger(k,{toastId:"post_sharing_modal_download_error",loggingTitle:k,loggingDescription:"Error message when a file download fails"}),V.addError(o)}finally{$(!1)}}else{const o=ue[u];if(!o||!o.fileBlob){_.danger(k,{toastId:"post_sharing_modal_download_error",loggingTitle:k,loggingDescription:"Error message when a file download fails"}),V.addError("post_sharing_modal_download_error"),$(!1);return}te(o.fileBlob,c)}},xe=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:R("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(Ve,{showLinkCopied:S,isGeneratingShareLink:h,disabled:h,onClick:me,postText:r,showDownloadButton:!!(n||i),odysseyShareIntent:i,isDownloadingOdyssey:ge,onOdysseyFileDownload:pe})}),qe(ce,de,T!=null?T:!1)]});return e.jsx(Ee,{onExitComplete:t,children:l&&e.jsx(A.Root,{isOpen:!0,onClose:()=>{Q(!1)},className:"max-w-[664px] px-4",children:e.jsx(A.Overlay,{showBackground:!0,children:e.jsxs(A.Content,{size:"normal",position:"center",className:R("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":he==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(A.Header,{title:r,type:"success",closeButton:e.jsx(Ie,{onClick:()=>Q(!1)})}),e.jsxs("div",{children:[e.jsx("div",{className:R("flex justify-center",!i&&"pointer-events-none"),children:fe}),xe]})]})})})})}function qe(s,t,a){const r=[];return a&&r.push(e.jsx(G,P({},x.shareLinkVisibleToWorkspaceOnly),"workspace")),t&&r.push(e.jsx(G,P({},x.screenshotDisclaimer),"screenshot")),s&&r.push(e.jsx(G,ae(P({},x.imageLicenseDisclaimer),{values:{nbsp:" ",link:m=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:m})}}),"image")),r.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:r.map((m,n)=>e.jsxs(Ce.Fragment,{children:[n>0&&e.jsx(e.Fragment,{children:" "}),m]},n))},"image-disclaimer"):null}export{es as PostSharingModal};
//# sourceMappingURL=ngzddsuq9p60x7qe.js.map
