var G=Object.defineProperty,j=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var m=(o,t,n)=>t in o?G(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,R=(o,t)=>{for(var n in t||(t={}))v.call(t,n)&&m(o,n,t[n]);if(S)for(var n of S(t))B.call(t,n)&&m(o,n,t[n]);return o},y=(o,t)=>j(o,q(t));import{A as $,e as W,h as K,r as P,u as Q,j as I,ac as k,f as z}from"./i8clt0mfz495j7ii.js";import{f1 as a,u as J,mP as Y,e as V,mQ as X,ky as Z,R as w,f0 as _,aS as ee,aU as te,aH as ne,aL as h,jU as se,aJ as oe,mR as N,P as M,mS as ce,j as ae}from"./ghewn7l2ynbm32fm.js";import{g as re}from"./e93h41nejhumufi1.js";import{C as ie}from"./o56jrqjpjpipvc65.js";const ue={OAUTH_SCOPES_MISMATCH:a.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:a.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},b=z({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),de=$(function(){const t=W(),n=J(),r=K(),p=Z("installations/select_target"),g=Y(),U=V(),f=P.useRef(!1),{mutateAsync:L}=X(),d=Q();return P.useEffect(()=>{if(f.current===!0)return;f.current=!0;async function H(){var A,O,T;const C=re()==="popup"||g,D=window.location.href;try{const e=await w.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:D}});if(await d.invalidateQueries({refetchType:"all",queryKey:["fetchConnectorLinkData"]}),!(e!=null&&e.post_auth_url)){r(_(a.OAUTH_FAILED_GENERIC));return}const s=new URL(e.post_auth_url,location.origin),i=((A=e==null?void 0:e.link)==null?void 0:A.connector_id)===ee[te.GITHUB_CONNECTOR],u=s.searchParams.get("github_onboarding")==="sync-repos";if(i&&u){const c=await w.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(p,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const E=ne(s.hash)===h.Connectors;if(!E){const c=se[e.link.connector_id];c&&s.searchParams.set("add_source",c)}let l;if(E){const c=new URLSearchParams;c.set("connector",e.link.connector_id),i&&!u&&c.set("github_onboarding","configure-repos");const F=y(R({},s),{search:"",hash:oe(h.Connectors).hash+"?".concat(c.toString())});l=k(F)}else i&&!u&&s.searchParams.set("github_onboarding","configure-repos"),l=k({pathname:s.pathname,search:s.search,hash:s.hash});if(C){N({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}M.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id});const x=e.link.connector_id===ce?t.formatMessage(b.slackAiAppSuccess):t.formatMessage(b.genericSuccess,{connector:e.link.name});r(_(a.CUSTOM_MSG,l,x))}catch(e){const s=e instanceof ae?(T=ue[(O=e.detail)==null?void 0:O.error_code])!=null?T:a.OAUTH_FAILED_GENERIC:a.OAUTH_FAILED_GENERIC;if(C){N({success:!1,connectorId:"",errorType:s}),window.close();return}M.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:s,success:!1,type:"unknown"}),r(_(s,"#settings/".concat(h.Connectors)))}}H()},[n,g,p,t,r,U,L,d]),I.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:I.jsx(ie,{size:36})})});export{de as default};
//# sourceMappingURL=cpdsh3off8x2tq7s.js.map
