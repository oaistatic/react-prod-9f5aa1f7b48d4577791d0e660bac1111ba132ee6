var J=Object.defineProperty,W=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var D=(e,r,o)=>r in e?J(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,C=(e,r)=>{for(var o in r||(r={}))G.call(r,o)&&D(e,o,r[o]);if(B)for(var o of B(r))L.call(r,o)&&D(e,o,r[o]);return e},T=(e,r)=>W(e,F(r));import{cl as O,cn as v,hv as c,co as E,J as V}from"./ghewn7l2ynbm32fm.js";import{groupGlauxMessages as $}from"./ksuwacyo5m7qmkk7.js";import{b$ as g,c0 as H,c1 as K,c2 as P,c3 as Q,c4 as U}from"./j0yo6uv6652vva62.js";import{h as X}from"./dwikchly7agkd2y3.js";const b=new WeakMap;function oe(e,r){const o=[];let p=!1,h=!1;const k=l=>{if(h)return!0;const{recipient:m}=l;return typeof m=="string"&&m.startsWith("computer")};return e.forEach((l,m)=>{const _=m===e.length-1;let u=b.get([l,_]);if(!u){const d=e[m-1];u=Y(l,_,d,r),u&&b.set([l,_],u)}u&&o.push(...u),h||(h=l.messages.some(k)),p||(p=p||l.messages.some(d=>{var y;return((y=d.metadata)==null?void 0:y.n7jupd_message)&&d.author.name!==O.n7jupd_m&&d.content.content_type!==v.StructuredThoughts&&d.content.content_type!==v.ReasoningRecap}))}),{chunks:o,isAgentVisualCoT:p,containsAuraComputerTool:h}}function Y(e,r,o,p=!1){var h,k,l,m,_,u,d,y,A,M,z,w,R,q,I,j;switch(e.type){case c.ReasoningRecap:{if(p&&!r&&(o==null?void 0:o.type)===c.StructuredThoughts&&o.messages.length===1&&((h=o.messages[0].content.thoughts)==null?void 0:h.length)===0)return[];const n=e.messages[e.messages.length-1],s=n.content.content;return[{type:g.Recap,content:s,didFailReasoning:((k=n.metadata)==null?void 0:k.reasoning_status)==="reasoning_cancelled"}]}case c.Browsing:case c.RetrievalBrowsing:{const n=U({messages:e.messages});return[{type:g.Browsing,sources:n,isRetrieval:e.type===c.RetrievalBrowsing,title:(l=e.messages[0].metadata)==null?void 0:l.reasoning_title}]}case c.StructuredThoughts:{const n=[];for(const s of e.messages){const{thoughts:t}=s.content;for(const a of t)!a.content&&!a.summary||n.push({type:g.Thought,thought:a})}return n}case c.CodeInterpreter:case c.Container:{let n=e.messages.slice(1);const s=e.messages[0];let t=!0;if(s.author.role===E.Tool)n=e.messages,t=!1;else if(s.author.role!==E.Assistant){V.addError(new Error("[cot] out of order code tool messages"));break}return(n.length>0?n:[null]).map((i,f)=>{var N,S,x;return{type:i!=null&&(X(i)||((S=(N=i.metadata)==null?void 0:N.attachments)==null?void 0:S.length))?g.ImageAnalysis:g.CodeAnalysis,toolMessage:i,assistantMessage:f===0&&t?s:void 0,messages:e.messages,title:f===0&&t?(x=s.metadata)==null?void 0:x.reasoning_title:void 0}})}case c.CoTSearchTool:{const n={type:g.Search,queries:[],sources:[]};for(const s of e.messages)if((m=s.metadata)!=null&&m.reasoning_title&&(n.title=s.metadata.reasoning_title),(u=(_=s.metadata)==null?void 0:_.search_queries)!=null&&u.length&&(n.queries=s.metadata.search_queries),(y=(d=s.metadata)==null?void 0:d.search_result_groups)!=null&&y.length)for(const t of s.metadata.search_result_groups)(A=n==null?void 0:n.sources)!=null&&A.some(a=>a.domain===t.domain)||(M=n.sources)==null||M.push(t);return[n]}case c.n7jupd:return Q(e.messages,r);case c.n7jupd_x:return P(e);case c.n7jupd_a:return K(e);case c.n7jupd_native_api_tool:return H(e);case c.e1ld0dvz:{const n=[],s=new Map;for(const t of e.messages)if(t.content.content_type===v.Code){if((z=t.metadata)!=null&&z.e1ld0dvz_tasks)for(const a of t.metadata.e1ld0dvz_tasks)s.set(a.id,{id:a.id,status:"running",model:a.model,instruction:a.instruction,startedAtMs:(w=t.metadata)!=null&&w.e1ld0dvz_task_create_time?(R=t.metadata)==null?void 0:R.e1ld0dvz_task_create_time:Date.now()});else if((q=t.metadata)!=null&&q.e1ld0dvz_task_ids)for(const a of t.metadata.e1ld0dvz_task_ids)if(s.has(a)){const i=s.get(a);i&&s.set(a,T(C({},i),{status:"gathering"}))}else s.set(a,{id:a,status:"gathering"})}else if(((I=t.metadata)==null?void 0:I.e1ld0dvz_status)==="completed"&&((j=t.metadata)!=null&&j.e1ld0dvz_task_id)){const a=t.metadata.e1ld0dvz_task_id,i=s.get(a);i?s.set(a,T(C({},i),{status:"completed"})):s.set(a,{id:a,status:"completed"})}return n.push({type:g.e1ld0dvz,tasks:Array.from(s.values())}),n}case c.Glaux:{const n=$(e.messages),s=[];for(const t of n){if(t.call==="unhandled")continue;const a=t.call.isMixer?t.call.queries.map(f=>({connectorName:f.connectorName,query:f.query})):[{connectorName:t.call.connectorName,query:t.call.query}];if(!a.length)continue;const i=t.results.map(f=>C({},f));s.push({type:g.Glaux,queries:a,results:i})}return s}case c.Strix:return[]}}export{oe as p};
//# sourceMappingURL=o2ch1u40q6bs5ljp.js.map
