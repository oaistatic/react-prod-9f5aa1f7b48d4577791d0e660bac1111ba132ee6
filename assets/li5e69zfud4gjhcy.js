const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/b8lmybnmedr4n7bh.js","assets/i8clt0mfz495j7ii.js","assets/c55vg8l44veafqy5.js","assets/mbhfxri3syrb9rbq.js","assets/gf67njbmurwfkel2.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/dntm9op0tz5bndrs.js","assets/fzrn137102spawew.js","assets/eflwd0j5c3pxruh8.js","assets/j0yo6uv6652vva62.js","assets/conversation-small-lq38g8zw.css"])))=>i.map(i=>d[i]);
var Y=Object.freeze,se=Object.defineProperty,pe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var ee=(s,n,t)=>n in s?se(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,oe=(s,n)=>{for(var t in n||(n={}))ne.call(n,t)&&ee(s,t,n[t]);if(y)for(var t of y(n))te.call(n,t)&&ee(s,t,n[t]);return s},le=(s,n)=>pe(s,he(n));var ae=(s,n)=>{var t={};for(var l in s)ne.call(s,l)&&n.indexOf(l)<0&&(t[l]=s[l]);if(s!=null&&y)for(var l of y(s))n.indexOf(l)<0&&te.call(s,l)&&(t[l]=s[l]);return t};var re=(s,n)=>Y(se(s,"raw",{value:Y(n||s.slice())}));import{j as e,r as j,_ as L}from"./i8clt0mfz495j7ii.js";import{C as fe,m0 as je,m1 as _e,m3 as C,$ as ge,o as S,aR as ve,m2 as N,d as F,F as be,L as A,e as we,kF as Ce,es as Ne,eK as ke}from"./ghewn7l2ynbm32fm.js";import{dZ as ye,ae as Le,ad as Se}from"./j0yo6uv6652vva62.js";import{u as Ee,D as Oe}from"./pbj0pbxmo88l6n4f.js";import{u as Pe,U as De,a as ce}from"./gjgbg8mnok0ngaoo.js";import{s as Me}from"./dntm9op0tz5bndrs.js";import"./pc7u7c6vz2ia5xux.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./nnzgss862gapaux3.js";import"./f5bdf2ynleqr2zah.js";import"./jh95iaetowvobxaf.js";const P=S(()=>L(()=>import("./b8lmybnmedr4n7bh.js").then(s=>s._),__vite__mapDeps([0,1])),{loading:s=>A(s)}),D=S(()=>L(()=>import("./c55vg8l44veafqy5.js").then(s=>s._),__vite__mapDeps([2,1])),{loading:s=>A(s)}),Fe=S(()=>L(()=>import("./mbhfxri3syrb9rbq.js").then(s=>s._),__vite__mapDeps([3,1])),{loading:s=>A(s)}),Ae=S(()=>L(()=>import("./gf67njbmurwfkel2.js"),__vite__mapDeps([4,1,5,6,7,8,9,10,11])).then(s=>s.JsonViewer));function ss({threadId:s,threadUserId:n}){return Pe(De.isDebugModalOpen)&&e.jsx(fe,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>ce.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(ze,{threadId:s,threadUserId:n!=null?n:void 0,onClose:()=>ce.toggleDebugModalOpen()})})}const Re=(s,n)=>{const t=JSON.stringify(n,null,2),l=new Blob([t],{type:"application/json"}),a=window.URL.createObjectURL(l),i=document.createElement("a");i.href=a,i.download=s,i.click(),window.URL.revokeObjectURL(a)},ie="<|im_start|>",de="<|im_sep|>",me="<|im_end|>",Te="<|fim_suffix|>",$e="<|meta_sep|>";function xe({prompt:s}){const[n,t]=j.useState({}),l=[],a=[];let i=0;for(;;){const r=s.indexOf(ie,i);if(r===-1)break;const d=s.indexOf(de,r);if(d===-1)break;let o=s.indexOf(me,d);const m=s.indexOf(Te,d);if(m!==-1&&(o===-1||m<o)&&(o=m),o===-1)break;const c=s.substring(r+ie.length,d).replace($e," channel="),_=s.substring(d+de.length,o);a.push(r);const k=n[r];l.push(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>t(g=>le(oe({},g),{[r]:!g[r]})),children:k?e.jsx(P,{size:14}):e.jsx(D,{size:14})}),e.jsxs("span",{className:"font-semibold",children:["[",c,"]"]})]}),e.jsx("div",{className:F("whitespace-pre-wrap",k&&"line-clamp-2 truncate"),children:_})]},r)),i=o+me.length}function u(r){const d={};for(const o of a)d[o]=r;t(d)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>u(!0),children:[e.jsx(D,{size:14})," Collapse All"]}),"/",e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>u(!1),children:[e.jsx(P,{size:14})," Expand All"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:l})]})}var ue;const f=be.div(ue||(ue=re(["mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ",""])),({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent");function ze({threadId:s,threadUserId:n,message:t,onClose:l}){var T,$,z,V,I,J,U,B,K,Q,W;const[a,i]=j.useState(t?"message":"json"),{data:u,isLoading:r,refetch:d}=Ee({threadId:s,threadUserId:n,refetchOnMount:"always"}),o=u==null?void 0:u.thread;if(j.useEffect(()=>{i(t?"message":o!=null&&o.turns.length?"turn".concat((o==null?void 0:o.turns.length)-1):"thread")},[o==null?void 0:o.turns.length,t]),!r&&!o&&!t)return e.jsxs(Oe,{onClickRetry:()=>d(),children:["Failed to load."," "]});if(r)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const m=o==null?void 0:o.turns,c=o==null?void 0:o.turns[o.turns.length-1],_=($=(T=c==null?void 0:c.artifacts__)==null?void 0:T.model_snapshots)==null?void 0:$.default_id,k=(J=(I=(V=(z=c==null?void 0:c.artifacts__)==null?void 0:z.settings)==null?void 0:V.model_response)==null?void 0:I.completion_model)==null?void 0:J.model,g=_!=null?_:k,E=(U=c==null?void 0:c.artifacts__)==null?void 0:U.eval_preset,R=n&&s?ye(n,s):null,v=(Q=(K=(B=t==null?void 0:t.metadata)==null?void 0:B.__internal)==null?void 0:K.debug)==null?void 0:Q.render_for_completion_result_decoded;return e.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:e.jsxs(je,{orientation:"vertical",value:a,onValueChange:p=>i(p),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(_e,{className:"flex items-center justify-start gap-3 p-2",children:[t&&e.jsx(C,{value:"message",children:e.jsx(f,{$isSelected:a==="message",children:"Message"})},"message"),v&&e.jsx(C,{value:"render_for_completion",children:e.jsx(f,{$isSelected:a==="render_for_completion",children:"Prompt"})},"render_for_completion"),o&&e.jsx(C,{value:"thread",children:e.jsx(f,{$isSelected:a==="thread",children:"Thread"})},"thread"),e.jsx(C,{value:"connectors",children:e.jsx(f,{$isSelected:a==="connectors",children:"Connectors"})},"connectors"),m==null?void 0:m.map((p,x)=>{var h,b;return e.jsxs(j.Fragment,{children:[e.jsx(C,{value:"turn".concat(x),children:e.jsxs(f,{$isSelected:a==="turn".concat(x),children:["Turn[",x,"]"]})},x),(b=(h=p.artifacts__)==null?void 0:h.debug_ddtrace_urls)==null?void 0:b.map(w=>e.jsx(f,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:w,className:"text-nowrap",rel:"noreferrer",children:["Trace[",x,"] â†—"]})},w))]},x)})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[o&&e.jsxs(ge,{size:"small",color:"secondary",onClick:()=>Re("thread.json",o),children:[e.jsx(Fe,{className:"icon-sm"})," thread.json"]}),e.jsx(ve,{onClick:l})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"Model",id:g,className:"shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),E&&E!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"Eval Preset",id:E,className:"shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),R&&e.jsx(e.Fragment,{children:e.jsx(O,{name:"Permalink",id:R,className:"flex-shrink-1"})})]}),m==null?void 0:m.map((p,x)=>{var b,w,X,Z,q,G,H;const h=(b=p.model_response)==null?void 0:b.text;return e.jsxs(N,{value:"turn".concat(x),className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:F("flex flex-col gap-2 p-2",((w=p.index)!=null?w:0)%2===1&&"bg-token-main-surface-secondary"),children:[e.jsx(xe,{prompt:(G=(q=(Z=(X=p.artifacts__)==null?void 0:X.debug_info)==null?void 0:Z.main_model_response)==null?void 0:q.prompt_string)!=null?G:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:(H=Me(h!=null?h:""))!=null?H:h})]})]})," "]},x)}),o&&e.jsx(N,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(M,{data:o,collapsed:4,jsonFiltersKey:"thread"})}),t&&e.jsx(N,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(M,{data:t,collapsed:4,jsonFiltersKey:"message"})}),v&&e.jsx(N,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(xe,{prompt:v!=null?v:""})}),e.jsx(N,{value:"connectors",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(Ve,{})})]},(W=o==null?void 0:o.turns.length)!=null?W:"message")})}function M({data:s,collapsed:n,jsonFiltersKey:t}){const[l,a]=j.useState(n!=null?n:!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>a(!l),className:"flex items-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Ae,{jsonFiltersKey:t,json:s,jsonViewProps:{collapsed:l,shortenTextAfterLength:0}},String(l))})]})}function Ve(){const{availableConnectors:s,isLoading:n}=Ce(),{connectionInstanceData:t,isLoading:l}=Ne({}),{connectorLinks:a,isLoading:i}=ke({fetchValidLinksOnly:!0});if(n||l||i)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading connectors..."});const u=s.map(r=>{const c=r,{logo_url:d,logo_url_dark:o}=c;return ae(c,["logo_url","logo_url_dark"])});return e.jsx(M,{data:{availableConnectors:u,syncConnectors:t,accessConnectors:a},collapsed:2,jsonFiltersKey:"connectors"})}function O({name:s,id:n,className:t}){const l=we(),a=j.useCallback(i=>{Le(n,l,i)},[n,l]);return e.jsxs("div",{className:F("flex items-center gap-2 truncate",t),children:[e.jsxs("span",{className:"font-semibold text-nowrap",children:[s,":"]}),e.jsx("span",{title:n,className:"truncate text-gray-500 dark:text-white",children:n}),e.jsx(Se,{onCopy:a})]})}export{M as DebugJsonViewer,ss as DebugModal,ze as DebugModalContents};
//# sourceMappingURL=li5e69zfud4gjhcy.js.map
