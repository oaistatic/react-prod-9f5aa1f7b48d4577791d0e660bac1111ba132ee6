var A=Object.defineProperty,_=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var L=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))E.call(t,o)&&L(e,o,t[o]);if(g)for(var o of g(t))I.call(t,o)&&L(e,o,t[o]);return e},f=(e,t)=>_(e,D(t));import{r as d,b as C}from"./i8clt0mfz495j7ii.js";import{ap as r,aq as s,b6 as O,b7 as w}from"./ghewn7l2ynbm32fm.js";import{u as b}from"./f5bdf2ynleqr2zah.js";import{be as y}from"./j0yo6uv6652vva62.js";const c="last_checked_loc",p=1440*60*1e3,u="last_denied_loc",N=3600*1e3;function M(){const[e,t]=b(),{data:o}=O(w.PreciseLocationEnabledForDevice);d.useEffect(()=>{typeof o=="boolean"&&e.useLocation!==o&&t(n=>f(m({},n),{useLocation:o}))},[o,t,e.useLocation]);const{data:a}=C({queryKey:["userLocation",e.useLocation],queryFn:({queryKey:[n,i]})=>S({enabled:i}),initialData:k(e.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return a}function k(e){if(e){const t=r.getCookie(s.LastLocation);if(t)try{return JSON.parse(t)}catch(o){return l(),null}}return null}async function S({enabled:e}){var o;if(!e)return l();if(((o=await T())==null?void 0:o.state)!=="granted"){const a=localStorage.getItem(c);if(a){const n=Number(a),i=r.getCookie(s.LastLocation);if(i&&Date.now()-p<n)try{return JSON.parse(i)}catch(h){}}}const t=localStorage.getItem(u);if(t){const a=Number(t);if(Date.now()-N<a)return null}return await new Promise(a=>{navigator.geolocation.getCurrentPosition(n=>{const i={latitude:n.coords.latitude,longitude:n.coords.longitude,locationAccuracy:n.coords.accuracy};r.setCookie(s.LastLocation,JSON.stringify(i),{maxAge:y}),localStorage.setItem(c,Date.now().toString()),a(i)},()=>{localStorage.setItem(u,Date.now().toString()),a(l())},{enableHighAccuracy:!0,maximumAge:0})})}function J(){return S({enabled:!0})}async function T(){return navigator!=null&&navigator.permissions?await navigator.permissions.query({name:"geolocation"}):null}const P={latitude:null,longitude:null,locationAccuracy:null};function l(){return r.setCookie(s.LastLocation,JSON.stringify(P),{maxAge:y}),localStorage.removeItem(c),localStorage.removeItem(u),null}d.createContext(null);export{l as c,J as r,M as u};
//# sourceMappingURL=dbdg2o93q6s69qkd.js.map
