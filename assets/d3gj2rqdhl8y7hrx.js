var z=Object.defineProperty;var N=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var k=(n,a,s)=>a in n?z(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s,D=(n,a)=>{for(var s in a||(a={}))Q.call(a,s)&&k(n,s,a[s]);if(N)for(var s of N(a))q.call(a,s)&&k(n,s,a[s]);return n};import{e as O,u as J,r as f,j as e,M as d,f as K}from"./i8clt0mfz495j7ii.js";import{e as V,u as H,a0 as I,o7 as X,P as u,C as Z,b0 as $,bF as y,jD as A,h as ee,J as ae}from"./ghewn7l2ynbm32fm.js";import{cE as te,dL as se,bK as oe,a_ as ie}from"./j0yo6uv6652vva62.js";import{g as ne}from"./fe1zgnccg3ea7jld.js";import{u as ce}from"./bjlbvo9rov23708i.js";import"./ji1868fe7hk3rgcl.js";import"./izvx0vf35f3cqx26.js";import"./o1s10g7vrpyumh3e.js";import"./e2bky2k6amgws3b2.js";import"./kplnfohfof8ely0n.js";import"./kgnykbdth8mb50na.js";import"./g8i6bixylsxyemsr.js";import"./iej0cupg2dqkmejt.js";import"./n8tfpmgkqe98i7yl.js";import"./mq11hu99eist2abq.js";import"./mtmwfv9ttg0ed53k.js";function je({isOpen:n,onClose:a,onClaimOfferButtonClicked:s,currentAccount:t}){const i=O(),h=V(),m=H(),{data:p}=te(),g=se(t.id),{data:S,isLoading:x,error:C}=oe({currency:t.mustGetSubscriptionBillingCurrency("GlobalSettingsModal"),ctx:m}),F=t.data.subscriptionStatus.planType,w=t.getLastActiveSubscription().subscription_id,c=t.data.subscriptionStatus.discount,l=ie(F.toLowerCase()),B=J(),j=I(m,"468168202"),T=I(m,"3170465812"),G=t.isEligibleForCancellationPromotion(),{cancellationPromoMetadata:o,isCancelPromoLoading:M}=ce(t.id,G),W=o?T.get("promo_redemption_cta_color","secondary"):"secondary",{numPeriods:R,formattedDiscountedCost:U}=f.useMemo(()=>{var P,E;const v=t.mustGetSubscriptionBillingCurrency("GlobalSettingsModal");if(!o||!S||x||C)return{numPeriods:0,formattedDiscountedCost:""};const r=(E=(P=o.duration)==null?void 0:P.num_periods)!=null?E:1;return D({numPeriods:r},ne(i,r,o.discount,v,S))},[t,o,i,S,x,C]),_=(c==null?void 0:c.cancellation_policy)===X.IMMEDIATE&&!(c!=null&&c.discount_start_in_num_periods),Y=async()=>{if(!t||!w)throw new Error("Missing current account or subscription id");await g.mutateAsync(t.id,{onError:()=>{h.danger(L.cancelFailure,{duration:5,toastId:"cancel_subscription_modal"}),u.logEventWithStatsig("Cancel Subscription Modal Cancel Failed","chatgpt_cancel_subscription_modal_cancel_failed")},onSuccess:async()=>{if(B.invalidateQueries(A()),h.info(i.formatMessage(L.cancelSuccess),{duration:5}),u.logEventWithStatsig("Cancel Subscription Modal Cancel Success","chatgpt_cancel_subscription_modal_cancel_success"),ee(m,"3376055906")){const r=new URL("https://openai.qualtrics.com/jfe/form/SV_eW3mdeRdMrpnPLw");r.searchParams.append("subscription_id",w),r.searchParams.append("plan_type",t.planType),t.authUserId?r.searchParams.append("oai_user",t.authUserId):ae.addError("authUserId missing from currentAccount"),window.open(r.toString(),"_blank")}setTimeout(()=>{a()},5e3)}})};f.useEffect(()=>{g.isSuccess&&a()},[g.isSuccess,a]),f.useEffect(()=>{u.logEventWithStatsig("Cancel Subscription Modal Shown","chatgpt_cancel_subscription_modal_shown")}),f.useEffect(()=>{o&&!M&&u.logEventWithStatsig("Cancel Subscription Modal with Cancellation Promo Shown","chatgpt_cancel_subscription_modal_with_cancellation_promo_shown",{promo_id:o.campaign_id})},[o,M]);const b=p!=null&&p.active_until?new Date(p.active_until).toLocaleDateString(i.locale,{year:"numeric",month:"short",day:"numeric"}):"";return e.jsx(Z,{testId:"modal-cancel-subscription",type:"success",isOpen:n,onClose:a,size:"custom",noPadding:!0,className:"max-w-xl",showCloseButton:!0,title:o?i.formatMessage({id:"cancelSubscriptionModal.promo.title",defaultMessage:"Are you sure you want to cancel?"}):c?_?i.formatMessage({id:"cancelSubscriptionModal.hasDiscount.titleImmediate",defaultMessage:"End {planName} access immediately?"},{planName:l}):i.formatMessage({id:"cancelSubscriptionModal.hasDiscount.title",defaultMessage:"End {planName} access on {expirationDate}?"},{planName:l,expirationDate:b}):i.formatMessage({id:"cancelSubscriptionModal.title",defaultMessage:"Subscription Cancellation"}),removePopoverStyling:!0,children:M?e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx($,{})}):e.jsxs("div",{className:"p-5",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary",children:o.summary}),e.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-xl border border-solid p-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-token-text-primary text-base font-semibold",children:o.title})}),e.jsx("p",{className:"text-token-text-secondary mt-1 text-base",children:e.jsx(d,{id:"cancelPromoModal.regularPrice",defaultMessage:"For {discountedFormattedCost}, you'll get {planName} for {numPeriods} months.",values:{discountedFormattedCost:U,planName:l,numPeriods:R}})})]}),e.jsx("div",{children:e.jsx(y,{title:i.formatMessage({id:"cancelPromoModal.promo.getOffer",defaultMessage:"Get offer"}),color:W,onClick:s})})]}),e.jsx("p",{className:"text-token-text-secondary mt-8",children:_?e.jsx(d,{id:"cancelSubscriptionModal.promo.canceledSubscriptionBottomImmediate",defaultMessage:"To cancel your subscription, just confirm your choice below. Your access to {planName} features will end immediately.",values:{planName:l}}):e.jsx(d,{id:"cancelSubscriptionModal.promo.canceledSubscriptionBottom",defaultMessage:"To cancel your subscription, just confirm your choice below. Your access to {planName} features will end on {expirationDate}.",values:{planName:l,expirationDate:b}})})]}):e.jsx("p",{className:"text-token-text-secondary",children:c?_?e.jsx(d,{id:"cancelSubscriptionModal.hasDiscount.canceledSubscriptionImmediate",defaultMessage:"If you cancel your subscription now, your {planName} access will end immediately. Any discounts applied will be removed, and can't be used again.",values:{planName:l}}):e.jsx(d,{id:"cancelSubscriptionModal.hasDiscount.canceledSubscription",defaultMessage:"If you cancel your subscription now, your {planName} access will end on {expirationDate}. Any discounts applied will be removed, and can't be used again.",values:{planName:l,expirationDate:b}}):e.jsx(d,{id:"cancelSubscriptionModal.canceledSubscription",defaultMessage:"Your {planName} subscription will be canceled but will remain active until the end of your billing period on {expirationDate}.",values:{planName:l,expirationDate:b}})}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(y,{title:i.formatMessage({id:"cancelSubscriptionModal.goBack",defaultMessage:"Go back"}),color:j.get("cancellation_modal_go_back_button_color","secondary"),onClick:a}),e.jsx(y,{title:i.formatMessage({id:"cancelSubscriptionModal.cancel",defaultMessage:"Cancel subscription"}),color:j.get("cancellation_modal_cancel_button_color","danger"),onClick:()=>{u.logEventWithStatsig("Cancel Subscription Modal Confirmation Button Clicked","chatgpt_cancel_subscription_modal_confirmation_button_clicked"),Y()},loading:g.isPending})]})]})})}const L=K({cancelSuccess:{id:"cancelSubscriptionModal.cancelSuccess",defaultMessage:"Your subscription has been canceled."},cancelFailure:{id:"cancelSubscriptionModal.cancelFailure",defaultMessage:"Something went wrong while canceling your subscription."}});export{je as CancelSubscriptionModal};
//# sourceMappingURL=d3gj2rqdhl8y7hrx.js.map
