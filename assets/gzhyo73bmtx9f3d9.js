const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pfg8sguwg6pyv34z.js","assets/i8clt0mfz495j7ii.js","assets/jics938ioiejxmr3.js","assets/ig60ujc76weklqmh.js","assets/g03e0l13yr8s5v7c.js","assets/oqpuvdflzxc04e1g.js","assets/c8sj5q0wb2w4qlno.js","assets/e2cp3j62rtjkqpkh.js","assets/fdvvre1nmaxxpozb.js","assets/abem9sgzsjl2l7io.js","assets/gytkx7r7j7x1uill.js","assets/fbo3r3nxh907ko6l.js","assets/b3nbyz21c52nzclw.js","assets/o84nb2862ibyoi1c.js","assets/dyie70wwv508ud8r.js","assets/fefndn2gt024gfqh.js"])))=>i.map(i=>d[i]);
var nt=Object.freeze,St=Object.defineProperty;var rt=(e,s)=>nt(St(e,"raw",{value:nt(s||e.slice())}));import{r as x,j as t,_ as w,M as j,e as Q,h as ut,u as ce,a as ue,k as Ft,L as Dt}from"./i8clt0mfz495j7ii.js";import{C as me}from"./o56jrqjpjpipvc65.js";import{ih as It,i0 as Bt,mi as Ot,d6 as At,q as Vt}from"./j0yo6uv6652vva62.js";import{C as Wt}from"./chs4g5r39qlnqw6r.js";import{F as Qt,aW as qt,aV as zt,o as y,L as T,d as W,b0 as mt,e as pe,c6 as se,T as ae,he as $t,ca as Ht,iB as Kt,ed as Ut,cE as Lt,u as Gt,h as ot,$ as Jt,q as it}from"./ghewn7l2ynbm32fm.js";import{l as _,f as Xt,w as Yt,W as L,O as Zt,o as pt,P as es,B as ts,Q as lt}from"./g5lgy1otfli5p2x7.js";import{W as ss}from"./c80gqv0732s10rnu.js";import{W as as}from"./i94vqq9eycryltby.js";import{u as ns,m as rs,a as os}from"./o6tyvbjf9zh9qku3.js";var ct;const de=Qt.div(ct||(ct=rt(["animate-pulse rounded-[4px] bg-token-main-surface-tertiary"])));function is(){return t.jsx(qt,{children:t.jsx(zt.div,{className:"border-token-border-light overflow-y-clip border-b",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.15,ease:"easeOut"},children:t.jsxs("div",{className:"flex w-full flex-col gap-0.5 px-3 py-3.5",children:[t.jsx(de,{className:"mt-[0.425rem] mb-[0.225rem] h-[0.6rem] w-[200px]"}),t.jsx(de,{className:"mt-[0.225rem] mb-[0.425rem] h-[0.6rem] w-[100px]"})]})})})}const ls=x.memo(is),ds=y(()=>w(()=>import("./pfg8sguwg6pyv34z.js"),__vite__mapDeps([0,1])),{loading:e=>T(e)}),cs=y(()=>w(()=>import("./jics938ioiejxmr3.js"),__vite__mapDeps([2,1])),{loading:e=>T(e)}),us=y(()=>w(()=>import("./ig60ujc76weklqmh.js"),__vite__mapDeps([3,1])),{loading:e=>T(e)}),ms=y(()=>w(()=>import("./g03e0l13yr8s5v7c.js"),__vite__mapDeps([4,1])),{loading:e=>T(e)});function ps({count:e,className:s}){const o=e>=4?ds:e===3?cs:e===2?us:ms;return t.jsxs("span",{className:W("border-token-border-default text-token-text-primary inline-flex h-[24px] items-center gap-1 rounded-full border px-2 py-1 text-[12px] font-medium",s),children:[t.jsx(o,{"aria-hidden":!0,className:"icon-sm"}),t.jsx(j,{id:"pNS3rO",defaultMessage:"{count}",values:{count:e}})]})}function fs({done:e,total:s,className:o}){return t.jsxs("span",{className:W("text-token-text-tertiary inline-flex items-center gap-2 text-sm",o),children:[t.jsx(j,{id:"wham.whamAttemptsProgress.progress",defaultMessage:"{done}/{total} versions",values:{done:e,total:s}}),e===0?t.jsx(me,{size:12,strokeWidth:2}):t.jsx(It,{percentage:e/s*100,thickness:1/10,className:"text-token-text-primary size-3",backgroundStrokeClassName:" stroke-token-text-primary/20",transitionDuration:"0.2s",transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})]})}function hs({taskId:e,latestTurnId:s,behavior:o="navigate",onFixCreated:r}){const a=Q(),d=pe(),n=ut(),i=ce(),c=_(l=>l.setLastViewedTaskId),g=_(l=>l.assignPendingTaskToFinalTask),u=_(l=>l.removePendingTaskId),k=_(l=>l.clearFixReviewTaskInFlight),m=x.useCallback(l=>{["current","all","code_review","archived"].forEach(D=>{const p=["wham","tasks",D];i.setQueryData(p,C=>se(C,I=>{I&&I.pages.forEach(ne=>{var N;(N=ne.items)==null||N.forEach(q=>{if(q.id===e){if(!q.task_status_display){q.task_status_display={fix_task_id:l};return}q.task_status_display.fix_task_id=l}})})}))})},[i,e]);return ue({mutationFn:async()=>{if(!s)throw new Error("missing_latest_turn_id");return await L.createFixReviewTask(e,s)},onSuccess:(l,f)=>{m(l.task.id),i.invalidateQueries({queryKey:["wham","tasks"]}),i.invalidateQueries({queryKey:["wham","tasks","current"]}),k(e),f!=null&&f.pendingTaskId&&g(f.pendingTaskId,l.task.id),o==="navigate"&&(c(l.task.id),n("/codex/tasks/".concat(l.task.id)),d.success(a.formatMessage({id:"wham.whamTaskRow.fixTaskCreated",defaultMessage:"Started fix task"}))),r==null||r({fixTaskId:l.task.id,pendingTaskId:f==null?void 0:f.pendingTaskId,response:l})},onError:(l,f)=>{if(k(e),f!=null&&f.pendingTaskId&&u(f.pendingTaskId),l instanceof Xt){Yt(l,e,a,d);return}d.danger(a.formatMessage({id:"wham.whamTaskRow.fixTaskCreateError",defaultMessage:"Couldn't start fix task"}))}})}function gs({taskId:e,latestTurnId:s,highlightTasksTabOnSuccess:o=!1}){const r=_(m=>m.addPendingTaskId),a=_(m=>m.shouldHighlightTasksTab),d=_(m=>m.setShouldHighlightTasksTab),n=_(m=>m.markFixReviewTaskInFlight),i=_(m=>m.clearFixReviewTaskInFlight),c=_(m=>!!m.fixReviewTasksInFlight[e]),g=hs({taskId:e,latestTurnId:s,behavior:"stay"}),u=x.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),c||g.isPending||!s)return;const l=crypto.randomUUID();r(l);const f=o&&!a;f&&d(!0),n(e),g.mutateAsync({pendingTaskId:l}).catch(()=>{f&&d(!1),i(e)})},[r,o,c,g,d,n,i,a,e,s]),k=g.isPending||c;return t.jsx("button",{type:"button",className:"border-token-border-subtle bg-token-bg-tertiary text-token-text-primary hover:bg-token-bg-secondary flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition-colors disabled:cursor-not-allowed disabled:opacity-70",onClick:u,disabled:k||!s,children:k?t.jsx(mt,{className:"icon-sm"}):t.jsx(j,{id:"wham.whamTaskRow.fixButton",defaultMessage:"Fix"})})}const xs=y(()=>w(()=>import("./oqpuvdflzxc04e1g.js").then(e=>e._),__vite__mapDeps([5,1])),{loading:e=>T(e)}),_s=y(()=>w(()=>import("./c8sj5q0wb2w4qlno.js").then(e=>e._),__vite__mapDeps([6,1])),{loading:e=>T(e)});function ks({criticalIssueCount:e,highIssueCount:s,totalIssueCount:o}){"use no forget";const r=Q();if(o===0)return t.jsx(ae,{label:r.formatMessage({id:"wham.whamTaskIssuesSummary.noIssuesTooltip",defaultMessage:"Codex didn’t flag any issues"}),children:t.jsx("span",{className:"bg-token-bg-success/20 text-token-text-primary inline-flex min-w-[1.5rem] items-center justify-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold",children:t.jsx(_s,{className:"icon-sm text-[#008000]"})})});const a=[];return e>0&&a.push({severity:"critical",count:e}),s>0&&a.push({severity:"high",count:s}),a.length===0?null:t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.map(({severity:d,count:n})=>{const i=d==="critical",c=i?r.formatMessage({id:"wham.whamTaskIssuesSummary.criticalIssueTooltip",defaultMessage:"Codex flagged {count, plural, one {# severe bug} other {# severe bugs}}"},{count:n}):r.formatMessage({id:"wham.whamTaskIssuesSummary.highIssueTooltip",defaultMessage:"Codex flagged {count, plural, one {# bug} other {# bugs}}"},{count:n});return t.jsx(ae,{label:c,children:t.jsxs("span",{className:W("inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium",i?"bg-token-text-status-error/15 text-token-text-status-error":"bg-token-text-status-warning/15 text-token-text-status-warning"),children:[t.jsx(xs,{className:W("icon-sm",i?"text-token-text-status-error":"text-token-text-status-warning")}),i?t.jsx(j,{id:"wham.whamTaskIssuesSummary.criticalIssueCopy",defaultMessage:"{count, plural, one {# severe bug} other {# severe bugs}}",values:{count:n}}):t.jsx(j,{id:"wham.whamTaskIssuesSummary.highIssueCopy",defaultMessage:"{count, plural, one {# bug} other {# bugs}}",values:{count:n}})]})},"".concat(d,"-").concat(n))})})}function vs({dateString:e}){const s=Q(),[o,r]=x.useState(()=>new Date);$t(()=>r(new Date),6e4);const a=x.useMemo(()=>new Date(e),[e]),d=x.useMemo(()=>Ht(o,a),[o,a]),n=x.useMemo(()=>Kt(o,a),[o,a]);return n<1?s.formatMessage({id:"wham.formattedRelativeDateTime.justNow",defaultMessage:"Just now"}):n<60?s.formatMessage({id:"wham.formattedRelativeDateTime.minAgo",defaultMessage:"{numMinsDiff} min ago"},{numMinsDiff:n}):d===0?a.toLocaleTimeString(s.locale,{hour:"numeric",minute:"2-digit"}):a.toLocaleDateString(s.locale,{month:"short",day:"numeric"})}function ws(e){return/^[0-9a-f]{40}$/i.test(e)?e.slice(-7):e.length>48?"…"+e.slice(-48):e}const ys=y(()=>w(()=>import("./e2cp3j62rtjkqpkh.js"),__vite__mapDeps([7,1])),{loading:e=>T(e)}),Ts=y(()=>w(()=>import("./fdvvre1nmaxxpozb.js"),__vite__mapDeps([8,1])),{loading:e=>T(e)}),bs=y(()=>w(()=>import("./abem9sgzsjl2l7io.js"),__vite__mapDeps([9,1])),{loading:e=>T(e)}),js=y(()=>w(()=>import("./gytkx7r7j7x1uill.js"),__vite__mapDeps([10,1])),{loading:e=>T(e)}),Ns=y(()=>w(()=>import("./fbo3r3nxh907ko6l.js").then(e=>e._),__vite__mapDeps([11,1])),{loading:e=>T(e)});function Ms(e){return e?e.merged?"merged":e.state==="closed"?"closed":e.draft?"draft":"open":null}function Cs({taskAssistantTurnId:e,taskId:s,data:o,className:r}){const[a,d]=x.useState(o),n=x.useRef(!1);if(x.useEffect(()=>{async function u(){if(!(!a||!e||!s||n.current)){if(!a.merged)try{const k=await L.getTaskTurnPR(s,e);d(k.pr)}catch(k){}n.current=!0}}u()},[a,e,s]),!a)return null;const i=Ms(a);if(!i)return null;const c=a.url,g=u=>{u.stopPropagation(),u.preventDefault(),window.open(c,"_blank","noopener,noreferrer")};return t.jsxs("button",{type:"button",onClick:g,onAuxClick:u=>{u.button===1&&g(u)},className:W("inline-flex w-fit cursor-pointer items-center rounded-full px-2.5 py-1 text-[10px] font-semibold","border border-transparent","group/pill overflow-hidden",{"bg-[#C3DEC780] text-[#008C2E] dark:bg-[#6BBD6720] dark:text-[#6BBD67]":i==="open","bg-[#D6303D20] text-[#D6303D] dark:bg-[#FD756F20] dark:text-[#FD756F]":i==="closed","bg-[#8E3CF320] text-[#8E3CF3] dark:bg-[#C26FFD20] dark:text-[#C26FFD]":i==="merged","bg-[#59636E20] text-[#59636E] dark:bg-[#B2B2B220] dark:text-[#B2B2B2]":i==="draft"},r),children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"icon-container relative transition-all duration-100 group-hover/pill:translate-y-full group-hover/pill:opacity-0 group-hover/pill:blur-sm",children:i==="open"?t.jsx(ys,{"aria-hidden":!0,className:"icon-xs me-1"}):i==="closed"?t.jsx(js,{"aria-hidden":!0,className:"icon-xs me-1"}):i==="merged"?t.jsx(Ts,{"aria-hidden":!0,className:"icon-xs me-1"}):t.jsx(bs,{"aria-hidden":!0,className:"icon-xs me-1"})}),t.jsx("div",{className:"absolute start-0 top-0 -translate-y-full opacity-0 transition-all duration-100 group-hover/pill:translate-y-0 group-hover/pill:opacity-100",children:t.jsx(Ns,{"aria-hidden":!0,className:"icon-xs me-1"})})]}),i==="open"?t.jsx(j,{id:"wham.prStatusBadge.open",defaultMessage:"Open"}):i==="closed"?t.jsx(j,{id:"wham.prStatusBadge.closed",defaultMessage:"Closed"}):i==="merged"?t.jsx(j,{id:"wham.prStatusBadge.merged",defaultMessage:"Merged"}):t.jsx(j,{id:"wham.prStatusBadge.draft",defaultMessage:"Draft"})]})}const Es=y(()=>w(()=>import("./b3nbyz21c52nzclw.js").then(e=>e._),__vite__mapDeps([12,1])),{loading:e=>T(e)}),Rs=y(()=>w(()=>import("./o84nb2862ibyoi1c.js").then(e=>e._),__vite__mapDeps([13,1])),{loading:e=>T(e)}),Ps=y(()=>w(()=>import("./dyie70wwv508ud8r.js").then(e=>e._),__vite__mapDeps([14,1])),{loading:e=>T(e)});function dt(e){return e==="archived"?{add:["current","all"],remove:["archived","code_review"]}:e==="code_review"?{add:["archived"],remove:["code_review","current","all"]}:{add:["archived"],remove:["current","all","code_review"]}}function Ss(e){return e&&pt(e)}function Fs(e){var s;return(s=e==null?void 0:e.filter(o=>Ss(o.turn_status)).length)!=null?s:0}function Ds(e){if(e)return typeof e=="string"?e:"".concat(e.partition_key,"~").concat(e.id)}function Is({taskListItem:e,index:s,disableFocusStyle:o,hoveredIndex:r,isCompact:a=!1,hideBorder:d=!1,onMouseEnter:n,onMouseLeave:i,linkPath:c,showArchiveButton:g=!0,currentFilter:u}){var Ne,Me,Ce,Ee,Re,Pe,Se,Fe,De,Ie,Be,Oe,Ae,Ve,We,Qe,qe,ze,$e,He,Ke,Ue,Le,Ge,Je,Xe,Ye,Ze,et,tt,st;const k=Q(),m=pe(),l=Ut(),f=_(h=>h.homeTab),D=u!=null?u:es(f),p=_(h=>h.removePendingTaskByTaskId),C=_(h=>h.setLastViewedTaskId),I=(Ne=e.task_status_display)==null?void 0:Ne.fix_task_id,ne=ut(),N=(Ee=(Ce=(Me=e.task_status_display)==null?void 0:Me.latest_turn_status_display)==null?void 0:Ce.turn_status)!=null?Ee:"pending",q=ns(e.id,N,(Pe=(Re=e.task_status_display)==null?void 0:Re.latest_turn_status_display)==null?void 0:Pe.turn_id),fe=(Ie=(De=(Fe=(Se=e.task_status_display)==null?void 0:Se.latest_turn_status_display)==null?void 0:Fe.diff_stats)==null?void 0:De.lines_added)!=null?Ie:0,he=(Ve=(Ae=(Oe=(Be=e.task_status_display)==null?void 0:Be.latest_turn_status_display)==null?void 0:Oe.diff_stats)==null?void 0:Ae.lines_removed)!=null?Ve:0,M=(qe=(Qe=(We=e.task_status_display)==null?void 0:We.latest_turn_status_display)==null?void 0:Qe.issue_counts)!=null?qe:null,ge=(ze=M==null?void 0:M["0"])!=null?ze:0,xe=($e=M==null?void 0:M["1"])!=null?$e:0,ft=M?Object.values(M).reduce((h,R)=>h+R,0):0,ht=ge+xe,z=Lt(e.pull_requests),b=z==null?void 0:z.pull_request,_e=Ds(z==null?void 0:z.assistant_turn_id),ke=((He=e==null?void 0:e.task_status_display)==null?void 0:He.initial_intent)==="cr",G=ke?b:null,re=b==null?void 0:b.head,gt=(Ke=e.task_status_display)==null?void 0:Ke.branch_name,B=(Ue=re!=null?re:gt)!=null?Ue:"",ve=ws(B),xt=B&&B!==ve,_t=!l&&!!B&&B!=="master"&&B!=="main"&&(b==null?void 0:b.state)!=="closed"&&(b==null?void 0:b.state)!=="merged",oe=(Ge=(Le=e.task_status_display)==null?void 0:Le.latest_turn_status_display)==null?void 0:Ge.turn_id,kt=(Xe=(Je=e.task_status_display)==null?void 0:Je.latest_turn_status_display)==null?void 0:Xe.turn_status,vt=N==="completed"&&ht>0&&!!oe&&M!=null&&!I,we=(et=(Ze=(Ye=e.task_status_display)==null?void 0:Ye.latest_turn_status_display)==null?void 0:Ze.sibling_turn_ids)!=null?et:[],ye=we.length+1,wt=we.length>0&&(N==="pending"||N==="in_progress")&&!b,{data:ie}=Zt(e.id,oe,wt),J=(tt=ie==null?void 0:ie.latest_turns)!=null?tt:null,X=J?J.length:ye,yt=J?Fs(J):pt(kt)?ye:0,E=ce(),Tt=x.useMemo(()=>t.jsx(me,{size:20,initialOffset:Math.random()*20*Math.PI}),[]),bt=s!==void 0&&r!=null&&s===r-1,Te=Gt(),jt=(ot(Te,"2665240312")||void 0)&&!ke&&!l&&!a&&N!=="pending"&&N!=="in_progress"&&g,Nt=ot(Te,"879591222")||void 0;x.useEffect(()=>{p(e.id)},[e.id,p]);const{mutate:Mt}=ue({mutationFn:({taskId:h,currentFilter:R})=>R==="archived"?L.recoverTask(h):L.archiveTask(h),onMutate:async({taskId:h,taskListItem:R,currentFilter:F})=>{var Z,at;const{add:$,remove:H}=dt(F),O={},K=async P=>{O[P.join("|")]=E.getQueryData(P),await E.cancelQueries({queryKey:P})};for(const P of H){const S=["wham","tasks",P];await K(S),E.setQueryData(S,le=>se(le,V=>{V==null||V.pages.forEach(U=>{var ee;U.items=((ee=U.items)!=null?ee:[]).filter(te=>te.id!==h)})}))}for(const P of $){const S=["wham","tasks",P];await K(S),E.setQueryData(S,le=>se(le,V=>{var te;if(!V||V.pages.length===0)return;const U=V.pages[0],ee=(te=U.items)!=null?te:[];U.items=[R,...ee].filter((Ct,Et,Rt)=>Rt.findIndex(Pt=>Pt.id===Ct.id)===Et)}))}const A=["wham","task",R.id,(at=(Z=R.task_status_display)==null?void 0:Z.latest_turn_status_display)==null?void 0:at.turn_id];return O[A.join("|")]=E.getQueryData(A),await E.cancelQueries({queryKey:A}),E.setQueryData(A,P=>se(P,S=>{S&&(S.task.archived=!S.task.archived)})),{snapshots:O}},onError:(h,R,F)=>{var $;Object.entries(($=F==null?void 0:F.snapshots)!=null?$:{}).forEach(([H,O])=>{E.setQueryData(H.split("|"),O)}),m.danger(k.formatMessage({id:"wham.whamTaskRow.failedToUpdateTask",defaultMessage:"Failed to update task"}))},onSuccess:(h,R)=>{var K,A;const{taskListItem:F,currentFilter:$}=R,{add:H,remove:O}=dt($);E.invalidateQueries({queryKey:["wham","task",F.id,(A=(K=F.task_status_display)==null?void 0:K.latest_turn_status_display)==null?void 0:A.turn_id]}),[...H,...O].forEach(Z=>E.invalidateQueries({queryKey:["wham","tasks",Z]}))}}),Y=M!=null?t.jsx(ks,{criticalIssueCount:ge,highIssueCount:xe,totalIssueCount:ft},"issues-summary"):null,v=[];switch(N){case"pending":case"in_progress":{X>1?v.push(t.jsx(fs,{done:yt,total:X},"attempt-progress")):a?v.push(Tt):(v.push(t.jsx("span",{className:"loading-shimmer-pure-text",children:rs(q,32)},"in-progress-text")),Nt&&v.push(t.jsx(As,{taskId:e.id})));break}case"failed":v.push(t.jsx("span",{className:"text-token-text-status-error",children:t.jsx(j,{id:"wham.whamTaskRow.failed",defaultMessage:"Failed"})},"failed-text"));break;case"cancelled":v.push(t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(j,{id:"wham.whamTaskRow.cancelled",defaultMessage:"Cancelled"})},"cancelled-text"));break;case"completed":{Y&&v.push(Y),X>1&&!b&&v.push(t.jsx(ps,{count:X},"attempts")),b&&_e&&v.push(t.jsx(Cs,{taskAssistantTurnId:_e,taskId:e.id,data:b},"pr-status")),(fe!==0||he!==0)&&!M&&v.push(t.jsx(ss,{className:"min-w-10 justify-end",linesAdded:fe,linesRemoved:he},"message-stats"));break}default:v.push(t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(j,{id:"wham.whamTaskRow.unknown",defaultMessage:"Unknown"})},"unknown-text"));break}I?v.push(t.jsx(Jt,{type:"button",size:"small",color:"secondary",onClick:h=>{h.preventDefault(),h.stopPropagation(),C(I),ne("/codex/tasks/".concat(I))},children:t.jsx(j,{id:"wham.whamTaskRow.viewFixTask",defaultMessage:"Open fix"})},"view-fix-button")):vt&&v.push(t.jsx(gs,{taskId:e.id,latestTurnId:oe,highlightTasksTabOnSuccess:D==="code_review"},"fix-button")),N!=="completed"&&Y&&v.unshift(Y);const be=e.updated_at?new Date(e.updated_at*1e3):null,je=(st=e.task_status_display)==null?void 0:st.environment_label;return t.jsx("div",{className:"group task-row-container",onMouseEnter:n,onMouseLeave:i,children:t.jsxs(Bs,{disableFocusStyle:o,taskId:e.id,linkPath:c,children:[t.jsxs("div",{className:W("border-token-border-light grid w-full grid-cols-[minmax(0,1fr)_auto] items-center gap-5 border-b px-4 py-3.5 text-sm md:px-3",(bt||d)&&"border-b-transparent"),children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("div",{className:"text-token-text-primary flex w-full min-w-0 items-center gap-1.5",children:[e.has_unread_turn&&t.jsx("div",{className:"size-1.5 rounded-full bg-blue-500"}),t.jsx("div",{className:"flex-1 truncate font-medium",children:G!=null&&G.title?t.jsx("span",{children:G.title}):t.jsx(Os,{task:e})})]}),be&&t.jsxs("div",{className:"text-token-text-tertiary flex gap-1",children:[t.jsx("span",{className:"truncate empty:hidden",children:t.jsx(vs,{dateString:be.toISOString()})}),je&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-token-text-tertiary",children:"·"}),t.jsx("span",{className:"truncate empty:hidden",children:je})]}),_t&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-token-text-tertiary",children:"·"}),t.jsx(ae,{label:xt?B:void 0,children:t.jsx("span",{className:"max-w-[8rem] truncate md:max-w-[10rem]",children:ve})})]})]})]}),t.jsx("div",{className:"flex flex-1 items-center gap-2",children:v})]}),jt&&t.jsx("div",{role:"button",onClick:h=>{h.stopPropagation(),h.preventDefault(),Mt({taskId:e.id,taskListItem:e,currentFilter:D})},className:"before:from-token-bg-tertiary before:via-token-bg-tertiary absolute inset-y-1 end-0 z-20 flex w-20 cursor-pointer items-center justify-end pe-2 opacity-0 transition-opacity duration-0 group-hover:opacity-100 group-hover:duration-0 before:pointer-events-none before:absolute before:inset-0 before:-start-0.5 before:bg-gradient-to-l before:to-transparent before:content-['']",children:t.jsx(ae,{label:e.archived?k.formatMessage({id:"wham.whamTaskRow.unarchiveTask",defaultMessage:"Unarchive"}):k.formatMessage({id:"wham.whamTaskRow.archiveTask",defaultMessage:"Archive"}),side:"top",children:e.archived?t.jsx(Es,{className:"icon-md text-token-text-secondary hover:text-token-text-primary relative z-10"}):t.jsx(Ps,{className:"icon-md text-token-text-secondary hover:text-token-text-primary relative z-10"})})})]})})}function Bs({taskId:e,children:s,disableFocusStyle:o,linkPath:r}){const a=_(c=>c.setLastViewedTaskId),d=_(c=>c.lastViewedTaskId),n=x.useRef(null),i=Ft();return x.useEffect(()=>{d===e&&requestAnimationFrame(()=>{var c,g,u;(c=n.current)==null||c.scrollIntoView({behavior:"instant",block:"center"}),(g=i.state)!=null&&g.focusComposer||(u=n.current)==null||u.focus()})},[]),e?t.jsx("div",{className:W("hover:bg-token-bg-tertiary relative ring-inset",!o&&"focus-within:border-token-border-heavy focus-within:border-s-2 focus-within:ps-[-2px]"),children:t.jsx(Dt,{className:"outline-offset-[-1px] focus-within:rounded-lg",ref:n,to:r!=null?r:"/codex/tasks/".concat(e),onClick:()=>a(e),onMouseDown:c=>c.preventDefault(),children:s})}):t.jsx("div",{className:"hover:bg-token-bg-tertiary relative rounded-lg",children:s})}function Os({task:e}){var g,u;const s=Q(),o=(g=e.task_status_display)==null?void 0:g.latest_turn_status_display,r=o?(u=o.turn_status)!=null?u:"pending":"failed",[a,d]=x.useState(),n=o==null?void 0:o.turn_id,i=e.has_generated_title===!1&&(r==="pending"||r==="in_progress")&&!!n,c=x.useMemo(()=>"title-".concat(e.id,"-").concat(n!=null?n:""),[e.id,n]);return os(e.id,n,["task_title_generated"],{enabled:i,subscriberId:c,onEvent:k=>d(k.title)}),r==="failed"&&e.has_generated_title===!1?s.formatMessage({id:"wham.whamTaskRow.codexTask",defaultMessage:"Codex task"}):e.has_generated_title===!1&&!a?t.jsx(de,{className:"mt-[0.425rem] mb-[0.225rem] h-[0.6rem] w-[200px]"}):t.jsx("span",{children:a!=null?a:e.title})}function As({taskId:e}){const s=Q(),o=pe(),r=ce(),[a,d]=x.useState(!1),{mutate:n}=ue({mutationFn:async()=>(d(!0),await L.cancelTask(e),await r.invalidateQueries({queryKey:["wham","tasks"]}),!0),onError:()=>{o.danger(s.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{}});return t.jsx("button",{type:"button",className:"border-token-border-heavy hover:bg-token-bg-secondary flex h-6 w-6 items-center justify-center rounded-full border",onClick:i=>{i.stopPropagation(),i.preventDefault(),as.recordCancel("home"),n()},disabled:a,"aria-label":s.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:a?t.jsx(mt,{className:"icon-sm p-0.5"}):t.jsx(Rs,{className:"icon-sm"})})}function Vs({pendingTaskIds:e,inProgressTasks:s,closePopover:o}){return!s.length&&!e.length?t.jsx("div",{className:"flex min-w-48 items-center justify-center py-5",children:t.jsx(j,{id:"+xSTVR",defaultMessage:"No pending work"})}):t.jsxs("ol",{className:"max-h-[600px] w-[450px] overflow-y-auto p-2",children:[e.map(r=>t.jsx(ls,{},r)),s.map((r,a)=>t.jsx("li",{onClick:o,children:t.jsx(Is,{index:a,taskListItem:r,isCompact:!0,disableFocusStyle:!0,hoveredIndex:null,onMouseEnter:it,onMouseLeave:it,hideBorder:a===s.length-1,currentFilter:"current"})},r.id))]})}const Ws=y(()=>w(()=>import("./fefndn2gt024gfqh.js").then(e=>e._),__vite__mapDeps([15,1])),{loading:e=>T(e)});function Zs(){var D;const[e,s]=x.useState(!1),o=x.useRef(null),{data:r}=ts(),a=_(p=>p.pendingTaskIds),d=_(p=>p.pendingCodeReviewIds),n=(D=r==null?void 0:r.pages.flatMap(p=>{var C;return(C=p.items)!=null?C:[]}))!=null?D:[],i=n.filter(p=>!lt(p)),c=n.filter(p=>!!p.has_unread_turn),g=n.filter(p=>!!p.has_unread_turn||!lt(p)),u=Array.from(Object.values(a)).filter(p=>!n.some(C=>C.id===p)),k=Array.from(Object.values(d)).filter(p=>!n.some(C=>C.id===p)),m=[...u,...k],l=i.length+m.length,f=Q();return t.jsxs(Bt,{onOpenChange:s,children:[t.jsx(Ot,{asChild:!0,children:t.jsx(At,{"aria-label":f.formatMessage({id:"wham.notificationPopover.openNotifications",defaultMessage:"Open notifications"}),children:l===0?t.jsxs("div",{className:"relative",children:[c.length>0&&t.jsx("div",{className:"absolute start-0 top-0 size-1.5 rounded-full bg-blue-500"}),t.jsx(Ws,{})]}):t.jsx(me,{size:24,arcPercentage:e?1:.25,children:t.jsx("span",{className:"text-xs",children:l})})})}),t.jsx(Vt,{forceMount:!0,children:t.jsx(Wt,{isOpen:e,closePopover:()=>s(!1),popoverContentRef:o,align:"end",side:"bottom",sideOffset:8,alignOffset:-8,children:t.jsx(Vs,{pendingTaskIds:m,inProgressTasks:g,closePopover:()=>s(!1)})})})]})}export{Zs as N,Is as W,ls as a,ws as g,hs as u};
//# sourceMappingURL=gzhyo73bmtx9f3d9.js.map
