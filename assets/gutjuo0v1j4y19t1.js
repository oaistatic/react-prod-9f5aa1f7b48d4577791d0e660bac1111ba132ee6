var N=Object.defineProperty,H=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var S=(a,e,t)=>e in a?N(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,i=(a,e)=>{for(var t in e||(e={}))F.call(e,t)&&S(a,t,e[t]);if(T)for(var t of T(e))K.call(e,t)&&S(a,t,e[t]);return a},b=(a,e)=>H(a,W(e));import{u as q,aK as j,n1 as U,kL as L,aJ as M,aL as O,l as B,n2 as G,n3 as J}from"./ghewn7l2ynbm32fm.js";import{h as $,r as d,K as A}from"./i8clt0mfz495j7ii.js";const z=new Set(["google-oauth2","windowslive","apple"]),Q="password";function m(){var e;return typeof window<"u"&&!!((e=window.location)!=null&&e.origin)?window.location.origin:window.location.origin}const V=240;function E(a,e){return e!=null&&e.idp&&z.has(e.idp)?i({connection:e.idp},e.email&&{login_hint:e.email}):(e==null?void 0:e.idp)==="auth0"?i({connection:Q},e.email?{login_hint:e.email}:{[J]:"true"}):e!=null&&e.email?i({},e.email&&{login_hint:e.email}):{}}function g(a){if(!a)throw new Error("No session found, cannot enable MFA");if(a.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function k(a){try{return B(a)}catch(e){throw new Error("Unable to decode access token")}}function X(a){return a.pwd_auth_time}function P(a){const e=X(a);if(!e)return!0;const t=e/1e3;return Date.now()/1e3-t>V}function R(a){var e;return((e=a[G])==null?void 0:e.required)==="yes"}var Y=(a=>(a.PushAuth="push_auth",a.Totp="totp",a.Sms="sms",a))(Y||{}),Z=(a=>(a.Enable="enable",a.Disable="disable",a))(Z||{});function I(){const a=m(),e=new URL("/",a),t=M(O.Security).hash;return e.hash=t||"settings",e}function v(a){const e=I(),t=new URLSearchParams;return t.set("action","enable"),t.set("factor",a),e.search=t.toString(),e.toString()}function tt(a){const e=I(),t=new URLSearchParams;return t.set("action","disable"),t.set("factor_id",a),e.search=t.toString(),e.toString()}function it(a){var w,p;const e=q(),{session:t}=j(e),f=$(),[_,o]=d.useState(!1),D=((w=t==null?void 0:t.user)==null?void 0:w.idp)==="auth0",x=!!((p=t==null?void 0:t.user)!=null&&p.mfa),c=d.useCallback(async(n,s=!1)=>{g(t);let u=!0;if(t!=null&&t.accessToken){const l=k(t.accessToken);u=P(l)||s&&!R(l)}return u?(o(!0),A.signIn(t==null?void 0:t.authProvider,{callbackUrl:n},i(i({max_age:"0"},U(L())),E(e,t==null?void 0:t.user))),!0):!1},[e,t]),y=d.useCallback(async(n="totp")=>{g(t),o(!0);const s=m();if(n==="totp"||n==="passkey"){const r=new URL("/auth/enroll_mfa",s);r.searchParams.set("factor",n),a.redirectUrl&&r.searchParams.set("redirect_path",a.redirectUrl);const h=r.toString();return await c(h)?!0:(window.location.href=h,o(!1),!1)}if(n==="push_auth"){const r=v("push_auth");return await c(r)?!0:(o(!1),!1)}const u=v("sms");return await c(u)?!0:(o(!1),!1)},[t,a.redirectUrl,c]),C=d.useCallback(async(n="totp",s="")=>{if(g(t),n==="push_auth"||n==="sms"){if(!s)throw new Error("Factor ID is required for MFA factor removal");const r=tt(s);return await c(r,!0)?!0:(o(!1),!1)}const u=new URL("/auth/disable_mfa",m()).toString();let l=!0;if(t!=null&&t.accessToken){const r=k(t.accessToken);l=P(r)||!R(r)}return l?(A.signIn(t==null?void 0:t.authProvider,{callbackUrl:u},i(i({max_age:"0"},E(e,t==null?void 0:t.user)),U(L()))),!0):(f(b(i({},M(O.Security)),{pathname:"/",search:"disable_mfa=true"})),!1)},[e,t,f,c]);return{setupMfa:y,isUsernamePassword:D,isLoggedInWithMfa:x,removeMfa:C,isLoadingRedirect:_}}export{Z as M,Y as a,it as u};
//# sourceMappingURL=gutjuo0v1j4y19t1.js.map
