const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/b3nbyz21c52nzclw.js","assets/i8clt0mfz495j7ii.js","assets/ceivmd4pm4umbvdn.js","assets/mdgmhl7nsma70wnx.js"])))=>i.map(i=>d[i]);
var k=Object.defineProperty;var M=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var R=(e,a,n)=>a in e?k(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,c=(e,a)=>{for(var n in a||(a={}))N.call(a,n)&&R(e,n,a[n]);if(M)for(var n of M(a))A.call(a,n)&&R(e,n,a[n]);return e};var O=(e,a)=>{var n={};for(var r in e)N.call(e,r)&&a.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&M)for(var r of M(e))a.indexOf(r)<0&&A.call(e,r)&&(n[r]=e[r]);return n};import{o as S,r as C,e as P,j as t,M as u,f as L,u as w,a as q,F as H,_ as y}from"./i8clt0mfz495j7ii.js";import{$ as W,C as z,R as D,A as U,e as V,o as E,T,L as I}from"./ghewn7l2ynbm32fm.js";import{T as l}from"./zm1ki9l766pgg0bx.js";import{DeleteConversationConfirmationModal as B}from"./abwq3htfqpekhs38.js";import{dK as G}from"./j0yo6uv6652vva62.js";const K=E(()=>y(()=>import("./b3nbyz21c52nzclw.js").then(e=>e._),__vite__mapDeps([0,1])),{loading:e=>I(e)}),Q=E(()=>y(()=>import("./ceivmd4pm4umbvdn.js").then(e=>e._),__vite__mapDeps([2,1])),{loading:e=>I(e)}),Y=E(()=>y(()=>import("./mdgmhl7nsma70wnx.js").then(e=>e._),__vite__mapDeps([3,1])),{loading:e=>I(e)}),F=["archivedConversations"],$=30,Z=3,o=L({name:{id:"archivedConversationsModal.name",defaultMessage:"Name"},dateCreated:{id:"archivedConversationsModal.dateCreated",defaultMessage:"Date created"},loading:{id:"archivedConversationsModal.loading",defaultMessage:"Loading..."},somethingWentWrong:{id:"archivedConversationsModal.somethingWentWrong",defaultMessage:"Something went wrong..."},retry:{id:"archivedConversationsModal.retry",defaultMessage:"Retry"},noArchivedConversations:{id:"archivedConversationsModal.noArchivedConversations",defaultMessage:"You have no archived conversations."},title:{id:"archivedConversationsModal.title",defaultMessage:"Archived Chats"},unarchiveConversation:{id:"archivedConversationsModal.unarchiveConversation",defaultMessage:"Unarchive conversation"},deleteConversation:{id:"archivedConversationsModal.deleteConversation",defaultMessage:"Delete conversation"},deleteFailed:{id:"archivedConversationsModal.deleteFailed",defaultMessage:"Deleting failed"}});function J({conversation:e,elementRef:a,closeParentModal:n}){var d;const r=P(),_=V(),m=w(),{mutate:f,isPending:h}=q({mutationFn:async x=>{var g=x,{conversationId:s}=g,i=O(g,["conversationId"]);return D.safePatch("/conversation/{conversation_id}",{parameters:{path:{conversation_id:s}},requestBody:i,intercomEventOnError:"fetch-error:conversation:edit"})},onSettled:()=>{m.invalidateQueries({queryKey:[F]}),G(m,e.gizmo_id)},onError:()=>{_.danger(o.deleteFailed,{toastId:"archived_conversations_modal_delete_failed"})}}),[j,v]=C.useState(!1),p="/c/".concat(e.id);return t.jsxs(t.Fragment,{children:[t.jsxs(l.Row,{disabled:h,children:[t.jsx(l.Cell,{children:t.jsxs("a",{href:p,rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",ref:a,children:[t.jsx(Y,{className:"icon"}),e.title]})}),t.jsx(l.Cell,{children:e.create_time!=null?t.jsx(H,{value:e.create_time,month:"long",year:"numeric",day:"numeric"}):null}),t.jsx(l.Cell,{textAlign:"right",children:t.jsxs(l.Actions,{children:[t.jsx(T,{label:r.formatMessage(o.unarchiveConversation),side:"top",children:t.jsx("button",{"aria-label":r.formatMessage(o.unarchiveConversation),className:"text-token-text-tertiary hover:text-token-text-secondary cursor-pointer text-[18px]",onClick:()=>{f({conversationId:e.id,is_archived:!1})},children:t.jsx(K,{className:"icon-sm"})})}),t.jsx(T,{label:r.formatMessage(o.deleteConversation),side:"top",children:t.jsx("button",{onClick:()=>v(!0),"aria-label":r.formatMessage(o.deleteConversation),className:"text-token-text-tertiary hover:text-token-text-secondary",children:t.jsx(Q,{className:"icon-sm"})})})]})})]}),j&&t.jsx(B,{title:(d=e.title)!=null?d:"",handleDelete:()=>{f({conversationId:e.id,is_visible:!1})},onClose:s=>{v(!1),s!=null&&s.closeParentModal&&n()}})]})}function re({onClose:e}){const{data:a,isLoading:n,isError:r,refetch:_,fetchNextPage:m,hasNextPage:f}=S({queryKey:[F],queryFn:({pageParam:s})=>D.safeGet("/conversations",{parameters:{query:{offset:s,limit:$,order:"updated",is_archived:!0}},intercomEventOnError:"fetch-error:conversations:get",authOption:U.SendIfAvailable}),initialPageParam:0,getNextPageParam:s=>{var x,g,b;const i=((x=s.offset)!=null?x:0)+((g=s.limit)!=null?g:0);return i<((b=s.total)!=null?b:0)?i:void 0},refetchOnMount:"always"}),h=C.useRef(null),j=C.useCallback(s=>{var i;n||s==null||((i=h.current)==null||i.disconnect(),h.current=new IntersectionObserver(x=>{x[0].isIntersecting&&f&&m()}),h.current.observe(s))},[n,f,m]);C.useEffect(()=>()=>{var s;(s=h.current)==null||s.disconnect()},[]);const v=C.useMemo(()=>{var s;return(s=a==null?void 0:a.pages.flatMap(i=>i.items))!=null?s:[]},[a]),p=P();let d;return n?d=t.jsx("div",{className:"text-token-text-secondary pb-8",children:t.jsx(u,c({},o.loading))}):r?d=t.jsxs("div",{children:[t.jsx("div",{className:"mb-4 text-red-500",children:t.jsx(u,c({},o.somethingWentWrong))}),t.jsx("div",{children:t.jsx(W,{color:"secondary",onClick:()=>{_()},children:t.jsx(u,c({},o.retry))})})]}):v.length===0?d=t.jsx("div",{className:"text-token-text-tertiary pb-8",children:t.jsx(u,c({},o.noArchivedConversations))}):d=t.jsxs(l.Root,{className:"max-h-[28rem]",size:"compact",children:[t.jsxs(l.Header,{children:[t.jsx(l.HeaderCell,{children:t.jsx(u,c({},o.name))}),t.jsx(l.HeaderCell,{children:t.jsx(u,c({},o.dateCreated))}),t.jsx(l.HeaderCell,{})]}),t.jsx(l.Body,{children:v.map((s,i)=>t.jsx(J,{conversation:s,elementRef:i===v.length-Z?j:void 0,closeParentModal:e},s.id))})]}),t.jsx(z,{testId:"modal-archived-conversations",isOpen:!0,onClose:e,size:"custom",className:"max-w-5xl",type:"success",title:p.formatMessage(o.title),showCloseButton:!0,children:d})}export{re as default};
//# sourceMappingURL=f9hj5mrd5jefgj9m.js.map
