var We=Object.defineProperty,Xe=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var Te=(r,e,t)=>e in r?We(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pe=(r,e)=>{for(var t in e||(e={}))Ze.call(e,t)&&Te(r,t,e[t]);if(_e)for(var t of _e(e))et.call(e,t)&&Te(r,t,e[t]);return r},ke=(r,e)=>Xe(r,Ye(e));import{c as Ee,e as tt,r as S,f as st,v as Ce,j as g}from"./i8clt0mfz495j7ii.js";import{u as nt,bN as at,bz as rt,a as ve,cH as ot,hV as we,h as it,$ as Pe,bQ as Re,bO as Fe,a_ as je,ak as me,cn as se,co as U,dK as lt,cJ as ct,dM as ut,bT as dt,cR as ft,dE as gt,ea as pt}from"./ghewn7l2ynbm32fm.js";import{ks as mt,kt as ht,d5 as Ne,ku as xe,ff as Mt,fg as St,kv as xt,kw as bt,b_ as At,kx as yt,ky as he,kz as _t,kA as Me,bO as Se,kB as Tt,bP as kt}from"./j0yo6uv6652vva62.js";import{g as Ct}from"./olrcssu7duieo6m7.js";function vt(r){"use forget";const e=Ee.c(69),{prompt:t,isComplete:p,clientThreadId:i,parentMessageId:m}=r,l=nt();let n;e[0]!==i||e[1]!==l?(n=at(l,i),e[0]=i,e[1]=l,e[2]=n):n=e[2];const a=n,u=tt(),[c,B]=S.useState(!1),H=rt();let k;e[3]!==a?(k=()=>ut(a).id,e[3]=a,e[4]=k):k=e[4];const x=ve(k);let d;e[5]!==t?(d=()=>Mt(t?[t]:[]),e[5]=t,e[6]=d):d=e[6];const[f,G]=S.useState(d),A=S.useRef(null),y=ot(i,Pt),D=ve(we.agentSafeModeHasSeenNux$),s=st({startDefault:{id:"auraAgentSuggestion.startDefault",defaultMessage:"Continue"},cancel:{id:"auraAgentSuggestion.cancel",defaultMessage:"No thanks"},accepted:{id:"auraAgentSuggestion.accepted",defaultMessage:"The user has asked for agent to complete their task."}}),$=S.useRef(!1);let M,_;e[7]===Symbol.for("react.memo_cache_sentinel")?(M=()=>(A.current||(A.current=new St([],o=>{G(o)},!0)),()=>{var o;(o=A.current)==null||o.destroy(),A.current=null}),_=[],e[7]=M,e[8]=_):(M=e[7],_=e[8]),S.useEffect(M,_);let C,q;e[9]!==p||e[10]!==t?(C=()=>{var h;const o=t?[t]:[];o.length===0&&G([]),(h=A.current)==null||h.onMessagePartsUpdated(o,!p)},q=[t,p],e[9]=p,e[10]=t,e[11]=C,e[12]=q):(C=e[11],q=e[12]),S.useEffect(C,q);const[Oe,Ie]=S.useState(!1);let K;e[13]===Symbol.for("react.memo_cache_sentinel")?(K=()=>{var o,h;Ie((h=(o=A.current)==null?void 0:o.isComplete())!=null?h:!1)},e[13]=K):K=e[13];let z;e[14]!==f?(z=[f],e[14]=f,e[15]=z):z=e[15],S.useEffect(K,z);let J,V;e[16]!==i||e[17]!==x||e[18]!==y?(J=()=>{if($.current||!x||y)return;$.current=!0;const o=h=>{dt(i,T=>{T.conduitToken=h,T.prepareState="success"})};xt(i,x,[me.Agent],o,{isRegen:!1,isOnboardingConversation:!1,delayAfterCompletion:!1})},V=[i,x,y],e[16]=i,e[17]=x,e[18]=y,e[19]=J,e[20]=V):(J=e[19],V=e[20]),S.useEffect(J,V);let Q;e[21]!==l?(Q=it(l,"3269508448"),e[21]=l,e[22]=Q):Q=e[22];const b=Q,ne=b&&D===!1,Le=wt,Ue=()=>u.formatMessage(s.accepted);let W;e[23]!==ne?(W=()=>{ne&&bt(!0)},e[23]=ne,e[24]=W):W=e[24];const X=W;let Y;e[25]!==b?(Y={isAgentHintActive:!0,isAgentSessionModeDropdownEnabled:b},e[25]=b,e[26]=Y):Y=e[26];const{agentSessionModeNuxModal:ae,ensureAgentSessionModeNux:Be,isAgentSessionModeNuxOpen:De}=mt(Y),be=async o=>{var ye;if(c||!t)return;X();const h=Re(i),T=h?Fe.lastUserMessage(h):null;if(!T){je.error("AuraAgentSuggestion: Unable to find last user message",{clientThreadId:i,parentMessageId:m});return}B(!0),H(me.Agent);const Ae=b&&o?Le(o):void 0,ze={id:Ce(),author:{role:U.Tool,name:xe},create_time:Date.now()/1e3,content:{content_type:se.Text,parts:[Ue()]},recipient:"all",status:"finished_successfully",weight:0},Je=pe(ke(pe({},(ye=T.metadata)!=null?ye:{}),{is_visually_hidden_from_conversation:!0}),Ae!==void 0&&{n7jupd_local_safe_mode:Ae}),Ve=lt("",Je),Qe={systemHints:[me.Agent],conversationMode:{kind:ct.PrimaryAssistant}};await Ne({conversation:a,promptMessage:Ve,eventSource:"mouse",prependMessages:[ze],completionMetadata:Qe})};let Z;e[27]!==X||e[28]!==a||e[29]!==c?(Z=async()=>{if(c)return;X(),B(!0);const o={id:Ce(),author:{role:U.Tool,name:xe},create_time:Date.now()/1e3,content:{content_type:se.Text,parts:["The user has declined to use Agent, answer their question directly"]},recipient:"all",status:"finished_successfully",weight:0};await Ne({conversation:a,promptMessage:o,eventSource:"mouse"})},e[27]=X,e[28]=a,e[29]=c,e[30]=Z):Z=e[30];const re=Z;if(!t)return null;let ee;e[31]!==f?(ee=ht(f),e[31]=f,e[32]=ee):ee=e[32];const oe=ee,ie=u.formatMessage(s.startDefault),le=()=>{const o=b?we.agentSessionMode$():void 0;b&&Be(T=>{be(T)})||be(o)},ce=b&&D===!0&&!De;let v;e[33]===Symbol.for("react.memo_cache_sentinel")?(v=Ct(!1),e[33]=v):v=e[33];const He="text-token-text-primary mb-2 flex max-w-full flex-col gap-6",ue=!p;let w;e[34]!==oe||e[35]!==ue?(w=g.jsx(At,{className:"text-token-text-primary text-base leading-6 break-words",isActivelyStreaming:ue,children:oe}),e[34]=oe,e[35]=ue,e[36]=w):w=e[36];const Ge="flex flex-col gap-3 transition-opacity duration-200",de=Oe?1:0;let P;e[37]!==de?(P={opacity:de},e[37]=de,e[38]=P):P=e[38];const $e="flex flex-col gap-2 min-[420px]:flex-row min-[420px]:items-center min-[420px]:justify-end min-[420px]:gap-3",qe="flex flex-col-reverse gap-2 min-[420px]:flex-row min-[420px]:flex-wrap min-[420px]:gap-2",fe=Pe,Ke="secondary",ge=u.formatMessage(s.cancel);let N;e[39]!==fe||e[40]!==re||e[41]!==c||e[42]!==ge?(N=g.jsx(fe,{color:Ke,onClick:re,disabled:c,children:ge}),e[39]=fe,e[40]=re,e[41]=c,e[42]=ge,e[43]=N):N=e[43];let E;e[44]!==le||e[45]!==c||e[46]!==ie?(E=g.jsx(Pe,{color:"primary",onClick:le,disabled:c,children:ie}),e[44]=le,e[45]=c,e[46]=ie,e[47]=E):E=e[47];let R;e[48]!==N||e[49]!==E?(R=g.jsxs("div",{className:qe,children:[N,E]}),e[48]=N,e[49]=E,e[50]=R):R=e[50];let F;e[51]!==c||e[52]!==ce?(F=ce?g.jsx(yt,{disabled:c,showLeadingDivider:!0}):null,e[51]=c,e[52]=ce,e[53]=F):F=e[53];let j;e[54]!==R||e[55]!==F?(j=g.jsxs("div",{className:$e,children:[R,F]}),e[54]=R,e[55]=F,e[56]=j):j=e[56];let O;e[57]!==P||e[58]!==j?(O=g.jsx("div",{className:Ge,style:P,children:j}),e[57]=P,e[58]=j,e[59]=O):O=e[59];let I;e[60]!==w||e[61]!==O?(I=g.jsxs("div",{className:He,children:[w,O]}),e[60]=w,e[61]=O,e[62]=I):I=e[62];let L;e[63]!==v||e[64]!==I?(L=g.jsx("div",{className:v,children:I}),e[63]=v,e[64]=I,e[65]=L):L=e[65];let te;return e[66]!==ae||e[67]!==L?(te=g.jsxs(g.Fragment,{children:[L,ae]}),e[66]=ae,e[67]=L,e[68]=te):te=e[68],te}function wt(r){return r==="incognito"}function Pt(r){var e;return(e=r==null?void 0:r.prepareRequestBlocked)!=null?e:!1}const Nt={close_tabs:{inProgress:"Closing tabs",finished:"Closed tabs",error:"Failed to close tabs"},open_tabs:{inProgress:"Opening tabs",finished:"Opened tabs",error:"Failed to open tabs"},list_tabs:{inProgress:"Listing tabs",finished:"Listed tabs",error:"Failed to list tabs"},focus_tab:{inProgress:"Focusing tab",finished:"Focused tab",error:"Failed to focus tab"},navigate_current_tab:{inProgress:"Navigating current tab",finished:"Navigated current tab",error:"Failed to navigate current tab"},set_tab_pinned_state:{inProgress:"Updating tab pin state",finished:"Updated tab pin state",error:"Failed to update tab pin state"},set_preference:{inProgress:"Setting preference",finished:"Updated preference",error:"Failed to set preference"},add_bookmark:{inProgress:"Adding bookmark",finished:"Added bookmark",error:"Failed to add bookmark"},reorder_tabs:{inProgress:"Reordering tabs",finished:"Reordered tabs",error:"Failed to reorder tabs"},search_browsing_history:{inProgress:"Searching browser memories",finished:"Searching browser memories",error:"Failed to search browser memories"}},Et=Object.fromEntries(Object.entries(Nt).map(([r,e])=>["".concat(ft,".").concat(r),e])),Rt={inProgress:"Running tool",finished:"Finished running tool",error:"Error running tool"};function Ft(r,e){const t=Et[r];return t?t[e]:Rt[e]}function jt({messages:r,isRequestActive:e,isLastMessageInTurn:t,clientThreadId:p}){"use no forget";var y,D;const i=r.filter(s=>s.author.role===U.Assistant&&s.recipient&&he(s.recipient)),m=Re(p),l=m?Fe.getConversationTurns(m).flatMap(s=>s.messages):[],n=l.findLastIndex(s=>s.author.role===U.Assistant&&s.recipient&&he(s.recipient)),a=n>=0?l[n]:void 0,u=a&&a.recipient,c=n>=0?l.slice(n+1).filter(s=>s.author.role===U.Tool&&s.author.name===u):[],B=n>=0?l.slice(n+1).find(s=>s.author.role===U.Assistant&&(!s.recipient||!he(s.recipient))):void 0,H=B!=null&&gt(B),k=c.length>0,x=a==null?void 0:a.id,d=_t(s=>x?s.getToolState(p,x):void 0);let f=null;k||(d==null?void 0:d.status)===Me.Finished?f={key:"finished",status:Se.Finished}:(d==null?void 0:d.status)===Me.Error?f={key:"error",status:Se.Error}:((d==null?void 0:d.status)===Me.Running||e&&t&&!d)&&(f={key:"inProgress",status:Se.Running});const G=S.useMemo(()=>!u||!f?null:Ft(u,f.key),[u,f]);if(i.length===0||!u||!i.some(s=>s.id===(a==null?void 0:a.id)))return null;if(u===xe){if(!a||c.length>0||H)return null;let s="";a.content.content_type===se.Text?s=(D=(y=a.content.parts)==null?void 0:y[0])!=null?D:"":a.content.content_type===se.Code&&(s=a.content.text);const $=a.status==="finished_successfully",[M]=Tt(s,C=>pt(C));!M&&s.trim().length>0&&je.error("BrowserToolMessage: failed to parse SuggestAgent arguments",{args:s});let _="";return typeof(M==null?void 0:M.prompt)=="string"&&(_=M.prompt),{type:"suggestion",prompt:_,isComplete:$,parentMessageId:a.id}}return H||!f?null:{type:"message",message:G,display:f}}function Dt(r){"use forget";const e=Ee.c(13),{messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m}=r;let l;e[0]!==m||e[1]!==i||e[2]!==p||e[3]!==t?(l={messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m},e[0]=m,e[1]=i,e[2]=p,e[3]=t,e[4]=l):l=e[4];const n=jt(l);if(!n)return null;if(n.type==="suggestion"){let u;return e[5]!==m||e[6]!==n.isComplete||e[7]!==n.parentMessageId||e[8]!==n.prompt?(u=g.jsx(vt,{prompt:n.prompt,isComplete:n.isComplete,clientThreadId:m,parentMessageId:n.parentMessageId}),e[5]=m,e[6]=n.isComplete,e[7]=n.parentMessageId,e[8]=n.prompt,e[9]=u):u=e[9],u}let a;return e[10]!==n.display.status||e[11]!==n.message?(a=g.jsx(kt,{highlightedCommand:n.message,showWorkUserSetting:!1,status:n.display.status,children:null}),e[10]=n.display.status,e[11]=n.message,e[12]=a):a=e[12],a}export{Dt as BrowserToolMessage};
//# sourceMappingURL=ju3nxwuiavion3ab.js.map
