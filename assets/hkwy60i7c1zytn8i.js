const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/e216z3zqjas1rma2.js","assets/i8clt0mfz495j7ii.js"])))=>i.map(i=>d[i]);
var ae=Object.defineProperty,ie=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t)=>{for(var n in t||(t={}))de.call(t,n)&&D(e,n,t[n]);if(K)for(var n of K(t))pe.call(t,n)&&D(e,n,t[n]);return e},U=(e,t)=>ie(e,ue(t));import{r as k,j as o,M as B,_ as _e}from"./i8clt0mfz495j7ii.js";import{u as Y,cH as fe,a as me,h as xe,co as C,cn as J,aW as he,d as W,P as ee,o as ge,i as ye,L as ve,bO as te,dM as be,bN as je}from"./ghewn7l2ynbm32fm.js";import{cm as Se,cn as le,co as Fe,cp as Ee,bQ as L,cq as H,cr as we,cs as ke,ct as Me,cu as Ie,bN as se,cv as Te,cw as Ne,cx as V,cj as Re,bU as Oe}from"./j0yo6uv6652vva62.js";import{F as qe}from"./da0eqg5j39u1e96s.js";import{GlauxSearchQueryWithIcon as oe,GlauxSearchQueryOverflow as Pe}from"./ksuwacyo5m7qmkk7.js";import{A as ne}from"./fy1n36to2eb0czaf.js";import"./nvrhbbc4qxooogd5.js";import"./l3jkxavl2du23cqn.js";const Ae=ge(()=>_e(()=>import("./e216z3zqjas1rma2.js").then(e=>e._),__vite__mapDeps([0,1])),{loading:e=>ve(e)});function X(e,t){const n=new RegExp("<\\s*".concat(t,"\\s*>([\\s\\S]*?)<\\s*/\\s*").concat(t,"\\s*>"),"i"),h=e.match(n);return h&&h[1]?h[1].trim():e}function Ue(e){if(e===void 0)return;const t="Content Snippet:",n=e.indexOf(t);return n===-1?e:e.substring(n+t.length).trim()}function Le(e,t){var n,h,M,S,g;t.text=Ue(e.contents),(n=e.documentId)!=null&&n.includes("ks--slack")||(h=t.cloud_doc_url)!=null&&h.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name="#".concat(t.name)):(M=t.cloud_doc_url)!=null&&M.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=X(t.text,"sheet_summary"):(S=t.cloud_doc_url)!=null&&S.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=X(t.text,"git_summary"):(g=t.cloud_doc_url)!=null&&g.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=X(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function Xe({turnIndex:e,clientThreadId:t,variant:n="sidebar"}){const h=Y(),M=Se(),S=le(h)||M,g=Fe(h),I=Ee(h),[P,a]=fe(t,u=>[te.getTurnContentReferences(u,e),te.getConversationTurnAtIndex(u,e).messages]),T=me(()=>be(je(h,t))),F=a.some(u=>{var _;return((_=u==null?void 0:u.metadata)==null?void 0:_.api_tool_type)==="glaux"}),E=F||xe(h,"2137702454"),N=k.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),$=k.useMemo(()=>{const u=[],_=new Set,f=new Map;if(I.forEach(s=>{f.set(s,[])}),P.forEach(s=>{var y,i,c,l,m,d,R,p,b,x;if(s.type==="file"&&!_.has(s.id)){const r=L((y=s.cloud_doc_url)!=null?y:""),v={id:s.id,name:(i=r==null?void 0:r.type)!=null?i:s.name,subtitle:r!=null&&r.type?s.name:void 0,cloud_doc_url:(l=s.cloud_doc_url)!=null?l:(c=s.extra)==null?void 0:c.cloud_doc_url,text:E?s.snippet:void 0,authors:(m=s.medical_file_reference)==null?void 0:m.authors_display,publication_year:(d=s.medical_file_reference)==null?void 0:d.publication_year,journal_name:(R=s.medical_file_reference)==null?void 0:R.journal_name,doi:(p=s.medical_file_reference)==null?void 0:p.doi,journal_homepage_url:(b=s.medical_file_reference)==null?void 0:b.journal_homepage_url};if(!!!v.cloud_doc_url&&!H(v.id))return;u.push(v),f.has(s.type)&&((x=f.get(s.type))==null||x.push(v)),_.add(s.id)}else s.type==="file_navlist"?s.items.forEach(r=>{var v,w,O;if(!_.has(r.id)){const q=L((v=r.cloud_doc_url)!=null?v:""),j={name:(w=q==null?void 0:q.type)!=null?w:r.name,subtitle:q!=null&&q.type?r.name:void 0,cloud_doc_url:r.cloud_doc_url,text:E?r.description:void 0,id:r.id,lastModifiedTime:r.last_modified_time};if(!!!j.cloud_doc_url&&!H(j.id))return;u.push(j),f.has(s.type)&&((O=f.get(s.type))==null||O.push(j)),_.add(r.id)}}):s.type==="grouped_webpages"&&g&&s.items.forEach(r=>{var v,w,O,q;if(!_.has(r.url)){const j=L((v=r.url)!=null?v:""),z={name:(w=j==null?void 0:j.type)!=null?w:r.title,subtitle:j!=null&&j.type?r.title:void 0,cloud_doc_url:r.url,text:E&&(O=r.snippet)!=null?O:void 0,journal_name:r.attribution,id:r.url};u.push(z),f.has(s.type)&&((q=f.get(s.type))==null||q.push(z)),_.add(r.url)}})}),I.length>0){const s=[];return I.forEach(y=>{var i;f.has(y)&&s.push(...(i=f.get(y))!=null?i:[])}),s}return u},[I,P,E,g]),G=we(T),Q=k.useMemo(()=>{var f,s;if(!G||n==="bottom")return[];const u=[],_=new Set;for(const y of a)if(y.author.role===C.Tool&&y.author.name==="file_search"&&y.content.content_type===J.TetherBrowsingDisplay){const i=ke(y.content.result),c=(s=(f=y.metadata)==null?void 0:f.cloud_doc_urls)!=null?s:[];i.chunks.forEach((l,m)=>{var x,r;if(!l.documentId||_.has(l.documentId))return;let d;if(l.metadata.cloud_doc_url)d=l.metadata.cloud_doc_url.toString();else if(m<c.length)d=c[m];else if(l.documentId.endsWith("--google")){const v=l.documentId.split("--")[1];d="https://drive.google.com/file/d/".concat(v)}if(!d)return;_.add(l.documentId);const R=(x=l.metadata["File last modified at"])!=null?x:l.metadata["File created at"],p=L(d!=null?d:""),b={id:l.documentId,name:(r=p==null?void 0:p.type)!=null?r:l.title,subtitle:p!=null&&p.type?l.title:void 0,cloud_doc_url:d,text:l.contents,lastModifiedTime:R?R.toString():void 0};Le(l,b),u.push(b)})}return u},[G,a,n]),Z=k.useMemo(()=>{var _,f,s,y;if(n==="bottom"||!F)return[];const u=[];for(const i of a)if(i.author.role===C.Tool&&i.author.name==="api_tool.call_tool"&&i.content.content_type===J.MultimodalText){const c=(_=i.metadata)==null?void 0:_.citation_metadata,l=c==null?void 0:c.id;if(!c||!l||!c.url)continue;const R=i.content.parts[1].toString().split("\n").flatMap(b=>{const x=Me.exec(b);return x?[x[1]]:[]}).flatMap(b=>{const x=Ie.exec(b);return x?/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i.exec(x[2])?[x[2].trim().replace(/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i,(v,w,O)=>"".concat((O==null?void 0:O.trim())||(w==null?void 0:w.trim()),":")).replace(/\r/g,"")]:[x[2].trim()]:[]}),p=L(c.url);u.push(o.jsx(ce,{clientThreadId:t,item:{id:l,name:(f=p==null?void 0:p.type)!=null?f:c.title,subtitle:p!=null&&p.type?c.title:void 0,cloud_doc_url:c.url,text:R.slice(0,3).join("\n"),lastModifiedTime:c.last_modified_at}},"".concat(i.id,"-").concat(l)))}else if(i.author.role===C.Assistant&&i.recipient==="api_tool.call_tool"&&i.content.content_type===J.Code&&i.content.language==="json"){let c={};try{if(c=JSON.parse(i.content.text),typeof c.args=="string")try{c.args=JSON.parse(c.args)}catch(m){continue}}catch(m){continue}if(!c.path)continue;const l=[];if(c.path==="mixer://search"&&typeof((s=c.args)==null?void 0:s.sources)=="object"){const m=c.args.sources;for(const d in m){const R=m[d],p=se(d);if(p){const b=new Set;R.forEach(x=>{x.query&&!b.has(x.query)&&(l.push(U(A({},p),{query:x.query})),b.add(x.query))})}}}else if((y=c.args)!=null&&y.query){const m=se(c.path);m&&l.push(U(A({},m),{query:c.args.query}))}if(!l.length)continue;u.push(o.jsx("div",{className:"flex flex-row flex-wrap items-center gap-2 px-3 py-2.5",children:l.length<=3?l.map((m,d)=>o.jsx(oe,{query:m.query},i.id+d)):o.jsxs(o.Fragment,{children:[l.slice(0,3).map((m,d)=>o.jsx(oe,{query:m.query},i.id+d)),o.jsx(Pe,{maxResults:3,queries:l},i.id+"query-overflow")]})},i.id))}return u},[t,a,n,F]);return o.jsx(he,{children:o.jsxs("div",{className:W("bg-token-main-surface-primary flex w-full flex-col",n==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(re,{title:o.jsx(B,{id:"dlVlo6",defaultMessage:"Citations"}),items:$,clientThreadId:t,sectionId:"citations",analyticsMetadata:N}),!S&&o.jsx(re,{title:o.jsx(B,{id:"njZblE",defaultMessage:"Search Results"}),items:Q,clientThreadId:t,sectionId:"search-results",analyticsMetadata:N,unstructuredResults:Z})]})})}function re({title:e,items:t,scrollToHeader:n,shouldAnimateScroll:h,clientThreadId:M,analyticsMetadata:S,sectionId:g,unstructuredResults:I=[]}){const P=Y(),a=ye(P),T=k.useRef(null),F=k.useMemo(()=>S?U(A({},S),{sectionId:g,numResultsInSection:t.length}):void 0,[S,t.length,g]);return k.useEffect(()=>{T.current&&n&&setTimeout(()=>{T.current&&T.current.scrollIntoView({behavior:h?"smooth":"instant"})},300)},[n,h]),I.length===0&&(!t||t.length===0)?null:o.jsxs("div",{ref:T,children:[o.jsx(ne,{className:W("bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex items-center px-6 pt-4 pb-4 text-sm font-medium",a?"border-b-thin h-[var(--header-height,3.5rem)] border-(--bento-border-color)":"border-token-border-sharp h-[calc(var(--header-height,3.5rem)+1px)] border-b"),children:e}),o.jsxs("div",{className:"flex list-none flex-col px-3 py-2",children:[t.map((E,N)=>o.jsx(ne,{index:N,children:o.jsx(ce,{positionInSection:N,item:E,analyticsMetadata:F,clientThreadId:M},N)},"".concat(e,"-").concat(N))),I]})]})}function ce({item:e,analyticsMetadata:t,positionInSection:n,clientThreadId:h}){var u,_,f;const M=Y(),S=Te(),g=le(M),I=Ne(M),P=g&&e.journal_name!=null?e.journal_name:e.name,a=L((u=e.cloud_doc_url)!=null?u:"");let T=P!=null?P:o.jsx(B,{id:"bqY3sN",defaultMessage:"File"}),F=(_=a==null?void 0:a.Icon)!=null?_:e.cloud_doc_url?V:Ae;!e.cloud_doc_url&&!H(e.id)&&(T=o.jsx(B,{id:"hGgoxF",defaultMessage:"Source"}),F=V);const[E,N]=k.useState(!1);let $=e.cloud_doc_url?e.cloud_doc_url:"";I&&e.journal_homepage_url&&($=e.journal_homepage_url),g&&$.length>0&&(F=({className:s})=>o.jsx(Oe,{url:$,className:W(s,"object-cover"),size:32,fallback:o.jsx(V,{className:s})}));const G=k.useCallback(()=>{t&&ee.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",U(A({},t),{positionInSection:n,sourceType:a==null?void 0:a.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,a==null?void 0:a.type,n]),Q=k.useCallback(()=>{t&&ee.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",U(A({},t),{positionInSection:n,sourceType:a==null?void 0:a.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,a==null?void 0:a.type,n]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:G,className:W("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",E&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"ellipses flex h-6 items-center gap-2 text-xs",children:[F&&o.jsx(F,{className:"icon-sm bg-primary flex-none rounded-full object-cover"}),o.jsx("p",{className:"text-token-text-secondary flex-auto truncate overflow-ellipsis",children:T})]}),g&&e.name!=null&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),g&&e.authors!=null&&e.publication_year!=null&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),g&&e.doi!=null&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),e.subtitle&&o.jsx("div",{className:"text-token-text-primary line-clamp-1 text-sm font-semibold",children:e.subtitle}),((f=e.text)!=null?f:e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(Re,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),S?null:o.jsx(qe,{className:W("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",E&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:h,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:E,setIsFollowupMenuOpen:N,trackFileSourceFollowup:Q})]})})}export{Xe as ChatScreenRetrievalResultsFlyoutContent,re as SourcesListGroup,Le as __hacky_maybe_enhance_ref};
//# sourceMappingURL=hkwy60i7c1zytn8i.js.map
