const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fbo3r3nxh907ko6l.js","assets/i8clt0mfz495j7ii.js","assets/nnak5qlpz7soad97.js","assets/eu4d2sy2duibeikv.js","assets/ef28lc1b3o54kec9.js","assets/b8lmybnmedr4n7bh.js","assets/mbhfxri3syrb9rbq.js","assets/gbr30v7j74ce8rab.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/gfxl3n7r4t82beqq.js","assets/k5zh2h7fpzx4n2oe.js","assets/j0yo6uv6652vva62.js","assets/conversation-small-lq38g8zw.css","assets/kf7tqzde2yk57qjr.js","assets/n4d5s6gidn7smpjz.js","assets/dabvy8uqe4jm1b47.js","assets/oz2w8uv2a0ics46w.js","assets/7drepi7d7klmi8rs.js","assets/2uk20wu2pu1737un.js","assets/bgxcag65uz54fc39.js","assets/m53ly4eu8e9c6q19.js","assets/jwwofwbvdtftvupg.js","assets/is912miy7ctt2z66.js","assets/d3y46a2mpr2sbz7s.js","assets/e8a1uw0zdlt1m0jy.js","assets/d69imh1iyv32gaf9.js","assets/jlsn3bgiglwu2091.js","assets/gxutkm8tkisxteim.js","assets/fwyctp3zfyh6emd2.js","assets/c8sj5q0wb2w4qlno.js","assets/k7gle8iztcijpdqk.js","assets/kl3c7pa639r7ky2c.js","assets/pdp94tw1ktf1pj0a.js","assets/rsi9kppw43ykrsgk.js","assets/jyroje0qaxw6h3z1.js","assets/frf0wu8ouyfyu06j.js","assets/m6wym3ejj3i5iveb.js","assets/da9ysnvw39tlmcb1.js","assets/fp27qqwhg12gsehb.js","assets/g5jbfk4gk138tht0.js","assets/dkwbd01msodbgagg.js","assets/oqpuvdflzxc04e1g.js","assets/gsyp9a9fup59ufmh.js","assets/llj6x3d5vhdkrkxn.js","assets/n1njhaxkf65rrafr.js","assets/bqk4d9uy5l3d6vsz.js","assets/gryeadru0tqqt3vi.js","assets/gr73ffwzttzymtep.js","assets/b0k25fupgmbv7hs2.js","assets/irdjjmg8z2875a0t.js","assets/cxbsld3botts7bfn.js","assets/da0eqg5j39u1e96s.js","assets/bbipyj9bituayr8q.js","assets/dbdg2o93q6s69qkd.js","assets/f5bdf2ynleqr2zah.js","assets/gvo1fqf7h2313x3d.js","assets/lb3e2s17svct1mam.js","assets/nnzgss862gapaux3.js","assets/nfccle6oyncifphl.js","assets/hu1bt0oauegdhua6.js","assets/h1em0bjkpkjv8ykw.js","assets/mjbhy8c4bs0n8qw2.js","assets/gy1lpvuoewmzh42c.js","assets/hxdh3tr5l8kut4ed.js","assets/ieykhlrsk25lij4e.js","assets/i03gut32e8jn5ajq.js","assets/e26n6uhwwtwdmiki.js","assets/mjq17q47489shd3e.js","assets/ozby1o16tp40naiq.js","assets/mzyl3pd4zxnxoe9i.js","assets/lep2wptoy14cfe2w.js","assets/eb6zep29zccfypdc.js","assets/ivb8c1xam3e690hh.js","assets/kmo5unuf793khl43.js","assets/zl0env7yrga8vz86.js","assets/mnf9y116wq0a5kdn.js","assets/product-variants-gcznzbx5.css","assets/ov015nmz1yxh95ok.js","assets/olrcssu7duieo6m7.js","assets/czlj2e41cb4c3w4v.js","assets/iiok29s29bpdre61.js","assets/gjgbg8mnok0ngaoo.js","assets/kq8d654gegx6snmr.js","assets/ozgq3nk5vhninx80.js","assets/i94vqq9eycryltby.js","assets/g5lgy1otfli5p2x7.js","assets/pn83wqr6w775mq4b.js","assets/chs4g5r39qlnqw6r.js","assets/nzsqhqpna1ee8hwf.js","assets/ivhm4b1s5w1b1cuw.js","assets/eh21clr7cewe9q6y.js","assets/gutjuo0v1j4y19t1.js","assets/c80gqv0732s10rnu.js","assets/g69peh4qbpo7a7d7.js","assets/bzqztn8malpuegtc.js","assets/zul7780usssm7kro.js","assets/ansi-1f6vhsjh.css","assets/jyyjaseddjwyjwou.js","assets/kz85ppopzltkr0hm.js","assets/o9vew0btr2k0i59c.js","assets/f76gy0b8ieo4s693.js","assets/dxyrjy681bkwlnj8.js","assets/iakvhqfu6nmvphq6.js","assets/l0icc3zt92jpknxy.js","assets/iarex6kxmgocprus.js","assets/go502v54gisfd23y.js","assets/6ji8ehbh56ghw0zw.js","assets/ce3hgmw4iyyhicud.js","assets/mqebxepg7t6q2tie.js","assets/jdfzk1zd468oela3.js","assets/gdq1l97elemowxcc.js","assets/l2r1du6tfxyv7jaj.js","assets/ln88gzx578175chd.js","assets/hf25g8jqpmy99k5w.js","assets/omoqxnq6po1pmb00.js","assets/o56jrqjpjpipvc65.js","assets/kl7c6054usfnqmd4.js","assets/k97n0y6ba9c9h39c.js","assets/ew5h1tpzyj1oiamp.js","assets/dwikchly7agkd2y3.js","assets/julkxv3pzs8k4gnq.js","assets/bgrybb42icl9dini.js","assets/zm1ki9l766pgg0bx.js","assets/ib30xv8geh252fv7.js","assets/ol9d5wxhynx9q2is.js","assets/fna9z31n721lpf9f.js","assets/table-components-iztk4amh.css"])))=>i.map(i=>d[i]);
var Eo=Object.freeze,No=Object.defineProperty,Ri=Object.defineProperties;var $i=Object.getOwnPropertyDescriptors;var ws=Object.getOwnPropertySymbols;var To=Object.prototype.hasOwnProperty,Io=Object.prototype.propertyIsEnumerable;var dn=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t);var un=(t,e,s)=>e in t?No(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,z=(t,e)=>{for(var s in e||(e={}))To.call(e,s)&&un(t,s,e[s]);if(ws)for(var s of ws(e))Io.call(e,s)&&un(t,s,e[s]);return t},Q=(t,e)=>Ri(t,$i(e));var Po=t=>typeof t=="symbol"?t:t+"",Le=(t,e)=>{var s={};for(var n in t)To.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&ws)for(var n of ws(t))e.indexOf(n)<0&&Io.call(t,n)&&(s[n]=t[n]);return s};var Ro=(t,e,s)=>un(t,typeof e!="symbol"?e+"":e,s);var vs=(t,e)=>Eo(No(t,"raw",{value:Eo(e||t.slice())}));var ks=function(t,e){this[0]=t,this[1]=e},$o=(t,e,s)=>{var n=(i,l,c,d)=>{try{var f=s[i](l),u=(l=f.value)instanceof ks,g=f.done;Promise.resolve(u?l[0]:l).then(p=>u?n(i==="return"?i:"next",l[1]?{done:p.done,value:p.value}:p,c,d):c({value:p,done:g})).catch(p=>n("throw",p,c,d))}catch(p){d(p)}},o=i=>a[i]=l=>new Promise((c,d)=>n(i,l,c,d)),a={};return s=s.apply(t,e),a[dn("asyncIterator")]=()=>a,o("next"),o("throw"),o("return"),a};var fn=(t,e,s)=>(e=t[dn("asyncIterator")])?e.call(t):(t=t[dn("iterator")](),e={},s=(n,o)=>(o=t[n])&&(e[n]=a=>new Promise((i,l,c)=>(a=o.call(t,a),c=a.done,Promise.resolve(a.value).then(d=>i({value:d,done:c}),l)))),s("next"),s("return"),e);import{j as r,_ as se,M as q,e as _e,r as m,v as Ai,c as je,a as Vn,d as es,f as Gt,h as Li,w as Di,b as Oi,l as Fi,i as qn,R as ma}from"./i8clt0mfz495j7ii.js";import{M as zi,r as Bi,a as Wi,b as Hi,m as ha,u as En,R as Nn,c as Tn,S as In,d as Ui,I as Gi,e as Vi,C as qi,f as Ki,g as Xi,h as Zi,i as Yi}from"./gvo1fqf7h2313x3d.js";import{o as ne,L as ae,d as D,vO as Ji,bR as ds,cH as us,cn as Qi,b0 as fs,u as Me,e as Mt,h as Pe,cF as Kn,oc as el,bh as tl,be as sl,J as Vt,eu as nl,bz as ol,ak as Ao,a as rt,dw as pa,am as rl,w as ga,x as xa,e0 as al,$ as Ve,M as _t,ay as il,af as ll,ag as cl,aV as rs,T as Ct,ja as dl,iX as ul,pT as fl,bi as ms,P as st,gj as hs,bb as Xn,bc as Zn,e4 as He,eo as ba,tR as ml,an as hl,rO as ps,q6 as gs,ui as pl,nT as ts,tN as Fe,rP as as,rQ as Ps,nU as is,kV as gl,al as xl,vN as bl,s as Lt,R as Xs,A as Yn,e$ as yl,vP as _l,fn as wl,q9 as js,a$ as ya,kA as vl,lv as kl,vQ as jl,gM as Jn,il as Sl,id as Ml,ig as Cl,ie as El,ic as Nl,rT as Tl,rR as Il,uf as Pl,og as Rl,la as $l,ff as Qn,bT as Al,bY as Ll,ee as Dl,bO as ft,aL as Ol,ed as xs,i as at,fU as _a,aX as Zs,bX as wa,h7 as Et,kx as Fl,vR as zl,h6 as Bl,fY as Wl,li as Hl,iE as mn,ba as Ys,dv as Ul,f5 as Gl,hc as Vl,hy as ql,gz as Kl,hM as Xl,aR as Zl,cG as Yl,oG as Qt,ar as va,cO as eo,lN as Jl,hw as Ql,aW as Lo,F as ka,bk as ec,vS as tc,dp as sc,cE as nc,jT as oc,el as ja,co as rc,hp as hn,bQ as Do,mZ as ac,cS as ic}from"./ghewn7l2ynbm32fm.js";import{u as lc,g as cc,s as pn,F as yt,C as dc,I as uc,P as fc,a as mc,b as hc,c as pc,d as gc}from"./eb6zep29zccfypdc.js";import{yH as xc,yI as Sa,gY as Ma,ad as Ca,ae as to,p3 as bc,hQ as yc,dh as _c,cv as Js,f6 as jt,f4 as wc,b_ as vc,ki as kc,i0 as Qs,mi as en,q as tn,t as sn,tr as jc,ch as Ea,gn as Sc,gm as Mc,yJ as Pn,yK as Os,yL as Cc,yM as Ec,yN as Nc,sH as Na,yO as Ta,aD as Oo,aC as Tc,bG as so,yP as Ic,uB as Pc,yQ as Rc,n4 as $c,n5 as Ac,n6 as Lc,fd as Dc,fe as Oc,kJ as St,ci as no,yR as nn,th as Ia,yS as Pa,yT as Ra,yU as $a,yV as Fc,ce as on,bU as Rs,kh as zc,S as Bc,bu as Wc,E as bs,mg as Aa,yW as Hc,nr as Uc,kD as Gc,h5 as Vc,kH as La,kO as qc,na as Kc,yX as Da,a5 as Oa,yY as Xc,yZ as Zc,nd as Yc,dV as Jc,cq as Qc,cm as ed,y_ as Fa,y$ as td,d9 as sd,o$ as nd,a4 as od,lL as rd,iK as Ss,ie as ad,gc as id,z0 as ld,z1 as cd,wV as dd}from"./j0yo6uv6652vva62.js";import{u as oo}from"./ov015nmz1yxh95ok.js";import{N as ud}from"./olrcssu7duieo6m7.js";import{g as Fo,F as fd,i as md}from"./czlj2e41cb4c3w4v.js";import{v as hd,u as pd,P as gd,W as xd}from"./k5zh2h7fpzx4n2oe.js";import{L as bd}from"./iiok29s29bpdre61.js";import{r as yd,b as _d,C as wd}from"./lb3e2s17svct1mam.js";import{a as vd}from"./gjgbg8mnok0ngaoo.js";import{g as kd,A as $s,c as jd,D as Sd,b as Rn,o as Md,I as za,d as Cd}from"./nnzgss862gapaux3.js";import{u as Ed}from"./f5bdf2ynleqr2zah.js";import{W as Nd,c as Td,b as Id,a as Pd}from"./ieykhlrsk25lij4e.js";import{W as rn}from"./kq8d654gegx6snmr.js";import{W as Rd}from"./ozgq3nk5vhninx80.js";import{W as zo,i as $d}from"./i94vqq9eycryltby.js";import{u as Ad}from"./bzqztn8malpuegtc.js";import{l as Ld,B as Dd,W as Od,n as Fd}from"./g5lgy1otfli5p2x7.js";import{A as zd}from"./zul7780usssm7kro.js";import{P as Bd,S as Wd,a as Hd,h as Ud,r as Bo,u as Gd}from"./jyyjaseddjwyjwou.js";import{c as Vd,d as qd,B as $n,e as Kd,b as Xd,H as Zd,f as Yd,I as An,L as Jd,g as Ba,O as Ln,U as Dn,S as Qd,T as eu,h as tu,i as su,C as nu,s as ou,j as ru,t as au,w as Wo,l as iu}from"./kz85ppopzltkr0hm.js";import{P as Wa,H as On,R as lu,T as cu}from"./o9vew0btr2k0i59c.js";import{N as du,E as uu,S as fu}from"./f76gy0b8ieo4s693.js";import{f as mu}from"./dxyrjy681bkwlnj8.js";import{remarkRemoveDirectives as hu,markdownToPlaintext as pu}from"./iarex6kxmgocprus.js";import{r as gu}from"./nfccle6oyncifphl.js";import{r as xu}from"./mjbhy8c4bs0n8qw2.js";import{b as Ue,A as bu,T as yu,a as Ha}from"./go502v54gisfd23y.js";import{Z as ro,T as Ua}from"./ce3hgmw4iyyhicud.js";import{u as _u}from"./mqebxepg7t6q2tie.js";import{c as ao}from"./hf25g8jqpmy99k5w.js";import{s as wu}from"./omoqxnq6po1pmb00.js";import{C as Ho}from"./o56jrqjpjpipvc65.js";import{d as vu}from"./kl7c6054usfnqmd4.js";import{g as ku}from"./k97n0y6ba9c9h39c.js";import{u as io}from"./ew5h1tpzyj1oiamp.js";import{M as lo}from"./mzyl3pd4zxnxoe9i.js";import{a as ju,b as Su}from"./dwikchly7agkd2y3.js";import{g as Mu,b as Cu,a as Eu,c as Nu,F as Tu,d as Iu}from"./cxbsld3botts7bfn.js";import{v as Uo,C as Pu,A as Ru,h as $u,j as Au,f as Lu,p as Du,k as Ou,n as Fu,P as zu,o as Bu,q as Wu,L as Hu}from"./julkxv3pzs8k4gnq.js";import{u as ss,t as Go,r as Fn,g as ot}from"./bgrybb42icl9dini.js";import{T as De}from"./zm1ki9l766pgg0bx.js";import{c as Ga}from"./ib30xv8geh252fv7.js";import{t as Vo}from"./fna9z31n721lpf9f.js";const Uu=Ga("ChevronDownFilled","1em",["M15.8 7.73c.28.3.27.78-.03 1.06l-5.25 5a.75.75 0 0 1-1.04 0l-5.25-5a.75.75 0 0 1 1.04-1.08L10 12.2l4.73-4.5a.75.75 0 0 1 1.06.02Z"]),Gu=Ga("ChevronLeftFilled","1em",["M12.27 15.8a.75.75 0 0 1-1.06-.03l-5-5.25a.75.75 0 0 1 0-1.04l5-5.25a.75.75 0 1 1 1.08 1.04L7.8 10l4.5 4.73c.29.3.28.78-.02 1.06Z"]),Vu=ne(()=>se(()=>import("./fbo3r3nxh907ko6l.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>ae(t)});function qu(s){var n=s,{children:t}=n,e=Le(n,["children"]);return r.jsxs(zi,Q(z({},e),{className:"decorated-link",children:[t,r.jsx("span",{"aria-hidden":!0,className:"ms-0.5 inline-block align-middle leading-none",children:r.jsx(Vu,{className:"block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"})})]}))}const qo=({children:t,"data-start":e=null,"data-end":s=null,"data-is-last-node":n,"data-is-only-node":o,tag:a})=>{const{animationTiming:i,shouldAnimate:l,shouldHide:c,isDisabled:d,onComplete:f,onReady:u}=lc({isMarker:!0,tag:a,children:t,start:e,end:s,isLastNode:n,isOnlyNode:o});return d||c?r.jsx(a,{"data-start":e,"data-end":s,className:D(c&&"hidden"),children:t}):r.jsx(a,{"data-start":e,"data-end":s,className:D(pn.marker,l?pn.animate:pn.hidden),onAnimationStart:()=>u(0),onAnimationEnd:()=>f(0),style:cc(i),children:t})},Ku={p:t=>r.jsx(yt,z({tag:"p"},t)),h1:t=>r.jsx(yt,z({tag:"h1"},t)),h2:t=>r.jsx(yt,z({tag:"h2"},t)),h3:t=>r.jsx(yt,z({tag:"h3"},t)),h4:t=>r.jsx(yt,z({tag:"h4"},t)),h5:t=>r.jsx(yt,z({tag:"h5"},t)),h6:t=>r.jsx(yt,z({tag:"h6"},t)),li:t=>r.jsx(qo,z({tag:"li",isListItem:!0},t)),hr:t=>r.jsx(qo,z({tag:"hr"},t))};function Xu(t){const e=t.split("\n");Yu(e);const s=e.pop();if(s===":"||s==="::")e.push("");else{const n=Zu(s).trimEnd();n&&e.push(n)}return e.join("\n")}function Zu(t){if(!t||/^\s*-\s*([*_]+)?\s*$/.test(t))return"";const e=[];let s="",n=0;for(;n<t.length;){if(t[n]==="*"&&t[n+1]==="*"){s+="**",e.length&&e[e.length-1]==="**"?e.pop():e.push("**"),n+=2;continue}if(t[n]==="*"||t[n]==="_"){s+=t[n];const a=t[n];e.length&&e[e.length-1]===a?e.pop():e.push(a),n++;continue}if(t[n]==="["){const a=t[n];s+=a,e.push(a),n++;continue}if(t[n]==="]"){const a=t[n];s+=a,e.length&&e[e.length-1]==="["&&e.pop(),n++;continue}if(t[n]==="("&&t[n-1]==="]"){const a=t[n];s+=a,e.push(a),n++;continue}if(t[n]===")"){const a=t[n];s+=a,e.length&&e[e.length-1]==="("&&e.pop(),n++;continue}s+=t[n],n++}if(e.length===0)return t;let o=s.trimEnd();for(;e.length;){const a=e.pop();if(a==null)break;a==="("?o+=")":o.endsWith(a)?o=o.slice(0,-a.length).trimEnd():a==="["?o+="]()":o+=a}return o}function Yu(t){let e=!1,s=null;for(let n=0;n<t.length;n++){const o=t[n],a=xc(o);if(a){const l=a.info.trimStart(),c=a.info.trim();if(e)s&&a.marker===s.marker&&a.fence.length===s.fence.length&&c.length===0&&(s=null);else if(l.startsWith("{")){const d=sf(t,n,a);t[n]=d.normalizedLine,(d.linesConsumed>0||d.replacementLines.length)&&t.splice(n+1,d.linesConsumed,...d.replacementLines),s=a}else if(c.length===0&&n===t.length-1){t[n]="";continue}e=!e;continue}if(e){s&&af(o,s)&&(t[n]="".concat(s.leadingWhitespace).concat(s.fence),s=null,e=!1);continue}const i=o.trim();if(i.startsWith(":::")&&i!==":::"){const l=i.indexOf("{");if(l===-1){const c=i.slice(3).trim();if(c.length>0&&!(c in Ji)){t[n]=":::";continue}const d=o.replace(/\s+$/,"");t[n]=d+"{}";continue}Qu(i,l)||(t[n]=Ju(o,o.indexOf("{")))}t.length>1&&t[t.length-1]===":::"&&t[t.length-2]===":::"&&t.splice(-2)}s&&(t.push("".concat(s.leadingWhitespace).concat(s.fence)),s=null)}function Ju(t,e){const s=t.replace(/\s+$/,""),n=s.slice(0,e).replace(/\s+$/,""),o=s.slice(e+1);if(o.trim().length===0||!/=/.test(o))return n+"{}";let i=null,l=!1;for(let c=0;c<o.length;c++){const d=o[c];if(l){l=!1;continue}if(d==="\\"){l=!0;continue}if(i){d===i&&(i=null);continue}if(d==='"'||d==="'"){i=d;continue}}return i?s+i+"}":/=[\s]*$/.test(o)?s+'""}':s+"}"}function Qu(t,e){let s=null,n=0,o=!1;for(let a=e;a<t.length;a++){const i=t[a];if(o){o=!1;continue}if(i==="\\"){o=!0;continue}if(s){i===s&&(s=null);continue}if(i==='"'||i==="'"){s=i;continue}if(i==="{"){n++;continue}if(i==="}"){if(n--,n===0)return!0;continue}}return!1}function ef(t){const e=t.match(/^\s*/),s=e?e[0]:"",n=t.slice(s.length);if(!n.startsWith("{"))return"".concat(s,"{}");let o;try{const[l]=Sa(n,!0);o=l}catch(l){return"".concat(s,"{}")}const a=Va(o);if(!a)return"".concat(s,"{}");const i=JSON.stringify(a);return"".concat(s).concat(i)}function Va(t){if(!(!t||Array.isArray(t)||typeof t!="object"))return t}const tf=4,qa=2048;function sf(t,e,s){var d,f;const n=s.leadingWhitespace.length+s.fence.length;let a=(f=(d=t[e])==null?void 0:d.slice(n))!=null?f:"",i=0,l=Ko(a);if(l.kind==="complete")return{normalizedLine:Xo(s,l.value),linesConsumed:0,replacementLines:Zo(l.remainder)};for(;l.kind==="needsMore"&&i<tf&&a.length<qa;){const u=e+i+1;if(u>=t.length)break;const g=t[u];if(!of(g))break;if(i++,a="".concat(a,"\n").concat(g!=null?g:""),l=Ko(a),l.kind==="complete")return{normalizedLine:Xo(s,l.value),linesConsumed:i,replacementLines:Zo(l.remainder)};if(l.kind==="invalid")break}return{normalizedLine:nf(s,a),linesConsumed:i,replacementLines:[]}}function Ko(t){if(!t)return{kind:"invalid"};const e=t.indexOf("{");if(e===-1)return{kind:"invalid"};const s=t.slice(e),n=rf(s);if(n==null)return t.length>=qa?{kind:"invalid"}:{kind:"needsMore"};const o=s.slice(0,n+1);try{const[a,i]=Sa(o.trim()),l=Va(a);if(!l)return{kind:"invalid"};if(i!=null)return{kind:"needsMore"};const c=s.slice(n+1);return{kind:"complete",value:l,remainder:c}}catch(a){return{kind:"invalid"}}}function Xo(t,e){const s="".concat(t.leadingWhitespace).concat(t.fence);return"".concat(s).concat(JSON.stringify(e))}function nf(t,e){const s="".concat(t.leadingWhitespace).concat(t.fence),n=ef(e.replace(/\r?\n+/g," ").trimStart()).trim();return n.length===0?"".concat(s,"{}"):"".concat(s).concat(n)}function of(t){if(!t)return!1;const e=t.trimStart();if(e.length===0)return!0;const s=e[0];return s==='"'||s==="'"||s==="{"||s==="}"||s==="["||s===","}function rf(t){let e=!1,s=0,n=!1,o=!1;for(let a=0;a<t.length;a++){const i=t[a];if(!e){i==="{"&&(e=!0,s=1);continue}if(o){o=!1;continue}if(i==="\\"){o=!0;continue}if(n){i==='"'&&(n=!1);continue}if(i==='"'){n=!0;continue}if(i==="{"){s++;continue}if(i==="}"){if(s--,s===0)return a;continue}}return null}function Zo(t){if(!t)return[];const e=t.startsWith("\n")?t.slice(1):t;return e.length===0?[]:e.split("\n")}function af(t,e){const s=t.trim();return s.length===0||!lf(s,e.marker)?!1:s.length<e.fence.length}function lf(t,e){for(let s=0;s<t.length;s++)if(t[s]!==e)return!1;return!0}const cf=ne(()=>se(()=>import("./nnak5qlpz7soad97.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>ae(t)});function df({citation:t}){return r.jsx(Ma,{side:"top",triggerButton:r.jsx("span",{className:"inline-flex items-center font-bold",children:r.jsx(q,{id:"ZNWtPG",defaultMessage:"{startChar}clipboard {icon}{endChar}",values:{startChar:"「",icon:r.jsx(cf,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:r.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[r.jsx("div",{className:"flex justify-end border-b",children:r.jsx(Ca,{onCopy:e=>to(t.text,void 0,e),buttonText:!0,textPosition:"left"})}),r.jsx("div",{children:t.text})]})})}const uf=ne(()=>se(()=>import("./eu4d2sy2duibeikv.js").then(t=>t._),__vite__mapDeps([3,1])),{loading:t=>ae(t)});function ff({citation:t,conversation:e,nodeType:s}){const n=_e(),o=ds(e.id),a=bc(t.screenshot_asset_pointer,o);return s==="containerDirective"&&n.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"}),r.jsx(Ma,{side:"top",triggerButton:r.jsx("span",{className:"inline-flex items-center font-bold",children:r.jsx(q,{id:"qUxKU1",defaultMessage:"{startChar}screenshot {icon}{endChar}",values:{startChar:"「",icon:r.jsx(uf,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:a?r.jsx("img",{className:"w-xl max-w-screen",src:a,alt:n.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"})}):r.jsx("div",{className:"text-sm",children:r.jsx(q,{id:"BUdJTR",defaultMessage:"Screenshot not available"})})})}const mf=ne(()=>se(()=>import("./ef28lc1b3o54kec9.js").then(t=>t._),__vite__mapDeps([4,1])),{loading:t=>ae(t)});function Ka({conversation:t,messageId:e,fileId:s,fileName:n,processedMarkdownInfo:o,isStandaloneAttachment:a}){const i=ds(t.id),l=us(t.id,w=>{var S;return e?(S=w==null?void 0:w.tree.getNodeIfExists(e))==null?void 0:S.message:void 0}),c=m.useMemo(()=>{var h;if(!l)return null;const w={content_type:Qi.Text,parts:["{{file:".concat(s,"}}")]},S=Q(z({},l==null?void 0:l.metadata),{is_synthetic_share_message:!0,is_standalone_share_attachment:a});return S.content_references=(h=o==null?void 0:o.displayedContentReferences.filter(M=>M.type!=="debug"))!=null?h:[],S.citations=[],o&&(w.parts=[o.rawText],S.n7jupd_crefs=o.n7jupdCrefs),Q(z({},l),{id:Ai(),content:w,metadata:S})},[l,s,o,a]),d=m.useMemo(()=>{if(!(!l||!c||!i))return{previewMessage:c,clientThreadId:t.id,fileId:s,messageId:l.id,serverThreadId:i,isStandaloneAttachment:a,fileName:n}},[c,t.id,s,l,i,a,n]),f=yc({odysseyShareIntent:d,clientThreadId:t.id}),[u,g]=m.useState(!1);return{onClick:m.useCallback(async()=>{g(!0),await f(),g(!1)},[g,f]),isLoading:u,isEnabled:!!d}}function hf({conversation:t,messageId:e,fileId:s,fileName:n,processedMarkdownInfo:o}){const a=_e(),{onClick:i,isLoading:l,isEnabled:c}=Ka({conversation:t,messageId:e,fileId:s,fileName:n,processedMarkdownInfo:o,isStandaloneAttachment:!1});return c?r.jsx(_c,{onClick:i,label:a.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:l?fs:mf}):null}function pf(t){return t.endsWith(".md")}const gf=({citation:t,conversation:e,messageId:s})=>{const n=Me(),[o,a]=m.useState(!1),i=ds(e.id),l=Mt(),[c,d]=m.useState(null),f=m.useRef(null),u=m.useCallback(j=>{l.danger(j,{toastId:"ttom_file_citation_failed_to_download_file"})},[l]),g=t.file_id,p=Pe(n,"3154019201"),x=p,w=Js(),S=oo(!0,i,g,void 0,u),h=S==null?void 0:S.data,M=(S==null?void 0:S.isPending)||!1;m.useEffect(()=>{var j;if((h==null?void 0:h.status)==="success"&&h.download_url){(j=f.current)==null||j.abort();const y=new AbortController;f.current=y,a(!0),(async()=>{try{const E=await fetch(h.download_url,{headers:w?{}:Kn(),signal:y.signal});if(!E.ok)throw new Error("HTTP ".concat(E.status));d(await E.text())}catch(E){E.name!=="AbortError"&&l.danger("Failed to download file",{toastId:"ttom_file_citation_failed_to_download_file"})}finally{a(!1)}})()}return()=>{var y;(y=f.current)==null||y.abort()}},[h,l,w]);const v=m.useContext(jt),k=m.useMemo(()=>{var A,N,T,I,B,W,X,H,b;if(c==null)return null;const y=(I=((T=(N=(A=v==null?void 0:v.message)==null?void 0:A.metadata)==null?void 0:N.content_references_by_file)!=null?T:{})[t.cite_key])!=null?I:[],E=el(c,y);let C=E.processedText;const _=(B=E.displayedContentReferences)!=null?B:[],$=(b=((H=(X=(W=v==null?void 0:v.message)==null?void 0:W.metadata)==null?void 0:X.n7jupd_crefs_by_file)!=null?H:{})[t.cite_key])!=null?b:[];return $.length>0&&(C=wc(C,$)),{processedText:C,displayedContentReferences:_,n7jupdCrefs:$,rawText:c}},[c,v,t.cite_key]);return M||o?r.jsx(fs,{className:"inline"}):!k||!(v!=null&&v.message)?"[Could not display report]":r.jsx(jt.Provider,{value:Q(z({},v),{contentReferences:k.displayedContentReferences,n7jupdCrefs:k.n7jupdCrefs}),children:r.jsxs("div",{className:"border-token-border-light dark:border-token-bg-tertiary @container relative mx-[-16px] mt-4 mb-4 flex cursor-text flex-col items-start overflow-hidden rounded-[14px] border px-4 pt-6 pb-6 contain-inline-size sm:mx-[-32px] sm:rounded-[28px] sm:px-8 sm:shadow-sm",children:[r.jsx("div",{className:"w-full pt-1 pb-1 sm:pt-4 sm:pb-3",children:r.jsx(vc,{conversation:e,componentOverrides:ud,children:k.processedText})}),x&&r.jsx("div",{className:"flex",children:p&&r.jsx(hf,{conversation:e,messageId:s,fileId:g,fileName:t.file_name,processedMarkdownInfo:k,isStandaloneAttachment:!1})})]})})},Yo=(t,e)=>{const s=new bd(new URL("/assets/walnut-worker-DVNBhG5v.js",import.meta.url),{type:"module"});return new Promise((n,o)=>{s.onmessage=a=>{var i;s.terminate(),a.data.error?o(new Error(a.data.error)):n((i=a.data.protoBytes)!=null?i:new Uint8Array)},s.onerror=a=>{s.terminate(),o(a)},s.postMessage({bytes:t.buffer,ext:e},[t.buffer])})},xf="Walnut",bf={hash:"sha256-+cEU/A/mgo45yM6i1KODvg3MimVrPUST5+CFTgsvIEY=",fingerprinting:{"DocumentFormat.OpenXml.Framework.edzyb0h7ls.wasm":"DocumentFormat.OpenXml.Framework.wasm","DocumentFormat.OpenXml.6omu38mmwr.wasm":"DocumentFormat.OpenXml.wasm","Google.Protobuf.bvef67su4p.wasm":"Google.Protobuf.wasm","System.Collections.Concurrent.dg7gv773h7.wasm":"System.Collections.Concurrent.wasm","System.Collections.NonGeneric.xh26yzmj9q.wasm":"System.Collections.NonGeneric.wasm","System.Collections.Specialized.k9ijgfx3oq.wasm":"System.Collections.Specialized.wasm","System.Collections.e40hzefbp0.wasm":"System.Collections.wasm","System.ComponentModel.Primitives.p7eihts9gc.wasm":"System.ComponentModel.Primitives.wasm","System.ComponentModel.TypeConverter.yc3lg0zbud.wasm":"System.ComponentModel.TypeConverter.wasm","System.ComponentModel.nu6ttwym4t.wasm":"System.ComponentModel.wasm","System.Console.2u9f7xoyjt.wasm":"System.Console.wasm","System.Diagnostics.DiagnosticSource.3zzx5i2bbp.wasm":"System.Diagnostics.DiagnosticSource.wasm","System.IO.Compression.hdb1gzcatq.wasm":"System.IO.Compression.wasm","System.IO.Packaging.8th4tkd3a0.wasm":"System.IO.Packaging.wasm","System.Linq.Expressions.y2o66p61a5.wasm":"System.Linq.Expressions.wasm","System.Linq.pk029p0ix8.wasm":"System.Linq.wasm","System.Memory.pk7xw966yi.wasm":"System.Memory.wasm","System.Net.Http.ela86sx87h.wasm":"System.Net.Http.wasm","System.Net.Primitives.e24bsgwgy3.wasm":"System.Net.Primitives.wasm","System.ObjectModel.6ul5qo6tt0.wasm":"System.ObjectModel.wasm","System.Private.CoreLib.2ast54y18t.wasm":"System.Private.CoreLib.wasm","System.Private.Uri.34jz1zbpkm.wasm":"System.Private.Uri.wasm","System.Private.Xml.Linq.qo5fu6rx08.wasm":"System.Private.Xml.Linq.wasm","System.Private.Xml.jqrh4s0xni.wasm":"System.Private.Xml.wasm","System.Runtime.InteropServices.JavaScript.ptvo7oirfc.wasm":"System.Runtime.InteropServices.JavaScript.wasm","System.Security.Cryptography.yghuwbq1rf.wasm":"System.Security.Cryptography.wasm","System.Text.RegularExpressions.woo0o1jb20.wasm":"System.Text.RegularExpressions.wasm","System.8rv0tdtrxz.wasm":"System.wasm","System.Xml.Linq.fnt4rzi185.wasm":"System.Xml.Linq.wasm","Walnut.c6p9313jxd.wasm":"Walnut.wasm","dotnet.native.0636i1lq9c.js":"dotnet.native.js","dotnet.native.zzbol9rv1j.wasm":"dotnet.native.wasm","dotnet.js":"dotnet.js","dotnet.runtime.drv0pr9n5o.js":"dotnet.runtime.js","icudt_CJK.tjcz0u77k5.dat":"icudt_CJK.dat","icudt_EFIGS.tptq2av103.dat":"icudt_EFIGS.dat","icudt_no_CJK.lfu7j35m59.dat":"icudt_no_CJK.dat"},jsModuleNative:{"dotnet.native.0636i1lq9c.js":"sha256-eOSbmdfdvZnWUgf0HnOlq0pzSFy11pyE4WY5A/bXqIY="},jsModuleRuntime:{"dotnet.runtime.drv0pr9n5o.js":"sha256-yfXUv1l/B489E8p12JxUvxly0JvHL9CCsoZUDlfGH9c="},wasmNative:{"dotnet.native.zzbol9rv1j.wasm":"sha256-v7sIQgsxYlZxP1U1O8+/+QbuogAs3q+OgUmKYGQEhL8="},icu:{"icudt_CJK.tjcz0u77k5.dat":"sha256-SZLtQnRc0JkwqHab0VUVP7T3uBPSeYzxzDnpxPpUnHk=","icudt_EFIGS.tptq2av103.dat":"sha256-8fItetYY8kQ0ww6oxwTLiT3oXlBwHKumbeP2pRF4yTc=","icudt_no_CJK.lfu7j35m59.dat":"sha256-L7sV7NEYP37/Qr2FPCePo5cJqRgTXRwGHuwF5Q+0Nfs="},coreAssembly:{"System.Private.CoreLib.2ast54y18t.wasm":"sha256-aklKXz16j6YsJZ7e7Kith4Jncrh9z8KwSVqmZ9onfUc=","System.Runtime.InteropServices.JavaScript.ptvo7oirfc.wasm":"sha256-46EslAlUY8PCFPNNdxh6xyl1tMDibDGNP8Izg1454zo="},assembly:{"DocumentFormat.OpenXml.Framework.edzyb0h7ls.wasm":"sha256-kqKbud4eaFNkjKW0OqLAmn6WKvayLb00uusbPCIHELQ=","DocumentFormat.OpenXml.6omu38mmwr.wasm":"sha256-uk6XntGO/XP+reJb9GzcEEHGK7bBcqvuZ0Se7acMAGE=","Google.Protobuf.bvef67su4p.wasm":"sha256-+YTHK5iMJ1qqT8rwso0msRnFimxTnVn7anp423wPdM4=","System.Collections.Concurrent.dg7gv773h7.wasm":"sha256-Q0t+lcdV4fbf4dlwKQCsokiL4Xwb5/RA4PKHw0Epfy4=","System.Collections.NonGeneric.xh26yzmj9q.wasm":"sha256-JUDrn7Om1WpQQdWHTaqXKj/3EobK0GWT1k1gVLEN/DM=","System.Collections.Specialized.k9ijgfx3oq.wasm":"sha256-OF8j9PfGV75lZ7E3FyULLUIRFPJQvpkm4IPxppAWJbc=","System.Collections.e40hzefbp0.wasm":"sha256-3sUZ64D/YCJbw5WumYeKGFTRuqgQauwlXdeT6qTqnfg=","System.ComponentModel.Primitives.p7eihts9gc.wasm":"sha256-dV0r23r7Lx5OxQXMJ14aC6agLulNBGIKSruhV0rx1yk=","System.ComponentModel.TypeConverter.yc3lg0zbud.wasm":"sha256-vvvYMybVeXzv4HJqiyd7iNAPMZ1jcbplD3jR0OUpKlU=","System.ComponentModel.nu6ttwym4t.wasm":"sha256-EdstTP9IiGWSnfAiUfYQU/+yVLpIFnkDsEhkbUYb1Bk=","System.Console.2u9f7xoyjt.wasm":"sha256-impSSXOvVI1OlM3VB67h2UWC8s89uwvX6Hgpj61TXr4=","System.Diagnostics.DiagnosticSource.3zzx5i2bbp.wasm":"sha256-X8GRK2kyaCYrvHDMMpZah01/45/agEOGsEGDme3FoYc=","System.IO.Compression.hdb1gzcatq.wasm":"sha256-1avnbMsYG348l6vTPbcjRPhUYpJotFC3oo4HhvAx0/U=","System.IO.Packaging.8th4tkd3a0.wasm":"sha256-1C+I5A7ESuL28X57RP+FiTL8ayuTe86SmJE6NSg4dQA=","System.Linq.Expressions.y2o66p61a5.wasm":"sha256-aim/Zu8aVv9Ks0amT1ETMHDVYou4htLWYVaiY6t6jFI=","System.Linq.pk029p0ix8.wasm":"sha256-l2OMvJ/4QA2lOgA9B5jpmCTtbi3eQCI6kzh8FtE2dRQ=","System.Memory.pk7xw966yi.wasm":"sha256-mWj1AQRTZv4MVK979XjQrZBgC+TsR5qspsObnCl0OZE=","System.Net.Http.ela86sx87h.wasm":"sha256-oq1HdWFv3md3LJ+cuYG4SvSqFkxHG9hAjiDKFOmitno=","System.Net.Primitives.e24bsgwgy3.wasm":"sha256-VsWTEOyEbltVNWebWtzswCEfVLEN7seHoNS6agRLaJw=","System.ObjectModel.6ul5qo6tt0.wasm":"sha256-Mqjt8iygUqGlnAvdiEdCvkrO/2e2oT04GXu9W3klLBw=","System.Private.Uri.34jz1zbpkm.wasm":"sha256-fbeiKtQPeS/eVZ4NLtr/UMtzpz1Qj7DWR1/jOBWoPfE=","System.Private.Xml.Linq.qo5fu6rx08.wasm":"sha256-do8HcvsRlHrzqquDkQl6MMvuTEgZIypo9T4sy8aw20Q=","System.Private.Xml.jqrh4s0xni.wasm":"sha256-VaUN8FKyCWvhqngi8AGac1fdW6tbrriW5tSxbTMpX6U=","System.Security.Cryptography.yghuwbq1rf.wasm":"sha256-8r8r+1iud18cVRj+drs6QMU+Pbi5fh3tj50AilEPWto=","System.Text.RegularExpressions.woo0o1jb20.wasm":"sha256-ANdAHV1xjhmnR3y6yA9nEMpmcfuT2mmd8oQ84iNsSd8=","System.8rv0tdtrxz.wasm":"sha256-xMF0eauQ5DkSzUozHLFFMQnL6DSJO09nJLtgag+Dzbw=","System.Xml.Linq.fnt4rzi185.wasm":"sha256-5claBNmyy8L12DFLS17Fh4SBiTjwhYts3ds7g8dX8Gc=","Walnut.c6p9313jxd.wasm":"sha256-tF6/80HO+3JLMjF7fLVS+fC4Q/J/400KSQZ+WjvDOiY="}},yf=0,_f=!0,wf="sharded",vf={mainAssemblyName:xf,resources:bf,debugLevel:yf,linkerEnabled:_f,globalizationMode:wf};let Ms=null;async function kf(){const t=await hd.withConfig(vf).withResourceLoader((s,n,o,a)=>s==="dotnetjs"?o:new URL(o,location.href).origin!==location.origin?fetch(o,{credentials:"omit",integrity:a}):o).create(),e=t.getConfig().mainAssemblyName;return e?t.getAssemblyExports(e):null}const jf=()=>(Ms!=null||(Ms=kf()),Ms);function Sf(){"use forget";const t=je.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=jf(),t[0]=e):e=t[0],e}const Mf=ne(()=>se(()=>import("./b8lmybnmedr4n7bh.js").then(t=>t._),__vite__mapDeps([5,1])),{loading:t=>ae(t)}),Cf=ne(()=>se(()=>import("./mbhfxri3syrb9rbq.js").then(t=>t._),__vite__mapDeps([6,1])),{loading:t=>ae(t)}),Ef=ne(()=>se(()=>import("./gbr30v7j74ce8rab.js"),__vite__mapDeps([7,1,8,9,10,11,12,13,14,15,16])).then(t=>t.WalnutMiniPlayer)),Nf=({citation:t,conversation:e,messageId:s})=>{var P,L,K,U,G;const n=Sf(),[o,a]=m.useState(!1),[i,l]=m.useState(null),[c,d]=m.useState(!1),f=!!((L=(P=m.useContext(jt))==null?void 0:P.message.metadata)!=null&&L.is_standalone_share_attachment),u=tl(),{presentationMap:g,updatePresentationMap:p,open:x}=pd(),w=Me(),S=ds(e.id),h=Pe(w,"3154019201")&&!!S,M=Pe(w,"638971034"),v=sl(w,"2888003541").value,k=Number((K=v==null?void 0:v.max_bytes)!=null?K:3e7),j=Mt(),y=m.useRef(null),E=m.useCallback(te=>{j.danger(te,{toastId:"w_failed_to_download_file"})},[j]),C=!!t.file_id,_=oo(!1,e.id,t.file_id,()=>{},E),R=(U=g[t.file_id])==null?void 0:U.presentation,$=(G=g[t.file_id])==null?void 0:G.workbook,A=m.useCallback(async te=>{if(e.id!==void 0){te.preventDefault();const{data:oe}=await _.refetch();if(oe===void 0||(oe==null?void 0:oe.status)!=="success"){j.danger("Failed to download file");return}const re=document.createElement("a");re.href=oe.download_url,re.click()}},[e.id,_,j]),{refetch:N}=_,T=Js();m.useEffect(()=>{var oe;(oe=y.current)==null||oe.abort();const te=new AbortController;return y.current=te,a(!0),(async()=>{var me;let re=!1;try{const{data:he}=await N();if(he===void 0||(he==null?void 0:he.status)!=="success"){j.danger("Failed to download file");return}const ie=await fetch(he.download_url,{headers:T?{}:Kn(),signal:te.signal});if(!ie.ok)throw new Error("HTTP ".concat(ie.status));const pe=await ie.blob();if(k!==0&&pe.size>k){d(!0),l("fileTooLarge"),re=!0;return}const Ee=new Uint8Array(await pe.arrayBuffer()),Se=(me=Fo(t.file_name))!=null?me:"pptx";if(Se==="pptx"){let O;if(M)O=await Yo(Ee,Se);else{const V=await n;if(!V)return;O=V.PptxReader.ExtractSlidesProto(Ee,!1)}const F=gd.decode(O);p(t.file_id,{fileBlob:pe,fileName:t.file_name,presentation:F,workbook:null,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}else{let O;if(M)O=await Yo(Ee,Se);else{const V=await n;if(!V)return;O=V.XlsxReader.ExtractXlsxProto(Ee,!1)}const F=xd.decode(O);p(t.file_id,{fileBlob:pe,fileName:t.file_name,presentation:null,workbook:F,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}}catch(he){he.name!=="AbortError"&&(d(!0),Vt.addError(he,{file_id:t.file_id}))}finally{a(!1),u&&!re&&x(t.file_id)}})(),()=>{var re;(re=y.current)==null||re.abort()}},[N,j,p,t.file_name,t.file_id,u,x,k,T,n,M]);function I(te){te.preventDefault(),x(t.file_id)}const{onClick:B,isLoading:W,isEnabled:X}=Ka({conversation:e,messageId:s,fileId:t.file_id,fileName:t.file_name,processedMarkdownInfo:null,isStandaloneAttachment:!0}),H=f&&!u,b=Fo(t.file_name);return r.jsxs("div",{className:D("border-token-border-light flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] flex-col overflow-hidden rounded-lg border",f&&"mx-auto my-0"),children:[r.jsxs("div",{className:"text-token-text-secondary border-token-border-light flex flex-row justify-between gap-4 border-b p-2",children:[r.jsxs("div",{className:"flex flex-row items-center gap-2 overflow-hidden",children:[r.jsx(fd,{fileName:t.file_name}),r.jsx("div",{className:"truncate text-sm font-medium",children:b==="pptx"?r.jsx(q,{id:"HTIcmf",defaultMessage:"Presentation"}):r.jsx(q,{id:"pftlup",defaultMessage:"Spreadsheet"})})]}),r.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center",children:[!H&&r.jsxs(r.Fragment,{children:[C&&r.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",onClick:A,children:r.jsx(Cf,{})}),r.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary disabled:text-token-text-tertiary rounded-full p-1 disabled:cursor-not-allowed disabled:bg-transparent",disabled:!R&&!$,onClick:I,children:r.jsx(Mf,{})})]}),h&&!!s&&X&&r.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",disabled:!X,onClick:B,children:W?r.jsx(fs,{}):r.jsx(Tf,{})})]})]}),r.jsxs("div",{className:"bg-token-bg-secondary group relative p-2",children:[r.jsx(Ef,{walnutId:t.file_id,isLoading:o,isError:c,isInShareModal:H,errorMessage:i,handleDownloadClick:A}),H&&r.jsx("div",{className:"absolute end-5 top-46 z-10 inline-flex flex-shrink-0 items-end justify-end",children:r.jsx(kc,{className:D("inline h-4 w-24 text-end")})})]})]})},Tf=({className:t})=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:t,children:[r.jsx("path",{d:"M3 12.4428V12.2806C3 11.9219 3.2843 11.631 3.63497 11.631C3.98563 11.631 4.26993 11.9219 4.26993 12.2806V12.4428C4.26993 13.1372 4.2708 13.6193 4.3007 13.994C4.33 14.3609 4.38426 14.5675 4.46108 14.7218L4.52821 14.8459C4.69655 15.1266 4.93812 15.3556 5.22657 15.5061L5.35059 15.5604C5.48786 15.6107 5.6688 15.6476 5.938 15.6701C6.30417 15.7008 6.77519 15.7007 7.45408 15.7007H12.546C13.2246 15.7007 13.6959 15.7008 14.0621 15.6701C14.4204 15.6402 14.6226 15.5846 14.7735 15.5061L14.8946 15.4364C15.169 15.2642 15.3929 15.0169 15.5399 14.7218L15.593 14.595C15.6421 14.4546 15.6782 14.2692 15.7003 13.994C15.7301 13.6193 15.73 13.1372 15.73 12.4428V12.2806C15.73 11.922 16.0145 11.6312 16.3651 11.631C16.7157 11.631 17 11.9219 17 12.2806V12.4428C17 13.1158 17.0006 13.6601 16.9655 14.0999C16.9342 14.4916 16.8722 14.8443 16.7343 15.1731L16.6709 15.3123C16.4174 15.8213 16.0318 16.2469 15.5585 16.544L15.3506 16.6632C14.9909 16.8507 14.6028 16.9281 14.1655 16.9646C13.7356 17.0006 13.2038 17 12.546 17H7.45408C6.79615 17 6.26438 17.0006 5.8345 16.9646C5.45207 16.9327 5.10749 16.8699 4.78649 16.729L4.65035 16.6632C4.1528 16.4038 3.73604 16.0094 3.44569 15.5251L3.32914 15.3123C3.14585 14.9444 3.07023 14.5473 3.03451 14.0999C2.9994 13.6601 3 13.1158 3 12.4428Z"}),r.jsx("path",{d:"M9.99993 13.2544C10.3505 13.2544 10.6348 12.9635 10.6348 12.6047V5.218L12.7337 7.36545L12.8335 7.44845C13.0799 7.61506 13.4146 7.58749 13.6316 7.36545C13.8486 7.14342 13.8756 6.80101 13.7127 6.54884L13.6316 6.44677L10.4493 3.19088C10.3302 3.06897 10.1683 3 9.99993 3C9.8316 3.0001 9.67044 3.06906 9.55138 3.19088L6.36815 6.44677C6.12048 6.70037 6.12057 7.11179 6.36815 7.36545C6.58526 7.58755 6.92077 7.61523 7.1673 7.44845L7.26707 7.36545L9.36491 5.21897V12.6047C9.36491 12.9634 9.64934 13.2542 9.99993 13.2544Z"})]}),If=new Set(["jpg","jpeg","png","gif","webp","svg"]),Pf=t=>{const e=t.split(".").pop();return e?If.has(e):!1};function Rf({citation:t,conversation:e,messageId:s}){var c;const n=Me(),o=nl(),a=ol(),i=m.useRef(o!==Ao.Research),l=rt(e.serverId$);if(m.useEffect(()=>{!i.current&&o===Ao.Research&&(i.current=!0,a(null))},[o,a]),md(t.file_name)&&Pe(n,"3392860057"))return r.jsx(Nf,{citation:t,conversation:e,messageId:s,children:(c=t.label)!=null?c:t.file_name});if(pf(t.file_name))return r.jsx(gf,{citation:t,conversation:e,messageId:s});if(l)return r.jsx($f,{citation:t,serverThreadId:l})}function $f({citation:t,serverThreadId:e}){var a,i;const s=Mt(),n=m.useCallback(l=>{s.danger(l,{toastId:"fcoa_renderer_failed_to_download_file"})},[s]),{data:o}=oo(!0,e,t.file_id,void 0,n);return Pf(t.file_name)&&(o!=null&&o.download_url)?r.jsx("img",{src:o==null?void 0:o.download_url,alt:(a=t.label)!=null?a:t.file_name,className:"max-h-[350px] max-w-screen"}):r.jsx("a",{href:o==null?void 0:o.download_url,children:(i=t.label)!=null?i:t.file_name})}function Af({citationIndex:t,conversation:e,nodeType:s,messageId:n}){var l;const o=parseInt(t,10),a=m.useContext(jt);if(!a)return null;const i=(l=a.n7jupdCrefs)==null?void 0:l[o];if(!i)return null;switch(i.type){case"clipboard":return r.jsx(df,{citation:i});case"computer_output":return r.jsx(ff,{citation:i,conversation:e,nodeType:s});case"file":return r.jsx(Rf,{citation:i,conversation:e,messageId:n});case"invalid":return null}}function Lf(t){return t&&/^turn[0-9]+ifs[0-9]+$/.test(t)}const Df=ne(()=>se(()=>import("./oz2w8uv2a0ics46w.js").then(t=>t._),__vite__mapDeps([17,1])),{loading:t=>ae(t)}),Of=ne(()=>se(()=>import("./7drepi7d7klmi8rs.js").then(t=>t._),__vite__mapDeps([18,1])),{loading:t=>ae(t)});function Ff({path:t,lineRangeStart:e,lineRangeEnd:s,gitUrl:n}){const[o,a]=m.useState(!1),i=m.useContext(rn),l=m.useRef(null),c=m.useRef(null),d=m.useRef(null),f=()=>{d.current&&(clearTimeout(d.current),d.current=null),a(!0)},u=()=>{d.current=window.setTimeout(()=>{a(!1)},200)};if(!t)return null;const g=i==null?void 0:i.fileSnapshots.find(x=>x.path===t);if(!g)return null;const p=Bf(e,s,g);return p.length?r.jsxs(Qs,{open:o,onOpenChange:a,children:[r.jsx(en,{asChild:!0,onMouseEnter:f,onMouseLeave:u,children:r.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:r.jsx(Of,{className:"size-[10px]"})})}),r.jsx(tn,{children:r.jsx(sn,{ref:c,className:"z-50 focus:outline-none",side:"right",onMouseEnter:f,onMouseLeave:u,onOpenAutoFocus:x=>x.preventDefault(),children:r.jsx(zf,{snapshot:g,snippetLines:p,lineRangeStart:e,lineRangeEnd:s,gitUrl:n})})})]}):null}function zf({snapshot:t,snippetLines:e,lineRangeStart:s,lineRangeEnd:n,gitUrl:o}){var c;const a=(c=t.path.split(".").pop())!=null?c:"sh",i=e.reduce((d,f)=>{if(f.trim()==="")return d;const u=f.match(/^\s*/),g=u?u[0].length:0;return d===-1?g:Math.min(d,g)},-1),l=e.map(d=>i>0?d.slice(i):d).join("\n");return r.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex max-h-[600px] flex-col rounded-2xl border px-2 pt-2 pb-4 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[l&&r.jsx(jc,{wrapperClassName:"rounded-lg !bg-token-bg-tertiary !border-none mb-3 max-h-[400px] overflow-auto text-xs w-[600px] max-w-full",codeContainerClassName:"!p-2",language:a,content:l,showActionBar:!1}),r.jsxs("div",{className:"grid w-full grid-cols-[minmax(0,1fr)_auto] items-center justify-between gap-1 px-2 text-sm",children:[t.path,r.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 whitespace-nowrap",children:[r.jsx(q,{id:"wham.citation.file.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:s,lineRangeEnd:n}}),o&&r.jsx("a",{className:"group flex w-full items-center gap-1 p-1",href:o,target:"_blank",rel:"noopener noreferrer",children:r.jsx(Df,{className:"icon-xs hover:text-token-text-primary"})})]})]})]})}function Bf(t,e,s){var i;if(s.contents){const l=s.contents.split("\n"),c=Math.max(0,t-1),d=e?Math.min(l.length,e):c+1;return l.slice(c,d)}const n=(i=s.line_range_contents)==null?void 0:i.find(l=>Wf(l,t,e));if(!n)return[];const o=Math.max(t-n.line_range_start,0),a=o+(e-t+1);return n.content.slice(o,a)}function Wf(t,e,s){return e<t.line_range_start?!1:!(s>t.line_range_end)}function Hf({assetPointer:t}){var i,l,c,d,f;const e=m.useContext(rn),s=_e(),n=e==null?void 0:e.imagePointers.find(u=>u.asset_pointer===t),o=Ea({asset:{content_type:pa.ImageAssetPointer,asset_pointer:(i=n==null?void 0:n.asset_pointer)!=null?i:"",size_bytes:(l=n==null?void 0:n.size_bytes)!=null?l:0,width:(c=n==null?void 0:n.width)!=null?c:0,height:(d=n==null?void 0:n.height)!=null?d:0}});if(!n||!((f=o.data)!=null&&f.url))return null;const a=s.formatMessage({id:"wham.contentReference.imageAlt",defaultMessage:"Captured screenshot"});return r.jsx(Sc,{src:o.data.url,alt:a,className:"max-h-[250px] max-w-[250px]",children:r.jsx(Mc,{src:o.data.url,alt:a,width:n.width,height:n.height,className:"max-h-[250px] max-w-[250px] object-contain"})})}function Uf(){const t=ga.getItem(xa.ProposedTasks);return t&&typeof t=="object"?t:{}}const Jo=rl(t=>({tasks:Uf(),store(e){t(s=>{const n=Q(z({},s.tasks),{[e.contentId]:e});return ga.setItem(xa.ProposedTasks,n),{tasks:n}})}})),Gf=ne(()=>se(()=>import("./2uk20wu2pu1737un.js").then(t=>t._),__vite__mapDeps([19,1])),{loading:t=>ae(t)}),Vf=ne(()=>se(()=>import("./bgxcag65uz54fc39.js").then(t=>t._),__vite__mapDeps([20,1])),{loading:t=>ae(t)});function qf({title:t,prompt:e,environmentId:s,branch:n,contentId:o,hasHitRateLimit:a}){const[i,l]=m.useState(!1),c=al(),{setEnvironmentId:d,setBranch:f}=Ld(),{refetch:u}=Dd(),g=_e(),p=Mt(),x=Jo(k=>k.tasks[o]),w=Jo(k=>k.store),{mutate:S,isPending:h}=Vn({mutationFn:()=>Od.createNewTask(s,n,e,!1).catch(k=>{throw p.danger(es({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:"suggestion-".concat(o),duration:5,hasCloseButton:!0,toastId:"wham_proposed_task_failed_to_create_task"}),k}),onSuccess:async k=>{await u(),M(k)}}),M=k=>{try{const j=k.task.id,y=k.turn.id,E="/codex/tasks/".concat(j);w({contentId:o,prompt:e,scheduledTaskId:j,turnId:y,url:E}),l(!1)}catch(j){}},v=!s||!n||h||a;return r.jsxs("div",{className:D("mt-1 mb-3 flex w-full items-center rounded-xl px-3 py-3",x?"bg-token-bg-secondary border border-transparent":"bg-token-bg-primary border-token-border-default border shadow-[0px_1px_1px_0px_rgba(0,0,0,0.05)]"),children:[r.jsxs("div",{className:D("group flex flex-1 items-center gap-1",!x&&"-my-3 py-3",!x&&!v&&"cursor-pointer"),onClick:()=>{v||x||(d(s),f(n),l(!0),zo.recordProposedTaskClicked("edit"))},children:[r.jsxs("div",{className:"flex flex-col gap-0.5",children:[r.jsx("span",{className:"text-token-text-tertiary text-xs",children:r.jsx(q,{id:"wham.whamProposedTask.title",defaultMessage:"Suggested task"})}),r.jsx("span",{className:D("text-sm font-medium",x&&"text-token-text-tertiary"),children:t})]}),!v&&!x&&r.jsx(Vf,{className:"icon-sm text-token-text-secondary mb-0.5 cursor-pointer self-end opacity-0 transition-opacity group-hover:opacity-100"})]}),r.jsx("div",{className:"flex items-center justify-end gap-2 text-xs",children:x?r.jsx(Ve,{size:"small",color:"secondary",as:"a",to:x==null?void 0:x.url,openNewTab:!0,children:r.jsx("span",{className:"text-token-text-primary font-medium",children:r.jsx(q,{id:"lwqFNG",defaultMessage:"View task"})})}):r.jsx(Kf,{prompt:a?g.formatMessage({id:"wham.proposedTask.hitRateLimit",defaultMessage:"You have reached your rate limit"}):e,tooltipEnabled:!x&&!i,children:r.jsx(Ve,{size:"small",color:"secondary",disabled:v,onClick:()=>{zo.recordProposedTaskClicked("create"),S()},children:r.jsxs("div",{className:"flex items-center gap-0.5",children:[r.jsx(q,{id:"b2N2Y8",defaultMessage:"Start task"}),h?r.jsx(fs,{className:"icon-xs me-[2px]"}):r.jsx(Gf,{className:"icon-sm"})]})})})}),r.jsx(_t.Root,{testId:"modal-task-stub-composer",isOpen:i,onClose:()=>l(!1),children:r.jsx(_t.Overlay,{children:r.jsxs(_t.Content,{className:"flex max-w-3xl! items-center justify-center px-12 py-4 focus:outline-hidden",size:"normal",removeBackground:!0,onEscapeKeyDown:k=>{k.stopPropagation(),l(!1)},children:[r.jsxs(il,{children:[r.jsx(ll,{children:r.jsx(q,{id:"wham.proposedTaskModel.title",defaultMessage:"Kick off a new Codex task"})}),r.jsx(cl,{children:r.jsx(q,{id:"wham.proposedTaskModel.description",defaultMessage:"Codex can propose new follow up tasks"})})]}),r.jsx(rs.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},transition:{duration:c?0:.25},className:"w-full",children:r.jsxs("div",{className:"flex flex-col items-center gap-8",children:[r.jsx("h1",{className:"text-token-text-primary dark text-[28px] font-semibold",children:r.jsx(q,{id:"wham.proposedTaskModal.title",defaultMessage:"Edit suggested task"})}),r.jsx(Xf,{prompt:e,onSuccess:M})]})})]})})})]})}function Kf({prompt:t,tooltipEnabled:e,children:s}){return e?r.jsx(Ct,{side:"right",label:r.jsx("span",{className:"block p-2 text-start whitespace-pre-wrap",children:t}),wide:!0,children:s}):s}function Xf({prompt:t,onSuccess:e}){const{composerController:s}=Ad();return m.useEffect(()=>{dl(ul(s),t.trimEnd())},[s,t]),r.jsx(fl.Provider,{value:s,children:r.jsx(Rd,{isBigBoxMode:!0,expanded:!0,disableDuringSubmit:!0,onSuccess:e})})}function Zf({title:t,prompt:e}){const s=m.useContext(rn),{data:n}=Fd(),o=$d(n),a=m.useMemo(()=>Yf("".concat(s==null?void 0:s.taskId,":").concat(t,":").concat(e)),[s==null?void 0:s.taskId,t,e]);return!s||!s.environmentId||!s.branch?null:r.jsx(qf,{title:t,prompt:e,environmentId:s.environmentId,branch:s.branch,contentId:a,hasHitRateLimit:o})}function Yf(t){let e=5381;for(let s=0;s<t.length;s++)e=(e<<5)+e^t.charCodeAt(s);return(e>>>0).toString(16).padStart(8,"0")}const Jf=ne(()=>se(()=>import("./m53ly4eu8e9c6q19.js").then(t=>t._),__vite__mapDeps([21,1])),{loading:t=>ae(t)});function Qf({chunkId:t,lineRangeStart:e,lineRangeEnd:s}){const[n,o]=m.useState(!1),a=m.useContext(rn),i=a==null?void 0:a.terminalMessageContents.find(x=>x.includes(t)),l=m.useRef(null),c=m.useRef(null),d=m.useRef(null);if(!i)return null;const f=tm(i);if(!f)return null;const u=f.output.slice(e-1,s);if(!u.some(x=>!!x.length))return null;const g=()=>{d.current&&(clearTimeout(d.current),d.current=null),o(!0)},p=()=>{d.current=window.setTimeout(()=>{o(!1)},200)};return r.jsxs(Qs,{open:n,onOpenChange:o,children:[r.jsx(en,{asChild:!0,onMouseEnter:g,onMouseLeave:p,children:r.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:r.jsx(Jf,{className:"size-[10px]"})})}),r.jsx(tn,{children:r.jsx(sn,{ref:c,className:"z-50 focus:outline-none",side:"right",onMouseEnter:g,onMouseLeave:p,onOpenAutoFocus:x=>x.preventDefault(),children:r.jsx("div",{className:"max-h-[500px] max-w-screen px-4",children:r.jsx(em,{lines:u,lineRangeStart:e,lineRangeEnd:s})})})})]})}function em({lines:t,lineRangeStart:e,lineRangeEnd:s}){return r.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex flex-col overflow-auto rounded-2xl border px-2 pt-2 pb-3 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[r.jsx(zd,{className:"bg-token-sidebar-surface-primary dark mb-2.5 max-h-[200px] w-full overflow-auto rounded-lg p-3 font-mono text-xs whitespace-pre text-white dark:border dark:border-white/10",children:t.join("\n")}),r.jsx("div",{className:"flex w-full justify-end gap-1 px-2 text-sm",children:r.jsx("span",{className:"text-token-text-tertiary",children:r.jsx(q,{id:"wham.citation.terminal.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:e,lineRangeEnd:s}})})})]})}function tm(t){try{const e=JSON.parse(t);return!("chunk_id"in e)||typeof e.chunk_id!="string"||!("session_name"in e)||typeof e.session_name!="string"||!("start_line_no"in e)||typeof e.start_line_no!="number"?null:"output"in e?e:null}catch(e){return null}}var Fs=(t=>(t.STANDARD="standard",t.EMAIL="email",t.CREATIVE="creative",t.CHAT_MESSAGE="chat_message",t.SOCIAL_POST="social_post",t.UNKNOWN="unknown",t))(Fs||{});function sm(t){return Object.values(Fs).includes(t)?t:"unknown"}const zn=["group my-4 w-full overflow-visible rounded-3xl","bg-token-bg-primary","dark:bg-[#2a2a2a]","shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.08),0px_8px_480px_rgba(0,0,0,0.04)]","hover:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.16),0px_8px_480px_rgba(0,0,0,0.04)]","focus-within:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.24),0px_8px_480px_rgba(0,0,0,0.04)]","hover:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.24),0px_8px_480px_rgba(0,0,0,0.04)]","dark:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.04)]","dark:hover:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.10)]","dark:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.16)]","dark:hover:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.16)]","dark:hover:bg-[#2a2a2a]","dark:focus-within:bg-[#2a2a2a]","dark:hover:focus-within:bg-[#2a2a2a]"].join(" "),nm="bg-token-bg-primary/90 dark:bg-[#2a2a2a]/90 group-hover:bg-token-bg-primary/90 dark:group-hover:bg-[#2a2a2a]/90 group-focus-within:bg-token-bg-primary/90 dark:group-focus-within:bg-[#2a2a2a]/90 group-hover:group-focus-within:bg-token-bg-primary/90 dark:group-hover:group-focus-within:bg-[#2a2a2a]/90",Qo="placeholder:text-token-text-tertiary min-w-0 flex-1 shrink-0 truncate border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",co="text-sm font-medium",om=ne(()=>se(()=>import("./jwwofwbvdtftvupg.js").then(t=>t._),__vite__mapDeps([22,1])),{loading:t=>ae(t)}),rm=ne(()=>se(()=>import("./is912miy7ctt2z66.js").then(t=>t._),__vite__mapDeps([23,1])),{loading:t=>ae(t)}),am=ne(()=>se(()=>import("./d3y46a2mpr2sbz7s.js").then(t=>t._),__vite__mapDeps([24,1])),{loading:t=>ae(t)}),gn=ne(()=>se(()=>import("./e8a1uw0zdlt1m0jy.js").then(t=>t._),__vite__mapDeps([25,1])),{loading:t=>ae(t)});function im(t){"use forget";const e=je.c(56),{onClick:s,clientThreadId:n,messageId:o}=t,a=_e();let i;e[0]!==n||e[1]!==o||e[2]!==s?(i=H=>{st.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",Q(z({},hs({clientThreadId:n,messageId:o})),{provider:H})),Xn.count(Zn.WRITING_BLOCKS,"chatgpt_writing_block_email_send_button_clicked"),s(H)},e[0]=n,e[1]=o,e[2]=s,e[3]=i):i=e[3];const l=i,c=!ms();let d;e[4]!==a?(d=a.formatMessage({id:"BnHAsh",defaultMessage:"Open email in app"}),e[4]=a,e[5]=d):d=e[5];let f,u;e[6]===Symbol.for("react.memo_cache_sentinel")?(f=r.jsx(gn,{className:"icon-md me-0.5"}),u=r.jsx(q,{id:"Ebr+Et",defaultMessage:"Open in email"}),e[6]=f,e[7]=u):(f=e[6],u=e[7]);let g;e[8]!==d?(g=r.jsxs("button",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary flex items-center gap-1 px-2 py-2 text-sm select-none","aria-label":d,children:[f,u]}),e[8]=d,e[9]=g):g=e[9];let p;e[10]!==l?(p=()=>l("gmail"),e[10]=l,e[11]=p):p=e[11];let x;e[12]===Symbol.for("react.memo_cache_sentinel")?(x=r.jsx(am,{}),e[12]=x):x=e[12];let w;e[13]!==a?(w=a.formatMessage({id:"2cYA6Z",defaultMessage:"Open email using Gmail"}),e[13]=a,e[14]=w):w=e[14];let S;e[15]===Symbol.for("react.memo_cache_sentinel")?(S=r.jsx(q,{id:"N+/ksm",defaultMessage:"Gmail"}),e[15]=S):S=e[15];let h;e[16]!==p||e[17]!==w?(h=r.jsx(He.Item,{onSelect:p,icon:x,"aria-label":w,label:S}),e[16]=p,e[17]=w,e[18]=h):h=e[18];let M;e[19]!==l?(M=()=>l("outlook"),e[19]=l,e[20]=M):M=e[20];let v;e[21]===Symbol.for("react.memo_cache_sentinel")?(v=r.jsx(om,{}),e[21]=v):v=e[21];let k;e[22]!==a?(k=a.formatMessage({id:"puDMOA",defaultMessage:"Open email using Outlook"}),e[22]=a,e[23]=k):k=e[23];let j;e[24]===Symbol.for("react.memo_cache_sentinel")?(j=r.jsx(q,{id:"0Laq6P",defaultMessage:"Outlook"}),e[24]=j):j=e[24];let y;e[25]!==M||e[26]!==k?(y=r.jsx(He.Item,{onSelect:M,icon:v,"aria-label":k,label:j}),e[25]=M,e[26]=k,e[27]=y):y=e[27];let E;e[28]!==l?(E=()=>l("default"),e[28]=l,e[29]=E):E=e[29];let C;e[30]===Symbol.for("react.memo_cache_sentinel")?(C=r.jsx(rm,{}),e[30]=C):C=e[30];let _;e[31]!==a?(_=a.formatMessage({id:"aW6dXc",defaultMessage:"Open email using default email app"}),e[31]=a,e[32]=_):_=e[32];let R;e[33]===Symbol.for("react.memo_cache_sentinel")?(R=r.jsx(q,{id:"DcalRY",defaultMessage:"Default email app"}),e[33]=R):R=e[33];let $;e[34]!==E||e[35]!==_?($=r.jsx(He.Item,{onSelect:E,icon:C,"aria-label":_,label:R}),e[34]=E,e[35]=_,e[36]=$):$=e[36];let A;e[37]!==h||e[38]!==y||e[39]!==$||e[40]!==g?(A=r.jsx("div",{className:"hidden md:block",children:r.jsxs(ba,{alignOffset:-8,size:"small",triggerButton:g,children:[h,y,$]})}),e[37]=h,e[38]=y,e[39]=$,e[40]=g,e[41]=A):A=e[41];let N;e[42]===Symbol.for("react.memo_cache_sentinel")?(N=D("text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary px-2 py-2",co),e[42]=N):N=e[42];let T;e[43]!==a?(T=a.formatMessage({id:"5fZEc+",defaultMessage:"Open in email"}),e[43]=a,e[44]=T):T=e[44];let I;e[45]!==l?(I=()=>l("default"),e[45]=l,e[46]=I):I=e[46];let B;e[47]!==c?(B=c?r.jsx(Ct,{label:r.jsx(q,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email"}),children:r.jsx(gn,{className:"icon-md"})}):r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(gn,{className:"icon-md"}),r.jsx(q,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email"})]}),e[47]=c,e[48]=B):B=e[48];let W;e[49]!==T||e[50]!==I||e[51]!==B?(W=r.jsx("div",{className:"block md:hidden",children:r.jsx("button",{className:N,"aria-label":T,onClick:I,children:B})}),e[49]=T,e[50]=I,e[51]=B,e[52]=W):W=e[52];let X;return e[53]!==A||e[54]!==W?(X=r.jsxs(r.Fragment,{children:[A,W]}),e[53]=A,e[54]=W,e[55]=X):X=e[55],X}const Wt="magicEditId",zs="magicEditHighlightFrom",Bs="magicEditHighlightTo";class Xa extends du{unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}createNodeSpec({role:e,contentEditable:s}){return{attrs:{[Wt]:{default:null},[zs]:{default:null},[Bs]:{default:null}},group:"block",content:"block+",isolating:!0,defining:!0,selectable:!1,allowGapCursor:!1,parseDOM:[],toDOM(n){var l;const o=(l=n.attrs)==null?void 0:l[Wt],i={"data-me-role":e,"data-me-id":typeof o=="string"?o:"","data-magic-edit-block":"true"};return s||(i.contenteditable="false",i["aria-readonly"]="true"),["div",i,0]}}}}class uo extends Xa{static proseMirrorNodeName(){return"magic_edit_original_block"}unistNodeName(){return uo.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"orig",contentEditable:!1})}proseMirrorNodeToUnistNodes(e,s){return s}}class fo extends Xa{static proseMirrorNodeName(){return"magic_edit_suggested_block"}unistNodeName(){return fo.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"sugg",contentEditable:!0})}proseMirrorNodeToUnistNodes(){return[]}}class lm extends uu{constructor(s={}){super();Ro(this,"options");this.options=s}dependencies(){let s=!1;try{s=ml(hl())}catch(n){}return[new Vd,new Wa,new qd,new $n,new Kd,new Xd,new On,new Zd,new Yd,new An,new Jd,new Ba,new Ln,new lu,new cu,new Dn,new Qd,new fu,new eu,new tu,new su,new uo,new fo,...s?[new nu]:[]]}unifiedInitializationHook(s){var o;const n=(o=this.options.contentReferences)!=null?o:[];return s.use(gu).use(Bi).use(xu,{singleTilde:!1}).use(yd).use([[Wi,n]]).use(hu).use(mu).use(Hi).use(ou).use(ru)}}const er=new Map;function cm(t={}){var o,a;const e={shouldStripDirectives:(o=t.shouldStripDirectives)!=null?o:!1,contentReferences:(a=t.contentReferences)!=null?a:[]},s=JSON.stringify(e);let n=er.get(s);if(n==null){const i=[new lm({contentReferences:e.contentReferences})];t.shouldStripDirectives&&i.push(new Wd),n=new Bd(i),er.set(s,n)}return n}function dm(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"maxLength")}const Ot=new ps("writingBlockInputConstraints");function um(t){return new gs({key:Ot,state:{init(){return{maxLength:t}},apply(e,s){const n=e.getMeta(Ot);return dm(n)?{maxLength:typeof n.maxLength=="number"?n.maxLength:null}:s}},props:{handleTextInput(e,s,n,o){var d;const a=Ot.getState(e.state),i=(d=a==null?void 0:a.maxLength)!=null?d:null;if(i==null)return!1;const l=tr(e.state,i,s,n);if(l<=0)return!0;if(o.length<=l)return!1;const c=o.slice(0,l);return c.length>0&&e.dispatch(e.state.tr.insertText(c,s,n)),!0},handlePaste(e,s){var g,p,x;const n=Ot.getState(e.state),o=(g=n==null?void 0:n.maxLength)!=null?g:null;if(o==null)return!1;const a=s.clipboardData;if(!a)return!1;const i=a.getData("text/html"),l=(p=a.getData("text/plain"))!=null?p:"",{from:c,to:d}=e.state.selection,f=tr(e.state,o,c,d);if(i){if(s.preventDefault(),f<=0)return!0;const w=new window.DOMParser().parseFromString(i,"text/html");pm(w.body);const S=(x=w.body.innerText)!=null?x:"";S.length>f&&(w.body.innerHTML="",w.body.append(document.createTextNode(S.slice(0,f))));const h=e.state.schema,M=pl.fromSchema(h).parseSlice(w.body,{preserveWhitespace:!0});return e.dispatch(e.state.tr.replaceSelection(M)),!0}if(l.length===0)return!1;if(f<=0)return s.preventDefault(),!0;if(l.length<=f)return!1;s.preventDefault();const u=l.slice(0,f);return e.dispatch(e.state.tr.insertText(u,c,d)),!0}}})}function fm(t,e){return t.setMeta(Ot,{maxLength:typeof e=="number"?e:null})}function tr(t,e,s,n){const o=mm(t.doc),a=hm(t,s,n);return e-(o-a)}function mm(t){return t.textBetween(0,t.content.size,"\n","\n").length}function hm(t,e,s){return e===s?0:t.doc.textBetween(e,s,"\n","\n").length}function pm(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),s=[];for(;e.nextNode();){const n=e.currentNode;if(!(n instanceof HTMLElement))continue;const o=n;o.style&&(o.style.color="",o.style.backgroundColor="",o.style.fontFamily="",o.style.fontSize="",o.style.lineHeight="",o.style.textDecoration="",o.style.textShadow=""),(o.tagName==="SPAN"||o.tagName==="FONT")&&!o.hasAttributes()&&s.push(o)}for(const n of s.reverse()){const o=n.parentNode;if(o){for(;n.firstChild;)o.insertBefore(n.firstChild,n);o.removeChild(n)}}}const gm="_keyBindingTight_19h6r_76",mo={"magic-edit-selection":"_magic-edit-selection_19h6r_1",keyBindingTight:gm},Be=new ps("writingBlockMagicEdit");function sr(t){return typeof t=="object"&&t!=null}function xm(t){if(t===void 0)return!0;if(!sr(t))return!1;const{setPinnedRange:e,removeEntryId:s}=t,n=e==null||sr(e)&&typeof e.from=="number"&&typeof e.to=="number",o=s==null||typeof s=="string";return n&&o}function Za(t,e){if(!e)return null;const s=t.map(e.from,-1),n=t.map(e.to,1);return{from:s,to:n}}function nr(t,e){if(!e)return null;const s=Za(t,e);return!s||s.to<=s.from?null:s}function Ya(t){var n,o;const e=(n=t.nodes.magic_edit_original_block)!=null?n:null,s=(o=t.nodes.magic_edit_suggested_block)!=null?o:null;return!e||!s?null:{originalType:e,suggestedType:s}}function or(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()!==""){const e=Number(t);return Number.isFinite(e)?e:null}return null}function bm(t,e){var i,l;const s=or((i=t.attrs)==null?void 0:i[zs]),n=or((l=t.attrs)==null?void 0:l[Bs]);if(s==null||n==null)return null;const o=e+1+Math.max(0,s),a=e+1+Math.max(0,n);return a<=o?null:{from:o,to:a}}function Bn(t,e){if(!t)return null;const s=e.pos+1,n=e.pos+e.nodeSize-1,o=Math.max(s,t.from),a=Math.min(n,t.to);return a<=o?null:{from:o,to:a}}function rr(t){const e=Ya(t.type.schema);if(!e)return new Map;const s=new Map;t.descendants((o,a)=>{var i;if(o.type===e.originalType||o.type===e.suggestedType){const l=(i=o.attrs)==null?void 0:i[Wt];if(!l)return!1;let c=s.get(l);c||(c={},s.set(l,c));const d={pos:a,nodeSize:o.nodeSize},f=Bn(bm(o,a),d),u={position:d,highlight:f};return o.type===e.originalType?c.original=u:c.suggested=u,!1}return!0});const n=new Map;return s.forEach((o,a)=>{if(!o.original||!o.suggested)return;const i=Math.min(o.original.position.pos,o.suggested.position.pos),l=Math.max(o.original.position.pos+o.original.position.nodeSize,o.suggested.position.pos+o.suggested.position.nodeSize);n.set(a,{id:a,from:i,to:l,original:o.original.position,suggested:o.suggested.position,originalHighlight:o.original.highlight,suggestedHighlight:o.suggested.highlight})}),n}function ar(t,e,s){const n=[];return e&&n.push(Ps.inline(e.from,e.to,{class:"magic-edit-selection ".concat(mo["magic-edit-selection"])})),s.forEach(o=>{o.originalHighlight&&n.push(Ps.inline(o.originalHighlight.from,o.originalHighlight.to,{nodeName:"span","data-me-change":"delta"})),o.suggestedHighlight&&n.push(Ps.inline(o.suggestedHighlight.from,o.suggestedHighlight.to,{nodeName:"span","data-me-change":"delta"}))}),n.length===0?as.empty:as.create(t,n)}function ym(){return new gs({key:Be,state:{init:(t,e)=>{const s=rr(e.doc);return{pinnedRange:null,entries:s,decorations:ar(e.doc,null,s)}},apply(t,e,s,n){let o=Za(t.mapping,e.pinnedRange);const a=new Map;e.entries.forEach((u,g)=>{a.set(g,{originalHighlight:nr(t.mapping,u.originalHighlight),suggestedHighlight:nr(t.mapping,u.suggestedHighlight)})});const i=t.getMeta(Be),l=xm(i)?i:void 0;l&&l.setPinnedRange!==void 0&&(o=l.setPinnedRange),l!=null&&l.removeEntryId&&a.delete(l.removeEntryId);const c=rr(n.doc),d=new Map;c.forEach((u,g)=>{var S,h;if(l!=null&&l.removeEntryId&&l.removeEntryId===g)return;const p=a.get(g),x=Bn((S=p==null?void 0:p.originalHighlight)!=null?S:u.originalHighlight,u.original),w=Bn((h=p==null?void 0:p.suggestedHighlight)!=null?h:u.suggestedHighlight,u.suggested);d.set(g,{id:u.id,from:u.from,to:u.to,original:u.original,suggested:u.suggested,originalHighlight:x,suggestedHighlight:w})});const f=ar(n.doc,o,d);return{pinnedRange:o,entries:d,decorations:f}}},props:{decorations(t){var e,s;return(s=(e=Be.getState(t))==null?void 0:e.decorations)!=null?s:as.empty}}})}function _m(t){const{from:e,to:s}=t.state.selection;if(e===s)return!1;const n=t.state.tr;return n.setMeta(Be,{setPinnedRange:{from:e,to:s}}),t.dispatch(n),!0}function wm(t){const e=t.state.tr;e.setMeta(Be,{setPinnedRange:null}),t.dispatch(e)}function vm({view:t,pmu:e,range:s,magicEditId:n,replacement:o}){var L;const{state:a}=t,i=Ya(a.schema);if(!i)return!1;const l=a.doc.resolve(s.from),c=a.doc.resolve(s.to),d=a.doc.slice(s.from,s.to),f=(K,U,G)=>Math.max(U,Math.min(G,K)),u=()=>{if(l.parent.isTextblock&&c.parent.isTextblock){const U=l.before(),G=c.after(),te=a.doc.slice(U,G),oe=a.schema.topNodeType.createAndFill({},te.content);if(oe){const re="⟦MAGICSTART⟧",me="⟦MAGICEND⟧",he=s.from-U,ie=s.to-U,pe=V=>new ts(is.from(a.schema.text(V)),0,0),Ee=oe.replace(ie,ie,pe(me)).replace(he,he,pe(re)),Se=e.serialize(Ee),O=Se.indexOf(re),F=Se.indexOf(me);if(O!==-1&&F!==-1&&O<=F){const V=Se.slice(0,O)+(o!=null?o:"")+Se.slice(F+me.length),Z=e.parse(V);return{deletionFrom:U,deletionTo:G,anchorPos:U,originalSliceForNode:te,selectionRelStart:he,selectionRelEnd:ie,suggestionSlice:new ts(Z.content,0,0)}}}}const K=e.parse(o!=null?o:"");return{deletionFrom:s.from,deletionTo:s.to,anchorPos:s.from,originalSliceForNode:d,selectionRelStart:0,selectionRelEnd:d.content.size,suggestionSlice:K.slice(0,K.content.size)}},{deletionFrom:g,deletionTo:p,anchorPos:x,originalSliceForNode:w,selectionRelStart:S,selectionRelEnd:h,suggestionSlice:M}=u(),v=w.content.size,k=M.content.size,j=f(S,0,v),y=f(h,j,v),E=j,C=y,_=k-v,R=f(j,0,k),$=f(j+Math.max(0,y-j+_),R,k),A=C>E,N=$>R,T=i.originalType.create({[Wt]:n,[zs]:A?Math.floor(E):null,[Bs]:A?Math.floor(C):null},w.content),I=i.suggestedType.create({[Wt]:n,[zs]:N?Math.floor(R):null,[Bs]:N?Math.floor($):null},M.content),B=new ts(is.fromArray([T,I]),0,0),W=a.tr.replaceRange(g,p,B);W.setMeta(Pn,!0),W.setMeta(Be,{setPinnedRange:null});const H=W.mapping.map(x,-1)+T.nodeSize,b=Math.min(W.doc.content.size,H+1),P=(L=Fe.findFrom(W.doc.resolve(b),1,!0))!=null?L:Fe.near(W.doc.resolve(b),1);return W.setSelection(P).scrollIntoView(),t.dispatch(W),!0}function ir(t,e,s){var w;const n=Be.getState(t.state);if(!n)return;const o=n.entries.get(e);if(!o)return;const a=t.state.doc,i=a.nodeAt(o.original.pos),l=a.nodeAt(o.suggested.pos);if(!i||!l)return;const c=Math.min(o.original.pos,o.suggested.pos),d=Math.max(o.original.pos+i.nodeSize,o.suggested.pos+l.nodeSize),f=s==="keep"?i.content:l.content,u=new ts(f,0,0),g=t.state.tr.replaceRange(c,d,u);g.setMeta(Be,{setPinnedRange:null,removeEntryId:e});const p=Math.min(g.doc.content.size,c+u.size),x=(w=Fe.findFrom(g.doc.resolve(p),-1,!0))!=null?w:Fe.near(g.doc.resolve(p),-1);g.setSelection(x),g.scrollIntoView(),t.dispatch(g)}function Ja(t){const e=Be.getState(t.state);if(!e)return!1;const{from:s,to:n}=t.state.selection;if(s===n)return!1;for(const o of e.entries.values())if(s>=o.from&&n<=o.to)return!0;return!1}function lr(t){var e,s;return(s=(e=Be.getState(t.state))==null?void 0:e.pinnedRange)!=null?s:null}function cr(t){var a,i;const e=new Map,{nodes:s}=t.type.schema,n=(a=s.magic_edit_original_block)!=null?a:null,o=(i=s.magic_edit_suggested_block)!=null?i:null;return!n||!o||t.descendants((l,c)=>{var u,g;if(l.type!==n&&l.type!==o)return!0;const d=(u=l.attrs)==null?void 0:u[Wt];if(!d)return!1;const f=(g=e.get(d))!=null?g:{hasOriginal:!1,hasSuggested:!1};return l.type===n?f.hasOriginal=!0:f.hasSuggested=!0,e.set(d,f),!1}),e}function km(t){if(!t)return new Set;const e=t,s=new Set;return typeof e.removeEntryId=="string"&&s.add(e.removeEntryId),s}const jm=new ps("writingBlockMagicEditGuard");function Sm(){return new gs({key:jm,filterTransaction(t,e){if(!t.docChanged||t.getMeta(Hd))return!0;const s=km(t.getMeta(Be)),n=cr(e.doc),o=cr(t.doc);for(const[a,i]of n){const l=o.get(a),c=s.has(a);if(!l){if(!c)return!1;continue}if(i.hasOriginal&&!l.hasOriginal&&!c||i.hasSuggested&&!l.hasSuggested&&!c)return!1}return!0}})}const Mm="\\[[^\\[\\]]+\\]";function Cm(t){var o;const e=new RegExp(Mm,"g"),s=[];let n=e.exec(t);for(;n;){const a=(o=n.index)!=null?o:-1;a>=0&&s.push({start:a,end:a+n[0].length,text:n[0]}),n=e.exec(t)}return s}const Em={class:"text-token-text-primary cursor-text","data-placeholder-token":"true",style:"background-color: color-mix(in srgb, var(--selection) 20%, transparent); padding-top: 4px; padding-bottom: 4px;"};function Nm(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"isDisabled")}const Ft=new ps("writingBlockPlaceholder");function Tm(t){return new gs({key:Ft,state:{init(e,s){return{decorations:dr(s.doc,t),isDisabled:t}},apply(e,s){var a,i;const n=e.getMeta(Ft),o=(i=(a=Nm(n)?n.isDisabled:void 0)!=null?a:s.isDisabled)!=null?i:t;return!e.docChanged&&o===s.isDisabled?s:{isDisabled:o,decorations:dr(e.doc,o)}}},props:{decorations(e){var s,n;return(n=(s=Ft.getState(e))==null?void 0:s.decorations)!=null?n:null},handleDOMEvents:{mousedown(e,s){const n=s.target;if(!(n instanceof HTMLElement))return!1;const o=n.closest("[data-placeholder-token]");if(!(o instanceof HTMLElement))return!1;const a=Ft.getState(e.state);if(a!=null&&a.isDisabled)return!1;s.preventDefault(),e.hasFocus()||e.focus();const i=e.posAtDOM(o,0),l=e.posAtDOM(o,o.childNodes.length),c=gl.create(e.state.doc,i,l);return e.dispatch(e.state.tr.setSelection(c)),!0}}}})}function Im(t,e){return t.setMeta(Ft,{isDisabled:e})}function dr(t,e){if(e)return as.empty;const s=[];return t.descendants((n,o)=>{if(!n.type.isText||!n.text)return;const a=Cm(n.text);for(const i of a){const l=o+i.start,c=o+i.end;s.push(Ps.inline(l,c,Em))}}),as.create(t,s)}const an=[{id:"divider",command:"divider",disabled:!1},{id:"generate",command:"generate",disabled:!0}],Pm=new Map(an.map(t=>[t.id,t])),Rm=an.map(t=>t.id),$m=()=>an,Am=t=>{var e,s;return(s=(e=Pm.get(t))==null?void 0:e.disabled)!=null?s:!0},Lm=t=>{const e=t.trim().toLowerCase();return e.startsWith("/")?e.slice(1):e},Dm=t=>t===""?[...Rm]:an.filter(e=>e.command.includes(t)).map(e=>e.id),Ae=new ps("writingBlockSlashMenu"),Ke={triggerPos:null,anchorPos:null,query:"",normalizedQuery:"",visibleOptionIds:[],highlightedOptionId:null},ze=t=>(t==null?void 0:t.triggerPos)!=null&&(t==null?void 0:t.anchorPos)!=null,Om=(t,e)=>{const s=t.selection;if(!s.empty||s.from<e||t.doc.textBetween(e,e+1,"\0","\0")!=="/")return!1;const o=t.doc.resolve(e),a=t.selection.$from;return o.parent===a.parent},ur=(t,e,s)=>{var h,M,v,k,j,y;const n=t.doc,o=n.content.size,a=Math.min(e+1,o),i=(h=s==null?void 0:s.previousState)!=null?h:null,l=(v=(M=s==null?void 0:s.anchorOverride)!=null?M:i==null?void 0:i.anchorPos)!=null?v:null,c=l!=null?l:a,d=t.selection.from,f=d>=a?d:c,u=Math.min(Math.max(f,a),o),g=u<=a?"":n.textBetween(a,u,"\0","\0"),p=Lm(g),x=Dm(p),w=(k=i==null?void 0:i.highlightedOptionId)!=null?k:null,S=w&&x.length>0?x.includes(w)?w:(j=x[0])!=null?j:null:(y=x[0])!=null?y:null;return{triggerPos:e,anchorPos:u,query:g,normalizedQuery:p,visibleOptionIds:x,highlightedOptionId:S}},Fm=()=>new gs({key:Ae,state:{init:()=>Ke,apply(t,e,s,n){var l,c;const o=t.getMeta(Ae);if((o==null?void 0:o.type)==="open")return ur(n,o.triggerPos,{previousState:e,anchorOverride:o.anchorPos});if((o==null?void 0:o.type)==="close")return Ke;if((o==null?void 0:o.type)==="highlight"){if(!ze(e))return e;const d=o.commandId;return d==null?Q(z({},e),{highlightedOptionId:(l=e.visibleOptionIds[0])!=null?l:null}):e.visibleOptionIds.includes(d)?e.highlightedOptionId===d?e:Q(z({},e),{highlightedOptionId:d}):e}if((o==null?void 0:o.type)==="navigate"){if(!ze(e))return e;const d=e.visibleOptionIds;if(d.length===0)return e.highlightedOptionId==null?e:Q(z({},e),{highlightedOptionId:null});const f=o.direction==="previous"?-1:1,u=e.highlightedOptionId?d.indexOf(e.highlightedOptionId):-1,p=((u>=0?u:0)+f+d.length)%d.length;return d[p]===e.highlightedOptionId?e:Q(z({},e),{highlightedOptionId:(c=d[p])!=null?c:null})}if((o==null?void 0:o.type)==="execute"||!ze(e))return e;const a=e.triggerPos!=null?t.mapping.map(e.triggerPos,-1):null,i=e.anchorPos!=null?t.mapping.map(e.anchorPos,1):null;return a==null||i==null||!Om(n,a)?Ke:ur(n,a,{previousState:Q(z({},e),{triggerPos:a,anchorPos:i})})}},props:{handleTextInput(t,e,s,n){const o=n.lastIndexOf("/");if(o===-1)return!1;const a=t.state.tr;a.insertText(n,e,s);const i=e+o,l=e+n.length;return t.dispatch(a.setMeta(Ae,{type:"open",triggerPos:i,anchorPos:l})),!0},handleKeyDown(t,e){const s=Ae.getState(t.state);if(e.key==="Escape"&&ze(s)){e.preventDefault(),e.stopPropagation();const n=t.state.tr.setMeta(Ae,{type:"close"});return t.dispatch(n),!0}if(!s||!ze(s))return!1;if((e.key==="ArrowUp"||e.key==="ArrowDown")&&s.visibleOptionIds.length>0){e.preventDefault(),e.stopPropagation();const n=t.state.tr.setMeta(Ae,{type:"navigate",direction:e.key==="ArrowUp"?"previous":"next"});return t.dispatch(n),!0}if(e.key==="Enter"){e.preventDefault(),e.stopPropagation();const n=s.highlightedOptionId;if(!n||Am(n))return!0;const o=t.state.tr.setMeta(Ae,{type:"execute",commandId:n});return t.dispatch(o),!0}return!1}}}),fr=t=>{const e=Ae.getState(t.state);if(!ze(e))return;const s=t.state.tr.setMeta(Ae,{type:"close"});t.dispatch(s)},zm=ne(()=>se(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yA),__vite__mapDeps([12,1,8,9,13])),{loading:t=>ae(t)});function Bm({buttonText:t,triggerLabel:e,options:s,selectedOptionId:n,isOpen:o,onOpenChange:a,onSelect:i,preserveSelection:l,editorRef:c}){"use no forget";const d=m.useRef(null),[f,u]=m.useState(null);m.useEffect(()=>{const p=d.current;!p||typeof document>"u"||u(p.closest('[aria-hidden="true"]')!=null)},[]);const g=r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"text-sm",children:t}),r.jsx(zm,{"aria-hidden":!0,className:"icon-sm text-current"})]});return f!==!1?r.jsx("div",{ref:d,"data-toolbar-surface":"true",className:"h-full",children:r.jsx(Ue.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":o,tabIndex:-1,"data-state":o?"open":"closed",className:D("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5",o&&"bg-token-interactive-bg-secondary-selected"),children:g})}):r.jsx("div",{ref:d,"data-toolbar-surface":"true",className:"h-full",children:r.jsxs(Qs,{open:o,onOpenChange:p=>{p&&l(),a(p)},children:[r.jsx(en,{asChild:!0,children:r.jsx(Ue.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":o,className:D("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5","data-[state=open]:bg-token-interactive-bg-secondary-selected"),onMouseDown:p=>p.preventDefault(),onPointerDownCapture:l,onKeyDownCapture:p=>{(p.key===" "||p.key==="Enter")&&l()},children:g})}),r.jsx(tn,{children:r.jsx(sn,{align:"start",sideOffset:8,className:D(ro.toolbar,"popover","border-token-border-default bg-token-main-surface-primary w-52 rounded-2xl border p-1",Ua),"data-toolbar-surface":"true",onOpenAutoFocus:p=>p.preventDefault(),onCloseAutoFocus:p=>{var x;p.preventDefault(),(x=c.current)==null||x.focus({preventScroll:!0})},children:r.jsx("div",{className:"flex flex-col gap-0.5 py-1",role:"menu",children:s.map(p=>{const x=p.id===n;return r.jsx("button",{type:"button",role:"menuitemradio","aria-checked":x,"data-selected":x?"true":void 0,className:D("text-token-text-primary dark:hover:bg-token-main-surface-secondary w-full rounded-xl px-4 py-2 text-start text-sm hover:bg-[#f5f5f5]",x&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5] font-medium"),onPointerDown:w=>w.preventDefault(),onClick:()=>i(p.id),children:r.jsx("span",{className:"flex items-center gap-2",children:r.jsx("span",{children:p.label})})},p.id)})})})})]})})}function Qa({onDismiss:t,editorView:e,toolbarContentRef:s,isToolbarOpen:n,dismissOnPointerDown:o=!0}){const a=m.useCallback(c=>{if(!(c instanceof Node))return!1;const d=s.current;return d&&d.contains(c)?!0:c instanceof Element?c.closest('[data-toolbar-surface="true"]')!=null:!1},[s]),i=m.useCallback(c=>{c.key!=="Escape"||!n||t()},[t,n]),l=m.useCallback(c=>{a(c.target)||!n||t()},[a,n,t]);return m.useEffect(()=>{var d,f;const c=(f=(d=e.dom)==null?void 0:d.ownerDocument)!=null?f:typeof document<"u"?document:null;if(c)return c.addEventListener("keydown",i),o&&c.addEventListener("pointerdown",l,{capture:!0}),()=>{c.removeEventListener("keydown",i),o&&c.removeEventListener("pointerdown",l,!0)}},[o,e,i,l]),{handleKeyDown:i}}function ei(t,e){return Wm(t)(e)}const Wm=xl(()=>bl(t=>{const e=Lt(t),s=Lt(null),n=Lt(null),o=Lt(null),a=Lt([]),i=Lt("pending");return{magicEditId$:e,domAnchor$:s,textAnchor$:n,baseBlockVersion$:o,replacements$:a,status$:i}}));function Hm(){"use forget";const t=je.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e={mutationFn:Um},t[0]=e):e=t[0],Vn(e)}async function Um(t){const{payload:e}=t;return await Xs.safePost("/conversation/message/writing-blocks/magic-edit",{requestBody:e,authOption:Yn.SendIfAvailable})}const Gm="⟦MAGICSTART⟧",Vm="⟦MAGICEND⟧";function qm(t,e){var i;const n=((i=t.dom.ownerDocument)!=null?i:document).createRange(),o=t.domAtPos(e.from),a=t.domAtPos(e.to);return n.setStart(o.node,o.offset),n.setEnd(a.node,a.offset),n}function Km(t,e,s){const n=t.resolve(e);if(n.parent.inlineContent)return e;const o=Fe.findFrom(n,s,!0);return o?s<0?o.to:o.from:null}function mr(t,e,s,n,o){const a=Km(t,n,o);if(a==null)throw new Error("Unable to place selection marker.");const i=new ts(is.from(t.type.schema.text(s)),0,0),l=t.replace(a,a,i),d=e.serialize(l).indexOf(s);if(d===-1)throw new Error("Failed to locate selection marker in markdown.");return d}function Xm(t,e,s){const{state:n}=t,o=n.doc,a=o.content.size,i=e.serialize(o),l=s.from<=0,c=s.to>=a,d=l?0:mr(o,e,Gm,s.from,1),f=c?i.length:mr(o,e,Vm,s.to,-1);if(d>f)throw new Error("Failed to locate selection markers in markdown.");return{fullMarkdown:i,startIndex:d,endIndex:f}}async function Zm({view:t,pmu:e,ctx:s,range:n,instruction:o,numVariations:a,magicEditId:i}){let l;try{l=Xm(t,e,n)}catch(p){throw new Error("Unable to serialize the current selection for magic edit.")}const c=qm(t,n),d=Cc(t.dom,c),f=Ec(l.fullMarkdown,l.startIndex,l.endIndex),u=await Nc(l.fullMarkdown),g=ei(s,i);return g.domAnchor$.set(d),g.textAnchor$.set(f),g.baseBlockVersion$.set(u),{payload:{full_block_body_markdown:l.fullMarkdown,start_index:l.startIndex,end_index:l.endIndex,instruction:o,num_variations:a},snapshot:{domAnchor:d,textAnchor:f,baseBlockVersion:u}}}function Ym(t){"use forget";const e=je.c(23),{view:s,pmu:n}=t,o=Me(),a=Mt(),i=_e(),l=m.useRef(null),c=m.useRef(null),d=m.useRef(null),{mutateAsync:f,isPending:u}=Hm();let g;e[0]!==o||e[1]!==f?(g=async(E,C)=>{const R=(await f({payload:E})).choices,$=ei(o,C);return $.replacements$.set(R),$.status$.set("ready"),{replacements:R,magicEditId:C}},e[0]=o,e[1]=f,e[2]=g):g=e[2];const p=g;let x;e[3]!==o||e[4]!==p||e[5]!==i||e[6]!==n||e[7]!==a||e[8]!==s?(x=async E=>{var A;const{instruction:C,numVariations:_}=E,R=_===void 0?1:_,$=lr(s);if(!$){const N=i.formatMessage({id:"zpmbDf",defaultMessage:"Highlight text in the block to use magic edit."});return a.danger(N,{duration:2}),null}try{const N=crypto.randomUUID();d.current=N;const{payload:T,snapshot:I}=await Zm({view:s,pmu:n,ctx:o,range:$,instruction:C,numVariations:R,magicEditId:N});l.current=I,c.current=T;const B=await p(T,N);return Os("ChatGPT Writing Block Magic Edit Submitted","chatgpt_writing_block_magic_edit_submitted",{magicEditId:N}),B}catch(N){const T=N,I=(A=yl(T))!=null?A:i.formatMessage({id:"oSt4Kz",defaultMessage:"An error occured during magic edit."});return a.danger(I,{duration:2}),Os("ChatGPT Writing Block Magic Edit Failed","chatgpt_writing_block_magic_edit_failed",Q(z({},d.current?{magicEditId:d.current}:{}),{error:T instanceof Error?T.message:"Unknown error"})),null}},e[3]=o,e[4]=p,e[5]=i,e[6]=n,e[7]=a,e[8]=s,e[9]=x):x=e[9];const w=x;let S;e[10]!==p?(S=()=>!c.current||!d.current?Promise.resolve(null):p(c.current,d.current),e[10]=p,e[11]=S):S=e[11];const h=S;let M;e[12]!==n||e[13]!==s?(M=E=>{const{magicEditId:C,replacement:_}=E;if(!l.current)return!1;const $=lr(s);if(!$)return!1;const A=vm({view:s,pmu:n,range:$,magicEditId:C,replacement:_});return A&&(l.current=null),A},e[12]=n,e[13]=s,e[14]=M):M=e[14];const v=M;let k;e[15]!==s?(k=()=>Ja(s),e[15]=s,e[16]=k):k=e[16];const j=k;let y;return e[17]!==v||e[18]!==u||e[19]!==h||e[20]!==j||e[21]!==w?(y={isLoading:u,submitMagicEdit:w,applyMagicEditResult:v,isSelectionInsideMagicEdit:j,retry:h},e[17]=v,e[18]=u,e[19]=h,e[20]=j,e[21]=w,e[22]=y):y=e[22],y}const Jm=ne(()=>se(()=>import("./d69imh1iyv32gaf9.js").then(t=>t._),__vite__mapDeps([26,1])),{loading:t=>ae(t)}),Qm=ne(()=>se(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yn),__vite__mapDeps([12,1,8,9,13])),{loading:t=>ae(t)});function eh(t){"use forget";const e=je.c(48),{editorView:s,pmu:n,intl:o,isMagicEditOpen:a,toggleMagicEdit:i,isMagicEditDisabled:l,handleKeyDown:c}=t,[d,f]=m.useState(""),u=m.useRef(null),g=m.useRef(!1);let p;e[0]!==s||e[1]!==n?(p={view:s,pmu:n},e[0]=s,e[1]=n,e[2]=p):p=e[2];const{isLoading:x,submitMagicEdit:w,applyMagicEditResult:S}=Ym(p);let h;e[3]!==S||e[4]!==d||e[5]!==w||e[6]!==i?(h=async X=>{var K;g.current=!1,X==null||X.preventDefault(),X==null||X.stopPropagation();const H=d.trim();if(!H)return;const b=await w({instruction:H});if(!b||g.current)return;const P=(K=b.replacements[0])!=null?K:"";S({magicEditId:b.magicEditId,replacement:P})&&(f(""),i(!1))},e[3]=S,e[4]=d,e[5]=w,e[6]=i,e[7]=h):h=e[7];const M=h;let v;e[8]!==i?(v=()=>{g.current=!0,i(!1)},e[8]=i,e[9]=v):v=e[9];const k=v;if(!a){let X;e[10]!==o?(X=o.formatMessage({id:"fO+eDT",defaultMessage:"Magic edit"}),e[10]=o,e[11]=X):X=e[11];let H;e[12]===Symbol.for("react.memo_cache_sentinel")?(H=r.jsx("span",{className:mo.keyBindingTight,children:r.jsx(Na,{binding:Ta})}),e[12]=H):H=e[12];let b;e[13]!==i?(b=()=>i(!0),e[13]=i,e[14]=b):b=e[14];let P;e[15]!==l||e[16]!==X||e[17]!==b?(P=r.jsx(Ue.Action,{label:X,subLabel:H,onClick:b,onMouseDown:th,isDisabled:l}),e[15]=l,e[16]=X,e[17]=b,e[18]=P):P=e[18];let L;e[19]===Symbol.for("react.memo_cache_sentinel")?(L=r.jsx(Ue.Separator,{}),e[19]=L):L=e[19];let K;return e[20]!==P?(K=r.jsxs(r.Fragment,{children:[P,L]}),e[20]=P,e[21]=K):K=e[21],K}let j;e[22]===Symbol.for("react.memo_cache_sentinel")?(j=X=>f(X.target.value),e[22]=j):j=e[22];let y;e[23]!==o?(y=o.formatMessage({id:"hZs4Yo",defaultMessage:"Describe the edit"}),e[23]=o,e[24]=y):y=e[24];const E=x?k:M;let C;e[25]!==c||e[26]!==x||e[27]!==d||e[28]!==y||e[29]!==E?(C=r.jsx(_l,{selectAllOnFocus:!1,ref:u,value:d,onChange:j,onKeyDownCapture:c,placeholder:y,onSubmit:E,border:!1,className:"mx-0! min-w-[300px]! ps-2.5! pe-9!",name:"writing-block-magic-edit-instruction",autoFocus:!0,disabled:x}),e[25]=c,e[26]=x,e[27]=d,e[28]=y,e[29]=E,e[30]=C):C=e[30];const _=x?"menu-item-input-stop-btn":"composer-submit-btn";let R;e[31]!==_?(R=D("icon",_),e[31]=_,e[32]=R):R=e[32];let $;e[33]!==d?($=d.trim(),e[33]=d,e[34]=$):$=e[34];const A=$==="",N=x?k:M;let T;e[35]!==o?(T=o.formatMessage({defaultMessage:"Submit",id:"aria.submit"}),e[35]=o,e[36]=T):T=e[36];let I;e[37]!==x?(I=x?r.jsx(Jm,{className:"icon"}):r.jsx(Qm,{className:"icon-xs"}),e[37]=x,e[38]=I):I=e[38];let B;e[39]!==A||e[40]!==N||e[41]!==T||e[42]!==I||e[43]!==R?(B=r.jsx("div",{className:"absolute end-1.5 top-1/2 flex -translate-y-1/2 items-center justify-center",children:r.jsx("button",{className:R,disabled:A,onClick:N,"aria-label":T,"data-in-menu":!0,children:I})}),e[39]=A,e[40]=N,e[41]=T,e[42]=I,e[43]=R,e[44]=B):B=e[44];let W;return e[45]!==B||e[46]!==C?(W=r.jsxs("div",{className:"relative",children:[C,B]}),e[45]=B,e[46]=C,e[47]=W):W=e[47],W}function th(t){return t.preventDefault()}const sh=ne(()=>se(()=>import("./jlsn3bgiglwu2091.js").then(t=>t._),__vite__mapDeps([27,1])),{loading:t=>ae(t)}),nh=ne(()=>se(()=>import("./gxutkm8tkisxteim.js").then(t=>t._),__vite__mapDeps([28,1])),{loading:t=>ae(t)}),Cs=t=>({left:t.left,top:t.top,width:t.width,height:t.height}),Es=.5,As=(t,e)=>Math.abs(t.left-e.left)<Es&&Math.abs(t.top-e.top)<Es&&Math.abs(t.width-e.width)<Es&&Math.abs(t.height-e.height)<Es,oh=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:As(t,e),qe=Gt({bold:{id:"Z0FJiE",defaultMessage:"Bold"},italic:{id:"Ros0Mw",defaultMessage:"Italic"},textStylesTrigger:{id:"hngz+P",defaultMessage:"Text styles"},text:{id:"fGeL2E",defaultMessage:"Text"},heading1:{id:"Z1ugOp",defaultMessage:"Heading 1"},heading2:{id:"lVfGMg",defaultMessage:"Heading 2"},heading3:{id:"c55YcX",defaultMessage:"Heading 3"},heading1Glyph:{id:"QzkS3/",defaultMessage:"H1"},heading2Glyph:{id:"F2BLPp",defaultMessage:"H2"},heading3Glyph:{id:"SVuVmp",defaultMessage:"H3"},numberedList:{id:"IGi1BS",defaultMessage:"Numbered list"},bulletedList:{id:"EkLnA6",defaultMessage:"Bulleted list"}}),rh=({editorView:t,intl:e,isMagicEditEnabled:s,hasActiveMagicEditEntry:n,pmu:o})=>{"use no forget";const a=Me(),i=m.useRef(null),[l,c]=m.useState(!1),[d,f]=m.useState(!1),[u,g]=m.useState(!1),p=n||u,[x,w]=m.useState(!1),S=m.useRef(null),h=m.useCallback(()=>t.dom,[t]),M=m.useRef(null),v=m.useRef(null),[k,j]=m.useState(0),y=m.useRef(!1),E=m.useRef(null),[C,_]=m.useState(!1),[R,$]=m.useState(!1),[A,N]=m.useState("paragraph"),T=m.useCallback(O=>{const F=M.current;F==null&&O==null||F!=null&&O!=null&&As(F.selectionRect,O.selectionRect)&&As(F.editorRect,O.editorRect)&&As(F.containerRect,O.containerRect)&&oh(F.caretRect,O.caretRect)&&F.isFocusAtEnd===O.isFocusAtEnd||(M.current=O,j(Z=>Z+1))},[]),I=m.useCallback(()=>{var we,ke,ee,J,ve;const O=t.state,{from:F,to:V,empty:Z,$from:Y}=O.selection,ue=O.schema.marks[$n.proseMirrorMarkName()],le=O.schema.marks[An.proseMirrorMarkName()];if(Z){const xe=(we=O.storedMarks)!=null?we:Y.marks(),Ce=!!ue&&!!(xe!=null&&xe.find(Ne=>Ne.type===ue)),Ie=!!le&&!!(xe!=null&&xe.find(Ne=>Ne.type===le));_(Ce),$(Ie)}else{const xe=O.doc.textBetween(F,V,"\n","\n"),Ce=(ee=(ke=xe.match(/^\s*/))==null?void 0:ke[0].length)!=null?ee:0,Ie=(ve=(J=xe.match(/\s*$/))==null?void 0:J[0].length)!=null?ve:0,Ne=F+Ce,We=V-Ie;if(Ne>=We)_(!1),$(!1);else{let Oe=!1,it=!0,lt=!0;O.doc.nodesBetween(Ne,We,Ye=>{var ht;if(Ye.isText){if(!((ht=Ye.text)!=null?ht:"").trim())return!0;Oe=!0;const It=!!ue&&Ye.marks.some(ct=>ct.type===ue),Xt=!!le&&Ye.marks.some(ct=>ct.type===le);if(It||(it=!1),Xt||(lt=!1),!it&&!lt)return!1}return!0}),_(Oe&&it),$(Oe&&lt)}}let fe="paragraph";const be=O.schema.nodes[On.proseMirrorNodeName()],ce=O.schema.nodes[Ln.proseMirrorNodeName()],ge=O.schema.nodes[Dn.proseMirrorNodeName()];for(let xe=Y.depth;xe>=0;xe--){const Ce=Y.node(xe);if(Ce.type===ce){fe="orderedList";break}if(Ce.type===ge){fe="unorderedList";break}if(Ce.type===be){const Ie=Number(Ce.attrs.level);Ie===1?fe="heading1":Ie===2?fe="heading2":fe="heading3";break}}N(fe)},[t]),B=m.useCallback(()=>{if(typeof window>"u")return;v.current!=null&&window.cancelAnimationFrame(v.current);const O=y.current;v.current=window.requestAnimationFrame(()=>{var ke;if(v.current=null,O)return;const F=t.dom;if(!F){T(null);return}g(Ja(t));const V=window.getSelection();if(!V||V.rangeCount===0||V.isCollapsed){I(),T(null);return}const Z=V.getRangeAt(0);if(!Z||!F.contains(Z.commonAncestorContainer)){I(),T(null);return}I();const Y=Z.getBoundingClientRect();if(!Y||Y.width===0&&Y.height===0){T(null);return}const ue=F.getBoundingClientRect(),fe=((ke=F.offsetParent instanceof HTMLElement?F.offsetParent:F.parentElement)!=null?ke:F).getBoundingClientRect();let be=null,ce=!1;const{focusNode:ge,focusOffset:we}=V;if(ge!=null){try{const ee=document.createRange();ee.setStart(ge,we),ee.setEnd(ge,we);const J=ee.getBoundingClientRect();J&&(be=Cs(J))}catch(ee){be=null}try{ce=ge===Z.endContainer&&we===Z.endOffset}catch(ee){ce=!1}}T({selectionRect:Cs(Y),caretRect:be,editorRect:Cs(ue),containerRect:Cs(fe),isFocusAtEnd:ce})})},[T,t,I]);m.useEffect(()=>{if(typeof document>"u"||typeof window>"u")return;const O=()=>{B()},F=()=>{B()};return document.addEventListener("selectionchange",O),window.addEventListener("resize",F),window.addEventListener("scroll",F,!0),B(),()=>{document.removeEventListener("selectionchange",O),window.removeEventListener("resize",F),window.removeEventListener("scroll",F,!0),v.current!=null&&(window.cancelAnimationFrame(v.current),v.current=null)}},[B]);const W=m.useCallback(O=>{const F=M.current;if(!F)return null;const{selectionRect:V,editorRect:Z,containerRect:Y}=F,ue=8,le=V.left-Z.left,fe=V.width>0?V.width:O.width,be=Z.width,ce=Z.left-Y.left,ge=le+fe/2-O.width/2,ke=Math.min(Math.max(ge,0),Math.max(be-O.width,0))+ce,ee=V.top-Z.top,J=Z.top-Y.top,xe=ee-O.height-ue+J,Ce=bu.ABOVE;return{left:ke,top:xe,aboveOrBelow:Ce,toolbarSize:O}},[t,k]),X=m.useCallback(()=>{const{state:O,dispatch:F}=t,{selection:V}=O;if(V.empty)return;const Z=Math.min(V.to,O.doc.content.size),Y=O.doc.resolve(Z),ue=Fe.near(Y,-1);ue.eq(V)||F(O.tr.setSelection(ue))},[t]),H=m.useCallback(()=>{var V,Z,Y;const O=(Z=(V=t.dom)==null?void 0:V.ownerDocument)!=null?Z:typeof document<"u"?document:null,F=(Y=O==null?void 0:O.getSelection)==null?void 0:Y.call(O);F&&F.removeAllRanges()},[t]),b=m.useCallback(()=>{X(),H()},[X,H]),P=m.useCallback(O=>{O?(_m(t),w(!0),f(!0)):(wm(t),w(!1),f(!1))},[t]),L=m.useCallback(()=>{P(!1),b()},[P,b]),{handleKeyDown:K}=Qa({editorView:t,toolbarContentRef:i,isToolbarOpen:l,onDismiss:L}),U=m.useCallback(O=>{const F=t.dom;if(F){y.current=!0,typeof window<"u"&&E.current&&(window.clearTimeout(E.current),E.current=null),F.focus({preventScroll:!0});try{O(),I()}finally{typeof window<"u"?E.current=window.setTimeout(()=>{y.current=!1,E.current=null,B()},0):y.current=!1}}},[t,B,I]),G=m.useCallback(O=>{U(()=>{const{state:F,dispatch:V}=t,Z=F.schema.marks[O];Z&&au(F,V,Z)})},[t,U]);m.useEffect(()=>()=>{typeof window<"u"&&E.current!=null&&(window.clearTimeout(E.current),E.current=null)},[]),m.useEffect(()=>{if(!s)return;const O=()=>{S.current&&(S.current.action(),S.current.limitToGroups(),S.current=null)};if(l&&!p){const{addAction:F,limitActionGroups:V}=wl(a);S.current={action:F({key:"magicEdit",action:()=>P(!0),actionMessageDescriptor:e.formatMessage({id:"MWHvyw",defaultMessage:"Toggle magic edit"}),group:Oo.Chat,keyboardBinding:Ta}),limitToGroups:V([Oo.Chat])}}else O();return()=>{O()}},[a,e,s,l,p,P]);const te=m.useCallback(O=>{U(()=>{const{state:F,dispatch:V}=t,Z=F.schema,Y=Z.nodes[Wa.proseMirrorNodeName()],ue=Z.nodes[On.proseMirrorNodeName()],le=Z.nodes[Ln.proseMirrorNodeName()],fe=Z.nodes[Dn.proseMirrorNodeName()],be=Z.nodes[Ba.proseMirrorNodeName()],ce=we=>{const ke=F.selection.$from;for(let ee=ke.depth;ee>=0;ee--)if(ke.node(ee).type===we)return!0;return!1},ge=()=>{if(!be)return;const we=()=>{const ee=t.state.selection.$from;for(let J=ee.depth;J>=0;J--){const ve=ee.node(J).type;if(ve===le||ve===fe)return!0}return!1};let ke=t.state.selection.$from.depth;for(;ke-- >0&&we()&&iu(be)(t.state,t.dispatch););};switch(O){case"paragraph":{(ce(le)||ce(fe))&&ge(),Y&&js(Y)(t.state,t.dispatch);break}case"heading1":case"heading2":case"heading3":{const we=O==="heading1"?1:O==="heading2"?2:3;(ce(le)||ce(fe))&&ge(),ue&&js(ue,{level:we})(t.state,t.dispatch);break}case"orderedList":{ce(le)?ge():(ce(fe)&&ge(),Y&&js(Y)(F,V),le&&Wo(le)(t.state,t.dispatch));break}case"unorderedList":{ce(fe)?ge():(ce(le)&&ge(),Y&&js(Y)(F,V),fe&&Wo(fe)(t.state,t.dispatch));break}}})},[t,U]),oe=m.useMemo(()=>[{id:"paragraph",label:e.formatMessage(qe.text)},{id:"heading1",label:e.formatMessage(qe.heading1)},{id:"heading2",label:e.formatMessage(qe.heading2)},{id:"heading3",label:e.formatMessage(qe.heading3)},{id:"orderedList",label:e.formatMessage(qe.numberedList)},{id:"unorderedList",label:e.formatMessage(qe.bulletedList)}],[e]),re=e.formatMessage(qe.textStylesTrigger),[me,he]=m.useState(!1),ie=m.useRef(null),pe=m.useCallback(()=>{if(typeof window>"u"){ie.current=null;return}const O=window.getSelection();if(!O||O.rangeCount===0){ie.current=null;return}ie.current=O.getRangeAt(0).cloneRange()},[]),Ee=m.useCallback(()=>{if(typeof window>"u")return;const O=ie.current;if(!O)return;const F=window.getSelection();F&&(F.removeAllRanges(),F.addRange(O))},[]);m.useEffect(()=>{me||(ie.current=null)},[me]);const Se=m.useMemo(()=>{const O=oe.find(F=>F.id===A);return O?O.label:e.formatMessage(qe.text)},[A,e,oe]);return r.jsxs(yu,{showAskChatGPT:!1,toolbarType:Ha.WRITING,getEditorDom:h,getSelectionRange:()=>null,getToolbarPosition:W,savedSelection:x,toolbarContentRef:i,setIsToolbarOpen:c,isSendDisabled:!0,children:[s&&r.jsx(eh,{editorView:t,pmu:o,intl:e,isMagicEditOpen:d,toggleMagicEdit:P,isMagicEditDisabled:p,handleKeyDown:K}),!d&&r.jsxs(r.Fragment,{children:[r.jsx(Ue.Action,{label:e.formatMessage(qe.bold),hideLabel:!0,icon:nh,onClick:()=>G($n.proseMirrorMarkName()),onMouseDown:O=>O.preventDefault(),isActive:C}),r.jsx(Ue.Action,{label:e.formatMessage(qe.italic),hideLabel:!0,icon:sh,onClick:()=>G(An.proseMirrorMarkName()),onMouseDown:O=>O.preventDefault(),isActive:R}),r.jsx(Ue.Separator,{}),r.jsx(Bm,{buttonText:Se,editorRef:{current:t.dom},selectedOptionId:A,isOpen:me,onOpenChange:O=>{O?pe():ie.current=null,he(O)},onSelect:O=>{Ee(),te(O),he(!1)},options:oe,preserveSelection:pe,triggerLabel:re})]})]})},hr=Gt({divider:{id:"5lM+d4",defaultMessage:"Divider"},generate:{id:"TnriIz",defaultMessage:"Generate"},menuLabel:{id:"ZmuIH8",defaultMessage:"Insert options"}}),ah="text-token-text-primary hover:text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-xl px-3 py-2 text-left text-sm hover:bg-[#f5f5f5] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-token-border-strong",ih={divider:"divider",generate:"generate"};function ti(t){"use forget";var X,H;const e=je.c(44),{state:s,style:n,floatingRef:o,dispatchSlashMenuMeta:a}=t,i=_e(),l=m.useRef(null);let c;e[0]!==s?(c=ze(s),e[0]=s,e[1]=c):c=e[1];const d=c;s==null||s.visibleOptionIds;let f;e[2]!==(s==null?void 0:s.visibleOptionIds)?(f=(X=s==null?void 0:s.visibleOptionIds)!=null?X:[],e[2]=s==null?void 0:s.visibleOptionIds,e[3]=f):f=e[3];const u=f,g=(H=s==null?void 0:s.highlightedOptionId)!=null?H:null;let p;e[4]!==a?(p=()=>{a({type:"close"})},e[4]=a,e[5]=p):p=e[5];const x=p;let w;e[6]!==a?(w=b=>{a({type:"highlight",commandId:b})},e[6]=a,e[7]=w):w=e[7];const S=w;let h;e[8]!==a?(h=b=>{a({type:"execute",commandId:b})},e[8]=a,e[9]=h):h=e[9];const M=h;let v;e[10]!==M?(v=new Map,$m().forEach(b=>{const P=ih[b.id];v.set(b.id,{id:b.id,command:b.command,messageKey:P,disabled:b.disabled,onSelect:()=>{M(b.id)}})}),e[10]=M,e[11]=v):v=e[11];const k=v;let j;if(e[12]!==k||e[13]!==u){let b;e[15]!==k?(b=P=>{var L;return(L=k.get(P))!=null?L:null},e[15]=k,e[16]=b):b=e[16],j=u.map(b).filter(lh),e[12]=k,e[13]=u,e[14]=j}else j=e[14];const y=j;let E,C;e[17]!==x||e[18]!==d||e[19]!==y.length?(E=()=>{d&&(y.length>0||x())},C=[d,x,y.length],e[17]=x,e[18]=d,e[19]=y.length,e[20]=E,e[21]=C):(E=e[20],C=e[21]),m.useEffect(E,C);let _,R;e[22]!==x||e[23]!==d?(R=()=>{if(!d)return;const b=P=>{l.current&&(P.target instanceof Node&&l.current.contains(P.target)||x())};return document.addEventListener("pointerdown",b,!0),()=>{document.removeEventListener("pointerdown",b,!0)}},_=[d,x],e[22]=x,e[23]=d,e[24]=_,e[25]=R):(_=e[24],R=e[25]),m.useEffect(R,_);let $,A;if(e[26]!==x||e[27]!==d?($=()=>{if(!d)return;const b=L=>{if(!l.current){x();return}L.target instanceof Node&&l.current.contains(L.target)||x()},P=()=>{x()};return window.addEventListener("blur",P),document.addEventListener("focusin",b,!0),()=>{window.removeEventListener("blur",P),document.removeEventListener("focusin",b,!0)}},A=[d,x],e[26]=x,e[27]=d,e[28]=$,e[29]=A):($=e[28],A=e[29]),m.useEffect($,A),!d)return null;let N;e[30]!==o?(N=b=>{l.current=b,o==null||o(b)},e[30]=o,e[31]=N):N=e[31];let T;e[32]!==i?(T=i.formatMessage(hr.menuLabel),e[32]=i,e[33]=T):T=e[33];let I;e[34]===Symbol.for("react.memo_cache_sentinel")?(I=D(ro.toolbar,Ua,"writing-block-slash-menu border-token-border-default bg-token-bg-primary absolute w-64 rounded-2xl border p-2","flex flex-col gap-1"),e[34]=I):I=e[34];let B;e[35]!==S||e[36]!==g||e[37]!==y?(B=y.length===0?null:y.map(b=>{const P=b.id===g;return r.jsx("button",{type:"button",role:"menuitem","data-highlighted":P?"true":void 0,className:D(ah,b.disabled&&"cursor-not-allowed opacity-50",P&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5] font-medium"),disabled:b.disabled,"aria-disabled":b.disabled?"true":void 0,onClick:()=>{b.disabled||(S(b.id),b.onSelect())},onPointerDown:L=>{L.preventDefault(),L.stopPropagation(),b.disabled||(S(b.id),b.onSelect())},onMouseEnter:()=>{y.length>0&&S(b.id)},onFocus:()=>{y.length>0&&S(b.id)},children:r.jsx(q,z({},hr[b.messageKey]))},b.id)}),e[35]=S,e[36]=g,e[37]=y,e[38]=B):B=e[38];let W;return e[39]!==n||e[40]!==N||e[41]!==T||e[42]!==B?(W=r.jsx("div",{ref:N,role:"menu","aria-label":T,className:I,style:n,tabIndex:-1,children:B}),e[39]=n,e[40]=N,e[41]=T,e[42]=B,e[43]=W):W=e[43],W}function lh(t){return t!=null}ti.displayName="WritingBlockSlashMenu";const pr=Gt({accept:{id:"9u4W5n",defaultMessage:"Accept"},reject:{id:"ClnYCK",defaultMessage:"Undo"}}),ch=8,dh=[Tc.Mod,"Enter"];function uh(t){"use forget";const e=je.c(57),{editorView:s,editorRootRef:n,activeEntryId:o,onAccept:a,onReject:i}=t,l=_e(),[c,d]=_u(),{width:f}=c,u=m.useRef(null),[g,p]=m.useState(null),x=Me();let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w=G=>{p(te=>{const oe=te==null,re=G==null;return oe&&re||!oe&&!re&&te.left===G.left&&te.top===G.top?te:G})},e[0]=w):w=e[0];const S=w;let h;e[1]!==o||e[2]!==n?(h=()=>{const G=n.current;if(!G||!o)return null;const te=G.querySelectorAll("[data-me-role='sugg']");for(const oe of te)if(oe.dataset.meId===o)return oe;return null},e[1]=o,e[2]=n,e[3]=h):h=e[3];const M=h;let v;e[4]!==o||e[5]!==n||e[6]!==M||e[7]!==f?(v=()=>{var pe,Ee;if(!o){S(null);return}const G=n.current,te=M();if(!G||!te){S(null);return}const oe=G.getBoundingClientRect(),re=te.getBoundingClientRect(),me=(Ee=f!=null?f:(pe=u.current)==null?void 0:pe.offsetWidth)!=null?Ee:re.width,he=Math.max(0,(oe.width-me)/2),ie=re.bottom-oe.top+ch;S({left:he,top:ie})},e[4]=o,e[5]=n,e[6]=M,e[7]=f,e[8]=v):v=e[8];const k=v;let j,y;e[9]!==k?(j=()=>{k()},y=[k],e[9]=k,e[10]=j,e[11]=y):(j=e[10],y=e[11]),ya(j,y);let E,C;e[12]!==o||e[13]!==k?(E=()=>{if(!o)return;const G=()=>{k()};return window.addEventListener("resize",G),window.addEventListener("scroll",G,!0),()=>{window.removeEventListener("resize",G),window.removeEventListener("scroll",G,!0)}},C=[o,k],e[12]=o,e[13]=k,e[14]=E,e[15]=C):(E=e[14],C=e[15]),m.useEffect(E,C);const _=o!=null&&g!=null;let R;e[16]!==s||e[17]!==_||e[18]!==i?(R={editorView:s,toolbarContentRef:u,isToolbarOpen:_,onDismiss:i,dismissOnPointerDown:!1},e[16]=s,e[17]=_,e[18]=i,e[19]=R):R=e[19],Qa(R);let $;e[20]!==o||e[21]!==n||e[22]!==a?($=()=>{var oe,re;if(!o)return;const G=(re=(oe=n.current)==null?void 0:oe.ownerDocument)!=null?re:document,te=me=>{vl(me)||kl(me)!==jl()||me.key!=="Enter"||(me.preventDefault(),a())};return G.addEventListener("keydown",te,!0),()=>{G.removeEventListener("keydown",te,!0)}},e[20]=o,e[21]=n,e[22]=a,e[23]=$):$=e[23];let A;e[24]!==o||e[25]!==x||e[26]!==n||e[27]!==l||e[28]!==a?(A=[o,n,a,x,l],e[24]=o,e[25]=x,e[26]=n,e[27]=l,e[28]=a,e[29]=A):A=e[29],m.useEffect($,A);let N;e[30]!==l?(N=l.formatMessage(pr.reject),e[30]=l,e[31]=N):N=e[31];let T;e[32]===Symbol.for("react.memo_cache_sentinel")?(T=r.jsx("span",{className:"text-token-text-tertiary ms-1.5 text-sm font-medium",children:r.jsx(q,{id:"R6HH9/",defaultMessage:"ESC"})}),e[32]=T):T=e[32];let I;e[33]!==i||e[34]!==N?(I=r.jsx(Ue.Action,{label:N,onClick:i,labelClassName:"font-semibold text-black! dark:text-gray-400!",iconClassName:"text-black! dark:text-gray-400!",subLabel:T}),e[33]=i,e[34]=N,e[35]=I):I=e[35];let B;e[36]===Symbol.for("react.memo_cache_sentinel")?(B=r.jsx(Ue.Separator,{}),e[36]=B):B=e[36];let W;e[37]!==l?(W=l.formatMessage(pr.accept),e[37]=l,e[38]=W):W=e[38];let X;e[39]===Symbol.for("react.memo_cache_sentinel")?(X=r.jsx("span",{className:D(mo.keyBindingTight,"ms-1.5"),children:r.jsx(Na,{binding:dh})}),e[39]=X):X=e[39];let H;e[40]!==a||e[41]!==W?(H=r.jsx(Ue.Action,{label:W,onClick:a,labelClassName:"font-semibold text-blue-400!",iconClassName:"text-blue-400!",subLabel:X}),e[40]=a,e[41]=W,e[42]=H):H=e[42];let b;e[43]!==I||e[44]!==H?(b=r.jsxs(Ue,{toolbarType:Ha.WRITING,children:[I,B,H]}),e[43]=I,e[44]=H,e[45]=b):b=e[45];const P=b;if(!_)return null;let L;e[46]!==o||e[47]!==d||e[48]!==P?(L=o&&r.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:r.jsx("div",{ref:d,children:P})}),e[46]=o,e[47]=d,e[48]=P,e[49]=L):L=e[49];let K;e[50]!==_||e[51]!==g||e[52]!==P?(K=_&&r.jsx("div",{ref:G=>{u.current=G},style:{left:g?g.left:0,top:g?g.top:0},className:D("absolute",ro.toolbar),children:P}),e[50]=_,e[51]=g,e[52]=P,e[53]=K):K=e[53];let U;return e[54]!==L||e[55]!==K?(U=r.jsxs(r.Fragment,{children:[L,K]}),e[54]=L,e[55]=K,e[56]=U):U=e[56],U}function fh(t,e,s){var M,v,k;const{schema:n}=t.state,o=n.nodes.horizontal_rule,a=n.nodes.paragraph;if(!o)return!1;let i=t.state.tr;const l=Math.max(s!=null?s:e+1,e+1);i=i.delete(e,l);const c=i.mapping.map(e,-1),d=i.doc.childBefore(c+1),f=d.node,u=d.offset;if(a&&(f==null?void 0:f.type)===a&&f.isTextblock&&(f==null?void 0:f.content.size)===0){const j=o.create(),y=u+f.nodeSize;i=i.replaceRangeWith(u,y,j);const E=u+j.nodeSize;let C=E;if(a){const R=a.create(),$=R.nodeSize;i=i.insert(E,is.from(R)),C=E+1;const A=E+$,N=i.doc.nodeAt(A);(N==null?void 0:N.type)===a&&N.content.size===0&&(i=i.delete(A,A+N.nodeSize))}const _=(M=Fe.findFrom(i.doc.resolve(C),1,!0))!=null?M:Fe.near(i.doc.resolve(C),1);return t.dispatch(i.setSelection(_).scrollIntoView()),!0}const p=o.create(),x=a?a.create():null,w=x?[p,x]:[p];i=i.insert(c,is.from(w));const S=c+p.nodeSize;if(x&&a){const j=c+p.nodeSize,y=x.nodeSize,E=j+y,C=i.doc.nodeAt(E);C&&C.type===a&&C.content.size===0&&(i=i.delete(E,E+C.nodeSize));const _=(v=Fe.findFrom(i.doc.resolve(j+1),1,!0))!=null?v:Fe.near(i.doc.resolve(j+1),1);return t.dispatch(i.setSelection(_).scrollIntoView()),!0}const h=(k=Fe.findFrom(i.doc.resolve(S),1,!0))!=null?k:Fe.near(i.doc.resolve(S),1);return t.dispatch(i.setSelection(h).scrollIntoView()),!0}function mh(t){"use forget";const e=je.c(2);let s;return e[0]!==t?(s=cm({shouldStripDirectives:!0,contentReferences:t}),e[0]=t,e[1]=s):s=e[1],s}const hh=t=>{"use forget";const e=je.c(87),{markdown:s,onChange:n,isDisabled:o,className:a,maxLength:i,contentReferences:l,setDirty:c,flushPendingChanges:d}=t,f=Me(),u=_e(),g=Jn(so.MagicEditEnabled);let p;e[0]!==f?(p=Pe(f,"2459982630"),e[0]=f,e[1]=p):p=e[1];const w=g||p;let S;e[2]!==f?(S=Pe(f,"3539089402"),e[2]=f,e[3]=S):S=e[3];const h=S,M=mh(l),v=m.useRef(null),k=m.useRef(null),j=m.useRef(null),[y,E]=m.useState(null),[C,_]=m.useState(null),R=ao(n,300),$=m.useRef(R),A=m.useRef(c),N=m.useRef(d),[T,I]=m.useState(Ke);let B;e[4]===Symbol.for("react.memo_cache_sentinel")?(B={placement:"bottom-start",middleware:[Ml(8),Cl({fallbackPlacements:["top-start"]}),El({padding:8})],whileElementsMounted:(de,ye,Te)=>{var $e;return Sl(($e=v.current)!=null?$e:de,ye,Te,{ancestorResize:!0,ancestorScroll:!0})}},e[4]=B):B=e[4];const{refs:W,floatingStyles:X,update:H}=Nl(B),b=W.setReference,P=W.setFloating,L=m.useRef(null);let K;e[5]!==a?(K=D("markdown","prose","dark:prose-invert","w-full","min-h-6","break-words","focus:outline-none",a),e[5]=a,e[6]=K):K=e[6];const U=K;let G;e[7]!==U||e[8]!==o||e[9]!==s||e[10]!==i?(G={markdown:s,maxLength:i,isDisabled:o,editorClassName:U},e[7]=U,e[8]=o,e[9]=s,e[10]=i,e[11]=G):G=e[11];const te=m.useRef(G),oe=m.useRef(s);let re;e[12]===Symbol.for("react.memo_cache_sentinel")?(re=de=>{I(ye=>ye.triggerPos===de.triggerPos&&ye.anchorPos===de.anchorPos&&ye.query===de.query&&ye.normalizedQuery===de.normalizedQuery&&ye.highlightedOptionId===de.highlightedOptionId&&ye.visibleOptionIds.length===de.visibleOptionIds.length&&ye.visibleOptionIds.every((Te,$e)=>Te===de.visibleOptionIds[$e])?ye:de)},e[12]=re):re=e[12];const me=re;let he;e[13]!==b||e[14]!==H?(he=de=>{var gt,At;const ye=j.current,Te=de!=null?de:ye&&(gt=Ae.getState(ye.state))!=null?gt:Ke;if(!ye||!ze(Te)){L.current=null,b(null);return}const $e=Te.anchorPos,pt={contextElement:(At=v.current)!=null?At:void 0,getBoundingClientRect:()=>{try{const Zt=ye.coordsAtPos($e);return new DOMRect(Zt.left,Zt.bottom,0,0)}catch(Zt){return new DOMRect}}};L.current=pt,b(pt),H()},e[13]=b,e[14]=H,e[15]=he):he=e[15];const ie=he;let pe;e[16]===Symbol.for("react.memo_cache_sentinel")?(pe=de=>{const ye=j.current;if(!ye){de.type==="close"&&me(Ke);return}const Te=ye.state.tr.setMeta(Ae,de);ye.dispatch(Te)},e[16]=pe):pe=e[16];const Ee=pe;let Se;e[17]===Symbol.for("react.memo_cache_sentinel")?(Se=()=>{Ee({type:"close"})},e[17]=Se):Se=e[17];const O=Se;let F;e[18]===Symbol.for("react.memo_cache_sentinel")?(F=()=>{const de=j.current;if(!de)return;const ye=Ae.getState(de.state);if(!ze(ye))return;const{triggerPos:Te,anchorPos:$e}=ye;if(!fh(de,Te,$e)){O();return}fr(de)},e[18]=F):F=e[18];const V=F;let Z;e[19]===Symbol.for("react.memo_cache_sentinel")?(Z=de=>{if(de==="divider"){V();return}},e[19]=Z):Z=e[19];const Y=Z;let ue;e[20]!==C||e[21]!==y?(ue=()=>{!C||!y||(y.focus(),ir(y,C,"use"),Os("ChatGPT Writing Block Magic Edit Accepted","chatgpt_writing_block_magic_edit_accepted",{magicEditId:C}))},e[20]=C,e[21]=y,e[22]=ue):ue=e[22];const le=ue;let fe;e[23]!==C||e[24]!==y?(fe=()=>{!C||!y||(y.focus(),ir(y,C,"keep"),Os("ChatGPT Writing Block Magic Edit Rejected","chatgpt_writing_block_magic_edit_rejected",{magicEditId:C}))},e[23]=C,e[24]=y,e[25]=fe):fe=e[25];const be=fe;let ce,ge;e[26]!==R?(ce=()=>{$.current=R},ge=[R],e[26]=R,e[27]=ce,e[28]=ge):(ce=e[27],ge=e[28]),m.useEffect(ce,ge);let we,ke;e[29]!==c?(we=()=>{A.current=c},ke=[c],e[29]=c,e[30]=we,e[31]=ke):(we=e[30],ke=e[31]),m.useEffect(we,ke);let ee,J;e[32]!==d?(ee=()=>{N.current=d},J=[d],e[32]=d,e[33]=ee,e[34]=J):(ee=e[33],J=e[34]),m.useEffect(ee,J);let ve,xe;e[35]!==w||e[36]!==h||e[37]!==M||e[38]!==b||e[39]!==ie?(ve=()=>{var So;const de=k.current;if(!de)return;const{markdown:ye,maxLength:Te,isDisabled:$e,editorClassName:pt}=te.current,gt=M.parse(ye!=null?ye:"");oe.current=ye;const At=[Ud(),M.inputRulesPlugin(),...h?[Fm()]:[],M.keymapPlugin(),Tl(Q(z({},Il),{"Mod-z":Gd,"Mod-shift-z":Bo,"Mod-y":Bo})),Tm($e),um(typeof Te=="number"?Te:null)];w&&(At.push(ym()),At.push(Sm()));const Zt=Pl.create({doc:gt,schema:M.schema(),plugins:At}),Pi=Je=>{var _s;const dt=Be.getState(Je);if(!w||!dt)return;const Yt=dt.entries.size>0&&(_s=dt.entries.keys().next().value)!=null?_s:null;_(bt=>bt===Yt?bt:Yt)},xt=new Rl({mount:de},{state:Zt,editable:()=>!$e,attributes:{class:D("ProseMirror",pt),"aria-disabled":String($e)},dispatchTransaction(Je){var Co;const dt=Je.getMeta(Ae),Yt=(dt==null?void 0:dt.type)==="execute"?dt.commandId:null,_s=Je.getMeta(Pn)===!0,bt=xt.state.apply(Je);xt.updateState(bt);const cn=(Co=Ae.getState(bt))!=null?Co:Ke;if(me(cn),ze(cn)?ie(cn):(L.current=null,b(null)),Yt&&Y(Yt),Pi(bt),!Je.docChanged||_s)return;const Mo=M.serialize(bt.doc);oe.current=Mo,A.current(!0),$.current({content:Mo})}});j.current=xt,E(xt);const vo=(So=Ae.getState(xt.state))!=null?So:Ke;me(vo),ie(vo);const ko=xt.dom,jo=()=>{var Je;$.current.flush(),(Je=N.current)==null||Je.call(N),O()};return ko.addEventListener("blur",jo,!0),()=>{ko.removeEventListener("blur",jo,!0),$.current.flush(),xt.destroy(),j.current=null,E(null),me(Ke),L.current=null,b(null)}},xe=[M,O,b,ie,me,w,h,Y],e[35]=w,e[36]=h,e[37]=M,e[38]=b,e[39]=ie,e[40]=ve,e[41]=xe):(ve=e[40],xe=e[41]),m.useEffect(ve,xe);let Ce,Ie;e[42]!==U||e[43]!==o?(Ce=()=>{const de=j.current;if(!de)return;de.setProps({editable:()=>!o,attributes:{class:D("ProseMirror",U),"aria-disabled":String(o)}});const ye=Ft.getState(de.state);if((ye==null?void 0:ye.isDisabled)!==o){const Te=Im(de.state.tr,o);de.dispatch(Te)}},Ie=[U,o],e[42]=U,e[43]=o,e[44]=Ce,e[45]=Ie):(Ce=e[44],Ie=e[45]),m.useEffect(Ce,Ie);let Ne,We;e[46]!==b||e[47]!==T||e[48]!==ie?(Ne=()=>{if(!ze(T)){L.current=null,b(null);return}ie(T)},We=[b,T,ie],e[46]=b,e[47]=T,e[48]=ie,e[49]=Ne,e[50]=We):(Ne=e[49],We=e[50]),m.useEffect(Ne,We);let Oe,it;e[51]!==o?(Oe=()=>{if(!o)return;const de=j.current;de&&fr(de)},it=[o],e[51]=o,e[52]=Oe,e[53]=it):(Oe=e[52],it=e[53]),m.useEffect(Oe,it);let lt,Ye;e[54]!==i?(lt=()=>{var gt;const de=j.current;if(!de)return;const ye=Ot.getState(de.state),Te=(gt=ye==null?void 0:ye.maxLength)!=null?gt:null,$e=typeof i=="number"?i:null;if(Te===$e)return;const pt=fm(de.state.tr,$e);de.dispatch(pt)},Ye=[i],e[54]=i,e[55]=lt,e[56]=Ye):(lt=e[55],Ye=e[56]),m.useEffect(lt,Ye);let ht,Kt;e[57]!==s||e[58]!==M?(ht=()=>{const de=j.current;if(!de||s===oe.current)return;oe.current=s;const ye=M.parse(s!=null?s:""),Te=de.state.tr.replaceWith(0,de.state.doc.content.size,ye.content);Te.setMeta(Pn,!0),de.dispatch(Te)},Kt=[s,M],e[57]=s,e[58]=M,e[59]=ht,e[60]=Kt):(ht=e[59],Kt=e[60]),m.useEffect(ht,Kt);let It;e[61]!==T?(It=ze(T),e[61]=T,e[62]=It):It=e[62];const Xt=It;let ct;e[63]===Symbol.for("react.memo_cache_sentinel")?(ct=r.jsx("div",{ref:k}),e[63]=ct):ct=e[63];let Pt;e[64]!==X||e[65]!==h||e[66]!==P||e[67]!==Xt||e[68]!==T?(Pt=h&&r.jsx(ti,{state:T,floatingRef:P,style:Xt?X:void 0,dispatchSlashMenuMeta:Ee}),e[64]=X,e[65]=h,e[66]=P,e[67]=Xt,e[68]=T,e[69]=Pt):Pt=e[69];let Rt;e[70]!==C||e[71]!==y||e[72]!==le||e[73]!==be||e[74]!==w?(Rt=w&&y&&r.jsx(uh,{editorView:y,editorRootRef:v,activeEntryId:C,onAccept:le,onReject:be}),e[70]=C,e[71]=y,e[72]=le,e[73]=be,e[74]=w,e[75]=Rt):Rt=e[75];let $t;e[76]!==C||e[77]!==y||e[78]!==u||e[79]!==o||e[80]!==w||e[81]!==M?($t=!o&&y&&r.jsx(rh,{editorView:y,intl:u,isMagicEditEnabled:w,hasActiveMagicEditEntry:C!=null,pmu:M}),e[76]=C,e[77]=y,e[78]=u,e[79]=o,e[80]=w,e[81]=M,e[82]=$t):$t=e[82];let ys;return e[83]!==Pt||e[84]!==Rt||e[85]!==$t?(ys=r.jsxs("div",{ref:v,className:"writing-block-editor relative px-4 sm:px-5",children:[ct,Pt,Rt,$t]}),e[83]=Pt,e[84]=Rt,e[85]=$t,e[86]=ys):ys=e[86],ys},ph=2e4,si=t=>{"use forget";const e=je.c(7),{isInlineWritingBlockEditEnabled:s,writingBlock:n,onChange:o,isStreaming:a,setDirty:i,flushPendingChanges:l,contentReferences:c}=t,d=a||!s;let f;return e[0]!==c||e[1]!==l||e[2]!==o||e[3]!==i||e[4]!==d||e[5]!==n.content?(f=r.jsx(hh,{setDirty:i,markdown:n.content,onChange:o,isDisabled:d,maxLength:ph,flushPendingChanges:l,contentReferences:c}),e[0]=c,e[1]=l,e[2]=o,e[3]=i,e[4]=d,e[5]=n.content,e[6]=f):f=e[6],f},gh=ne(()=>se(()=>import("./fwyctp3zfyh6emd2.js").then(t=>t._),__vite__mapDeps([29,1])),{loading:t=>ae(t)}),xh=ne(()=>se(()=>import("./c8sj5q0wb2w4qlno.js").then(t=>t._),__vite__mapDeps([30,1])),{loading:t=>ae(t)});function bh({content:t,clientThreadId:e,messageId:s,contentReferences:n}){const o=Me(),a=_e(),i=Mt(),[l,c]=m.useState(!1),d=$l();return{handleCopy:async u=>{if(l)return;st.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",z({},hs({clientThreadId:e,messageId:s}))),Xn.count(Zn.WRITING_BLOCKS,"chatgpt_writing_block_copy_button_clicked");const g=await wu(t,{preserveContentReferences:!0}),p=ds(e);t!=null&&p!=null&&s!=null&&(st.logStructuredEvent(Ic,{conversationId:p,messageId:s}),Pc(o,{type:"copy",source:"mouse",location:"writing-block",selectedText:g,messageId:s,serverThreadId:p,contentType:"text"}));let x={"text/plain":g};try{x=ha(g,n)}catch(w){Vt.addError(w)}to(x,i,u),c(!0),d(()=>c(!1),2e3)},Icon:l?xh:gh,copyLabel:a.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function yh(t){"use forget";const e=je.c(10),{clientThreadId:s,messageId:n,content:o,contentReferences:a}=t;let i;e[0]!==s||e[1]!==o||e[2]!==a||e[3]!==n?(i={clientThreadId:s,messageId:n,content:o,contentReferences:a},e[0]=s,e[1]=o,e[2]=a,e[3]=n,e[4]=i):i=e[4];const{handleCopy:l,copyLabel:c}=bh(i),d=!ms();let f;e[5]===Symbol.for("react.memo_cache_sentinel")?(f=D(co,"font-normal","px-2 py-2"),e[5]=f):f=e[5];const u=d?void 0:c;let g;return e[6]!==l||e[7]!==d||e[8]!==u?(g=r.jsx(Ca,{onCopy:l,iconClassName:"icon-md me-0.5",className:f,iconOnly:d,buttonText:u}),e[6]=l,e[7]=d,e[8]=u,e[9]=g):g=e[9],g}const _h=ne(()=>se(()=>import("./k7gle8iztcijpdqk.js").then(t=>t._),__vite__mapDeps([31,1])),{loading:t=>ae(t)}),wh=ne(()=>se(()=>import("./kl3c7pa639r7ky2c.js").then(t=>t._),__vite__mapDeps([32,1])),{loading:t=>ae(t)}),gr=ne(()=>se(()=>import("./mbhfxri3syrb9rbq.js").then(t=>t._),__vite__mapDeps([6,1])),{loading:t=>ae(t)});function vh({serverThreadId:t,messageId:e,index:s,title:n}){const o=Mt(),a=_e(),[i,l]=m.useState(!1),c=!ms();if(!t)return null;const d=a.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function f(u){var g;l(!0);try{const p=await Xs.safePost("/export_doc/writing_block",{requestBody:{conversation_id:t,message_id:e,index:s,export_type:u},skipJsonTransform:!0});p.ok||o.danger(d);const x=await p.blob(),w=p.headers.get("Content-Disposition"),S=(g=ku(w))!=null?g:"".concat((n!=null?n:"Export").replaceAll("/","-"),".").concat(u);vu(x,S)}catch(p){Vt.addError(p,{tags:["type:writing_block_download_button","export_type:".concat(u)]}),o.danger(d)}finally{l(!1)}}return r.jsxs(He.Root,{children:[r.jsx(He.BasicTrigger,{asChild:!0,children:r.jsx("button",{className:"flex items-center gap-1 px-2 py-2 select-none",disabled:i,children:c?i?r.jsx(Ho,{size:16}):r.jsx(Ct,{label:r.jsx(q,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:r.jsx(gr,{className:"icon-md block"})}):r.jsxs("div",{className:D("flex items-center gap-1",co,"font-normal"),children:[i?r.jsx(Ho,{size:20}):r.jsx(gr,{className:"icon-md block"}),r.jsx(q,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"})]})})}),r.jsx(He.Portal,{children:r.jsxs(He.Content,{align:"end",children:[r.jsx(He.Label,{children:r.jsx(q,{id:"WritingBlockDownloadButton.menuTitle",defaultMessage:"Download"})}),r.jsx(He.Item,{onSelect:()=>{f("pdf")},icon:_h,label:a.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.label",defaultMessage:"PDF document"}),trailing:r.jsx("span",{children:a.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.ext",defaultMessage:".pdf"})})}),r.jsx(He.Item,{onSelect:()=>{f("docx")},icon:wh,label:a.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.label",defaultMessage:"Microsoft Word"}),trailing:r.jsx("span",{children:a.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.ext",defaultMessage:".docx"})})})]})})]})}const kh=ne(()=>se(()=>import("./pdp94tw1ktf1pj0a.js").then(t=>t._),__vite__mapDeps([33,1])),{loading:t=>ae(t)});function jh({content:t,clientThreadId:e,title:s,messageId:n,messageRef:o}){const a=_e(),i=Rc(e);function l(){$c.logButtonClick(Ac.OPEN_IN_CANVAS_WRITING_BLOCK),o.current&&Lc(o.current);const c=Dc.DOCUMENT;st.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",z({},hs({clientThreadId:e,messageId:n}))),i({title:s!=null?s:a.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:c,content:t,createSource:Oc.MESSAGE_WRITING_BLOCK})}return r.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:l,children:r.jsx(Ct,{label:r.jsx(q,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:r.jsx(kh,{className:"icon-md block"})})})}const ni=t=>{"use forget";const e=je.c(39),{primaryLabel:s,primaryAction:n,writingBlock:o,clientThreadId:a,messageId:i,isInlineWritingBlockExportEnabled:l,serverThreadId:c,shouldShowWritingBlockCanvasEdit:d,title:f,index:u,messageRef:g,autosaveStatus:p,hideDownloadButton:x,contentReferences:w}=t,S=x===void 0?!1:x,h=Me();let M;e[0]!==h?(M=Pe(h,"1600402835"),e[0]=h,e[1]=M):M=e[1];const v=!1,k="idle";let j;e:{j="text-token-text-tertiary";break e}const y=j;let E;e[2]===Symbol.for("react.memo_cache_sentinel")?(E=D(nm,"flex w-full items-center justify-between gap-3 rounded-t-[22px] px-3.5 py-1.5 font-sans sm:ps-4.5 sm:pe-3.5"),e[2]=E):E=e[2];let C;e[3]!==s?(C=s!=null?s:r.jsx(q,{id:"Ui6xge",defaultMessage:"Writing"}),e[3]=s,e[4]=C):C=e[4];let _;e[5]!==y||e[6]!==k||e[7]!==v?(_=v,e[5]=y,e[6]=k,e[7]=v,e[8]=_):_=e[8];let R;e[9]!==C||e[10]!==_?(R=r.jsxs("div",{className:"text-token-text-secondary dark:text-token-text-tertiary text-token-text-primary flex max-w-[75%] flex-grow cursor-default items-center gap-2 text-sm",children:[C,_]}),e[9]=C,e[10]=_,e[11]=R):R=e[11];let $;e[12]!==a||e[13]!==w||e[14]!==i||e[15]!==o?($=a&&i&&r.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:r.jsx(yh,{content:o.content,clientThreadId:a,messageId:i,contentReferences:w})}),e[12]=a,e[13]=w,e[14]=i,e[15]=o,e[16]=$):$=e[16];let A;e[17]!==S||e[18]!==u||e[19]!==l||e[20]!==i||e[21]!==c||e[22]!==f?(A=!S&&l&&c&&i&&r.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:r.jsx(vh,{serverThreadId:c,messageId:i,title:f,index:u})}),e[17]=S,e[18]=u,e[19]=l,e[20]=i,e[21]=c,e[22]=f,e[23]=A):A=e[23];let N;e[24]!==a||e[25]!==i||e[26]!==g||e[27]!==d||e[28]!==f||e[29]!==o?(N=a&&i&&d&&r.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:r.jsx(jh,{content:o.content,clientThreadId:a,messageId:i,title:f,messageRef:g})}),e[24]=a,e[25]=i,e[26]=g,e[27]=d,e[28]=f,e[29]=o,e[30]=N):N=e[30];let T;e[31]!==n||e[32]!==N||e[33]!==$||e[34]!==A?(T=r.jsxs("div",{className:"flex items-center justify-between",children:[$,A,N,n]}),e[31]=n,e[32]=N,e[33]=$,e[34]=A,e[35]=T):T=e[35];let I;return e[36]!==T||e[37]!==R?(I=r.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 z-1 mx-[1px] rounded-t-[22px] rounded-b-lg backdrop-blur-md",children:r.jsxs("div",{className:E,children:[R,T]})}),e[36]=T,e[37]=R,e[38]=I):I=e[38],I},xn={hr:"mx-4 my-0! border-0 border-t !border-token-border-light sm:mx-[1px]"},Sh=({children:t,hasBeenEdited:e,messageId:s,clientThreadId:n,messageRef:o,shouldShowWritingBlockCanvasEdit:a=!1,isInlineWritingBlockEditEnabled:i,isInlineWritingBlockExportEnabled:l,writingBlock:c,index:d,onChange:f,isStreaming:u,autosaveStatus:g,title:p,recipient:x,setDirty:w,flushPendingChanges:S,contentReferences:h})=>{var B,W,X;const M=Qn(n),[v,k]=m.useState((B=c.title)!=null?B:""),[j,y]=m.useState(String((X=(W=c.metadata)==null?void 0:W.recipient)!=null?X:"")),E=_e(),C=ao(f,300),_=m.useCallback(H=>{w(!0),k(H.target.value),C({title:H.target.value})},[C,w]),R=m.useCallback(H=>{w(!0),y(H.target.value),C({metadata:{recipient:H.target.value}})},[C,w]),$=m.useCallback(H=>{w(!0),C({title:H.target.value}),C.flush(),S==null||S()},[C,S,w]),A=m.useCallback(H=>{w(!0),C({metadata:{recipient:H.target.value}}),C.flush(),S==null||S()},[C,S,w]),N=m.useCallback(H=>{const b=encodeURIComponent(pu(c.content)),P=encodeURIComponent(j),L=encodeURIComponent(v);switch(H){case"gmail":return"https://mail.google.com/mail/u/0/?tf=cm&to=".concat(P,"&su=").concat(L,"&body=").concat(b);case"outlook":return"https://outlook.office.com/mail/deeplink/compose?to=".concat(P,"&subject=").concat(L,"&body=").concat(b);case"default":return"mailto:".concat(j,"?subject=").concat(L,"&body=").concat(b)}},[j,v,c.content]),T=r.jsx(q,{id:"PrFQxx",defaultMessage:"Email"}),I=r.jsx(im,{clientThreadId:n,messageId:s,onClick:H=>window.open(N(H),"_blank")});return r.jsxs("div",{ref:o,id:"writing-block-".concat(s),className:D(zn,"pt-0.5 pb-3"),"data-writing-block":!0,children:[r.jsx(ni,{primaryLabel:T,primaryAction:I,writingBlock:c,clientThreadId:n,messageId:s,title:p,hideDownloadButton:!0,isInlineWritingBlockEditEnabled:i,hasBeenEdited:e,autosaveStatus:g,shouldShowWritingBlockCanvasEdit:a,isInlineWritingBlockExportEnabled:l,serverThreadId:M,index:d,messageRef:o,contentReferences:h}),r.jsx("hr",{className:xn.hr}),r.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[r.jsx("div",{className:"font-medium",children:r.jsx(q,{id:"NPvnYL",defaultMessage:"To"})}),r.jsx("input",{disabled:u||!i,className:D(Qo),maxLength:240,placeholder:E.formatMessage({id:"12HHUV",defaultMessage:"name@email.com"}),value:u?x:j,onChange:R,onBlur:A,onCopy:H=>H.stopPropagation()})]}),r.jsx("hr",{className:xn.hr}),r.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[r.jsx("div",{className:"font-medium",children:r.jsx(q,{id:"eQGtfX",defaultMessage:"Subject"})}),r.jsx("input",{disabled:u||!i,className:D(Qo),value:u?p:v,maxLength:240,onChange:_,onBlur:$,onCopy:H=>H.stopPropagation()})]}),r.jsx("hr",{className:D(xn.hr,"mb-4!")}),r.jsx(si,{isInlineWritingBlockEditEnabled:i,writingBlock:c,onChange:f,isStreaming:u,setDirty:w,flushPendingChanges:S,contentReferences:h,children:t})]})};function Mh({serverThreadId:t,index:e,messageId:s,writingBlock:n,dirty:o,setDirty:a,delay:i=2e3}){const[l,c]=m.useState(!1),[d,f]=m.useState(null),[u,g]=m.useState(null),[p,x]=m.useState(!1),[w,S]=m.useState(!1),h=m.useRef(0),M=m.useRef(n.content),v=m.useRef(n.title),k=m.useRef(n.metadata),j=m.useRef(!1),y=m.useRef(!1),E=m.useRef(0),C=m.useRef(null),{mutate:_}=Vn({mutationFn:async({content:T,title:I,metadata:B})=>{h.current+=1,h.current>1&&S(!0),!(!t||!s)&&await Xs.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:s,conversation_id:t,index:String(e),id:n.id,writing_block:{content:T,index:String(e),variant:n.variant.toString(),metadata:B,title:I,id:n.id},updated_at:new Date().toISOString()},authOption:Yn.SendIfAvailable})},onSuccess:(T,I,B)=>{C.current===(B==null?void 0:B.myVersion)&&(a(!1),g(new Date))},onMutate:()=>{h.current=0,S(!1);const T=++E.current;return C.current=T,c(!0),f(null),{myVersion:T}},onError:(T,I,B)=>{f(T.message),a(!0)},onSettled:(T,I,B,W)=>{h.current=0,S(!1),C.current===(W==null?void 0:W.myVersion)&&(c(!1),C.current=null,j.current&&R.flush())},retry:1,retryDelay:3e3}),R=ao(({content:T,title:I,metadata:B})=>{j.current=!1,x(!1),_({content:T,title:I,metadata:B})},i);m.useEffect(()=>{var T;if(n.content===M.current&&n.title===v.current&&n.metadata===k.current){y.current=!1;return}M.current=n.content,v.current=n.title,k.current=n.metadata,j.current=!0,x(!0),R({content:n.content,title:n.title,metadata:(T=n.metadata)!=null?T:{}}),y.current&&(Promise.resolve().then(()=>{R.flush()}),y.current=!1)},[n.content,n.title,n.metadata,R]),m.useEffect(()=>()=>{R.cancel(),y.current=!1,x(!1)},[R]);const $=m.useCallback(()=>{if(!o&&!j.current){y.current=!1,x(!1);return}y.current=!0,j.current&&(R.flush(),y.current=!1,x(!1))},[o,R]),A=m.useMemo(()=>!!u&&!o&&!l,[u,o,l]);return{status:m.useMemo(()=>w?"retrying":l?"saving":d?"error":p?"queued":o?"dirty":A?"saved":"idle",[w,l,d,p,o,A]),savedAt:u,error:d,flushPendingChanges:$}}const Ch=()=>({editWritingBlock:m.useCallback(({content:e,clientThreadId:s,message:n,index:o,variant:a,metadata:i,title:l,id:c})=>{var d,f;(f=(d=n.metadata)==null?void 0:d.writing_blocks)!=null&&f[c]||st.logEventWithStatsig("ChatGPT Writing Block First Edit","chatgpt_writing_block_first_edit",z({},hs({clientThreadId:s,messageId:n.id}))),Al(s,u=>Ll.updateTree(u,g=>{var p,x;return g.updateNodeMessageMetadata(n.id,{writing_blocks:Q(z({},(x=(p=n.metadata)==null?void 0:p.writing_blocks)!=null?x:{}),{[c]:{id:c,index:o,content:e,variant:a,title:l,metadata:i}})})}))},[])}),Eh=t=>{"use forget";var U,G,te,oe,re,me,he,ie,pe,Ee,Se,O;const e=je.c(82),{title:s,children:n,originalContent:o,messageId:a,variant:i,recipient:l,isStreaming:c,index:d,id:f}=t,u=Dl(),[g,p]=m.useState(!1),x=Jn(so.EditInCanvas),w=Me();let S;e[0]!==w?(S=Pe(w,"669593727"),e[0]=w,e[1]=S):S=e[1];const h=S;let M;e[2]!==u?(M=()=>u==null?void 0:u.serverId$(),e[2]=u,e[3]=M):M=e[3];const v=rt(M);let k;e[4]!==a?(k=F=>a?ft.getNode(F,a).message:void 0,e[4]=a,e[5]=k):k=e[5];let j;e[6]===Symbol.for("react.memo_cache_sentinel")?(j={disablePerfDetector:!0},e[6]=j):j=e[6];const y=us(u==null?void 0:u.id,k,j),E=(G=(U=y==null?void 0:y.metadata)==null?void 0:U.writing_blocks)==null?void 0:G[f];E==null||E.metadata;let C;e[7]!==l||e[8]!==(E==null?void 0:E.metadata)?(C=(te=E==null?void 0:E.metadata)!=null?te:{recipient:l!=null?l:null},e[7]=l,e[8]=E==null?void 0:E.metadata,e[9]=C):C=e[9];const _=C,R=!!E,{editWritingBlock:$}=Ch(),A=Js(),N=v!=null&&!A;let T;e[10]!==f||e[11]!==d||e[12]!==((oe=y==null?void 0:y.metadata)==null?void 0:oe.writing_blocks)||e[13]!==_||e[14]!==o||e[15]!==s||e[16]!==i?(T=(he=(me=(re=y==null?void 0:y.metadata)==null?void 0:re.writing_blocks)==null?void 0:me[f])!=null?he:{id:f,content:o,index:d,variant:i,title:s,metadata:_},e[10]=f,e[11]=d,e[12]=(ie=y==null?void 0:y.metadata)==null?void 0:ie.writing_blocks,e[13]=_,e[14]=o,e[15]=s,e[16]=i,e[17]=T):T=e[17];const I=T;let B;e[18]!==((pe=y==null?void 0:y.metadata)==null?void 0:pe.content_references)?(B=(Se=(Ee=y==null?void 0:y.metadata)==null?void 0:Ee.content_references)!=null?Se:[],e[18]=(O=y==null?void 0:y.metadata)==null?void 0:O.content_references,e[19]=B):B=e[19];const W=B;let X;e[20]!==g||e[21]!==d||e[22]!==a||e[23]!==v||e[24]!==I?(X={serverThreadId:v,index:d,messageId:a,dirty:g,setDirty:p,writingBlock:I},e[20]=g,e[21]=d,e[22]=a,e[23]=v,e[24]=I,e[25]=X):X=e[25];const{status:H,flushPendingChanges:b}=Mh(X);let P;e[26]!==(u==null?void 0:u.id)||e[27]!==$||e[28]!==f||e[29]!==d||e[30]!==y||e[31]!==_||e[32]!==i||e[33]!==I?(P=F=>{const{content:V,title:Z,metadata:Y}=F;!(u!=null&&u.id)||!y||!y.id||$({content:V!=null?V:I.content,clientThreadId:u==null?void 0:u.id,message:y,index:d,variant:i,metadata:Object.assign({},_,Y),title:Z!=null?Z:I.title,id:f})},e[26]=u==null?void 0:u.id,e[27]=$,e[28]=f,e[29]=d,e[30]=y,e[31]=_,e[32]=i,e[33]=I,e[34]=P):P=e[34],u==null||u.id;const L=P,K=m.useRef(null);switch(i){case Fs.EMAIL:{const F=u==null?void 0:u.id,V=s!=null?s:"",Z=l!=null?l:"";let Y;return e[35]!==H||e[36]!==n||e[37]!==W||e[38]!==b||e[39]!==L||e[40]!==R||e[41]!==d||e[42]!==h||e[43]!==c||e[44]!==N||e[45]!==a||e[46]!==x||e[47]!==F||e[48]!==V||e[49]!==Z||e[50]!==I?(Y=r.jsx(Sh,{hasBeenEdited:R,messageRef:K,clientThreadId:F,messageId:a,index:d,shouldShowWritingBlockCanvasEdit:x,isInlineWritingBlockEditEnabled:N,isInlineWritingBlockExportEnabled:h,onChange:L,writingBlock:I,isStreaming:c,autosaveStatus:H,title:V,recipient:Z,setDirty:p,flushPendingChanges:b,contentReferences:W,children:n}),e[35]=H,e[36]=n,e[37]=W,e[38]=b,e[39]=L,e[40]=R,e[41]=d,e[42]=h,e[43]=c,e[44]=N,e[45]=a,e[46]=x,e[47]=F,e[48]=V,e[49]=Z,e[50]=I,e[51]=Y):Y=e[51],Y}default:{if(c&&i===Fs.UNKNOWN&&o===""){const be="writing-block-".concat(a);let ce;e[52]===Symbol.for("react.memo_cache_sentinel")?(ce=D(zn,"px-4 py-2","h-10"),e[52]=ce):ce=e[52];let ge;return e[53]!==be?(ge=r.jsx("div",{ref:K,id:be,className:ce,"data-writing-block":!0}),e[53]=be,e[54]=ge):ge=e[54],ge}const F="writing-block-".concat(a);let V;e[55]===Symbol.for("react.memo_cache_sentinel")?(V=D(zn,"pt-0.5 pb-3"),e[55]=V):V=e[55];const Z=u==null?void 0:u.id;let Y;e[56]!==H||e[57]!==W||e[58]!==R||e[59]!==d||e[60]!==h||e[61]!==N||e[62]!==a||e[63]!==v||e[64]!==x||e[65]!==Z||e[66]!==s||e[67]!==I?(Y=r.jsx(ni,{hasBeenEdited:R,autosaveStatus:H,writingBlock:I,clientThreadId:Z,messageId:a,isInlineWritingBlockExportEnabled:h,isInlineWritingBlockEditEnabled:N,serverThreadId:v,shouldShowWritingBlockCanvasEdit:x,title:s,index:d,messageRef:K,contentReferences:W}),e[56]=H,e[57]=W,e[58]=R,e[59]=d,e[60]=h,e[61]=N,e[62]=a,e[63]=v,e[64]=x,e[65]=Z,e[66]=s,e[67]=I,e[68]=Y):Y=e[68];let ue;e[69]===Symbol.for("react.memo_cache_sentinel")?(ue=r.jsx("hr",{className:"border-token-border-light! mx-4 my-0! mb-3! border-0 border-t sm:mx-[1px]"}),e[69]=ue):ue=e[69];let le;e[70]!==n||e[71]!==W||e[72]!==b||e[73]!==L||e[74]!==c||e[75]!==N||e[76]!==I?(le=r.jsx(si,{setDirty:p,isInlineWritingBlockEditEnabled:N,writingBlock:I,onChange:L,isStreaming:c,flushPendingChanges:b,contentReferences:W,children:n}),e[70]=n,e[71]=W,e[72]=b,e[73]=L,e[74]=c,e[75]=N,e[76]=I,e[77]=le):le=e[77];let fe;return e[78]!==F||e[79]!==Y||e[80]!==le?(fe=r.jsxs("div",{ref:K,id:F,className:V,"data-writing-block":!0,children:[Y,ue,le]}),e[78]=F,e[79]=Y,e[80]=le,e[81]=fe):fe=e[81],fe}}},Nh=ne(()=>se(()=>import("./rsi9kppw43ykrsgk.js").then(t=>t._),__vite__mapDeps([34,1])),{loading:t=>ae(t)});function Th({metadata:t,trackContentReferenceEvent:e}){var i;const s=Li(),n=Me(),o=Js(),a=Pe(n,"3375735072");return m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type,{checkout_id:t.checkout_id})},[e,t.type,t.checkout_id]),a?r.jsxs("div",{className:"border-token-border-default bg-token-bg-primary not-prose mb-6 flex max-w-[420px] flex-col gap-4 rounded-[20px] border py-4 shadow-[0px_4px_16px_0px_rgba(0,_0,_0,_0.05)]","data-order-id":t.checkout_id,role:"group",children:[r.jsxs("div",{className:"flex items-center gap-2 px-4 text-sm font-medium",children:[r.jsx(Nh,{className:"icon-lg text-green-400"}),r.jsx(q,{id:"checkout_purchase_confirmation_status",defaultMessage:"Purchase complete"})]}),r.jsxs("div",{className:"border-token-border-light flex items-start gap-3 border-b px-4 pb-4",children:[r.jsx("div",{className:"flex-shrink-0 overflow-hidden rounded-xl bg-gray-100 dark:bg-gray-700",children:r.jsx("img",{src:t.product_image_urls[0],alt:t.title,className:"m-0 aspect-square h-32 w-32 object-cover mix-blend-darken dark:mix-blend-lighten"})}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("div",{className:"line-clamp-2 min-h-6 text-base leading-snug font-medium",title:t.title,children:t.title}),r.jsx("div",{className:"text-token-text-secondary text-[13px] leading-snug whitespace-pre-wrap",children:t.subtitle})]})]}),t.error_message&&r.jsx("div",{className:"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default mx-4 flex items-center rounded-lg px-3 py-1 text-sm",children:t.error_message}),r.jsx("dl",{className:"space-y-1 px-4",children:(i=t.details)==null?void 0:i.map(l=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("dt",{className:"text-token-text-secondary flex-grow text-[13px] font-medium",children:l.label}),r.jsx("dd",{className:"text-token-text-primary text-[13px] font-medium",children:l.value})]},l.label))}),!o&&r.jsx("div",{className:"px-4",children:r.jsx(Ve,{fullWidth:!0,color:"secondary",className:"rounded-2xl border",onClick:()=>{s("#settings/".concat(Ol.Orders,"?order=").concat(t.checkout_id))},children:r.jsx(q,{id:"2Dn5nu",defaultMessage:"View details"})})})]}):null}const xr=4;function Ih({metadata:t,analyticsMetadata:e,trackContentReferenceEvent:s,imageSource:n,superWidgetContent:o,isFirstAssistantContent:a}){const i=n!=null?n:St.Turn,l=xs(),c=Me(),d=at(c),f=m.useMemo(()=>{if(!d||!o)return t.images;const h=o.widgets.images;return _a(t.images.concat(h),M=>M.thumbnail_url)},[t.images,d,o]),u=t.images.some(h=>h.is_proxied_image)?[]:f.map(h=>h.thumbnail_url),g=Di({queries:u.map(h=>kd(h,"_ImageCarousel")),combine:h=>{const M=new Set;return h.forEach((v,k)=>{v.isSuccess&&M.add(u[k])}),M}}),p=f.filter(h=>g.has(h.thumbnail_url)),x=t.images.length;if(t.images.some(h=>h.is_proxied_image)){const h=t.images.find(v=>v.is_proxied_image),M=D("mb-7 mt-1 min-w-32 max-w-[22%] rounded-xl border-[0.5px] border-token-border-default",h!=null&&h.float_top?"relative block":"float-image z-10 float-end clear-end ms-7 overflow-hidden");return r.jsx(nt,{image:h,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"deepResearch"},aspectRatio:$s,className:M,contentReferenceType:"image_v2"},h==null?void 0:h.content_url)}if(x===0)return null;if(x===1){const h=t.images[0];return r.jsx(nt,{image:h,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:$s,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 max-w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]",contentReferenceType:"image_v2"},h.content_url)}const w=d?null:xr,S=l||w==null?p.length:Math.min(p.length,w);return p.length>xr&&d?r.jsx(Rh,{images:p.slice(0,S),imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,isFirstAssistantContent:a}):r.jsx("div",{className:"no-scrollbar mt-1 mb-6 flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",children:p.slice(0,S).map((h,M)=>r.jsx("div",{className:D("border-token-border-default relative aspect-square w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-48 sm:w-[calc((100%-0.5rem)/4)]",M===0&&"rounded-s-xl",M===S-1&&"rounded-e-xl"),children:r.jsx(nt,{image:h,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:$s,className:"h-full w-full",contentReferenceType:"image_v2"},h.thumbnail_url)},h.thumbnail_url))})}const ho=m.memo(Ih,(t,e)=>t.numImageResults===e.numImageResults&&t.analyticsMetadata===e.analyticsMetadata&&t.trackContentReferenceEvent===e.trackContentReferenceEvent&&t.metadata.images.length===e.metadata.images.length&&t.metadata.images.every((s,n)=>s.content_url===e.metadata.images[n].content_url));function nt({image:t,imageSource:e,className:s,imgClassName:n,style:o,analyticsMetadata:a,trackContentReferenceEvent:i,eventMetadata:l={},badge:c,lightboxImages:d,aspectRatio:f,enableHoverAnimation:u=!0,fadeInOnMount:g,skeletonEl:p,contentReferenceType:x}){var $,A;const w=jd(t,{width:Sd,aspectRatio:f!=null?f:void 0}),S=t==null?void 0:t.content_url.replace(/^http:\/\//,"https://"),h=Lh(t),{isSuccess:M}=Rn(w,"ImageCarousel_thumbnail"),{isSuccess:v,isError:k}=Rn(h?S:void 0,"ImageCarousel_full"),j=m.useMemo(()=>z({image_url:w,title:t==null?void 0:t.title},l),[w,t==null?void 0:t.title,l]);m.useEffect(()=>{t&&M&&i("Search Content Reference Shown","search_content_reference_shown",x,j)},[i,t,M,j,x]),m.useEffect(()=>{S&&k&&Vt.addAction("Failed to download full image",{url:S,thumbnailUrl:w})},[S,k,w]);const y=no.useStore(),E=Md(($=t==null?void 0:t.thumbnail_crop_info)!=null?$:null,(A=t==null?void 0:t.thumbnail_size)!=null?A:null,f!=null?f:void 0),C=!t||!(M||v||t.is_proxied_image),_=(()=>{if(!C)return t.is_proxied_image?t.url:h&&v?S:w})(),R=z(z({},o),f?{aspectRatio:"".concat(f.width,"/").concat(f.height)}:{});return r.jsxs("button",{className:D("relative overflow-hidden",s),style:R,onClick:()=>{i("Search Content Reference Clicked","search_content_reference_clicked",x,j),y.setCurrentImage(t?{image:t,source:e,analyticsMetadata:a,imageResults:d}:void 0)},children:[Ph({isLoading:C,enableHoverAnimation:u,fadeInOnMount:g,src:_,image:t,objectPosition:E,className:n,skeletonEl:p}),c&&r.jsx("div",{className:"pointer-events-none absolute end-2 bottom-2",children:c})]})}function Ph({isLoading:t,enableHoverAnimation:e,fadeInOnMount:s,src:n,image:o,objectPosition:a,className:i,skeletonEl:l}){if(t)return l!=null?l:r.jsx("div",{className:"bg-token-main-surface-tertiary aspect-square h-full w-full animate-pulse"});const c=r.jsx(rs.img,{src:n,alt:o==null?void 0:o.content_url,style:a?{objectPosition:a}:{},className:D("bg-token-main-surface-tertiary m-0 h-full w-full object-cover",i),initial:s?{opacity:0}:!1,animate:{opacity:1},transition:s?{duration:.3,ease:"easeInOut"}:void 0});return e?r.jsx(za,{children:c}):c}function Rh(t){"use forget";const e=je.c(15),{images:s,imageSource:n,analyticsMetadata:o,trackContentReferenceEvent:a,isFirstAssistantContent:i}=t,l=Me();let c;e[0]!==l?(c=()=>Zs(l),e[0]=l,e[1]=c):c=e[1];const d=rt(c),f=Ah,u=i&&"mt-2",g=d?"-mx-[var(--thread-content-margin)]":"-mx-6";let p;e[2]!==u||e[3]!==g?(p=D("relative mb-6",u,g),e[2]=u,e[3]=g,e[4]=p):p=e[4];let x;e[5]!==o||e[6]!==n||e[7]!==a?(x=h=>r.jsx(nt,{image:h,imageSource:n,analyticsMetadata:o,trackContentReferenceEvent:a,className:"aspect-auto h-full w-full",aspectRatio:null,contentReferenceType:"image_v2"}),e[5]=o,e[6]=n,e[7]=a,e[8]=x):x=e[8];let w;e[9]!==s||e[10]!==x?(w=r.jsx(nn,{items:s,getItemKey:$h,itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)]",getItemStyle:f,onRenderItem:x,className:"h-48 min-h-48"}),e[9]=s,e[10]=x,e[11]=w):w=e[11];let S;return e[12]!==p||e[13]!==w?(S=r.jsx("div",{className:p,children:w}),e[12]=p,e[13]=w,e[14]=S):S=e[14],S}function $h(t){return t.thumbnail_url}function Ah(t){const{width:e,height:s}=t.content_size;return{width:s?e/s*192:180}}function Lh(t){return!t||t.is_proxied_image?!1:t.thumbnail_url.includes("images.openai.com")}const br=4,oi=5;function Dh(t){"use forget";var E,C,_,R;const e=je.c(29),{images:s,lastUserMsgOfPrevTurn:n,superWidgetContent:o,isContentReferenceComplete:a}=t,i=Me();let l;e[0]!==i?(l=at(i),e[0]=i,e[1]=l):l=e[1];const c=l;let d;e[2]!==n?(d=n?wa(n):null,e[2]=n,e[3]=d):d=e[3];const f=d,u=(C=(E=o==null?void 0:o.widgets)==null?void 0:E.query)!=null?C:"";let g;e[4]!==f||e[5]!==u?(g=((R=(_=u==null?void 0:u.trim())==null?void 0:_.length)!=null?R:0)>0?u:f,e[4]=f,e[5]=u,e[6]=g):g=e[6];const p=g;let x;e[7]!==i||e[8]!==s.length||e[9]!==c||e[10]!==p?(x=()=>{!c||s.length>=br||!p||Pa(i,p,"images")},e[7]=i,e[8]=s.length,e[9]=c,e[10]=p,e[11]=x):x=e[11];let w;e[12]!==i||e[13]!==s.length||e[14]!==c||e[15]!==n||e[16]!==p||e[17]!==o?(w=[i,c,n,p,s.length,o],e[12]=i,e[13]=s.length,e[14]=c,e[15]=n,e[16]=p,e[17]=o,e[18]=w):w=e[18],m.useEffect(x,w);let S;e[19]!==c||e[20]!==p?(S=$=>{var T,I;if(!c||!p)return[[],!1];const N=(T=$.entries[p])!=null?T:Ra;return[(I=N.images)!=null?I:[],$a(N,"images")]},e[19]=c,e[20]=p,e[21]=S):S=e[21];const[h,M]=Ia(S);let v;if(e[22]!==s||e[23]!==a||e[24]!==h){const $=s.map(Bh).filter(zh);v=a&&s.every(Fh)&&s.length<br?_a($.concat(h.slice(0,oi)),Oh):$,e[22]=s,e[23]=a,e[24]=h,e[25]=v}else v=e[25];const k=v,j=a&&M;let y;return e[26]!==k||e[27]!==j?(y={items:k,isLoading:j},e[26]=k,e[27]=j,e[28]=y):y=e[28],y}function Oh(t){return t.thumbnail_url}function Fh(t){return!!t.image_result}function zh(t){return!!t}function Bh(t){return t.image_result?{title:t.image_result.title,url:t.image_result.url,content_url:t.image_result.content_url,thumbnail_url:t.image_result.thumbnail_url,content_size:t.image_result.content_size,thumbnail_size:t.image_result.thumbnail_size}:null}const Wh=ne(()=>se(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yt),__vite__mapDeps([12,1,8,9,13])),{loading:t=>ae(t)});function ri({numImages:t}){return r.jsxs("div",{className:"flex items-center gap-1 rounded-full px-2 py-1.5 text-white backdrop-blur-md backdrop-brightness-75",children:[r.jsx(Wh,{className:"h-4 w-4"}),r.jsx("span",{className:"text-xs font-semibold",children:t})]})}const Hh=ne(()=>se(()=>import("./jyroje0qaxw6h3z1.js").then(t=>t._),__vite__mapDeps([35,1])),{loading:t=>ae(t)}),Uh=ne(()=>se(()=>import("./frf0wu8ouyfyu06j.js").then(t=>t._),__vite__mapDeps([36,1])),{loading:t=>ae(t)});function Gh(t){"use forget";const e=je.c(70),{images:s,className:n,aspect:o,objectPosition:a,showArrows:i,imageClassName:l,slideClassName:c,gap:d,peekPercent:f,showDots:u,onClick:g}=t,p=n===void 0?"":n,x=o===void 0?"aspect-[16/9]":o,w=a===void 0?"object-cover":a,S=i===void 0?!0:i,h=l===void 0?"":l,M=c===void 0?"":c,v=d===void 0?2:d,k=f===void 0?95:f,j=u===void 0?!1:u,[y,E]=m.useState(0),[C,_]=m.useState(!1),R=m.useRef(null);let $;e[0]===Symbol.for("react.memo_cache_sentinel")?($=[],e[0]=$):$=e[0];const A=m.useRef($),N=m.useRef(null),T=_e(),I=s.length;let B;e[1]!==k?(B=Dt(k,0,100),e[1]=k,e[2]=B):B=e[2];const W=B,X="".concat(W,"%");let H;e[3]!==X?(H={maxWidth:X},e[3]=X,e[4]=H):H=e[4];const b=H;let P;e[5]!==I?(P=(ee,J)=>{const ve=A.current[ee];if(!ve)return 0;const xe=ve.offsetLeft,Ce=xe+ve.offsetWidth,Ie=J.clientWidth,Ne=Math.max(0,J.scrollWidth-Ie);if(I<=1||ee===0)return Dt(xe,0,Ne);if(ee===I-1){const Oe=Ce-Ie;return Dt(Oe,0,Ne)}const We=xe-(Ie-ve.offsetWidth)/2;return Dt(We,0,Ne)},e[5]=I,e[6]=P):P=e[6];const L=P;let K;e[7]!==L||e[8]!==I?(K=(ee,J)=>{const ve=J===void 0?"smooth":J;if(I===0||ee<0||ee>=I)return;const xe=R.current;if(!xe)return;const Ce=L(ee,xe);if(_r(xe.scrollLeft,Ce)){ve!=="auto"&&xe.scrollTo({left:Ce,behavior:"auto"}),N.current=null;return}N.current=Ce,xe.scrollTo({left:Ce,behavior:ve})},e[7]=L,e[8]=I,e[9]=K):K=e[9];const U=K,G=C&&y!==0,te=C;let oe;e[10]!==y||e[11]!==U||e[12]!==I?(oe=ee=>{if(I===0)return;const J=Dt(ee,0,I-1);U(J,"smooth"),J!==y&&E(J)},e[10]=y,e[11]=U,e[12]=I,e[13]=oe):oe=e[13];const re=oe;let me;e[14]!==re||e[15]!==y||e[16]!==I?(me=()=>{if(I!==0){if(y>=I-1){re(0);return}re(y+1)}},e[14]=re,e[15]=y,e[16]=I,e[17]=me):me=e[17];const he=me;let ie;e[18]!==re||e[19]!==y?(ie=()=>re(y-1),e[18]=re,e[19]=y,e[20]=ie):ie=e[20];const pe=ie;let Ee,Se;e[21]!==L||e[22]!==y||e[23]!==I?(Ee=()=>{const ee=R.current;if(!ee)return;const J=()=>{const ve=ee.scrollLeft||0,xe=N.current;if(xe!=null){_r(ve,xe)&&(N.current=null);return}let Ce=y,Ie=Number.POSITIVE_INFINITY;for(let Ne=0;Ne<I;Ne++){const We=L(Ne,ee),Oe=Math.abs(We-ve);Oe<Ie-.5&&(Ie=Oe,Ce=Ne)}Ce!==y&&E(Ce)};return ee.addEventListener("scroll",J,{passive:!0}),()=>ee.removeEventListener("scroll",J)},Se=[I,y,L],e[21]=L,e[22]=y,e[23]=I,e[24]=Ee,e[25]=Se):(Ee=e[24],Se=e[25]),m.useEffect(Ee,Se);let O,F;e[26]!==C||e[27]!==he||e[28]!==pe||e[29]!==I?(O=()=>{if(!C)return;const ee=J=>{if(J.defaultPrevented||J.altKey||J.ctrlKey||J.metaKey||J.shiftKey)return;const ve=J.target;if(ve instanceof HTMLElement){if(ve.isContentEditable)return;const xe=ve.tagName;if(xe==="INPUT"||xe==="TEXTAREA"||xe==="SELECT")return;const Ce=ve.getAttribute("role");if(Ce==="textbox"||Ce==="combobox")return}I<=1||(J.key==="ArrowRight"?(J.preventDefault(),he()):J.key==="ArrowLeft"&&(J.preventDefault(),pe()))};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},F=[C,I,he,pe],e[26]=C,e[27]=he,e[28]=pe,e[29]=I,e[30]=O,e[31]=F):(O=e[30],F=e[31]),m.useEffect(O,F);const V="select-none ".concat(p," relative");let Z,Y;e[32]===Symbol.for("react.memo_cache_sentinel")?(Z=()=>_(!0),Y=()=>_(!1),e[32]=Z,e[33]=Y):(Z=e[32],Y=e[33]);const ue="relative w-full ".concat(x," overflow-clip");let le;e[34]!==v?(le={gap:v},e[34]=v,e[35]=le):le=e[35];let fe;e[36]!==h||e[37]!==s||e[38]!==T||e[39]!==w||e[40]!==g||e[41]!==M||e[42]!==I||e[43]!==b?(fe=s.map((ee,J)=>{var ve;return r.jsx("div",{onClick:()=>g==null?void 0:g(ee,J),ref:xe=>{A.current[J]=xe},className:D("relative flex h-full shrink-0 grow-0 snap-always items-stretch",J===0&&"snap-start",J===I-1&&"snap-end",J>0&&J<I-1&&"snap-center",M),style:b,children:ee.content?ee.content:r.jsx("img",{src:ee.src,alt:(ve=ee.alt)!=null?ve:T.formatMessage({id:"wHCsqa",defaultMessage:"Slide {index}"},{index:J+1}),className:"h-full w-auto ".concat(w," ").concat(h)})},J)}),e[36]=h,e[37]=s,e[38]=T,e[39]=w,e[40]=g,e[41]=M,e[42]=I,e[43]=b,e[44]=fe):fe=e[44];let be;e[45]!==le||e[46]!==fe?(be=r.jsx("div",{ref:R,className:"no-scrollbar flex h-full w-full touch-pan-x snap-x snap-mandatory overflow-x-scroll scroll-smooth",style:le,children:fe}),e[45]=le,e[46]=fe,e[47]=be):be=e[47];let ce;e[48]!==s.length||e[49]!==T||e[50]!==G||e[51]!==he||e[52]!==pe||e[53]!==te||e[54]!==S?(ce=S&&s.length>1&&r.jsxs(r.Fragment,{children:[r.jsx(wr,{ariaLabel:T.formatMessage({id:"l9pylv",defaultMessage:"Previous slide"}),onClick:pe,side:"start",visible:G,children:r.jsx(Uh,{className:"icon-md"})}),r.jsx(wr,{ariaLabel:T.formatMessage({id:"L0pbQh",defaultMessage:"Next slide"}),onClick:he,side:"end",visible:te,children:r.jsx(Hh,{className:"icon-md"})})]}),e[48]=s.length,e[49]=T,e[50]=G,e[51]=he,e[52]=pe,e[53]=te,e[54]=S,e[55]=ce):ce=e[55];let ge;e[56]!==re||e[57]!==s||e[58]!==y||e[59]!==T||e[60]!==j?(ge=j&&s.length>1&&s.length<=20&&r.jsx("div",{className:"absolute start-0 end-0 bottom-3 flex items-center justify-center",children:r.jsx("div",{className:"flex w-fit items-center justify-center gap-2 rounded-full bg-[#0D0D0D66] bg-clip-padding p-1 backdrop-blur",children:s.map((ee,J)=>r.jsx("button",{onClick:()=>re(J),"aria-label":T.formatMessage({id:"PUV+4+",defaultMessage:"Go to slide {index}"},{index:J+1}),className:"h-1.5 w-1.5 rounded-full transition-opacity ".concat(J===y?"bg-white":"bg-gray-400 opacity-60")},J))})}),e[56]=re,e[57]=s,e[58]=y,e[59]=T,e[60]=j,e[61]=ge):ge=e[61];let we;e[62]!==ue||e[63]!==be||e[64]!==ce||e[65]!==ge?(we=r.jsxs("div",{className:ue,children:[be,ce,ge]}),e[62]=ue,e[63]=be,e[64]=ce,e[65]=ge,e[66]=we):we=e[66];let ke;return e[67]!==V||e[68]!==we?(ke=r.jsx("div",{className:V,"aria-roledescription":"carousel",onMouseEnter:Z,onMouseLeave:Y,children:we}),e[67]=V,e[68]=we,e[69]=ke):ke=e[69],ke}const yr={width:4,height:5};function Vh(t){"use forget";const e=je.c(7),{image:s}=t,n=yr.height/yr.width;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o={maxHeight:"calc(100cqw * ".concat(n,")")},e[0]=o):o=e[0];let a;e[1]!==s.alt||e[2]!==s.content||e[3]!==s.src?(a=s.content?s.content:r.jsx("img",{src:s.src,alt:s.alt,className:"h-full w-full object-cover"}),e[1]=s.alt,e[2]=s.content,e[3]=s.src,e[4]=a):a=e[4];let i;return e[5]!==a?(i=r.jsx("div",{className:"[container-type:inline-size] w-full overflow-hidden [font-size:0] leading-none",style:o,children:a}),e[5]=a,e[6]=i):i=e[6],i}function qh(t){"use forget";const e=je.c(4);if(t.images.length===0)return null;if(t.images.length===1){let n;return e[0]!==t.images[0]?(n=r.jsx(Vh,{image:t.images[0]}),e[0]=t.images[0],e[1]=n):n=e[1],n}let s;return e[2]!==t?(s=r.jsx(Gh,z({},t)),e[2]=t,e[3]=s):s=e[3],s}const Dt=(t,e,s)=>Math.min(Math.max(t,e),s),_r=(t,e,s=1)=>Math.abs(t-e)<=s;function wr(t){"use forget";const e=je.c(11),{ariaLabel:s,onClick:n,side:o,visible:a,children:i}=t,l=o==="start"?"start-0 justify-end":"end-0 justify-start",c=a?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none ";let d;e[0]!==l||e[1]!==c?(d=D("group absolute top-0 bottom-0 flex h-full w-12.5 cursor-pointer items-center transition-opacity duration-300",l,c),e[0]=l,e[1]=c,e[2]=d):d=e[2];let f;e[3]===Symbol.for("react.memo_cache_sentinel")?(f=D("btn-secondary active:bg-token-bg-tertiary group-hover:bg-token-bg-secondary flex h-8 w-8 items-center justify-center rounded-full bg-clip-padding shadow-sm group-hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!"),e[3]=f):f=e[3];let u;e[4]!==s||e[5]!==i?(u=r.jsx("button",{"aria-label":s,className:f,children:i}),e[4]=s,e[5]=i,e[6]=u):u=e[6];let g;return e[7]!==n||e[8]!==d||e[9]!==u?(g=r.jsx("div",{className:d,onClick:n,children:u}),e[7]=n,e[8]=d,e[9]=u,e[10]=g):g=e[10],g}const po="mt-1 mb-5 [&:not(:first-child)]:mt-4",Kh=/^image_group[\s\S]*$/;function Xh({contentReference:t,trackContentReferenceEvent:e,analyticsMetadata:s,superWidgetContent:n,lastUserMsgOfPrevTurn:o,isFirstAssistantTurn:a}){var g;const i=Me(),l=at(i),{images:c,layout:d="carousel"}=t,f=Kh.test((g=t.matched_text)!=null?g:""),u={images:c,trackContentReferenceEvent:e,analyticsMetadata:s,isReferenceComplete:f};return l&&a&&(d==="carousel"||d==="bento")&&n?r.jsx(ip,z({superWidgetContent:n,lastUserMsgOfPrevTurn:o,imageSource:St.ImageGroup},u)):d==="carousel"?r.jsx(op,z({},u)):d==="bento"?r.jsx(tp,z({},u)):d==="full_width"?r.jsx(ap,z({},u)):null}const Zh={width:9,height:5},Yh={width:21,height:9};function Jh(t){switch(t){case 0:return"rounded-se-md rounded-ee-md rounded-ss-xl rounded-es-xl";case 1:return"rounded-se-xl rounded-ee-md rounded-ss-md rounded-es-md";case 2:return"rounded-se-md rounded-ee-xl rounded-ss-md rounded-es-md";default:return""}}const Qh=(t,e)=>{var s;return t.image_result?t.image_result.content_url:"".concat((s=t.image_search_query)!=null?s:t.image_ref_id,"-").concat(e)};function ep({images:t,trackContentReferenceEvent:e,analyticsMetadata:s}){const o=Me(),i=at(o)?Yh:Zh,l={width:i.width/3,height:i.height/2};return r.jsx("div",{className:D("grid grid-flow-dense grid-cols-3 grid-rows-2 gap-1",po),style:{aspectRatio:"".concat(i.width,"/").concat(i.height)},children:t.map((c,d)=>{var g;if(d>=3)return null;const u=d===Math.min(3,t.length)-1&&t.length>3;return r.jsx(nt,{image:(g=c.image_result)!=null?g:void 0,imageSource:St.ImageGroup,className:D("border-token-border-default h-full w-full border-[0.5px]",d===0&&"col-span-2 row-span-2",Jh(d)),badge:u?r.jsx(ri,{numImages:t.length}):void 0,lightboxImages:t.map(p=>p.image_result).filter(p=>!!p),aspectRatio:l,trackContentReferenceEvent:e,eventMetadata:{imageUse:"imageGroup",layout:"bento"},analyticsMetadata:s,contentReferenceType:"image_group"},Qh(c,d))})})}const go=(t,e)=>t.images.length===e.images.length&&t.analyticsMetadata===e.analyticsMetadata&&t.trackContentReferenceEvent===e.trackContentReferenceEvent&&t.images.every((s,n)=>{var o,a;return((o=s.image_result)==null?void 0:o.content_url)===((a=e.images[n].image_result)==null?void 0:a.content_url)}),tp=m.memo(ep,go),sp=3,bn={width:5,height:4};function np({images:t,analyticsMetadata:e,trackContentReferenceEvent:s,isReferenceComplete:n}){var c;const o=xs(),a=t.length,i=t.map(d=>d.image_result).filter(d=>!!d);if(a===0)return null;if(a===1){const d=t[0];return!d.image_result&&!n?null:r.jsxs(r.Fragment,{children:[r.jsx("span",{"aria-hidden":!0,className:"clear-both m-0 block h-0 p-0"}),r.jsx(nt,{image:(c=d==null?void 0:d.image_result)!=null?c:void 0,imageSource:St.ImageGroup,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"single"},aspectRatio:$s,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]",contentReferenceType:"image_group"})]})}const l=o?t.length:Math.min(t.length,sp);return r.jsx("div",{className:D("no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",po),children:t.slice(0,l).map((d,f)=>{var g,p,x;const u=f===l-1;return r.jsx("div",{className:D("border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-64 sm:w-[calc((100%-0.5rem)/3)]",f===0&&"rounded-s-xl",u&&"rounded-e-xl"),style:{aspectRatio:"".concat(bn.width,"/").concat(bn.height)},children:r.jsx(nt,{image:(g=d.image_result)!=null?g:void 0,imageSource:St.ImageGroup,lightboxImages:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"carousel"},className:"h-full w-full",badge:u&&t.length>l&&r.jsx(ri,{numImages:t.length}),aspectRatio:bn,contentReferenceType:"image_group"})},(x=(p=d.image_result)==null?void 0:p.thumbnail_url)!=null?x:"".concat(d.image_search_query,"-").concat(d.image_ref_id,"-").concat(f))})})}const op=m.memo(np,go);function rp({images:t,analyticsMetadata:e,trackContentReferenceEvent:s}){var d;const n=io(),[o,a]=Fc({track:"height"}),i=(d=o==null?void 0:o.height)!=null?d:null,l=n==null?void 0:n.onFullWidthImageHeightChange;m.useEffect(()=>{!l||i==null||l(i)},[l,i]);const c=t.map(f=>{var u;return{content:r.jsx(nt,{image:(u=f.image_result)!=null?u:void 0,imageSource:St.ImageGroup,aspectRatio:null,enableHoverAnimation:!1,analyticsMetadata:e,trackContentReferenceEvent:s,skeletonEl:r.jsx("div",{className:"bg-token-main-surface-tertiary aspect-[3/2] h-full w-full animate-pulse"}),lightboxImages:t.map(g=>g.image_result).filter(g=>!!g),className:"h-full w-full",contentReferenceType:"image_group",fadeInOnMount:!0})}});return r.jsx("div",{ref:a,className:"-mx-6 mt-[calc(-1rem-3px)] pb-5",children:r.jsx(qh,{images:c,aspect:"aspect-[5/4]",showDots:!0})})}const ap=m.memo(rp,go);function ip(t){"use forget";const e=je.c(21),{images:s,imageSource:n,superWidgetContent:o,lastUserMsgOfPrevTurn:a,analyticsMetadata:i,trackContentReferenceEvent:l,isReferenceComplete:c}=t,d=Me(),f=at(d);let u;e[0]!==d?(u=()=>Zs(d),e[0]=d,e[1]=u):u=e[1];const g=rt(u);let p;e[2]!==s||e[3]!==c||e[4]!==a||e[5]!==o?(p={images:s,lastUserMsgOfPrevTurn:a,superWidgetContent:o,isContentReferenceComplete:c},e[2]=s,e[3]=c,e[4]=a,e[5]=o,e[6]=p):p=e[6];const{items:x,isLoading:w}=Dh(p),S=w&&f?oi:0,h=cp,M=g?"-mx-[var(--thread-content-margin)]":"-mx-6";let v;e[7]!==M?(v=D("relative mb-6",po,M),e[7]=M,e[8]=v):v=e[8];let k;e[9]!==i||e[10]!==n||e[11]!==x||e[12]!==l?(k=C=>r.jsx(nt,{image:C,imageSource:n,analyticsMetadata:i,trackContentReferenceEvent:l,className:"aspect-auto h-full w-full",aspectRatio:null,contentReferenceType:"image_group",lightboxImages:x}),e[9]=i,e[10]=n,e[11]=x,e[12]=l,e[13]=k):k=e[13];const j=x.length===0?4:S;let y;e[14]!==x||e[15]!==k||e[16]!==j?(y=r.jsx(nn,{items:x,getItemKey:lp,itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)]",loadingItemClassName:"min-w-[240px]",getItemStyle:h,onRenderItem:k,className:"h-48 min-h-48",numLoadingItems:j}),e[14]=x,e[15]=k,e[16]=j,e[17]=y):y=e[17];let E;return e[18]!==v||e[19]!==y?(E=r.jsx("div",{className:v,children:y}),e[18]=v,e[19]=y,e[20]=E):E=e[20],E}function lp(t){return t.thumbnail_url}function cp(t){const{width:e,height:s}=t.content_size;return{width:s?e/s*192:180}}const dp=200,up=100,Ns=es({id:"imagePill.screenshot",defaultMessage:"screenshot"}),ai="m-0 p-[2px] pe-1",fp=D(ai,"h-full rounded-lg object-contain"),mp=D(ai,"p-[4px]");function vr({image:t}){const[e,s]=m.useState(!1),n=no.useStore(),o=m.useRef(null),a=m.useRef(null),i=_e(),l=t==null?void 0:t.content_url,c=m.useMemo(()=>l?on(l,"hostname"):null,[l]),d=m.useCallback(()=>{o.current&&clearTimeout(o.current)},[]),f=m.useCallback(()=>{t&&(d(),s(!1),n.setCurrentImage({image:t}))},[n,t,d]),u=m.useCallback(()=>{a.current&&clearTimeout(a.current)},[]),g=m.useCallback(()=>{s(!1)},[s]),p=m.useCallback(S=>{S.stopPropagation(),u(),o.current=setTimeout(()=>{s(!0)},dp)},[u]),x=m.useCallback(S=>{S.stopPropagation(),d(),a.current=setTimeout(()=>{g()},up)},[d,g]);m.useEffect(()=>{e&&u()},[e,u]);const w=m.useMemo(()=>({onBlur:x,onMouseLeave:x,onMouseEnter:p,onFocus:p}),[x,p]);return t?r.jsxs("span",Q(z({onClick:f,className:"relative"},w),{children:[r.jsxs(kr,{isOpen:e,children:[r.jsx("img",{className:fp,src:t.thumbnail_url}),r.jsx("span",{children:c!=null?c:i.formatMessage(Ns)})]}),e&&r.jsx("div",{className:"absolute start-0 z-50",children:r.jsxs("div",Q(z({className:D("text-token-text-secondary border-token-border-light w-[256px] cursor-pointer px-3 pt-2 pb-3 text-sm shadow-md outline-[0.5px] outline-black/5",Fl)},w),{children:[r.jsxs(Et,{href:t.content_url,target:"_blank",rel:"noopener",className:"z-50 mb-2 flex items-center gap-2 hover:opacity-70",onClick:S=>S.stopPropagation(),children:[r.jsx(Rs,{url:t.content_url,className:"m-0 size-4 p-0",size:32}),c!=null?c:i.formatMessage(Ns)]}),r.jsx("img",{className:"border-token-border-light m-0 cursor-pointer rounded-lg object-contain p-0 outline-[0.5px] outline-black/5",src:t.thumbnail_url,alt:c!=null?c:i.formatMessage(Ns),onClick:S=>{S.preventDefault(),f()}})]}))})]})):r.jsxs(kr,{isOpen:!1,children:[r.jsx("span",{className:mp,children:r.jsx(fs,{})}),r.jsx("span",{children:c!=null?c:i.formatMessage(Ns)})]})}function kr(n){var o=n,{children:t,isOpen:e}=o,s=Le(o,["children","isOpen"]);return r.jsx("span",Q(z({className:D("ms-1 cursor-pointer","inline-flex max-w-full items-center","relative top-[0.2rem]","animate-[show_150ms_ease-in]")},s),{children:r.jsx("span",{className:D("text-token-text-secondary flex h-4.5 overflow-hidden rounded-xl bg-[#F4F4F4] pe-2 text-[0.5625em] font-medium dark:bg-[#303030]","hover:bg-token-text-primary! hover:text-token-text-inverted",e&&"bg-token-main-surface-tertiary text-token-text-secondary","transition-colors duration-150 ease-in-out","items-center justify-center"),children:t})}))}async function hp({conversationId:t,messageId:e,assetPointerLinks:s,sharedConversationLikeId:n}){return await Xs.safePost("/conversation/get_images_for_message",{requestBody:{conversation_id:t!=null?t:null,share_id:n!=null?n:null,message_id:e,asset_pointer_links:s},authOption:Yn.SendIfAvailable})}function pp({reference:t,conversationId:e,messageId:s,sharedConversationLikeId:n,isN7jupdMessage:o}){return Oi(z({queryKey:["inline-images",t,e,s],queryFn:async()=>{if(!t.asset_pointer_links||t.asset_pointer_links.length===0||!e&&!n)return{images:[],formats:[]};const i=await hp({conversationId:e,messageId:s,assetPointerLinks:t.asset_pointer_links,sharedConversationLikeId:n});for(let l=0;l<i.images.length;l++){const c=i.images[l],d=i.formats[l],f="image/".concat(d),u=gp(c,f);i.images[l]=u}return i}},o?{retry:3,retryDelay:5e3}:{}))}function gp(t,e="",s=512){const n=atob(t),o=[];for(let i=0;i<n.length;i+=s){const l=n.slice(i,i+s),c=new Array(l.length);for(let f=0;f<l.length;f++)c[f]=l.charCodeAt(f);const d=new Uint8Array(c);o.push(d)}const a=new Blob(o,{type:e});return URL.createObjectURL(a)}const xp=200;function bp({reference:t,clientThreadId:e,message:s,trackContentReferenceEvent:n}){var g;const o=Qn(e),{postId:a}=m.useContext(zc),{data:i,isLoading:l,isError:c,error:d}=pp({reference:t,conversationId:o,messageId:s.id,sharedConversationLikeId:a,isN7jupdMessage:(g=s.metadata)==null?void 0:g.n7jupd_message}),f=m.useRef([]);m.useEffect(()=>()=>{f.current.forEach(p=>{URL.revokeObjectURL(p)}),f.current=[]},[]);const u=ii(s,t);return d||c||i&&!("images"in i)||l||!(i!=null&&i.images.length)?null:(f.current=[],r.jsx(r.Fragment,{children:i==null?void 0:i.images.map((p,x)=>{const w=li(t,p,u);return r.jsx(ho,{metadata:w,analyticsMetadata:{clientThreadId:e,messageId:s.id},numImageResults:1,trackContentReferenceEvent:n},"image-carousel-inline-".concat(x))})}))}const yp=(t,e)=>{const s=new RegExp(e+"\\s*([^\\n]+)","m"),n=t.match(s);return n&&n[1]?n[1].trim().length:0};function ii(t,e){return m.useMemo(()=>{let s=-1;return t.content.content_type==="text"&&(s=yp(t.content.parts.join(""),e.matched_text)),s<xp||s===-1},[t,e.matched_text])}function li(t,e,s){var n,o,a;return{matched_text:t.matched_text,start_idx:t.start_idx,end_idx:t.end_idx,safe_urls:t.safe_urls,alt:t.alt,prompt_text:t.prompt_text,type:"image_v2",refs:[],images:[{url:e,content_url:(n=t.clicked_from_url)!=null?n:"",thumbnail_url:e,title:(o=t.clicked_from_title)!=null?o:"",attribution:on((a=t.clicked_from_url)!=null?a:e,"hostname"),content_size:{width:jr,height:Sr},thumbnail_size:{width:jr,height:Sr},is_proxied_image:!0,float_top:s}]}}const jr=141,Sr=143;function _p({reference:t,clientThreadId:e,message:s,trackContentReferenceEvent:n}){var p,x,w,S,h;const o=((p=s.metadata)==null?void 0:p.n7jupd_message)&&t.matched_text.includes("screenshot"),a=Qn(e),i=(w=(x=m.useContext(Bc))==null?void 0:x.serverSharedThreadId)!=null?w:void 0,l=Wc(t.asset_pointer_links[0]),c=m.useMemo(()=>({content_type:pa.ImageAssetPointer,size_bytes:0,width:0,height:0,asset_pointer:l}),[l]),d=Ea({asset:c,sharedThreadId:i,conversationId:a}),f=(S=d.data)==null?void 0:S.url,u=ii(s,t),g=m.useMemo(()=>f?li(t,f,u):null,[f,t,u]);return d.error||d.isError?null:o&&!((h=d.data)!=null&&h.url)&&d.isLoading?r.jsx(vr,{image:null},"image-pill-loading"):!o&&(d.isLoading||!d.data)||!g?null:o?r.jsx(vr,{image:g.images[0]}):r.jsx(ho,{metadata:g,analyticsMetadata:{clientThreadId:e,messageId:s.id},numImageResults:1,trackContentReferenceEvent:n})}const Re=1e-6;let Ht=typeof Float32Array<"u"?Float32Array:Array;function wp(){const t=new Ht(2);return Ht!=Float32Array&&(t[0]=0,t[1]=0),t}function Mr(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function vp(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ci(t,e,s,n){const o=e[0],a=e[1];return t[0]=o+n*(s[0]-o),t[1]=a+n*(s[1]-a),t}(function(){const t=wp();return function(e,s,n,o,a,i){let l,c;for(s||(s=2),n||(n=0),o?c=Math.min(o*s+n,e.length):c=e.length,l=n;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],a(t,t,i),e[l]=t[0],e[l+1]=t[1];return e}})();function kp(){const t=new Ht(3);return Ht!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function jp(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function Sp(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t}function Mp(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}const Cp=Sp;(function(){const t=kp();return function(e,s,n,o,a,i){let l,c;for(s||(s=3),n||(n=0),o?c=Math.min(o*s+n,e.length):c=e.length,l=n;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],a(t,t,i),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();function Ep(t,e){const s=e[0],n=e[1],o=e[2],a=e[3],i=e[4],l=e[5],c=e[6],d=e[7],f=e[8],u=e[9],g=e[10],p=e[11],x=e[12],w=e[13],S=e[14],h=e[15],M=s*l-n*i,v=s*c-o*i,k=s*d-a*i,j=n*c-o*l,y=n*d-a*l,E=o*d-a*c,C=f*w-u*x,_=f*S-g*x,R=f*h-p*x,$=u*S-g*w,A=u*h-p*w,N=g*h-p*S;let T=M*N-v*A+k*$+j*R-y*_+E*C;return T?(T=1/T,t[0]=(l*N-c*A+d*$)*T,t[1]=(o*A-n*N-a*$)*T,t[2]=(w*E-S*y+h*j)*T,t[3]=(g*y-u*E-p*j)*T,t[4]=(c*R-i*N-d*_)*T,t[5]=(s*N-o*R+a*_)*T,t[6]=(S*k-x*E-h*v)*T,t[7]=(f*E-g*k+p*v)*T,t[8]=(i*A-l*R+d*C)*T,t[9]=(n*R-s*A-a*C)*T,t[10]=(x*y-w*k+h*M)*T,t[11]=(u*k-f*y-p*M)*T,t[12]=(l*_-i*$-c*C)*T,t[13]=(s*$-n*_+o*C)*T,t[14]=(w*v-x*j-S*M)*T,t[15]=(f*j-u*v+g*M)*T,t):null}function yn(t,e,s){const n=e[0],o=e[1],a=e[2],i=e[3],l=e[4],c=e[5],d=e[6],f=e[7],u=e[8],g=e[9],p=e[10],x=e[11],w=e[12],S=e[13],h=e[14],M=e[15];let v=s[0],k=s[1],j=s[2],y=s[3];return t[0]=v*n+k*l+j*u+y*w,t[1]=v*o+k*c+j*g+y*S,t[2]=v*a+k*d+j*p+y*h,t[3]=v*i+k*f+j*x+y*M,v=s[4],k=s[5],j=s[6],y=s[7],t[4]=v*n+k*l+j*u+y*w,t[5]=v*o+k*c+j*g+y*S,t[6]=v*a+k*d+j*p+y*h,t[7]=v*i+k*f+j*x+y*M,v=s[8],k=s[9],j=s[10],y=s[11],t[8]=v*n+k*l+j*u+y*w,t[9]=v*o+k*c+j*g+y*S,t[10]=v*a+k*d+j*p+y*h,t[11]=v*i+k*f+j*x+y*M,v=s[12],k=s[13],j=s[14],y=s[15],t[12]=v*n+k*l+j*u+y*w,t[13]=v*o+k*c+j*g+y*S,t[14]=v*a+k*d+j*p+y*h,t[15]=v*i+k*f+j*x+y*M,t}function Wn(t,e,s){const n=s[0],o=s[1],a=s[2];let i,l,c,d,f,u,g,p,x,w,S,h;return e===t?(t[12]=e[0]*n+e[4]*o+e[8]*a+e[12],t[13]=e[1]*n+e[5]*o+e[9]*a+e[13],t[14]=e[2]*n+e[6]*o+e[10]*a+e[14],t[15]=e[3]*n+e[7]*o+e[11]*a+e[15]):(i=e[0],l=e[1],c=e[2],d=e[3],f=e[4],u=e[5],g=e[6],p=e[7],x=e[8],w=e[9],S=e[10],h=e[11],t[0]=i,t[1]=l,t[2]=c,t[3]=d,t[4]=f,t[5]=u,t[6]=g,t[7]=p,t[8]=x,t[9]=w,t[10]=S,t[11]=h,t[12]=i*n+f*o+x*a+e[12],t[13]=l*n+u*o+w*a+e[13],t[14]=c*n+g*o+S*a+e[14],t[15]=d*n+p*o+h*a+e[15]),t}function di(t,e,s){const n=s[0],o=s[1],a=s[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Np(t,e,s){const n=Math.sin(s),o=Math.cos(s),a=e[4],i=e[5],l=e[6],c=e[7],d=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*o+d*n,t[5]=i*o+f*n,t[6]=l*o+u*n,t[7]=c*o+g*n,t[8]=d*o-a*n,t[9]=f*o-i*n,t[10]=u*o-l*n,t[11]=g*o-c*n,t}function Tp(t,e,s){const n=Math.sin(s),o=Math.cos(s),a=e[0],i=e[1],l=e[2],c=e[3],d=e[4],f=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*o+d*n,t[1]=i*o+f*n,t[2]=l*o+u*n,t[3]=c*o+g*n,t[4]=d*o-a*n,t[5]=f*o-i*n,t[6]=u*o-l*n,t[7]=g*o-c*n,t}function Ip(t,e,s,n,o){const a=1/Math.tan(e/2);if(t[0]=a/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const i=1/(n-o);t[10]=(o+n)*i,t[14]=2*o*n*i}else t[10]=-1,t[14]=-2*n;return t}const Pp=Ip;function Cr(t,e){const s=t[0],n=t[1],o=t[2],a=t[3],i=t[4],l=t[5],c=t[6],d=t[7],f=t[8],u=t[9],g=t[10],p=t[11],x=t[12],w=t[13],S=t[14],h=t[15],M=e[0],v=e[1],k=e[2],j=e[3],y=e[4],E=e[5],C=e[6],_=e[7],R=e[8],$=e[9],A=e[10],N=e[11],T=e[12],I=e[13],B=e[14],W=e[15];return Math.abs(s-M)<=Re*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(n-v)<=Re*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-k)<=Re*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(a-j)<=Re*Math.max(1,Math.abs(a),Math.abs(j))&&Math.abs(i-y)<=Re*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(l-E)<=Re*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-C)<=Re*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(d-_)<=Re*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(f-R)<=Re*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(u-$)<=Re*Math.max(1,Math.abs(u),Math.abs($))&&Math.abs(g-A)<=Re*Math.max(1,Math.abs(g),Math.abs(A))&&Math.abs(p-N)<=Re*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(x-T)<=Re*Math.max(1,Math.abs(x),Math.abs(T))&&Math.abs(w-I)<=Re*Math.max(1,Math.abs(w),Math.abs(I))&&Math.abs(S-B)<=Re*Math.max(1,Math.abs(S),Math.abs(B))&&Math.abs(h-W)<=Re*Math.max(1,Math.abs(h),Math.abs(W))}function Rp(){const t=new Ht(4);return Ht!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function $p(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t}function Ap(t,e,s){const n=e[0],o=e[1],a=e[2],i=e[3];return t[0]=s[0]*n+s[4]*o+s[8]*a+s[12]*i,t[1]=s[1]*n+s[5]*o+s[9]*a+s[13]*i,t[2]=s[2]*n+s[6]*o+s[10]*a+s[14]*i,t[3]=s[3]*n+s[7]*o+s[11]*a+s[15]*i,t}(function(){const t=Rp();return function(e,s,n,o,a,i){let l,c;for(s||(s=4),n||(n=0),o?c=Math.min(o*s+n,e.length):c=e.length,l=n;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],a(t,t,i),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();function Ls(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Bt(t,e){const s=Ap([],e,t);return $p(s,s,1/s[3]),s}function Hn(t,e,s){return t<e?e:t>s?s:t}function Lp(t){return Math.log(t)*Math.LOG2E}const Dp=Math.log2||Lp;function mt(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ge=Math.PI,ui=Ge/4,Ze=Ge/180,Un=180/Ge,ls=512,Er=4003e4,Ts=85.051129,fi=1.5;function Op(t){return Math.pow(2,t)}function zt(t){const[e,s]=t;mt(Number.isFinite(e)),mt(Number.isFinite(s)&&s>=-90&&s<=90,"invalid latitude");const n=e*Ze,o=s*Ze,a=ls*(n+Ge)/(2*Ge),i=ls*(Ge+Math.log(Math.tan(ui+o*.5)))/(2*Ge);return[a,i]}function ns(t){const[e,s]=t,n=e/ls*(2*Ge)-Ge,o=2*(Math.atan(Math.exp(s/ls*(2*Ge)-Ge))-ui);return[n*Un,o*Un]}function Fp(t){const{latitude:e,longitude:s,highPrecision:n=!1}=t;mt(Number.isFinite(e)&&Number.isFinite(s));const o=ls,a=Math.cos(e*Ze),i=o/360,l=i/a,c=o/Er/a,d={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[i,l,c],degreesPerUnit:[1/i,1/l,1/c]};if(n){const f=Ze*Math.tan(e*Ze)/a,u=i*f/2,g=o/Er*f,p=g/l*c;d.unitsPerDegree2=[0,u,g],d.unitsPerMeter2=[p,0,p]}return d}function zp(t){const{height:e,pitch:s,bearing:n,altitude:o,scale:a,center:i}=t,l=Ls();Wn(l,l,[0,0,-o]),Np(l,l,-s*Ze),Tp(l,l,n*Ze);const c=a/e;return di(l,l,[c,c,c]),i&&Wn(l,l,Mp([],i)),l}function Bp(t){const{width:e,height:s,altitude:n,pitch:o=0,offset:a,center:i,scale:l,nearZMultiplier:c=1,farZMultiplier:d=1}=t;let{fovy:f=Ws(fi)}=t;n!==void 0&&(f=Ws(n));const u=f*Ze,g=o*Ze,p=mi(f);let x=p;i&&(x+=i[2]*l/Math.cos(g)/s);const w=u*(.5+(a?a[1]:0)/s),S=Math.sin(w)*x/Math.sin(Hn(Math.PI/2-g-w,.01,Math.PI-.01)),h=Math.sin(g)*S+x,M=x*10,v=Math.min(h*d,M);return{fov:u,aspect:e/s,focalDistance:p,near:c,far:v}}function Wp(t){const{fov:e,aspect:s,near:n,far:o}=Bp(t);return Pp([],e,s,n,o)}function Ws(t){return 2*Math.atan(.5/t)*Un}function mi(t){return .5/Math.tan(.5*t*Ze)}function Hp(t,e){const[s,n,o=0]=t;return mt(Number.isFinite(s)&&Number.isFinite(n)&&Number.isFinite(o)),Bt(e,[s,n,o,1])}function Nr(t,e,s=0){const[n,o,a]=t;if(mt(Number.isFinite(n)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a))return Bt(e,[n,o,a,1]);const i=Bt(e,[n,o,0,1]),l=Bt(e,[n,o,1,1]),c=i[2],d=l[2],f=c===d?0:((s||0)-c)/(d-c);return ci([],i,l,f)}function Up(t){const{width:e,height:s,bounds:n,minExtent:o=0,maxZoom:a=24,offset:i=[0,0]}=t,[[l,c],[d,f]]=n,u=Gp(t.padding),g=zt([l,Hn(f,-Ts,Ts)]),p=zt([d,Hn(c,-Ts,Ts)]),x=[Math.max(Math.abs(p[0]-g[0]),o),Math.max(Math.abs(p[1]-g[1]),o)],w=[e-u.left-u.right-Math.abs(i[0])*2,s-u.top-u.bottom-Math.abs(i[1])*2];mt(w[0]>0&&w[1]>0);const S=w[0]/x[0],h=w[1]/x[1],M=(u.right-u.left)/2/S,v=(u.top-u.bottom)/2/h,k=[(p[0]+g[0])/2+M,(p[1]+g[1])/2+v],j=ns(k),y=Math.min(a,Dp(Math.abs(Math.min(S,h))));return mt(Number.isFinite(y)),{longitude:j[0],latitude:j[1],zoom:y}}function Gp(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(mt(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Tr=Math.PI/180;function Vp(t,e=0){const{width:s,height:n,unproject:o}=t,a={targetZ:e},i=o([0,n],a),l=o([s,n],a);let c,d;const f=t.fovy?.5*t.fovy*Tr:Math.atan(.5/t.altitude),u=(90-t.pitch)*Tr;return f>u-.01?(c=Ir(t,0,e),d=Ir(t,s,e)):(c=o([0,0],a),d=o([s,0],a)),[i,l,d,c]}function Ir(t,e,s){const{pixelUnprojectionMatrix:n}=t,o=Bt(n,[e,0,1,1]),a=Bt(n,[e,t.height,1,1]),l=(s*t.distanceScales.unitsPerMeter[2]-o[2])/(a[2]-o[2]),c=ci([],o,a,l),d=ns(c);return d.push(s),d}class Hs{constructor(e={width:1,height:1}){this.equals=h=>h instanceof Hs?h.width===this.width&&h.height===this.height&&Cr(h.projectionMatrix,this.projectionMatrix)&&Cr(h.viewMatrix,this.viewMatrix):!1,this.project=(h,M={})=>{const{topLeft:v=!0}=M,k=this.projectPosition(h),j=Hp(k,this.pixelProjectionMatrix),[y,E]=j,C=v?E:this.height-E;return h.length===2?[y,C]:[y,C,j[2]]},this.unproject=(h,M={})=>{const{topLeft:v=!0,targetZ:k=void 0}=M,[j,y,E]=h,C=v?y:this.height-y,_=k&&k*this.distanceScales.unitsPerMeter[2],R=Nr([j,C,E],this.pixelUnprojectionMatrix,_),[$,A,N]=this.unprojectPosition(R);return Number.isFinite(E)?[$,A,N]:Number.isFinite(k)?[$,A,k]:[$,A]},this.projectPosition=h=>{const[M,v]=zt(h),k=(h[2]||0)*this.distanceScales.unitsPerMeter[2];return[M,v,k]},this.unprojectPosition=h=>{const[M,v]=ns(h),k=(h[2]||0)*this.distanceScales.metersPerUnit[2];return[M,v,k]};let{width:s,height:n,altitude:o=null,fovy:a=null}=e;const{latitude:i=0,longitude:l=0,zoom:c=0,pitch:d=0,bearing:f=0,position:u=null,nearZMultiplier:g=.02,farZMultiplier:p=1.01}=e;s=s||1,n=n||1,a===null&&o===null?(o=fi,a=Ws(o)):a===null?a=Ws(o):o===null&&(o=mi(a));const x=Op(c);o=Math.max(.75,o);const w=Fp({longitude:l,latitude:i}),S=zt([l,i]);S.push(0),u&&jp(S,S,Cp([],u,w.unitsPerMeter)),this.projectionMatrix=Wp({width:s,height:n,scale:x,center:S,pitch:d,fovy:a,nearZMultiplier:g,farZMultiplier:p}),this.viewMatrix=zp({height:n,scale:x,center:S,pitch:d,bearing:f,altitude:o}),this.width=s,this.height=n,this.scale=x,this.latitude=i,this.longitude=l,this.zoom=c,this.pitch=d,this.bearing=f,this.altitude=o,this.fovy=a,this.center=S,this.meterOffset=u||[0,0,0],this.distanceScales=w,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:s,projectionMatrix:n,viewMatrix:o}=this,a=Ls();yn(a,a,n),yn(a,a,o),this.viewProjectionMatrix=a;const i=Ls();di(i,i,[e/2,-s/2,1]),Wn(i,i,[1,-1,0]),yn(i,i,a);const l=Ep(Ls(),i);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=l}projectFlat(e){return zt(e)}unprojectFlat(e){return ns(e)}getMapCenterByLngLatPosition({lngLat:e,pos:s}){const n=Nr(s,this.pixelUnprojectionMatrix),o=zt(e),a=Mr([],o,vp([],n)),i=Mr([],this.center,a);return ns(i)}fitBounds(e,s={}){const{width:n,height:o}=this,{longitude:a,latitude:i,zoom:l}=Up(Object.assign({width:n,height:o,bounds:e},s));return new Hs({width:n,height:o,longitude:a,latitude:i,zoom:l})}getBounds(e){const s=this.getBoundingRegion(e),n=Math.min(...s.map(l=>l[0])),o=Math.max(...s.map(l=>l[0])),a=Math.min(...s.map(l=>l[1])),i=Math.max(...s.map(l=>l[1]));return[[n,a],[o,i]]}getBoundingRegion(e={}){return Vp(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:s}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:s})}}function qp(t,e,s={}){const n={type:"Feature"};return(s.id===0||s.id)&&(n.id=s.id),s.bbox&&(n.bbox=s.bbox),n.properties=e||{},n.geometry=t,n}function hi(t,e,s={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pr(t[0])||!Pr(t[1]))throw new Error("coordinates must contain numbers");return qp({type:"Point",coordinates:t},e,s)}function Kp(t,e={}){const s={type:"FeatureCollection"};return e.id&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.features=t,s}function Pr(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function pi(t,e,s){if(t!==null)for(var n,o,a,i,l,c,d,f=0,u=0,g,p=t.type,x=p==="FeatureCollection",w=p==="Feature",S=x?t.features.length:1,h=0;h<S;h++){d=x?t.features[h].geometry:w?t.geometry:t,g=d?d.type==="GeometryCollection":!1,l=g?d.geometries.length:1;for(var M=0;M<l;M++){var v=0,k=0;if(i=g?d.geometries[M]:d,i!==null){c=i.coordinates;var j=i.type;switch(f=0,j){case null:break;case"Point":if(e(c,u,h,v,k)===!1)return!1;u++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(e(c[n],u,h,v,k)===!1)return!1;u++,j==="MultiPoint"&&v++}j==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(o=0;o<c[n].length-f;o++){if(e(c[n][o],u,h,v,k)===!1)return!1;u++}j==="MultiLineString"&&v++,j==="Polygon"&&k++}j==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(k=0,o=0;o<c[n].length;o++){for(a=0;a<c[n][o].length-f;a++){if(e(c[n][o][a],u,h,v,k)===!1)return!1;u++}k++}v++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(pi(i.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function gi(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const s=[1/0,1/0,-1/0,-1/0];return pi(t,n=>{s[0]>n[0]&&(s[0]=n[0]),s[1]>n[1]&&(s[1]=n[1]),s[2]<n[0]&&(s[2]=n[0]),s[3]<n[1]&&(s[3]=n[1])}),s}var Xp=gi;function Zp(t,e={}){const s=gi(t),n=(s[0]+s[2])/2,o=(s[1]+s[3])/2;return hi([n,o],e.properties,e)}var Yp=Zp,_n,Rr;function Jp(){if(Rr)return _n;Rr=1;var t=zl(),e=Bl(),s=Wl(),n=Hl(),o=t.isFinite,a=Math.min;function i(l){var c=Math[l];return function(d,f){if(d=s(d),f=f==null?0:a(e(f),292),f&&o(d)){var u=(n(d)+"e").split("e"),g=c(u[0]+"e"+(+u[1]+f));return u=(n(g)+"e").split("e"),+(u[0]+"e"+(+u[1]-f))}return c(d)}}return _n=i,_n}var wn,$r;function Qp(){if($r)return wn;$r=1;var t=Jp(),e=t("round");return wn=e,wn}var eg=Qp();const ut=Fi(eg),tg=m.createContext(null);function sg(t,e){const s=Array.isArray(t)?t[0]:t?t.x:0,n=Array.isArray(t)?t[1]:t?t.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return s===o&&n===a}function tt(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!tt(t[s],e[s]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(const o of s)if(!e.hasOwnProperty(o)||!tt(t[o],e[o]))return!1;return!0}return!1}function ng(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Ar(t,e){if(!t.getProjection)return;const s=t.getProjection(),n=e.getProjection();tt(s,n)||e.setProjection(s)}function Lr(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Dr(t,e){const s=e.viewState||e;let n=!1;if("longitude"in s&&"latitude"in s){const o=t.center;t.center=new o.constructor(s.longitude,s.latitude),n=n||o!==t.center}if("zoom"in s){const o=t.zoom;t.zoom=s.zoom,n=n||o!==t.zoom}if("bearing"in s){const o=t.bearing;t.bearing=s.bearing,n=n||o!==t.bearing}if("pitch"in s){const o=t.pitch;t.pitch=s.pitch,n=n||o!==t.pitch}return s.padding&&!t.isPaddingEqual(s.padding)&&(n=!0,t.padding=s.padding),n}const og=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Or(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const n of t.layers)e[n.id]=n;const s=t.layers.map(n=>{let o=null;"interactive"in n&&(o=Object.assign({},n),delete o.interactive);const a=e[n.ref];if(a){o=o||Object.assign({},n),delete o.ref;for(const i of og)i in a&&(o[i]=a[i])}return o||n});return Q(z({},t),{layers:s})}var Fr={};const zr={version:8,sources:{},layers:[]},Br={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},vn={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Wr={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},rg=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],ag=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ut{constructor(e,s,n){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const a=this.props[Wr[o.type]];a?a(o):o.type==="error"&&console.error(o.error)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const a=this.props[Br[o.type]];a&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),a(o),delete o.features)},this._onCameraEvent=o=>{if(!this._internalUpdate){const a=this.props[vn[o.type]];a&&a(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=e,this.props=s,this._initialize(n)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const s=this.props;this.props=e;const n=this._updateSettings(e,s);n&&this._createShadowTransform(this._map);const o=this._updateSize(e),a=this._updateViewState(e,!0);this._updateStyle(e,s),this._updateStyleComponents(e,s),this._updateHandlers(e,s),(n||o||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,s){const n=Ut.savedMaps.pop();if(!n)return null;const o=n.map,a=o.getContainer();for(s.className=a.className;a.childNodes.length>0;)s.appendChild(a.childNodes[0]);o._container=s;const i=o._resizeObserver;i&&(i.disconnect(),i.observe(s)),n.setProps(Q(z({},e),{styleDiffing:!1})),o.resize();const{initialViewState:l}=e;return l&&(l.bounds?o.fitBounds(l.bounds,Q(z({},l.fitBoundsOptions),{duration:0})):n._updateViewState(l,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),o._update(),n}_initialize(e){const{props:s}=this,{mapStyle:n=zr}=s,o=Q(z(z({},s),s.initialViewState),{accessToken:s.mapboxAccessToken||ig()||null,container:e,style:Or(n)}),a=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),s.gl){const f=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=f,s.gl)}const i=new this._MapClass(o);a.padding&&i.setPadding(a.padding),s.cursor&&(i.getCanvas().style.cursor=s.cursor),this._createShadowTransform(i);const l=i._render;i._render=f=>{this._inRender=!0,l.call(i,f),this._inRender=!1};const c=i._renderTaskQueue.run;i._renderTaskQueue.run=f=>{c.call(i._renderTaskQueue,f),this._onBeforeRepaint()},i.on("render",()=>this._onAfterRepaint());const d=i.fire;i.fire=this._fireEvent.bind(this,d),i.on("resize",()=>{this._renderTransform.resize(i.transform.width,i.transform.height)}),i.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Ar(i.transform,this._renderTransform)}),i.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const f in Br)i.on(f,this._onPointerEvent);for(const f in vn)i.on(f,this._onCameraEvent);for(const f in Wr)i.on(f,this._onEvent);this._map=i}recycle(){const s=this.map.getContainer().querySelector("[mapboxgl-children]");s==null||s.remove(),Ut.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const s=ng(e.transform);e.painter.transform=s,this._renderTransform=s}_updateSize(e){const{viewState:s}=e;if(s){const n=this._map;if(s.width!==n.transform.width||s.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(e,s){if(this._internalUpdate)return!1;const n=this._map,o=this._renderTransform,{zoom:a,pitch:i,bearing:l}=o,c=n.isMoving();c&&(o.cameraElevationReference="sea");const d=Dr(o,z(z({},Lr(n.transform)),e));if(c&&(o.cameraElevationReference="ground"),d&&s){const f=this._deferredEvents;f.move=!0,f.zoom||(f.zoom=a!==o.zoom),f.rotate||(f.rotate=l!==o.bearing),f.pitch||(f.pitch=i!==o.pitch)}return c||Dr(n.transform,e),d}_updateSettings(e,s){const n=this._map;let o=!1;for(const a of rg)if(a in e&&!tt(e[a],s[a])){o=!0;const i=n["set".concat(a[0].toUpperCase()).concat(a.slice(1))];i==null||i.call(n,e[a])}return o}_updateStyle(e,s){if(e.cursor!==s.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==s.mapStyle){const{mapStyle:n=zr,styleDiffing:o=!0}=e,a={diff:o};return"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Or(n),a),!0}return!1}_updateStyleComponents(e,s){const n=this._map;let o=!1;return n.isStyleLoaded()&&("light"in e&&n.setLight&&!tt(e.light,s.light)&&(o=!0,n.setLight(e.light)),"fog"in e&&n.setFog&&!tt(e.fog,s.fog)&&(o=!0,n.setFog(e.fog)),"terrain"in e&&n.setTerrain&&!tt(e.terrain,s.terrain)&&(!e.terrain||n.getSource(e.terrain.source))&&(o=!0,n.setTerrain(e.terrain))),o}_updateHandlers(e,s){var n,o;const a=this._map;let i=!1;for(const l of ag){const c=(n=e[l])!==null&&n!==void 0?n:!0,d=(o=s[l])!==null&&o!==void 0?o:!0;tt(c,d)||(i=!0,c?a[l].enable(c):a[l].disable())}return i}_queryRenderedFeatures(e){const s=this._map,n=s.transform,{interactiveLayerIds:o=[]}=this.props;try{return s.transform=this._renderTransform,s.queryRenderedFeatures(e,{layers:o.filter(s.getLayer.bind(s))})}catch(a){return[]}finally{s.transform=n}}_updateHover(e){var s;const{props:n}=this;if(n.interactiveLayerIds&&(n.onMouseMove||n.onMouseEnter||n.onMouseLeave)){const a=e.type,i=((s=this._hoveredFeatures)===null||s===void 0?void 0:s.length)>0,l=this._queryRenderedFeatures(e.point),c=l.length>0;!c&&i&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,c&&!i&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=a}else this._hoveredFeatures=null}_fireEvent(e,s,n){const o=this._map,a=o.transform,i=typeof s=="string"?s:s.type;return i==="move"&&this._updateViewState(this.props,!1),i in vn&&(typeof s=="object"&&(s.viewState=Lr(a)),this._map.isMoving())?(o.transform=this._renderTransform,e.call(o,s,n),o.transform=a,o):(e.call(o,s,n),o)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const n in this._deferredEvents)this._deferredEvents[n]&&e.fire(n);this._internalUpdate=!1;const s=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Ar(this._renderTransform,s),e.transform=s}}}Ut.savedMaps=[];function ig(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||Fr.MapboxAccessToken}catch(e){}try{t=t||Fr.REACT_APP_MAPBOX_ACCESS_TOKEN}catch(e){}return t}const lg=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function cg(t){if(!t)return null;const e=t.map,s={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:n=>{const o=e.transform;e.transform=t.transform;const a=e.project(n);return e.transform=o,a},unproject:n=>{const o=e.transform;e.transform=t.transform;const a=e.unproject(n);return e.transform=o,a},queryTerrainElevation:(n,o)=>{const a=e.transform;e.transform=t.transform;const i=e.queryTerrainElevation(n,o);return e.transform=a,i},queryRenderedFeatures:(n,o)=>{const a=e.transform;e.transform=t.transform;const i=e.queryRenderedFeatures(n,o);return e.transform=a,i}};for(const n of dg(e))!(n in s)&&!lg.includes(n)&&(s[n]=e[n].bind(e));return s}function dg(t){const e=new Set;let s=t;for(;s;){for(const n of Object.getOwnPropertyNames(s))n[0]!=="_"&&typeof t[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&e.add(n);s=Object.getPrototypeOf(s)}return Array.from(e)}const ug=typeof document<"u"?m.useLayoutEffect:m.useEffect,fg=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function mg(t,e){for(const n of fg)n in e&&(t[n]=e[n]);const{RTLTextPlugin:s="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;s&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(s,n=>{n&&console.error(n)},!0)}const ln=m.createContext(null);function hg(t,e,s){const n=m.useContext(tg),[o,a]=m.useState(null),i=m.useRef(),{current:l}=m.useRef({mapLib:null,map:null});m.useEffect(()=>{const f=t.mapLib;let u=!0,g;return Promise.resolve(f||s).then(p=>{if(!u)return;if(!p)throw new Error("Invalid mapLib");const x="Map"in p?p:p.default;if(!x.Map)throw new Error("Invalid mapLib");if(mg(x,t),!x.supported||x.supported(t))t.reuseMaps&&(g=Ut.reuse(t,i.current)),g||(g=new Ut(x.Map,t,i.current)),l.map=cg(g),l.mapLib=x,a(g),n==null||n.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(p=>{const{onError:x}=t;x?x({type:"error",target:null,originalEvent:null,error:p}):console.error(p)}),()=>{u=!1,g&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?g.recycle():g.destroy())}},[]),ug(()=>{o&&o.setProps(t)}),m.useImperativeHandle(e,()=>l.map,[o]);const c=m.useMemo(()=>z({position:"relative",width:"100%",height:"100%"},t.style),[t.style]),d={height:"100%"};return m.createElement("div",{id:t.id,ref:i,style:c},o&&m.createElement(ln.Provider,{value:l},m.createElement("div",{"mapboxgl-children":"",style:d},t.children)))}const pg=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Nt(t,e){if(!t||!e)return;const s=t.style;for(const n in e){const o=e[n];Number.isFinite(o)&&!pg.test(n)?s[n]="".concat(o,"px"):s[n]=o}}function gg(t,e){const{map:s,mapLib:n}=m.useContext(ln),o=m.useRef({props:t});o.current.props=t;const a=m.useMemo(()=>{let w=!1;m.Children.forEach(t.children,M=>{M&&(w=!0)});const S=Q(z({},t),{element:w?document.createElement("div"):null}),h=new n.Marker(S);return h.setLngLat([t.longitude,t.latitude]),h.getElement().addEventListener("click",M=>{var v,k;(k=(v=o.current.props).onClick)===null||k===void 0||k.call(v,{type:"click",target:h,originalEvent:M})}),h.on("dragstart",M=>{var v,k;const j=M;j.lngLat=a.getLngLat(),(k=(v=o.current.props).onDragStart)===null||k===void 0||k.call(v,j)}),h.on("drag",M=>{var v,k;const j=M;j.lngLat=a.getLngLat(),(k=(v=o.current.props).onDrag)===null||k===void 0||k.call(v,j)}),h.on("dragend",M=>{var v,k;const j=M;j.lngLat=a.getLngLat(),(k=(v=o.current.props).onDragEnd)===null||k===void 0||k.call(v,j)}),h},[]);m.useEffect(()=>(a.addTo(s.getMap()),()=>{a.remove()}),[]);const{longitude:i,latitude:l,offset:c,style:d,draggable:f=!1,popup:u=null,rotation:g=0,rotationAlignment:p="auto",pitchAlignment:x="auto"}=t;return m.useEffect(()=>{Nt(a.getElement(),d)},[d]),m.useImperativeHandle(e,()=>a,[]),(a.getLngLat().lng!==i||a.getLngLat().lat!==l)&&a.setLngLat([i,l]),c&&!sg(a.getOffset(),c)&&a.setOffset(c),a.isDraggable()!==f&&a.setDraggable(f),a.getRotation()!==g&&a.setRotation(g),a.getRotationAlignment()!==p&&a.setRotationAlignment(p),a.getPitchAlignment()!==x&&a.setPitchAlignment(x),a.getPopup()!==u&&a.setPopup(u),qn.createPortal(t.children,a.getElement())}const xg=m.memo(m.forwardRef(gg));function Hr(t){return new Set(t?t.trim().split(/\s+/):[])}function bg(t,e){const{map:s,mapLib:n}=m.useContext(ln),o=m.useMemo(()=>document.createElement("div"),[]),a=m.useRef({props:t});a.current.props=t;const i=m.useMemo(()=>{const l=z({},t),c=new n.Popup(l);return c.setLngLat([t.longitude,t.latitude]),c.once("open",d=>{var f,u;(u=(f=a.current.props).onOpen)===null||u===void 0||u.call(f,d)}),c},[]);if(m.useEffect(()=>{const l=c=>{var d,f;(f=(d=a.current.props).onClose)===null||f===void 0||f.call(d,c)};return i.on("close",l),i.setDOMContent(o).addTo(s.getMap()),()=>{i.off("close",l),i.isOpen()&&i.remove()}},[]),m.useEffect(()=>{Nt(i.getElement(),t.style)},[t.style]),m.useImperativeHandle(e,()=>i,[]),i.isOpen()&&((i.getLngLat().lng!==t.longitude||i.getLngLat().lat!==t.latitude)&&i.setLngLat([t.longitude,t.latitude]),t.offset&&!tt(i.options.offset,t.offset)&&i.setOffset(t.offset),(i.options.anchor!==t.anchor||i.options.maxWidth!==t.maxWidth)&&(i.options.anchor=t.anchor,i.setMaxWidth(t.maxWidth)),i.options.className!==t.className)){const l=Hr(i.options.className),c=Hr(t.className);for(const d of l)c.has(d)||i.removeClassName(d);for(const d of c)l.has(d)||i.addClassName(d);i.options.className=t.className}return qn.createPortal(t.children,o)}m.memo(m.forwardRef(bg));function qt(t,e,s,n){const o=m.useContext(ln),a=m.useMemo(()=>t(o),[]);return m.useEffect(()=>{const i=e,l=typeof e=="function"?e:null,{map:c}=o;return c.hasControl(a)||c.addControl(a,i==null?void 0:i.position),()=>{l&&l(o),c.hasControl(a)&&c.removeControl(a)}},[]),a}function yg(t){const e=qt(({mapLib:s})=>new s.AttributionControl(t),{position:t.position});return m.useEffect(()=>{Nt(e._container,t.style)},[t.style]),null}m.memo(yg);function _g(t){const e=qt(({mapLib:s})=>new s.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return m.useEffect(()=>{Nt(e._controlContainer,t.style)},[t.style]),null}m.memo(_g);function wg(t,e){const s=m.useRef({props:t}),n=qt(({mapLib:o})=>{const a=new o.GeolocateControl(t),i=a._setupUI;return a._setupUI=l=>{a._container.hasChildNodes()||i(l)},a.on("geolocate",l=>{var c,d;(d=(c=s.current.props).onGeolocate)===null||d===void 0||d.call(c,l)}),a.on("error",l=>{var c,d;(d=(c=s.current.props).onError)===null||d===void 0||d.call(c,l)}),a.on("outofmaxbounds",l=>{var c,d;(d=(c=s.current.props).onOutOfMaxBounds)===null||d===void 0||d.call(c,l)}),a.on("trackuserlocationstart",l=>{var c,d;(d=(c=s.current.props).onTrackUserLocationStart)===null||d===void 0||d.call(c,l)}),a.on("trackuserlocationend",l=>{var c,d;(d=(c=s.current.props).onTrackUserLocationEnd)===null||d===void 0||d.call(c,l)}),a},{position:t.position});return s.current.props=t,m.useImperativeHandle(e,()=>n,[]),m.useEffect(()=>{Nt(n._container,t.style)},[t.style]),null}m.memo(m.forwardRef(wg));function vg(t){const e=qt(({mapLib:s})=>new s.NavigationControl(t),{position:t.position});return m.useEffect(()=>{Nt(e._container,t.style)},[t.style]),null}const kg=m.memo(vg);function jg(t){const e=qt(({mapLib:a})=>new a.ScaleControl(t),{position:t.position}),s=m.useRef(t),n=s.current;s.current=t;const{style:o}=t;return t.maxWidth!==void 0&&t.maxWidth!==n.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==n.unit&&e.setUnit(t.unit),m.useEffect(()=>{Nt(e._container,o)},[o]),null}m.memo(jg);const Sg=se(()=>import("./m6wym3ejj3i5iveb.js").then(t=>t.m),__vite__mapDeps([37,1])),Mg=m.forwardRef(function(e,s){return hg(e,s,Sg)}),Cg=xg,Eg=kg,Ng=ne(()=>se(()=>import("./da9ysnvw39tlmcb1.js").then(t=>t._),__vite__mapDeps([38,1])),{loading:t=>ae(t)}),Tg=ne(()=>se(()=>import("./fp27qqwhg12gsehb.js").then(t=>t._),__vite__mapDeps([39,1])),{loading:t=>ae(t)}),Ig=ne(()=>se(()=>import("./g5jbfk4gk138tht0.js").then(t=>t._),__vite__mapDeps([40,1])),{loading:t=>ae(t)}),Pg=ne(()=>se(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yv),__vite__mapDeps([12,1,8,9,13])),{loading:t=>ae(t)});function xo({business:t,showHourDetail:e}){const s=_e();if(t.is_closed_permanently)return r.jsx("span",{className:"text-red-600",children:r.jsx(q,{id:"businessMetadata.closedPermanently",defaultMessage:"Closed Permanently"})},"closed_permanently");const n=t.next_open_hour,o=t.is_open!==void 0&&t.is_open!=null?t.is_open?r.jsx("span",{className:"text-green-600",children:r.jsx(q,{id:"businessMetadata.openHourDetail",defaultMessage:"Open"})},"open"):r.jsx("span",{children:r.jsx(q,{id:"businessMetadata.closedStatus",defaultMessage:"Closed"})},"closed"):null;if(!e||!n)return o;const a=n.day===new Date().getDay(),i=Ag(s,t.is_open?n.end:n.start),l=a?s.formatMessage({id:"Adun59",defaultMessage:"{openClosedText} until {time}"},{openClosedText:o,time:i}):s.formatMessage({id:"tMworT",defaultMessage:"{openClosedText} until {day} {time}"},{openClosedText:o,day:Lg(s,n.day),time:i});return r.jsx("div",{className:"font-normal",children:l&&r.jsx("span",{children:l})})}function Rg({business:t,isLoading:e=!1,mapUrl:s,showTitle:n=!1,showPrice:o=!0,showHourDetail:a=!0,showActionButtons:i=!0,showActionButtonsIcons:l=!1,trackContentReferenceEvent:c,topOffset:d=0}){const f=m.useRef({directions:null,website:null,phone:null});m.useEffect(()=>{f.current={directions:null,website:null,phone:null}},[t.id]);const u=m.useMemo(()=>({section:"entity_metadata",section_location:"response",entity_type:"local_business",business_id:t.id,provider:t.provider}),[t.id,t.provider]),g=m.useCallback((x,w,S)=>{if(!c)return;const h=Q(z({},u),{cta_type:x,url:S,link_type:"button",action:w});c("link_action",null,"entity_metadata",h),w==="show"?c("Entity Metadata Content Reference Shown","entity_metadata_content_reference_shown","entity_metadata",h):w==="click"&&c("Entity Metadata Content Reference Clicked","entity_metadata_content_reference_clicked","entity_metadata",h)},[u,c]);m.useEffect(()=>{if(!(!c||!i)&&(s&&f.current.directions!==s&&(g("directions","show",s),f.current.directions=s),t.website_url&&f.current.website!==t.website_url&&(g("website","show",t.website_url),f.current.website=t.website_url),t.phone)){const x="tel:".concat(t.phone);f.current.phone!==x&&(g("phone","show",x),f.current.phone=x)}},[t.phone,t.website_url,s,i,c,g]);const p=!(a&&t.next_open_hour)||t.is_closed_permanently;return r.jsxs("div",{className:D("text-token-text-primary bg-token-bg-primary mb-4 max-w-md rounded-md",e&&"pointer-events-none animate-pulse opacity-80",d&&"mt-[".concat(d,"px]")),children:[n&&t.name&&r.jsx("h2",{className:"mb-0! leading-tight",children:t.name}),r.jsx("div",{className:"leaading-tight",children:r.jsx(xi,{business:t,showPrice:o,showHours:p})}),!p&&r.jsx("div",{className:"leading-tight",children:r.jsx(xo,{business:t,showHourDetail:!0})}),i&&r.jsxs("div",{className:"justify-left mt-3 flex w-full flex-wrap gap-2",children:[s&&r.jsx(mn,{type:"button",className:"btn btn-primary btn-small relative m-0! w-auto min-w-fit px-4 py-1 text-xs font-medium",onClick:()=>{g("directions","click",s),window.open(s,"_blank","noopener,noreferrer")},children:r.jsxs("span",{className:"flex items-center gap-1",children:[l&&r.jsx(Ig,{className:"text-token-text-primary h-4 w-4"}),r.jsx(q,{id:"businessMetadata.directions",defaultMessage:"Directions"})]},"rating")}),t.website_url&&r.jsx(mn,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-auto min-w-fit px-4 py-1 text-xs font-medium",onClick:()=>{const x=t.website_url;x&&(g("website","click",x),window.open(x,"_blank","noopener,noreferrer"))},children:r.jsxs("span",{className:"flex items-center gap-1",children:[l&&r.jsx(Pg,{className:"text-token-text-primary h-4 w-4"}),r.jsx(q,{id:"businessMetadata.website",defaultMessage:"Website"})]},"rating")}),t.phone&&r.jsx(mn,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-auto min-w-fit px-4 py-1 text-xs font-medium",onClick:()=>{const x="tel:".concat(t.phone);g("phone","click",x),window.location.href=x},children:r.jsxs("span",{className:"flex items-center gap-1",children:[l&&r.jsx(Tg,{className:"text-token-text-primary h-4 w-4"}),r.jsx(q,{id:"businessMetadata.call",defaultMessage:"Call"})]},"rating")})]})]})}function xi(t){"use forget";const e=je.c(15),{business:s,showPrice:n,showHours:o}=t,a=n===void 0?!0:n,i=o===void 0?!0:o,l=s.categories&&s.categories.length>0?s.categories[0]:"";let c;e[0]!==s.rating?(c=s.rating?r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Ng,{className:"mt-0.25 h-3.5 w-3.5"}),s.rating.toFixed(1)]},"rating"):null,e[0]=s.rating,e[1]=c):c=e[1];let d;e[2]!==l?(d=l?r.jsx("span",{children:r.jsx(q,{id:"businessMetadata.category",defaultMessage:"{category}",values:{category:l}})},"category"):null,e[2]=l,e[3]=d):d=e[3];let f;e[4]!==s.price_str||e[5]!==a?(f=a&&s.price_str?r.jsx("span",{children:s.price_str},"price"):null,e[4]=s.price_str,e[5]=a,e[6]=f):f=e[6];let u;e[7]!==s||e[8]!==i?(u=i&&s.is_open!=null&&r.jsx(xo,{business:s,showHourDetail:!1}),e[7]=s,e[8]=i,e[9]=u):u=e[9];let g;return e[10]!==c||e[11]!==d||e[12]!==f||e[13]!==u?(g=r.jsx("div",{className:"flex flex-wrap items-center font-normal",children:[c,d,f,u].filter(Boolean).map($g)}),e[10]=c,e[11]=d,e[12]=f,e[13]=u,e[14]=g):g=e[14],g}function $g(t,e){return r.jsxs(ma.Fragment,{children:[e>0&&r.jsx("span",{className:"mx-1",children:"•"}),t]},e)}function Ag(t,e){const s=e.slice(0,2),n=e.slice(2,4),o=new Date(0,0,0,parseInt(s,10),parseInt(n,10));return t.formatTime(o,{hour:"numeric",minute:"2-digit"})}function Lg(t,e){return t.formatDate(new Date(0,0,e),{weekday:"short"})}const Dg="pk.eyJ1Ijoib2FpLWRhdGEiLCJhIjoiY20yYzRzZmFtMGNqNjJscHo2dThqdnkwNCJ9.rTosfWNn9lUu4slvYfMzHg",Og=ne(()=>se(()=>import("./da9ysnvw39tlmcb1.js").then(t=>t._),__vite__mapDeps([38,1])),{loading:t=>ae(t)}),Fg=ne(()=>se(()=>import("./dkwbd01msodbgagg.js").then(t=>t._),__vite__mapDeps([41,1])),{loading:t=>ae(t)}),zg=ne(()=>se(()=>import("./oqpuvdflzxc04e1g.js").then(t=>t._),__vite__mapDeps([42,1])),{loading:t=>ae(t)}),Bg=ne(()=>se(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yw),__vite__mapDeps([12,1,8,9,13])),{loading:t=>ae(t)}),Wg=ne(()=>se(()=>import("./gsyp9a9fup59ufmh.js").then(t=>t._),__vite__mapDeps([43,1])),{loading:t=>ae(t)}),Ur=50,Gr=20,Vr=20,qr=20,Hg=400;function Ug(t){"use forget";const e=je.c(55),{contentReference:s,clientThreadId:n,messageId:o,trackContentReferenceEvent:a}=t,i=Me();let l;e[0]!==i?(l=Pe(i,"1950533395"),e[0]=i,e[1]=l):l=e[1];const c=l,d=s.entities,f=m.useRef(!0),u=m.useRef(null),g=m.useRef(null);let p;e[2]===Symbol.for("react.memo_cache_sentinel")?(p={longitude:0,latitude:0,zoom:12},e[2]=p):p=e[2];const x=p,w=m.useRef(x);let S;e[3]===Symbol.for("react.memo_cache_sentinel")?(S=Q(z({},x),{pitch:0,bearing:0}),e[3]=S):S=e[3];const[h,M]=m.useState(S),[v,k]=m.useState(-1),j=m.useRef(v);let y;e[4]===Symbol.for("react.memo_cache_sentinel")?(y=F=>{j.current=F,k(F)},e[4]=y):y=e[4];const E=y,C=!ms(),[_,R]=m.useState(!1),$=m.useRef(!1);let A,N;e[5]!==a?(A=()=>{$.current||(a("Search Content Reference Shown","search_content_reference_shown","map"),$.current=!0)},N=[a],e[5]=a,e[6]=A,e[7]=N):(A=e[6],N=e[7]),m.useEffect(A,N);let T,I;e[8]===Symbol.for("react.memo_cache_sentinel")?(T=()=>{if(!u.current)return;const F=Ul(()=>{var Z;(Z=g.current)==null||Z.resize()},100),V=new ResizeObserver(F);return V.observe(u.current),()=>{V.disconnect()}},I=[],e[8]=T,e[9]=I):(T=e[8],I=e[9]),m.useEffect(T,I);let B;e[10]===Symbol.for("react.memo_cache_sentinel")?(B=new Set,e[10]=B):B=e[10];const[W,X]=m.useState(B),H=m.useRef(-1),[b,P]=m.useState(!1);let L;e[11]!==d||e[12]!==b||e[13]!==h.zoom?(L=()=>{var V,Z,Y;if(!g.current||!b)return;const F=Xg;if(H.current==-1||H.current!==h.zoom){const ue=[];for(const be of d){const ce=(V=g.current)==null?void 0:V.project([be.longitude,be.latitude]);if(!ce)return;const ge=ce.x-30,we=ce.y,ke=(Z=be.entity.rating)!=null?Z:0,ee=(Y=be.entity.is_open)!=null?Y:!1;ue.push({id:be.id,x:ge,y:we,w:60,h:30,rating:ke,openNow:ee})}ue.sort(Kg);const le=new Set,fe=new Map(ue.map(qg));for(const be of ue){let ce=!1;for(const ge of le){const we=fe.get(ge);if(we&&F(be,we)){ce=!0;break}}ce||le.add(be.id)}X(be=>be.size===le.size&&[...be].every(ce=>le.has(ce))?be:le)}H.current=h.zoom},e[11]=d,e[12]=b,e[13]=h.zoom,e[14]=L):L=e[14];let K;e[15]!==d||e[16]!==b||e[17]!==h.zoom||e[18]!==W?(K=[h.zoom,W,b,d],e[15]=d,e[16]=b,e[17]=h.zoom,e[18]=W,e[19]=K):K=e[19],m.useEffect(L,K);let U,G;e[20]!==d||e[21]!==v?(U=()=>{const F=function(){var be;const Y=function(ge,we){const ke=g.current;if(!ke)return!1;const{width:ee,height:J}=ke.getContainer().getBoundingClientRect(),ve=ke.unproject([Gr,Ur]),xe=ke.unproject([ee-Vr,J-qr]);return ut(ge,5)>=ut(xe.lat,5)&&ut(ge,5)<=ut(ve.lat,5)&&ut(we,5)>=ut(ve.lng,5)&&ut(we,5)<=ut(xe.lng,5)},ue=Kp(d.filter((ce,ge)=>f.current||v===-1||ge===v).map(Vg)),le=Xp(ue),fe=Yp(ue);if(u.current){const ce=u.current.clientWidth,ge=u.current.clientHeight,we=new Hs({width:ce,height:ge,longitude:fe.geometry.coordinates[0],latitude:fe.geometry.coordinates[1]}),{zoom:ke,latitude:ee,longitude:J}=we.fitBounds([[le[0],le[1]],[le[2],le[3]]],{maxZoom:13.5,padding:{top:Ur,left:Gr,right:Vr,bottom:qr}});f.current?(M(ve=>Q(z({},ve),{zoom:ke,latitude:ee,longitude:J})),w.current={longitude:J,latitude:ee,zoom:ke},f.current=!1):Y(ee,J)||(be=g.current)==null||be.flyTo({center:[J,ee]})}};if(d.length===0)return;if(f.current){F();return}if(v===-1)return;const V=setTimeout(F,200);return()=>clearTimeout(V)},G=[d,v],e[20]=d,e[21]=v,e[22]=U,e[23]=G):(U=e[22],G=e[23]),m.useEffect(U,G);const{openThreadSidebar:te}=bs(),{resetSidebarHistory:oe}=Aa(),re=io();let me;e[24]!==n||e[25]!==s.start_idx||e[26]!==re||e[27]!==o||e[28]!==te||e[29]!==oe?(me=(F,V)=>{E(F),n&&(re||oe(),te({type:"entity",debugThreadId:void 0,messageId:o,contentReferenceStartIndex:s.start_idx,query:V.name,category:"local_business",extraParams:V.entity.location?{location:V.entity.location}:void 0}))},e[24]=n,e[25]=s.start_idx,e[26]=re,e[27]=o,e[28]=te,e[29]=oe,e[30]=me):me=e[30];const he=me,ie=Ys();let pe;if(e[31]!==d||e[32]!==ie||e[33]!==c||e[34]!==he||e[35]!==v||e[36]!==a||e[37]!==W){let F;e[39]!==v?(F=(Z,Y)=>Z.idx===v?1:Y.idx===v?-1:Z.idx-Y.idx,e[39]=v,e[40]=F):F=e[40];let V;e[41]!==ie||e[42]!==c||e[43]!==he||e[44]!==v||e[45]!==a||e[46]!==W?(V=Z=>{const{business:Y,idx:ue}=Z,le=ue===v;return r.jsx(Cg,{longitude:Y.longitude,latitude:Y.latitude,anchor:"bottom",children:r.jsx(Ct,{label:r.jsx(ex,{business:Y.entity,idx:ue,trackContentReferenceEvent:a,onOpenEntity:()=>he(ue,Y),enableSidebarNavigation:c}),onOpenChange:fe=>E(fe?ue:-1),delayDuration:150,theme:ie?"default":"white",customPaddingClassName:"bg-clip-padding",customBorderClassName:"border-token-border-default border",contentClassName:"animate-show rounded-[20px]!",side:"top",sideOffset:10,wide:!0,interactive:!0,children:r.jsxs("div",{className:"relative",children:[r.jsx(Zg,{business:Y,isSelected:le}),r.jsx("div",{className:"absolute start-1/2 top-full -translate-x-1/2 font-bold text-nowrap text-gray-800 [text-shadow:_-0.8px_-0.8px_0_#fff,_0.8px_-0.8px_0_#fff,_-0.8px_0.8px_0_#fff,_0.8px_0.8px_0_#fff]",style:{opacity:W.has(Y.id)?1:0},children:Y.name}),r.jsx("div",{className:D("absolute inset-0 rounded-xl",c&&"cursor-pointer"),onClick:c?fe=>{fe.preventDefault(),E(ue),he(ue,Y)}:void 0})]})},ue)},ue)},e[41]=ie,e[42]=c,e[43]=he,e[44]=v,e[45]=a,e[46]=W,e[47]=V):V=e[47],pe=d.map(Gg).sort(F).map(V),e[31]=d,e[32]=ie,e[33]=c,e[34]=he,e[35]=v,e[36]=a,e[37]=W,e[38]=pe}else pe=e[38];const Ee=pe;let Se;e[48]!==C||e[49]!==Ee||e[50]!==_||e[51]!==h?(Se=!C&&r.jsx("div",{className:"bg-token-bg-primary pt-4",children:r.jsxs("div",{style:{height:Hg},className:"bg-token-bg-primary relative w-full",ref:u,children:[r.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-xl",children:r.jsxs(Mg,Q(z({},h),{mapboxAccessToken:Dg,mapStyle:"mapbox://styles/oai-data/cmhawgfb0000n01sd7bcybf4f",attributionControl:!1,renderWorldCopies:!1,cooperativeGestures:!0,onMove:F=>{M(F.viewState),Yg(w.current,F)&&R(!0)},ref:g,keyboard:!1,onLoad:()=>{P(!0)},children:[r.jsx(Eg,{position:"top-right",showCompass:!1,style:{borderRadius:9999,overflow:"hidden"}}),r.jsx(Jg,{show:_,onClick:()=>{M(Q(z({},w.current),{pitch:0,bearing:0})),R(!1)}}),Ee]}))}),r.jsx("div",{className:"absolute start-3 top-3",children:r.jsx(sx,{})})]})}),e[48]=C,e[49]=Ee,e[50]=_,e[51]=h,e[52]=Se):Se=e[52];let O;return e[53]!==Se?(O=r.jsx(Gl,{children:r.jsx("div",{className:"not-prose","data-testid":"businesses-map-widget",children:Se})}),e[53]=Se,e[54]=O):O=e[54],O}function Gg(t,e){return{business:t,idx:e}}function Vg(t){return hi([t.longitude,t.latitude])}function qg(t){return[t.id,t]}function Kg(t,e){const s=t.openNow,n=e.openNow;return s&&!n?-1:!s&&n?1:e.rating-t.rating}function Xg(t,e){return!(t.x+t.w<=e.x||e.x+e.w<=t.x||t.y+t.h<=e.y||e.y+e.h<=t.y)}const Zg=({business:t,isSelected:e})=>{var s;return r.jsx("div",{className:D("border-token-border-default shadow-elevation-03 flex h-7 min-w-7 items-center justify-center rounded-full border bg-clip-padding text-xs font-medium",e?"bg-token-interactive-bg-primary-press text-token-interactive-label-primary-press":"bg-token-bg-primary"),children:t.entity.rating?r.jsxs("div",{className:"flex items-center gap-0.75 px-2.5",children:[r.jsx("span",{children:(s=t.entity.rating)==null?void 0:s.toFixed(1)}),r.jsx(Og,{className:"h-3 w-3"})]}):r.jsx(Wg,{className:"h-3 w-3"})})},Yg=(t,e)=>{if(t){const s=Math.abs(e.viewState.zoom-t.zoom),n=Math.abs(e.viewState.latitude-t.latitude),o=Math.abs(e.viewState.longitude-t.longitude);return s>.05||n>5e-4||o>5e-4}return!1};function Jg(t){"use forget";const e=je.c(6),{show:s,onClick:n}=t,[o,a]=m.useState(null);let i,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=()=>({onAdd(){const f=document.createElement("div");return f.className="mapboxgl-ctrl mapboxgl-ctrl-group",a(f),f},onRemove(){a(null)}}),l={position:"top-right"},e[0]=i,e[1]=l):(i=e[0],l=e[1]),qt(i,l);let c;return e[2]!==o||e[3]!==n||e[4]!==s?(c=o&&s?qn.createPortal(r.jsx(Qg,{onClick:n}),o):null,e[2]=o,e[3]=n,e[4]=s,e[5]=c):c=e[5],c}function Qg(t){"use forget";const e=je.c(8),{onClick:s}=t,n=_e();let o;e[0]!==s?(o=c=>{c.preventDefault(),s()},e[0]=s,e[1]=o):o=e[1];let a;e[2]!==n?(a=n.formatMessage({id:"dUWlu0",defaultMessage:"Reset view"}),e[2]=n,e[3]=a):a=e[3];let i;e[4]===Symbol.for("react.memo_cache_sentinel")?(i=r.jsx(Fg,{className:"icon h-[18px]! w-[18px]!"}),e[4]=i):i=e[4];let l;return e[5]!==o||e[6]!==a?(l=r.jsx(Ve,{type:"button",color:"secondary",size:"small",className:"flex h-[30px] items-center justify-center bg-clip-padding text-black",contentWrapperClassName:"font-semibold",onClick:o,title:a,children:i}),e[5]=o,e[6]=a,e[7]=l):l=e[7],l}function ex({business:t,idx:e,trackContentReferenceEvent:s,onOpenEntity:n,enableSidebarNavigation:o}){var f;const a=!ms(),i={section:"map",section_location:"response",section_index:e},l="https://www.google.com/maps/dir/?api=1&destination=".concat(encodeURIComponent([t.name,t.address].join(",")));t.address&&s("link_action",null,"map",Q(z({},i),{url:l,link_type:"button",action:"show"})),t.website_url&&s("link_action",null,"map",Q(z({},i),{url:t.website_url,link_type:"button",action:"show"}));function c(){return r.jsx(r.Fragment,{children:r.jsxs("div",{className:"text-token-text-primary mt-auto flex min-h-[30px] w-full min-w-0 flex-wrap justify-center gap-2 text-base",children:[t.address&&r.jsx(kn,{to:l,onClick:()=>{s("link_action",null,"map",Q(z({},i),{url:l,link_type:"button",action:"click"}))},children:r.jsx(q,{id:"+a2f/C",defaultMessage:"Directions"})}),t.website_url&&r.jsx(kn,{to:t.website_url,onClick:()=>{s("link_action",null,"map",Q(z({},i),{url:t.website_url,link_type:"button",action:"click"}))},children:r.jsx(q,{id:"r0oqXM",defaultMessage:"Website"})}),t.phone&&r.jsx(kn,{to:"tel:"+t.phone,children:r.jsx(q,{id:"B/an6M",defaultMessage:"Call"})})]})})}const d=(f=t.image_urls)==null?void 0:f[0];return r.jsx(rs.div,{initial:{x:"0%",opacity:0,pointerEvents:"none",transition:{duration:.1,ease:"easeOut"}},animate:{x:"0%",opacity:1,pointerEvents:"auto",transition:{duration:.15,ease:"easeOut"}},children:r.jsxs("div",{className:D("bg-token-main-surface-primary relative text-start font-normal"),children:[r.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[r.jsxs("div",{className:"flex gap-3",children:[r.jsx("div",{className:D("h-23 w-23 shrink-0 overflow-hidden rounded-lg",o&&"cursor-pointer"),onClick:o?u=>{u.preventDefault(),n==null||n()}:void 0,children:d?r.jsx("img",{className:"h-full w-full object-cover",src:d!=null?d:void 0,alt:t.name}):r.jsx("div",{className:"h-full w-full bg-gray-100"})}),r.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center gap-0.5",children:[o?r.jsx("div",{className:"hover:entity-accent line-clamp-2 w-full cursor-pointer text-[17px] font-medium",onClick:u=>{u.preventDefault(),n==null||n()},title:t.name,children:t.name}):r.jsx("div",{title:t.name,className:"text-token-text-primary line-clamp-2 w-full text-[17px] font-medium",children:t.name}),r.jsx(tx,{business:t})]})]}),!a&&r.jsx("div",{className:"mt-1",children:c()})]}),a&&c()]})})}function kn(t){"use forget";const e=je.c(4),{to:s,onClick:n,children:o}=t;let a;return e[0]!==o||e[1]!==n||e[2]!==s?(a=r.jsx(Ve,{onClick:n,as:"link",to:s,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"h-[30px] min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:o}),e[0]=o,e[1]=n,e[2]=s,e[3]=a):a=e[3],a}function tx({business:t}){return r.jsxs("div",{className:"text-token-text-primary flex flex-col gap-0.5 text-sm",children:[r.jsx(xi,{business:t,showPrice:!0,showHours:!1}),r.jsx(xo,{business:t,showHourDetail:!0})]})}function sx(){const[t,e]=m.useState(!1),s=()=>e(o=>!o),n=t?Bg:zg;return r.jsxs("div",{className:D("text-token-text-primary flex h-5 items-center justify-start overflow-hidden rounded-full text-[10px] font-light whitespace-nowrap transition-all",t?"w-full bg-white":"w-5 bg-white/60 backdrop-blur-xl backdrop-filter hover:bg-white/70"),children:[r.jsx("button",{onClick:s,className:D("flex min-w-5 items-center justify-center transition-all"),children:r.jsx(n,{className:"icon-sm transition-colors"})}),r.jsxs("div",{className:"pe-2",children:["© ",r.jsx("a",{href:"https://www.mapbox.com/about/maps",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"Mapbox"})," ",r.jsx("a",{href:"https://www.mapbox.com/legal/end-user-terms",target:"_blank",rel:"noreferrer",className:"me-2 text-[#2964aa]!",children:r.jsx(q,{id:"u3dZJq",defaultMessage:"Terms"})}),"© ",r.jsx("a",{href:"http://www.openstreetmap.org/about",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"OpenStreetMap"})]})]})}const et={TTFP:"products.ttfp",TTLT:"products.ttlt",TTF_VISIBLE_CONTENT_TOKEN:"products.ttf_visible_content_token"},bo={[et.TTFP]:new Set,[et.TTLT]:new Set,[et.TTF_VISIBLE_CONTENT_TOKEN]:new Set};function jn({profiler:t,messageId:e,metric:s,overrideDurationMs:n}){bo[s].add(e);const o=Vc();t.logTimingOnce(s,{context:{eval_preset:o.eval_preset},overrideDurationMs:n})}function Sn({messageId:t,metric:e}){return bo[e].has(t)}function bi(t){"use forget";const e=je.c(27),{clientThreadId:s,messageId:n,products:o}=t;let a;e[0]!==n?(a=k=>[ft.getRequestId(k),ft.isMessageTurnEnded(k,n)],e[0]=n,e[1]=a):a=e[1];const[i,l]=us(s,a);let c;e[2]!==s?(c={namespace:Gc.ProductsCompletionRequest,clientThreadId:s},e[2]=s,e[3]=c):c=e[3];const{profiler:d,isRequestActive:f}=Hc(c),u=f&&!l,g=Uc(u);let p,x;e[4]!==u||e[5]!==n||e[6]!==o.length||e[7]!==d?(p=()=>{Sn({messageId:n,metric:et.TTFP})||d&&u&&o.length>0&&jn({profiler:d,messageId:n,metric:et.TTFP})},x=[u,n,o.length,d],e[4]=u,e[5]=n,e[6]=o.length,e[7]=d,e[8]=p,e[9]=x):(p=e[8],x=e[9]),m.useEffect(p,x);let w,S;e[10]!==u||e[11]!==n||e[12]!==g||e[13]!==d?(w=()=>{Sn({messageId:n,metric:et.TTLT})||d&&g.current&&!u&&jn({profiler:d,messageId:n,metric:et.TTLT})},S=[n,g,u,d],e[10]=u,e[11]=n,e[12]=g,e[13]=d,e[14]=w,e[15]=S):(w=e[14],S=e[15]),m.useEffect(w,S);const h=Me();let M;e[16]!==h||e[17]!==n||e[18]!==d||e[19]!==i?(M=()=>{if(Sn({messageId:n,metric:et.TTF_VISIBLE_CONTENT_TOKEN}))return;const k=i?Vl(h,i):null;if(d&&k){const j=et.TTF_VISIBLE_CONTENT_TOKEN;bo[j].add(n),jn({profiler:d,messageId:n,metric:j,overrideDurationMs:k.turnTracker.first_visible_content_token_lat})}},e[16]=h,e[17]=n,e[18]=d,e[19]=i,e[20]=M):M=e[20];let v;e[21]!==h||e[22]!==n||e[23]!==o.length||e[24]!==d||e[25]!==i?(v=[n,d,i,o.length,h],e[21]=h,e[22]=n,e[23]=o.length,e[24]=d,e[25]=i,e[26]=v):v=e[26],m.useEffect(M,v)}function nx({contentReference:t,clientThreadId:e,messageId:s,turnIndex:n,trackContentReferenceEvent:o}){const a=m.useCallback(()=>o("Search Content Reference Shown","search_content_reference_shown","product_entity",{content_reference_start_index:t.start_idx,product_id:t.product.id}),[o,t.start_idx,t.product.id]),i=m.useCallback(()=>o("Search Content Reference Clicked","search_content_reference_clicked","product_entity",{content_reference_start_index:t.start_idx,product_id:t.product.id}),[o,t.start_idx,t.product.id]),l=t.product;m.useEffect(()=>a(),[a]),bi({clientThreadId:e,messageId:s,products:[l]});const{openThreadSidebar:c}=bs();return r.jsx("span",{className:"entity-underline hover:entity-accent inline cursor-pointer align-baseline",onClick:()=>{if(i(),l.offers||!l.url){if(!e)return;c({type:"product",messageId:s,turnIndex:n,contentReferenceStartIndex:t.start_idx,productIndex:0,productId:l.id,productUrl:l.url,interactionSource:"inline_link"})}else window.open(l.url,"_blank")},children:r.jsx("span",{className:"whitespace-normal",children:l.title})})}const ox=ne(()=>se(()=>import("./jyroje0qaxw6h3z1.js").then(t=>t._),__vite__mapDeps([35,1])),{loading:t=>ae(t)}),rx=ne(()=>se(()=>import("./frf0wu8ouyfyu06j.js").then(t=>t._),__vite__mapDeps([36,1])),{loading:t=>ae(t)}),ax=ne(()=>se(()=>import("./llj6x3d5vhdkrkxn.js").then(t=>t._),__vite__mapDeps([44,1])),{loading:t=>ae(t)});function yi({items:t,targetItemCount:e,onCardRender:s,onCardShown:n,onCardClicked:o,onReplyClicked:a,allowFullWidth:i=!1,cardClassName:l,showGradient:c=!0,arrowClassName:d}){const f=m.useRef(null),[u,g]=m.useState(null),p=m.useRef(null),x=()=>{p.current=setTimeout(()=>{g(null),p.current=null},200)},w=()=>{p.current&&(clearTimeout(p.current),p.current=null)},S=m.useRef(null),[h,M]=m.useState({left:0,top:0}),v=8;m.useEffect(()=>{const C=f.current,_=S.current;if(!a||!u||!C||!_)return;const R=()=>{const $=u.card.getBoundingClientRect(),A=C.getBoundingClientRect(),N=_.getBoundingClientRect(),T=$.bottom-A.top+v;var I=$.left-A.left;I=Math.max(0,I),I=Math.min(I,A.width-N.width),M({left:I,top:T})};return R(),C.addEventListener("scroll",R),()=>C.removeEventListener("scroll",R)},[u,t,a]);const k=xs(),j=k?2:4;if(e===void 0)e=t.length;else if(!e&&t.length<j)return null;const y=(e!=null?e:t.length)>=j,E=y&&k;return r.jsxs("div",{className:"relative",children:[r.jsx("div",{ref:f,className:D("flex flex-row gap-4 py-2",E&&"mx-[-1rem] px-[1rem]",y&&"no-scrollbar snap-x snap-proximity scroll-ps-4 overflow-x-scroll scroll-smooth"),children:t.map((C,_)=>r.jsx("div",{className:D(y||!i?"thread-lg:w-61 w-50 shrink-0 snap-start":"min-w-0 flex-1"),children:r.jsx(ix,{cardClassName:l,onShown:()=>n(C,_),onClick:()=>o(C,_),onHover:R=>{w(),R?g({card:R,item:C,index:_}):x()},children:s(C,!k&&e===1)})},_))}),y&&!E&&r.jsx(lx,{scrollableRef:f,units:t.length,showGradient:c,arrowClassName:d}),a&&r.jsx("div",{ref:S,className:D("absolute z-10",u?"pointer-events-auto opacity-100":"pointer-events-none opacity-0","transition-[transform,opacity] duration-200"),style:{willChange:"opacity, transform",left:h.left,top:h.top,transform:u?"translateY(0)":"translateY(".concat(-v,"px)")},onMouseEnter:w,onMouseLeave:x,children:r.jsx(Ve,{className:D(u?"pointer-events-auto":"pointer-events-none","border-light bg-clip-padding px-4 py-2 shadow-md"),size:"small",color:"secondary",onClick:()=>u&&a(u.item,u.index),children:r.jsxs("div",{className:"flex flex-row items-center gap-1",children:[r.jsx(ax,{className:"icon-sm text-token-text-secondary"}),r.jsx(q,{id:"9TG7OR",defaultMessage:"Ask about this"})]})})})]})}function ix({onShown:t,onClick:e,onHover:s,children:n,cardClassName:o}){const a=m.useRef(null),i=m.useRef(t);return m.useEffect(()=>{i.current=t},[t]),m.useEffect(()=>{if(!a.current)return;const l=new IntersectionObserver(([c])=>c.isIntersecting&&i.current(),{threshold:.5});return l.observe(a.current),()=>l.disconnect()},[]),r.jsx("div",{ref:a,className:D("h-full w-full","bg-token-bg-primary cursor-pointer",o),onClick:e,onMouseEnter:()=>a.current&&s(a.current),onMouseLeave:()=>s(null),children:n})}function lx({scrollableRef:t,units:e,showGradient:s,arrowClassName:n}){const[o,a]=m.useState({left:!1,right:!1}),[i,l]=m.useState(!1);m.useEffect(()=>{const d=t.current;if(!d)return;const f=()=>{const{scrollLeft:u,scrollWidth:g,clientWidth:p}=d,x=u/(g-p);a({left:x>0,right:x<1}),!i&&u>0&&l(!0)};return f(),d.addEventListener("scroll",f),()=>d.removeEventListener("scroll",f)},[t,e,i]);const c=d=>{if(!t.current)return;l(!0);const{clientWidth:f,scrollWidth:u}=t.current,g=u/e,p=Math.floor(f/g)*g;t.current.scrollBy({left:p*d,behavior:"smooth"})};return r.jsxs("div",{className:"pointer-events-none absolute start-0 top-0 flex h-full w-full flex-row",children:[r.jsx("div",{className:D("flex h-full w-9 items-center justify-start",i&&s&&"bg-linear-to-r from-(--bg-primary) to-transparent",o.left?"opacity-100":"opacity-0","transition-opacity duration-100"),children:r.jsx(Ve,{color:"secondary",size:"small",className:D("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-8 w-8 translate-x-[-50%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",n),onClick:()=>c(-1),children:r.jsx(rx,{className:"icon"})})}),r.jsx("div",{className:D("ms-auto flex h-full w-9 items-center justify-end",i&&s&&"bg-linear-to-l from-(--bg-primary) to-transparent",o.right?"opacity-100":"opacity-0","transition-opacity duration-200"),children:r.jsx(Ve,{color:"secondary",size:"small",className:D("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-8 w-8 translate-x-[50%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",n),onClick:()=>c(1),children:r.jsx(ox,{className:"icon"})})})]})}const yo=ne(()=>se(()=>import("./eu4d2sy2duibeikv.js").then(t=>t._),__vite__mapDeps([3,1])),{loading:t=>ae(t)}),cx=ne(()=>se(()=>import("./jyroje0qaxw6h3z1.js").then(t=>t._),__vite__mapDeps([35,1])),{loading:t=>ae(t)});function dx({contentReference:t,clientThreadId:e,messageId:s,turnIndex:n,analyticsMetadata:o}){const a=t.products,i=t.target_product_count;bi({clientThreadId:e,messageId:s,products:a});const{showDebugConversationTurns:l}=ql(),c=us(e,j=>{var C,_;const E=(_=(C=ft.getNode(j,s).message.metadata)==null?void 0:C.content_references)==null?void 0:_.find(R=>R.type==="products");return t.start_idx===(E==null?void 0:E.start_idx)}),d=Me(),f=Pe(d,"3144771298"),u=at(d),g=rt(()=>Zs(d)),p=Pe(d,"2212894775"),x=La(o),w=m.useCallback((j,y)=>x("Search Content Reference Shown","search_content_reference_shown","products",{content_reference_start_index:t.start_idx,product_index:y,product_id:j.id,product_url:j.url}),[x,t.start_idx]),S=m.useCallback((j,y)=>x("Search Content Reference Clicked","search_content_reference_clicked","products",{content_reference_start_index:t.start_idx,product_index:y,product_id:j.id}),[x,t.start_idx]),{openThreadSidebar:h}=bs(),M=(j,y)=>{e&&(S(j,y),j.offers?h({type:"product",messageId:s,turnIndex:n,contentReferenceStartIndex:t.start_idx,productIndex:y,productId:j.id,productUrl:j.url,interactionSource:"carousel"}):window.open(j.url,"_blank"))},{setTargetedContent:v}=qc(),k=(j,y)=>{st.logEventWithStatsig("Product Targeted Reply Clicked","product_targeted_reply_clicked",Q(z({},hs(o)),{content_reference_start_index:t.start_idx,product_index:(y+1).toString(),product_id:j.id})),v({type:"object",label:j.title,createNewCompletionParams:E=>{var _;const C=Kl(j.title);return Q(z({},E),{promptMessage:Kc(E.promptMessage,{metadata:{targeted_reply:j.title,targeted_reply_label:j.title,targeted_reply_icon:"product_tag"}}),appendMessages:[...(_=E.appendMessages)!=null?_:[],C]})},onCreateCompletion:({serverThreadId:E,currentLeafId:C})=>{st.logEventWithStatsig("Targeted Reply Submitted","chatgpt_targeted_reply_submitted",{conversation_id:E,current_leaf_id:C,source_message_id:s,content_reference_start_index:t.start_idx,product_index:(y+1).toString(),product_id:j.id})},onCleared:({serverThreadId:E,currentLeafId:C})=>{st.logEventWithStatsig("Targeted Reply Cleared","chatgpt_targeted_reply_cleared",{conversation_id:E,current_leaf_id:C,source_message_id:s,content_reference_start_index:t.start_idx,product_index:(y+1).toString(),product_id:j.id})}})};if(t.inline_carousel&&a.length===1){const j=a[0];return r.jsx("div",{className:"flex flex-col","data-testid":"shopping-widget",children:r.jsx(hx,{product:j,showDebug:l,onShown:()=>w(j,0),onClicked:()=>M(j,0)})})}return r.jsxs("div",{className:"flex flex-col","data-testid":"products-widget",children:[u?r.jsx("div",{className:D("relative mb-6",g?"-mx-[var(--thread-content-margin)]":"-mx-6"),children:r.jsx(nn,{items:a,getItemKey:j=>j.id,onRenderItem:j=>r.jsx(Kr,{product:j,wide:!1,showDebug:l,isProductV2CardEnabled:p}),className:"min-h-36",itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)] thread-lg:w-61 w-50 shrink-0 border-none",arrowClassName:p?"translate-y-[-85%]!":"",onShown:w,onClick:M})}):r.jsx(yi,{items:a,targetItemCount:i,onCardRender:(j,y)=>r.jsx(Kr,{product:j,wide:y,showDebug:l,isProductV2CardEnabled:p}),onCardShown:w,onCardClicked:M,onReplyClicked:p?void 0:k,arrowClassName:p?"translate-y-[-85%]":"",allowFullWidth:!0,showGradient:!p,cardClassName:D(p?"group":"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden")}),c&&f&&!p&&r.jsxs("div",{className:"text-token-text-tertiary flex text-xs hover:cursor-pointer hover:underline",onClick:()=>window.open("https://help.openai.com/en/articles/11128490","_blank"),children:[r.jsx(q,{id:"4Y5Zn5",defaultMessage:"ChatGPT chooses products independently. Learn more"}),r.jsx(cx,{className:"icon -ms-0.5"})]}),!1]})}function Kr(t){"use forget";const e=je.c(5),{product:s,wide:n,showDebug:o,isProductV2CardEnabled:a}=t,i=o===void 0?!1:o;let l;return e[0]!==a||e[1]!==s||e[2]!==i||e[3]!==n?(l=a?r.jsx(fx,{product:s,wide:n,showDebug:i}):r.jsx(ux,{product:s,wide:n,showDebug:i}),e[0]=a,e[1]=s,e[2]=i,e[3]=n,e[4]=l):l=e[4],l}function ux({product:t,wide:e,showDebug:s=!1}){var l,c;const n=t.image_urls?t.image_urls[0]:void 0,[o,a]=m.useState("contain"),i=m.useRef(null);return r.jsxs("div",{className:D("flex",e?"flex-row":"flex-col"),children:[r.jsxs("div",{className:D("relative aspect-square",e?"w-1/3":"w-full","bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse"),children:[n?r.jsx("img",{ref:i,className:"absolute inset-0 m-0 h-full w-full mix-blend-darken object-".concat(o),src:n,alt:t.title,onLoad:()=>{if(!i.current)return;const{naturalWidth:d,naturalHeight:f}=i.current,u=d/f;a(Math.abs(u-1)<.25?"cover":"contain")}}):r.jsx("div",{className:"flex aspect-square items-center justify-center",children:r.jsx(yo,{className:"text-token-text-tertiary h-12 w-12"})}),t.featured_tag&&r.jsx("div",{className:"absolute start-3 end-3 bottom-3",children:r.jsxs("div",{className:"relative max-w-fit px-2 py-1",children:[r.jsx("div",{className:"absolute inset-0 rounded-full bg-white/60 backdrop-blur-xl"}),r.jsx("div",{className:"relative truncate text-xs font-semibold text-gray-950",children:t.featured_tag})]})})]}),r.jsxs("div",{className:"flex flex-1 flex-col p-4",children:[r.jsx("div",{className:"line-clamp-2 leading-snug font-semibold text-ellipsis",children:t.title}),t.description&&r.jsx("div",{className:"line-clamp-3 pt-3 text-sm text-ellipsis",children:t.description}),r.jsx("div",{className:"flex-1"}),r.jsxs("div",{className:"flex flex-row items-end pt-3",children:[r.jsxs("div",{className:"flex flex-col overflow-hidden",children:[r.jsx("div",{className:"text-md leading-snug font-semibold",children:t.price}),r.jsx("div",{className:"text-token-text-secondary overflow-hidden pt-0.5 text-xs text-ellipsis whitespace-nowrap",children:t.merchants})]}),r.jsx("div",{className:"flex-1"}),t.num_reviews&&t.num_reviews>0&&r.jsxs("div",{className:"text-token-text-secondary flex w-fit flex-row gap-1 text-sm",children:[r.jsx(dc,{rating:(l=t.rating)!=null?l:0/5}),((c=t.rating)!=null?c:0).toFixed(1)]})]}),!1]})]})}function fx({product:t,wide:e,showDebug:s=!1}){const n=t.image_urls?t.image_urls[0]:void 0,[o,a]=m.useState("contain"),[i,l]=m.useState("top"),c=m.useRef(null);return r.jsxs("div",{className:D("flex pb-2",e?"flex-row gap-3":"flex-col gap-2"),children:[r.jsx("div",{className:D("relative",e?"aspect-square w-1/4":"aspect-[13/16] w-full","bg-token-bg-tertiary dark:bg-token-text-inverted overflow-clip rounded-xl"),children:r.jsx(za,{className:"mix-blend-darken dark:mix-blend-lighten",children:n?r.jsx("img",{ref:c,className:"absolute inset-0 m-0 h-full w-full object-".concat(o," object-").concat(i),src:n,alt:t.title,onLoad:()=>{if(!c.current)return;const{naturalWidth:d,naturalHeight:f}=c.current,u=d/f;a(Math.abs(u-1)<.4?"cover":"contain"),l(f>d?"top":"center")}}):r.jsx("div",{className:"flex aspect-square items-center justify-center",children:r.jsx(yo,{className:"text-token-text-tertiary h-12 w-12"})})})}),r.jsxs("div",{className:"flex flex-col gap-1 px-1",children:[r.jsx("div",{className:D("line-clamp-2 font-medium text-ellipsis",e?"text-base":"text-sm"),children:t.title}),r.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-0.25 text-sm",children:[r.jsx("div",{children:t.price}),r.jsx("div",{className:"mx-0.5",children:"•"}),r.jsx("div",{className:"truncate",children:t.merchants})]}),!1]})]})}function mx({className:t,imageUrl:e,productTitle:s,onClicked:n}){const[o,a]=m.useState("contain"),i=m.useRef(null);return r.jsx("div",{className:D(t,"hover:scale-[1.005]","dark:bg-token-text-inverted bg-token-bg-primary","cursor-pointer overflow-hidden rounded-xl shadow-inner transition-all duration-200","relative aspect-square max-h-60"),onClick:n,children:e?r.jsx("img",{ref:i,className:"m-0 h-full w-full overflow-hidden object-".concat(o," mix-blend-darken"),src:e,alt:s,onLoad:()=>{if(!i.current)return;const{naturalWidth:l,naturalHeight:c}=i.current,d=l/c;a(Math.abs(d-1)<.5?"cover":"contain")}}):r.jsx("div",{className:"flex aspect-square items-center justify-center",children:r.jsx(yo,{className:"text-token-text-tertiary h-12 w-12"})})})}function hx({product:t,showDebug:e=!1,onShown:s,onClicked:n}){return m.useEffect(()=>{s()},[s]),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex flex-row gap-2 py-2",children:t.image_urls&&t.image_urls.length>0&&t.image_urls.slice(0,3).map(o=>r.jsx(mx,{imageUrl:o,productTitle:t.title,onClicked:n},o))}),!1]})}function px({attribution:t,wordFadeType:e}){var a;const s=m.useContext(jt),n=Xc(s==null?void 0:s.message.id,t.attributable_index),o=Zc();return r.jsx(bx,{isHighlighted:n,isDebugMode:o&&!1,content:(a=t.alt)!=null?a:"",attributableIndex:t.attributable_index,attributions:void 0,attributionsDebug:void 0,wordFadeType:e})}const gx=m.memo(lo);function xx({content:t,isHighlighted:e,isDebugMode:s,attributableIndex:n,attributions:o,attributionsDebug:a,wordFadeType:i}){const l=i==="indexed",c=Da(),d=m.useMemo(()=>l?{handlers:{text:(g,p,x)=>{const w=[];for(const S of c(p.value))w.push({type:"element",tagName:"span",properties:{className:Oa.fadeIn},children:[{type:"text",value:S}]});return w}}}:void 0,[l,c]),f=m.useMemo(()=>({p:({children:g})=>r.jsx(r.Fragment,{children:g})}),[]),u=r.jsx(gx,{rehypePlugins:Tn,remarkPlugins:Nn,urlTransform:En,remarkRehypeOptions:d,components:f,children:t});return r.jsx(yx,{isHighlighted:e,children:u})}const bx=ma.memo(xx);function yx({isHighlighted:t,className:e,children:s}){return r.jsx("span",{className:D("relative","-mx-px my-[-0.2rem] rounded px-px py-[0.2rem]",t&&"attribution-highlight-bg","transition-colors duration-100 ease-in-out",e),children:s})}function Xr(t,e){try{return BigInt(t).toLocaleString(e)}catch(s){const n=Number(t);return t.includes("e")||t.includes("E")?n.toExponential():n.toLocaleString(e,{maximumFractionDigits:6})}}function _x({data:t,trackContentReferenceEvent:e}){m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=Xl().locale;return t.expression&&t.result!=null?r.jsxs("div",{className:"no-scrollbar overflow-auto sm:overflow-hidden",children:[r.jsxs("div",{className:"pb-1 text-lg font-semibold",children:[t.prefix&&r.jsx("span",{children:t.prefix}),r.jsx("span",{children:Xr(t.result,s)}),t.suffix&&r.jsx("span",{children:t.suffix})]}),r.jsx("div",{className:"text-token-text-primary tracking-wide",children:"".concat(t.expression,"=").concat(Xr(t.result,s))})]}):null}const wx=ne(()=>se(()=>import("./n1njhaxkf65rrafr.js").then(t=>t._),__vite__mapDeps([45,1])),{loading:t=>ae(t)});function _i({ref:t,onClick:e,onMouseEnter:s,onMouseLeave:n}){const o=_e();return r.jsx("button",{ref:t,"aria-label":o.formatMessage({id:"citation.icon.label",defaultMessage:"Coding Citation"}),onClick:e,onMouseEnter:s,onMouseLeave:n,className:D("rounded-xl px-1","bg-token-interactive-bg-tertiary-press text-token-text-secondary hover:text-token-text-inverted hover:bg-token-interactive-bg-primary-selected"),children:r.jsx(wx,{className:"icon-sm"})})}function vx({codeMessage:t,codeExecutionOutputMessage:e,onDismiss:s,FormattedText:n}){const o=_e();return r.jsx(_t.Root,{isOpen:!0,onClose:s,testId:"modal-code-execution",children:r.jsx(_t.Overlay,{children:r.jsxs(_t.Content,{className:"flex max-h-[75vh] max-w-lg flex-col overflow-hidden",children:[r.jsx(_t.Header,{title:o.formatMessage(kx.title),type:"success",closeButton:r.jsx(Zl,{onClick:s})}),r.jsxs("div",{className:"flex flex-1 flex-col overflow-auto",children:[r.jsx("div",{children:r.jsx(ju,{FormattedText:n,message:t,codeRendererClassName:"border-none rounded-none",removeTopBorderRadius:!0})}),r.jsx("div",{children:r.jsx(Su,{message:e})})]})]})})})}const kx=Gt({title:{id:"CodeExecutionOutputModal.title",defaultMessage:"Analysis"}});function jx({displayInfo:t,FormattedText:e,trackContentReferenceEvent:s}){const[n,o]=m.useState(!1),a=_e();return m.useEffect(()=>{s("Search Content Reference Shown","search_content_reference_shown",t.type)},[s,t.type]),r.jsxs(r.Fragment,{children:[r.jsx(Ct,{label:a.formatMessage(Sx.viewAnalysis),side:"top",delayDuration:150,className:"align-middle",children:r.jsx(_i,{onClick:()=>o(!0)})}),n&&r.jsx(vx,{FormattedText:e,codeMessage:t.codeMessage,codeExecutionOutputMessage:t.codeExecutionOutputMessage,onDismiss:()=>o(!1)})]})}const Sx=Gt({viewAnalysis:{id:"viewAnalysis",defaultMessage:"View analysis"}});function Mx({contentReference:t,clientThreadId:e,turnIndex:s}){var p,x,w,S,h,M,v;const{toggleThreadSidebar:n}=bs(),o=Yc("codingCitations"),[a,i]=m.useState(!1),l=m.useRef(null),c=()=>{l.current!=null&&window.clearTimeout(l.current),i(!0)},d=()=>{l.current=window.setTimeout(()=>i(!1),100)},f=m.useCallback(()=>{var k,j;e&&n({type:"codingCitations",turnIndex:s||1,messageId:(j=(k=t.cited_message)==null?void 0:k.id)!=null?j:"",matchedText:t.matched_text},o)},[n,e,o,t,s]);if(!t.cited_message||!t.highlighted_text)return null;let u;t.type==="python"?u=(w=(x=(p=t.cited_message)==null?void 0:p.metadata)==null?void 0:x.aggregate_result)==null?void 0:w.code:t.type==="container"&&(u=(M=(h=(S=t.cited_message)==null?void 0:S.metadata)==null?void 0:h.container_citation)==null?void 0:M.source_cmd);const g=(v=u==null?void 0:u.split("\n").length)!=null?v:0;return r.jsx("span",{className:"relative top-[0.1rem] inline-block align-middle",children:r.jsx("span",{className:"inline-flex items-center",children:r.jsxs(Qs,{open:a,onOpenChange:i,children:[r.jsx(en,{asChild:!0,children:r.jsx(_i,{onClick:f,onMouseEnter:c,onMouseLeave:d})}),r.jsx(tn,{children:r.jsx(sn,{align:"start",sideOffset:4,onMouseEnter:c,onMouseLeave:d,className:D("border-default bg-token-bg-primary rounded-2xl border p-3"),children:r.jsxs("aside",{className:"flex flex-col gap-3",children:[r.jsx("h2",{className:D("text-token-text-secondary text-xs font-medium"),children:t.type==="python"?r.jsx(q,{id:"citation.popover.label.python",defaultMessage:"Python script · {count, number} lines",values:{count:g}}):r.jsx(q,{id:"citation.popover.label.container",defaultMessage:"Bash script · {count, number} lines",values:{count:g}})}),r.jsx("hr",{}),r.jsx("h2",{className:D("text-sm font-medium","max-w-full break-words whitespace-pre-line sm:max-w-[300px]"),children:t.highlighted_text})]})})})]})})})}function Cx({dil:t,trackContentReferenceEvent:e,widgetName:s}){return m.useEffect(()=>{const n=s==null?void 0:{widget_name:s};e("Search Content Reference Shown","search_content_reference_shown","dil",n)},[e,s]),null}function Ex({product:t,clientThreadId:e,messageId:s,contentReferenceStartIndex:n,trackContentReferenceEvent:o,showTitle:a=!1,showImageGallery:i=!1}){var v,k,j,y;const l=Me(),c=Pe(l,"3375735072"),d=Pe(l,"232003972"),f=m.useMemo(()=>({clientThreadId:e,messageId:s}),[e,s]),u=no.useStore(),[g,p]=m.useState(!1),[x,w]=m.useState(t),[S,h]=m.useState(!1),M=a||d||c;return m.useEffect(()=>{let E=!0;return(async _=>{h(!0);try{try{for(var R=fn(Nx(_)),$,A,N;$=!(A=await R.next()).done;$=!1){const T=A.value;E&&w(T)}}catch(A){N=[A]}finally{try{$&&(A=R.return)&&await A.call(R)}finally{if(N)throw N[0]}}}finally{E&&h(!1)}})(x),()=>{E=!1}},[(v=x.product_lookup_key)==null?void 0:v.variant_options_query]),x?r.jsxs("div",{className:"-mx-6",children:[i&&r.jsx(uc,{imageUrls:(k=x.image_urls)!=null?k:[],title:x.title,onImageClick:E=>{u.setCurrentImage({image:{url:E,content_url:E,thumbnail_url:E,title:x.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:St.ProductDetails,analyticsMetadata:f,contentReferenceStartIndex:n})}}),r.jsxs("div",{className:"bg-token-bg-primary flex w-full flex-col",children:[M&&r.jsxs("div",{className:"border-token-border-light flex flex-col border-b px-6 pb-3",children:[a&&r.jsx("div",{className:"text-token-text-primary text-xl font-medium capitalize",children:x.title}),d&&x.num_reviews&&x.rating&&r.jsx(fc,{rating:x.rating,numReviews:x.num_reviews,ratingGroupedCitation:x.rating_grouped_citation,trackContentReferenceEvent:()=>{},analyticsMetadata:f}),c&&x.variants&&x.variants.length>0&&r.jsx("div",{className:"mt-5 mb-2",children:r.jsx(mc,{options:x.variants,showErrors:g,updateOption:(E,C,_)=>w(R=>Tx({optionGroupId:E,selectedId:C,variant_index:_,product:R,trackContentReferenceEvent:o}))})})]}),r.jsx(hc,{className:"border-token-border-light -pt-3 -mx-3 flex flex-col border-b px-6 pb-3",offers:(j=t.offers)!=null?j:[],contentReferenceStartIndex:n,productIndex:0,product:t,trackContentReferenceEvent:o,analyticsMetadata:f,imageUrls:(y=t.image_urls)!=null?y:[],isLoading:S,onOpenCheckout:()=>p(!0)})]})]}):null}function Nx(t){return $o(this,null,function*(){const{product_lookup_key:e}=t;if(!!!(e!=null&&e.variant_options_query)){yield t;return}const n=Jc("".concat(Yl,"/search/product_info_variants"),{method:"POST",headers:z({},Kn({isAuthOptional:!0})),body:{product_lookup_key:t.product_lookup_key}});try{for(var o=fn(n),a,i,l;a=!(i=yield new ks(o.next())).done;a=!1){const c=i.value;"data"in c&&(yield c.data.product)}}catch(i){l=[i]}finally{try{a&&(i=o.return)&&(yield new ks(i.call(o)))}finally{if(l)throw l[0]}}})}function Tx({optionGroupId:t,selectedId:e,variant_index:s,product:n,trackContentReferenceEvent:o}){var d,f,u,g,p,x;const a=(d=n.variants)==null?void 0:d.find(w=>w.id===t);o("product_detail","product_detail","product_entity",{product_id:n.id,action:"variant_selected",section:"product_detail",section_location:"sidebar",variant_name:(f=a==null?void 0:a.label)!=null?f:"",variant_value:(g=(u=a==null?void 0:a.options.find(w=>w.id===e))==null?void 0:u.label)!=null?g:"",variant_index:s});const i=(x=(p=n.variants)==null?void 0:p.map(w=>w.id===t?Q(z({},w),{options:w.options.map(S=>Q(z({},S),{selected:S.id===e})),selected_option_id:e}):w))!=null?x:n.variants,c=(i==null?void 0:i.every(w=>w.selected_option_id))?i==null?void 0:i.reduce((w,S)=>(S.selected_option_id&&(w[S.id]=S.selected_option_id),w),{}):null;return Q(z({},n),{variants:i,product_lookup_key:Q(z({},n.product_lookup_key),{variant_options_query:c})})}function Ix({contentReference:t,clientThreadId:e,messageId:s,trackContentReferenceEvent:n}){var o,a,i;if(m.useEffect(()=>{var l,c;n("Entity Metadata Content Reference Shown","entity_metadata_content_reference_shown","entity_metadata",z({entity_type:t.entity_type},t.entity_type==="local_business"?{business_id:(l=t.entity_data)==null?void 0:l.id}:t.entity_type==="product"?{product_id:(c=t.entity_data)==null?void 0:c.id}:{}))},[n,t.entity_type,(o=t.entity_data)==null?void 0:o.id]),!(t!=null&&t.entity_data))return null;if(t.entity_type==="local_business"){const c=t.layout!=="one-line";return r.jsx(Rg,{isLoading:(a=t.metadata)==null?void 0:a.is_loading,business:t.entity_data,mapUrl:(i=t.metadata)==null?void 0:i.map_url,showActionButtons:c,showTitle:c,showHourDetail:c,showPrice:c,trackContentReferenceEvent:n,topOffset:c?0:-4})}else if(t.entity_type==="product")return r.jsx(Ex,{product:t.entity_data,clientThreadId:e,messageId:s,contentReferenceStartIndex:t.start_idx,trackContentReferenceEvent:n});return null}function Px(t,e){return new Date(t).toLocaleDateString(e,{month:"long",day:"numeric",year:"numeric"})}function Rx({metadata:t,trackContentReferenceEvent:e}){const s=t.items.filter(n=>n.cloud_doc_url||Qc(n.id));return s.length===0?null:r.jsx("div",{className:"mt-6 flex flex-col gap-3",children:s.map((n,o)=>r.jsx($x,{item:n,index:o,trackContentReferenceEvent:e},o))})}function $x({item:t,index:e,trackContentReferenceEvent:s}){const n=_e(),o=Me(),a=ed(),{fileName:i,fileTypeDisplayName:l,fileTypeIcon:c,snippet:d,url:f,fileLastModifiedTime:u}=Mu(t,"icon object-contain",o,n,a),g={title:i,description:d!=null?d:"",index:e};return m.useEffect(()=>{s("Contextual Answers Content Reference Shown","contextual_answers_content_reference_shown","file_navlist",g)},[]),r.jsxs(Et,{className:"group/nav-list relative flex items-center gap-6 py-1.5",href:f!=null?f:"/",onClick:()=>{s("Contextual Answers Content Reference Clicked","contextual_answers_content_reference_clicked","file_navlist",g)},children:[r.jsx("div",{className:"absolute start-0 top-0 bottom-0 w-[3px] rounded-t-lg rounded-b-lg bg-black/10"}),r.jsxs("div",{className:"ms-4 flex grow flex-col gap-1 overflow-hidden text-ellipsis",children:[r.jsxs("div",{className:"not-prose text-token-text-primary flex items-center gap-1.5 text-sm",children:[c,r.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm",children:l})]}),r.jsx("div",{className:"text-token-link decoration-token-link line-clamp-2 font-semibold group-hover/nav-list:underline",children:i}),r.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm leading-snug font-normal",children:d}),u&&r.jsx("div",{className:"text-token-text-secondary text-sm",children:Px(u,n.locale)})]})]})}var Mn={line:{color:"#F66",width:1,dashPattern:[]},sync:{enabled:!0,group:1,suppressTooltips:!1},zoom:{enabled:!0,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},snap:{enabled:!1},callbacks:{beforeZoom:function(t,e){return!0},afterZoom:function(t,e){}}},Ax={id:"crosshair",afterInit:function(t){if(t.config.options.scales.x){var e=t.config.options.scales.x.type;if(!(e!=="linear"&&e!=="time"&&e!=="category"&&e!=="logarithmic")){t.options.plugins.crosshair===void 0&&(t.options.plugins.crosshair=Mn),t.crosshair={enabled:!1,suppressUpdate:!1,x:null,originalData:[],originalXRange:{},dragStarted:!1,dragStartX:null,dragEndX:null,suppressTooltips:!1,ignoreNextEvents:0,reset:function(){this.resetZoom(t,!1,!1)}.bind(this)};var s=this.getOption(t,"sync","enabled");s&&(t.crosshair.syncEventHandler=function(n){this.handleSyncEvent(t,n)}.bind(this),t.crosshair.resetZoomEventHandler=function(n){var o=this.getOption(t,"sync","group");n.chartId!==t.id&&n.syncGroup===o&&this.resetZoom(t,!0)}.bind(this),window.addEventListener("sync-event",t.crosshair.syncEventHandler),window.addEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler)),t.panZoom=this.panZoom.bind(this,t)}}},afterDestroy:function(t){var e=this.getOption(t,"sync","enabled");e&&(window.removeEventListener("sync-event",t.crosshair.syncEventHandler),window.removeEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler))},panZoom:function(t,e){if(t.crosshair.originalData.length!==0){var s=t.crosshair.end-t.crosshair.start,n=t.crosshair.min,o=t.crosshair.max;e<0?(t.crosshair.start=Math.max(t.crosshair.start+e,n),t.crosshair.end=t.crosshair.start===n?n+s:t.crosshair.end+e):(t.crosshair.end=Math.min(t.crosshair.end+e,t.crosshair.max),t.crosshair.start=t.crosshair.end===o?o-s:t.crosshair.start+e),this.doZoom(t,t.crosshair.start,t.crosshair.end)}},getOption:function(t,e,s){return Uo(t.options.plugins.crosshair[e]?t.options.plugins.crosshair[e][s]:void 0,Mn[e][s])},getXScale:function(t){return t.data.datasets.length?t.scales[t.getDatasetMeta(0).xAxisID]:null},getYScale:function(t){return t.scales[t.getDatasetMeta(0).yAxisID]},handleSyncEvent:function(t,e){var s=this.getOption(t,"sync","group");if(e.chartId!==t.id&&e.syncGroup===s){var n=this.getXScale(t);if(n){var o=e.original.native.buttons===void 0?e.original.native.which:e.original.native.buttons;e.original.type==="mouseup"&&(o=0);var a={type:e.original.type=="click"?"mousemove":e.original.type,chart:t,x:n.getPixelForValue(e.xValue),y:e.original.y,native:{buttons:o},stop:!0};t._eventHandler(a)}}},afterEvent:function(t,e){if(t.config.options.scales.x.length==0)return;let s=e.event;var n=t.config.options.scales.x.type;if(!(n!=="linear"&&n!=="time"&&n!=="category"&&xscaleType!=="logarithmic")){var o=this.getXScale(t);if(o){if(t.crosshair.ignoreNextEvents>0){t.crosshair.ignoreNextEvents-=1;return}var a=s.native.buttons===void 0?s.native.which:s.native.buttons;s.native.type==="mouseup"&&(a=0);var i=this.getOption(t,"sync","enabled"),l=this.getOption(t,"sync","group");if(!s.stop&&i){var e=new CustomEvent("sync-event");e.chartId=t.id,e.syncGroup=l,e.original=s,e.xValue=o.getValueForPixel(s.x),window.dispatchEvent(e)}var c=this.getOption(t,"sync","suppressTooltips");if(t.crosshair.suppressTooltips=s.stop&&c,t.crosshair.enabled=s.type!=="mouseout"&&s.x>o.getPixelForValue(o.min)&&s.x<o.getPixelForValue(o.max),!t.crosshair.enabled&&!t.crosshair.suppressUpdate)return s.x>o.getPixelForValue(o.max)&&(t.crosshair.suppressUpdate=!0,t.update("none")),t.crosshair.dragStarted=!1,!1;t.crosshair.suppressUpdate=!1;var d=this.getOption(t,"zoom","enabled");if(a===1&&!t.crosshair.dragStarted&&d&&(t.crosshair.dragStartX=s.x,t.crosshair.dragStarted=!0),t.crosshair.dragStarted&&a===0){t.crosshair.dragStarted=!1;var f=o.getValueForPixel(t.crosshair.dragStartX),u=o.getValueForPixel(t.crosshair.x);Math.abs(t.crosshair.dragStartX-t.crosshair.x)>1&&this.doZoom(t,f,u),t.update("none")}t.crosshair.x=s.x,t.draw()}}},afterDraw:function(t){if(t.crosshair.enabled)return t.crosshair.dragStarted?this.drawZoombox(t):(this.drawTraceLine(t),this.interpolateValues(t),this.drawTracePoints(t)),!0},beforeTooltipDraw:function(t){return!t.crosshair.dragStarted&&!t.crosshair.suppressTooltips},resetZoom:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(s){if(t.crosshair.originalData.length>0)for(var n=0;n<t.data.datasets.length;n++){var o=t.data.datasets[n];o.data=t.crosshair.originalData.shift(0)}t.crosshair.originalXRange.min?(t.options.scales.x.min=t.crosshair.originalXRange.min,t.crosshair.originalXRange.min=null):delete t.options.scales.x.min,t.crosshair.originalXRange.max?(t.options.scales.x.max=t.crosshair.originalXRange.max,t.crosshair.originalXRange.max=null):delete t.options.scales.x.max}t.crosshair.button&&t.crosshair.button.parentNode&&(t.crosshair.button.parentNode.removeChild(t.crosshair.button),t.crosshair.button=!1);var a=this.getOption(t,"sync","enabled");if(!e&&s&&a){var i=this.getOption(t,"sync","group"),l=new CustomEvent("reset-zoom-event");l.chartId=t.id,l.syncGroup=i,window.dispatchEvent(l)}s&&t.update("none")},doZoom:function(t,e,s){if(e>s){var n=e;e=s,s=n}var o=Uo(t.options.plugins.crosshair.callbacks?t.options.plugins.crosshair.callbacks.beforeZoom:void 0,Mn.callbacks.beforeZoom);if(!o(e,s))return!1;if(t.crosshair.dragStarted=!1,t.options.scales.x.min&&t.crosshair.originalData.length===0&&(t.crosshair.originalXRange.min=t.options.scales.x.min),t.options.scales.x.max&&t.crosshair.originalData.length===0&&(t.crosshair.originalXRange.max=t.options.scales.x.max),!t.crosshair.button){var a=document.createElement("button"),i=this.getOption(t,"zoom","zoomButtonText"),l=this.getOption(t,"zoom","zoomButtonClass"),c=document.createTextNode(i);a.appendChild(c),a.className=l,a.addEventListener("click",function(){this.resetZoom(t)}.bind(this)),t.canvas.parentNode.appendChild(a),t.crosshair.button=a}t.options.scales.x.min=e,t.options.scales.x.max=s;var d=t.crosshair.originalData.length===0,f=t.config.options.scales.x.type!=="category";if(f)for(var u=0;u<t.data.datasets.length;u++){var g=[],p=0,x=!1,w=!1;d&&(t.crosshair.originalData[u]=t.data.datasets[u].data);for(var S=t.crosshair.originalData[u],h=0;h<S.length;h++){var M=S[h],v=M.x!==void 0?M.x:NaN;v>=e&&!x&&p>0&&(g.push(S[p-1]),x=!0),v>=e&&v<=s&&g.push(M),v>s&&!w&&p<S.length&&(g.push(M),w=!0),p+=1}t.data.datasets[u].data=g}if(t.crosshair.start=e,t.crosshair.end=s,d){var k=this.getXScale(t);t.crosshair.min=k.min,t.crosshair.max=k.max}t.crosshair.ignoreNextEvents=2,t.update("none");var j=this.getOption(t,"callbacks","afterZoom");j(e,s)},drawZoombox:function(t){var e=this.getYScale(t),s=this.getOption(t,"zoom","zoomboxBorderColor"),n=this.getOption(t,"zoom","zoomboxBackgroundColor");t.ctx.beginPath(),t.ctx.rect(t.crosshair.dragStartX,e.getPixelForValue(e.max),t.crosshair.x-t.crosshair.dragStartX,e.getPixelForValue(e.min)-e.getPixelForValue(e.max)),t.ctx.lineWidth=1,t.ctx.strokeStyle=s,t.ctx.fillStyle=n,t.ctx.fill(),t.ctx.fillStyle="",t.ctx.stroke(),t.ctx.closePath()},drawTraceLine:function(t){var e=this.getYScale(t),s=this.getOption(t,"line","width"),n=this.getOption(t,"line","color"),o=this.getOption(t,"line","dashPattern"),a=this.getOption(t,"snap","enabled"),i=t.crosshair.x;a&&t._active.length&&(i=t._active[0].element.x),t.ctx.beginPath(),t.ctx.setLineDash(o),t.ctx.moveTo(i,e.getPixelForValue(e.max)),t.ctx.lineWidth=s,t.ctx.strokeStyle=n,t.ctx.lineTo(i,e.getPixelForValue(e.min)),t.ctx.stroke(),t.ctx.setLineDash([])},drawTracePoints:function(t){for(var e=0;e<t.data.datasets.length;e++){var s=t.data.datasets[e],n=t.getDatasetMeta(e),o=t.scales[n.yAxisID];n.hidden||!s.interpolate||(t.ctx.beginPath(),t.ctx.arc(t.crosshair.x,o.getPixelForValue(s.interpolatedValue),3,0,2*Math.PI,!1),t.ctx.fillStyle="white",t.ctx.lineWidth=2,t.ctx.strokeStyle=s.borderColor,t.ctx.fill(),t.ctx.stroke())}},interpolateValues:function(t){for(var e=0;e<t.data.datasets.length;e++){var s=t.data.datasets[e],n=t.getDatasetMeta(e),o=t.scales[n.xAxisID],a=o.getValueForPixel(t.crosshair.x);if(!(n.hidden||!s.interpolate)){var i=s.data,l=i.findIndex(function(u){return u.x>=a}),c=i[l-1],d=i[l];if(t.data.datasets[e].steppedLine&&c)s.interpolatedValue=c.y;else if(c&&d){var f=(d.y-c.y)/(d.x-c.x);s.interpolatedValue=c.y+(a-c.x)*f}else s.interpolatedValue=NaN}}}};const Us=(t=1)=>"rgba(48, 166, 51, ".concat(t,")"),Gs=(t=1)=>"rgba(241, 77, 66, ".concat(t,")"),Zr="text-[#30a633]",Yr="text-[#f14d42]",Lx=["1d","5d","1m","6m","ytd","1y","5y","max"];function Dx({histories:t,selectedInterval:e,onSelectHistoryInterval:s}){var o;const n=Object.keys((o=t==null?void 0:t.quotes)!=null?o:{});return r.jsx("div",{className:"text-token-text-tertiary inline-flex items-start justify-between rounded-[10px] bg-[#f4f4f4] p-[3px] text-xs font-semibold sm:justify-start sm:gap-1 dark:bg-[#393939]",children:n.map(a=>r.jsx("button",{onClick:()=>{s==null||s(a)},className:D("border border-transparent px-3 py-1.5 text-xs font-semibold uppercase",e===a?"border-token-border-default! bg-token-main-surface-primary text-token-text-primary shadow-xxs dark:border-token-border-medium! rounded-lg":"hover:text-token-text-secondary"),children:wi[a].label},a))})}const wi={"1d":{label:"1D",formatTimestampLabel:Jr,formatTimestampTooltip:Jr,maxTicksLimit:6,lineTension:.1},"5d":{label:"5D",formatTimestampLabel:Qr,formatTimestampTooltip:Fx,maxTicksLimit:6,lineTension:.1},"1m":{label:"1M",formatTimestampLabel:Qr,formatTimestampTooltip:zx,maxTicksLimit:6,lineTension:.1,useUtc:!0},"6m":{label:"6M",formatTimestampLabel:Cn,formatTimestampTooltip:Jt,maxTicksLimit:5,lineTension:.1,useUtc:!0},ytd:{label:"YTD",formatTimestampLabel:Cn,formatTimestampTooltip:Jt,maxTicksLimit:5,lineTension:.1,useUtc:!0},"1y":{label:"1Y",formatTimestampLabel:Cn,formatTimestampTooltip:Jt,maxTicksLimit:5,lineTension:.2,useUtc:!0},"5y":{label:"5Y",formatTimestampLabel:ea,formatTimestampTooltip:Jt,maxTicksLimit:5,lineTension:.2,useUtc:!0},max:{label:"max",formatTimestampLabel:ea,formatTimestampTooltip:Jt,maxTicksLimit:5,lineTension:.2,useUtc:!0}};function Ox(t){return t?Lx.filter(s=>s in t.quotes).find(s=>t.quotes[s].length>0):void 0}function Tt(t,e){return ss(new Date(t*1e3),e!=null?e:"America/New_York")}function Jr(t,e,s){const n=Tt(e,s);return t.formatTime(n,{hour:"numeric",minute:"numeric"})}function Fx(t,e,s){const n=Tt(e,s);return t.formatDate(n,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}function Jt(t,e,s){const n=Tt(e,s);return t.formatDate(n,{month:"short",day:"numeric",year:"numeric"})}function Cn(t,e,s){const n=Tt(e,s);return t.formatDate(n,{month:"short",year:"numeric"})}function Qr(t,e,s){const n=Tt(e,s);return t.formatDate(n,{month:"short",day:"numeric"})}function zx(t,e,s){const n=Tt(e,s);return t.formatDate(n,{weekday:"short",month:"short",day:"numeric"})}function ea(t,e,s){const n=Tt(e,s);return t.formatDate(n,{year:"numeric"})}Pu.register(Ru,$u,Au,Lu,Du,Ou,Fu,zu,Bu,Ax,Wu);const Bx=100,ta={color:"#b4b4b4",font:{size:10,weight:"600",family:"Menlo"}};function Wx({isUp:t,histories:e,selectedInterval:s,setHighlightedPrice:n,latestTradingPeriod:o,timezone:a}){return r.jsx(r.Fragment,{children:e&&s&&o?r.jsx(Hx,{isUp:t,histories:e,selectedInterval:s,latestTradingPeriod:o,timezone:a,setHighlightedPrice:n}):r.jsx(Qt,{className:"h-full",index:1,width:100})})}function Hx({isUp:t,histories:e,selectedInterval:s,latestTradingPeriod:n,timezone:o,setHighlightedPrice:a}){const[i,l]=m.useState(null),[c,d]=m.useState(!1),f=s==="1d",u=m.useMemo(()=>{let k=e.quotes[s].filter(j=>j.close>=0);if(f&&n){const j=n.regular.start_timestamp,y=n.regular.end_timestamp;if(k=k.filter(E=>E.timestamp>=j&&E.timestamp<=y),k.length===0||k[k.length-1].timestamp<y){let C=k.length>0?k[k.length-1].timestamp:j-600;for(;C<y;)C+=600,k.push({timestamp:C,close:null})}}return k},[e,s,f,n]),g=wi[s],{formatTimestampTooltip:p,maxTicksLimit:x,useUtc:w=!1}=g,S=_e(),h=va(),M=Ys(),v=m.useMemo(()=>{const{formatTimestampLabel:k,lineTension:j}=g;return{labels:u.map(y=>k(S,y.timestamp,w?"UTC":o)),datasets:[{data:u.map(y=>y.close),borderColor:t?Us():Gs(),pointRadius:0,pointHoverRadius:4,pointStyle:"circle",pointBackgroundColor:t?Us():Gs(),pointHoverBorderWidth:2,pointHoverBorderColor:"rgba(255, 255, 255, 1)",backgroundColor:function(y){const{ctx:E,chartArea:C}=y.chart;if(C)return Gx(E,C,t)},fill:!0,borderWidth:2,lineTension:j!=null?j:.4}]}},[g,u,t,w,o,S]);return r.jsx("div",{className:"flex h-full flex-col gap-6",children:r.jsxs("div",{className:"relative h-full",onMouseEnter:()=>d(!0),onMouseLeave:()=>{d(!1),a(null)},children:[r.jsx(Hu,{options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},hover:{mode:c?"index":"point"},animation:!1,scales:{x:{afterBuildTicks:k=>{if(k.ticks.length>x)if(f)k.ticks=k.ticks.filter((j,y)=>u[y].timestamp%(h?3600:7200)===0);else{const j=Math.ceil(k.ticks.length/(x-1));k.ticks=k.ticks.filter((y,E)=>E>0&&(E%j===0||E===k.ticks.length-1))}},grid:{display:!1},ticks:Q(z({},ta),{align:"end"})},y:{ticks:Q(z({},ta),{maxTicksLimit:7}),border:{display:!1},grid:{color:M?"rgba(255, 255, 255, 0.1)":"rgba(229, 229, 229, 0.5)"}}},plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!1,animation:!1,displayColors:!1,callbacks:{title:function(k){var E;const j=k[0];if(!j)return"";const y=(E=u[j.dataIndex])==null?void 0:E.timestamp;return y?p(S,y,w?"UTC":o):""}},external:({tooltip:k})=>{var j,y,E,C;c&&k.opacity>0&&a(os((C=(E=(y=(j=k.dataPoints)==null?void 0:j[0])==null?void 0:y.parsed)==null?void 0:E.y)!=null?C:0)),l(_=>{var A,N,T,I,B;const R=k.chart.width,$=k.caretX>R-Bx;return!_||_.x!==k.caretX||_.y!==k.caretY||_.opacity!==k.opacity||_.flip!==$?Q(z({},_),{x:k.caretX,y:k.caretY,dateLabel:(A=k.title)==null?void 0:A[0],value:os((B=(I=(T=(N=k.dataPoints)==null?void 0:N[0])==null?void 0:T.parsed)==null?void 0:I.y)!=null?B:0),opacity:k.opacity,flip:$}):_})}},dropShadow:!1,crosshair:{line:{color:M?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",width:.5},zoom:{enabled:!1}}}},data:v}),r.jsx(Ux,{tooltipData:i})]})})}function Ux({tooltipData:t}){return!t||!t.opacity?null:r.jsx("div",{style:{left:t.x-5,top:10,transform:"translate(-50%, -50%)"},className:D("text-token-main-surface-primary dark:bg-token-main-surface-secondary pointer-events-none absolute translate-y-[-100%] rounded-lg bg-black px-2 py-1 font-mono font-semibold whitespace-nowrap dark:text-white"),children:r.jsx("div",{className:"text-xs",children:t.dateLabel})})}function Gx(t,e,s){const n=t.createLinearGradient(0,e.top,0,e.bottom);return n.addColorStop(0,s?Us(.4):Gs(.4)),n.addColorStop(1,s?Us(0):Gs(0)),n}function os(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)}function Qe({label:t,value:e,className:s}){return r.jsxs("div",{className:D("flex w-full flex-1 flex-row justify-between text-sm",s),children:[r.jsx("span",{className:"text-token-text-secondary font-normal whitespace-nowrap",children:t}),r.jsx("span",{className:"text-token-text-primary font-normal whitespace-nowrap",children:e})]})}function Vx({metrics:t}){const e=_e(),s=!!(t.marketCap&&t.peRatio&&t.eps);return r.jsx("div",{className:"border-token-border-default flex flex-col gap-1 rounded-b-lg border-t bg-[#f4f4f4] px-4 py-3 dark:bg-[#393939]",children:r.jsxs("div",{className:D("grid grid-cols-2 gap-x-10 gap-y-3 lg:grid-cols-3 lg:gap-x-6"),children:[r.jsx(Qe,{label:e.formatMessage({id:"MDHEj7",defaultMessage:"Open"}),value:e.formatNumber(t.openPrice,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-1"}),r.jsx(Qe,{label:e.formatMessage({id:"PboNMC",defaultMessage:"Volume"}),value:e.formatNumber(t.intradayVolume,{notation:"compact",maximumFractionDigits:1}),className:D("order-2",!s&&"lg:order-last")}),r.jsxs("div",{className:"order-4 row-span-2 flex flex-col gap-3",children:[r.jsx(Qe,{label:e.formatMessage({id:"bresUW",defaultMessage:"Day Low"}),value:e.formatNumber(t.intradayLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),r.jsx(Qe,{label:e.formatMessage({id:"oWyv5V",defaultMessage:"Day High"}),value:e.formatNumber(t.intradayHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),r.jsxs("div",{className:"order-5 row-span-2 flex flex-col gap-3",children:[r.jsx(Qe,{label:e.formatMessage({id:"DcEYIK",defaultMessage:"Year Low"}),value:e.formatNumber(t.fiftyTwoWeekLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),r.jsx(Qe,{label:e.formatMessage({id:"ZfFtJ4",defaultMessage:"Year High"}),value:e.formatNumber(t.fiftyTwoWeekHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),t.marketCap&&r.jsx(Qe,{label:e.formatMessage({id:"BzyP4Y",defaultMessage:"Market Cap"}),value:e.formatNumber(t.marketCap,{notation:"compact",maximumFractionDigits:2}),className:"order-last lg:order-3"}),t.peRatio&&t.eps&&r.jsxs(r.Fragment,{children:[r.jsx(Qe,{label:e.formatMessage({id:"edGd+S",defaultMessage:"EPS (TTM)"}),value:e.formatNumber(t.eps,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"}),r.jsx(Qe,{label:e.formatMessage({id:"AhpCu1",defaultMessage:"P/E Ratio"}),value:e.formatNumber(t.peRatio,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"})]})]})})}function qx({data:t,priceChange:e,highlightedPrice:s,extendedPriceChange:n,url:o}){var i;function a(l,c="intraday",d=null){const{isUp:f,changePercentage:u,changeLabel:g,changeAmount:p}=l,x=Math.abs(u).toFixed(2),w=os(p);return r.jsxs("span",{className:"flex min-w-0 items-center gap-1",children:[c==="extended_hours"&&d!=null&&r.jsx("span",{className:"font-semibold",children:r.jsx(q,{id:"HWwWpW",defaultMessage:"{price}",values:{price:d}})}),r.jsx("span",{className:D("font-semibold",f?Zr:Yr),children:r.jsx(q,{id:"3x4Lkl",defaultMessage:"{sign}{changeAmount}",values:{changeAmount:w,sign:f?"+":""}})}),r.jsx("span",{className:D("font-semibold",f?Zr:Yr),children:r.jsx(q,{id:"MbfF1T",defaultMessage:"({sign}{changePercentage}%)",values:{changePercentage:x,sign:f?"+":"-"}})}),c==="extended_hours"?r.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:g}):r.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:g})]})}return r.jsxs("div",{children:[r.jsx("div",{className:"mt-2 text-sm",children:t?r.jsx(q,{id:"+2WHuv",defaultMessage:"{name} ({ticker})",values:{name:t.asset.name,ticker:t.asset.ticker}}):r.jsx("div",{className:"w-32 font-medium",children:r.jsx(Qt,{index:9,width:100})})}),r.jsx("div",{className:"text-token-text-tertiary text-sm",children:t?r.jsx(r.Fragment,{children:o!=null&&r.jsxs(r.Fragment,{children:[" · ",r.jsx(Et,{href:o,className:"text-token-link hover:underline",children:on(o,"hostname")})]})}):r.jsx("div",{className:"mt-2 w-36",children:r.jsx(Qt,{index:6,width:100})})}),r.jsx("div",{className:"mt-2 flex text-4xl font-semibold",children:t?r.jsx(q,{id:"s+1uly",defaultMessage:"{price}",values:{price:s!=null?s:os(t.price.price)}}):r.jsx("div",{className:"w-32",children:r.jsx(Qt,{index:0,width:100})})}),r.jsx("div",{className:"mt-2 flex items-center justify-start gap-1 text-sm",children:e?a(e):r.jsx("div",{className:"mt-2 w-40",children:r.jsx(Qt,{index:3,width:100})})}),r.jsx("div",{className:"mt-0.5 flex items-center justify-start gap-1 text-sm",children:((i=t==null?void 0:t.price)==null?void 0:i.extended_price)!=null&&n!=null&&a(n,"extended_hours",os(t.price.extended_price))})]})}function Kx({contentReference:t,trackContentReferenceEvent:e}){var M,v,k,j,y,E,C,_,R,$,A,N,T,I,B;const s=_e();m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown","stock")},[e]);const n=Ox((M=t==null?void 0:t.stock)==null?void 0:M.histories),o=t==null?void 0:t.stock,[a,i]=m.useState(n),[l,c]=m.useState(null),d=a==="1d",f=(j=(k=(v=o==null?void 0:o.histories)==null?void 0:v.quotes)==null?void 0:k[a!=null?a:""])==null?void 0:j[0],u=a&&a in Ds?a:void 0,g=o&&(f&&!d?{changePercentage:(o.price.price-f.close)/f.close*100,changeAmount:o.price.price-f.close,changeLabel:u?s.formatMessage(Ds[u]):"",isUp:o.price.price>f.close}:o.price.change_percent&&o.price.change?{changePercentage:o.price.change_percent*100,changeAmount:o.price.change,changeLabel:Zx(o.price.latest_trade_timestamp,o.asset.timezone,s),isUp:o.price.change?o.price.change>0:!1}:null),p=o&&o.price.extended_price!=null&&o.price.extended_change_percent!=null&&o.price.extended_change!=null?{changePercentage:o.price.extended_change_percent*100,changeAmount:o.price.extended_change,changeLabel:s.formatMessage((y=Xx(o.price.market_status))!=null?y:Ds.extended),isUp:o.price.extended_change>0}:null,{fiftyTwoWeekHigh:x,fiftyTwoWeekLow:w}=m.useMemo(()=>{var b;const W=(b=o==null?void 0:o.histories)==null?void 0:b.quotes["1y"];if(!W)return{fiftyTwoWeekHigh:null,fiftyTwoWeekLow:null};const X=W.map(P=>P.high).filter(P=>P!=null),H=W.map(P=>P.low).filter(P=>P!=null);return{fiftyTwoWeekHigh:X.length>0?Math.max(...X):null,fiftyTwoWeekLow:H.length>0?Math.min(...H):null}},[(E=o==null?void 0:o.histories)==null?void 0:E.quotes]),S=o!=null&&o.price.open_price&&o.price.intraday_high&&o.price.intraday_low&&o.price.intraday_volume&&x&&w?{openPrice:o.price.open_price,intradayHigh:o.price.intraday_high,intradayLow:o.price.intraday_low,intradayVolume:o.price.intraday_volume,fiftyTwoWeekHigh:x,fiftyTwoWeekLow:w,marketCap:(_=(C=o.metrics)==null?void 0:C.market_cap)!=null?_:void 0,peRatio:($=(R=o.metrics)==null?void 0:R.pe_ratio)!=null?$:void 0,eps:(N=(A=o.metrics)==null?void 0:A.eps)!=null?N:void 0}:null,h=S!=null;return r.jsxs("div",{"data-testid":"finance-widget",className:D("border-token-border-default mb-2 flex min-h-[480px] flex-col gap-8 rounded-lg border"),children:[r.jsxs("div",{className:"mx-6 flex flex-wrap items-end justify-between",children:[r.jsx(qx,{data:o!=null?o:null,highlightedPrice:l,priceChange:g!=null?g:null,extendedPriceChange:p!=null?p:null,url:(T=t==null?void 0:t.url)!=null?T:null}),r.jsx("div",{className:"mt-4",children:r.jsx(Dx,{selectedInterval:a,onSelectHistoryInterval:i,histories:o==null?void 0:o.histories})})]}),r.jsx("div",{className:"mx-6 h-[340px]",children:r.jsx(Wx,{isUp:(I=g==null?void 0:g.isUp)!=null?I:!1,selectedInterval:a,histories:o==null?void 0:o.histories,setHighlightedPrice:c,onSelectHistoryInterval:W=>i(W),latestTradingPeriod:o==null?void 0:o.asset.latest_trading_period,timezone:(B=o==null?void 0:o.asset.timezone)!=null?B:null})}),h&&r.jsx("div",{className:"-mt-4",children:r.jsx(Vx,{metrics:S})})]})}function Xx(t){if(t==null)return null;const e=t.toLowerCase();return e==="premarket"||e==="open"?es({id:"By+pvF",defaultMessage:"Pre-Market"}):e==="afterhours"||e==="closed"?es({id:"aLCg3c",defaultMessage:"After Hours"}):es({id:"2p526c",defaultMessage:"Extended Hours"})}function Zx(t,e,s){function n(o,a){const l=ss(new Date,a),c=s.formatDate(l,{year:"numeric",month:"2-digit",day:"2-digit"}),d=Go(o*1e3),f=ss(d,a),u=s.formatDate(f,{year:"numeric",month:"2-digit",day:"2-digit"});return c===u}if(!t||!e||n(t,e))return s.formatMessage(Ds["1d"]);{const o=Go(t*1e3),a=ss(o,e);return s.formatDate(a,{month:"long",day:"numeric"})}}const Ds=Gt({"1d":{id:"SMdcuo",defaultMessage:"Today"},extended:{id:"2p526c",defaultMessage:"Extended Hours"},"5d":{id:"HCA6lr",defaultMessage:"Past 5 days"},"1m":{id:"DJpPMq",defaultMessage:"Past month"},"6m":{id:"1mUJ2L",defaultMessage:"Past 6 months"},ytd:{id:"b9KkhV",defaultMessage:"Year to date"},"1y":{id:"XnvD9A",defaultMessage:"Past year"},"5y":{id:"DfI1RB",defaultMessage:"Past 5 years"},max:{id:"WzOhuU",defaultMessage:"Max"}});function Yx({metadata:t,trackContentReferenceEvent:e}){const s=m.useCallback(l=>{e("link_action",null,t.type,{url:t.url,title:t.title,pub_date:null,sub_pill_index:null,link_type:"link_title",action:l})},[t.title,t.type,t.url,e]);m.useEffect(()=>{s("show")},[s]);const[n,o]=m.useState(!1),a=()=>{n||(s("hover"),o(!0))},i=()=>{s("click")};return r.jsx(Et,{href:t.url,onClick:i,onMouseEnter:a,onFocus:a,className:"underline",children:t.title})}const Jx={google_maps:{title:"Google Maps"}};function Qx({metadata:t,trackContentReferenceEvent:e}){var n,o;m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=(o=(n=Jx[t.provider])==null?void 0:n.title)!=null?o:"Maps";return r.jsx("span",{children:r.jsx(q,{id:"ZSUz1k",defaultMessage:" ({link}) ",values:{link:r.jsx(Et,{href:t.url,children:s})}})})}const e1=4,vi=3;function t1(t){"use forget";var _,R,$,A;const e=je.c(34),{metadata:s,lastUserMsgOfPrevTurn:n,superWidgetContent:o,isContentReferenceComplete:a}=t,i=Me();let l;e[0]!==i?(l=()=>eo(i),e[0]=i,e[1]=l):l=e[1];const c=rt(l);let d;e[2]!==n?(d=n?wa(n):null,e[2]=n,e[3]=d):d=e[3];const f=d,u=(R=(_=o==null?void 0:o.widgets)==null?void 0:_.query)!=null?R:"";let g;e[4]!==f||e[5]!==u?(g=((A=($=u==null?void 0:u.trim())==null?void 0:$.length)!=null?A:0)>0?u:f,e[4]=f,e[5]=u,e[6]=g):g=e[6];const p=g;let x;e[7]!==i||e[8]!==c||e[9]!==p||e[10]!==s.items.length?(x=()=>{!c||s.items.length>=e1||!p||Pa(i,p,"news")},e[7]=i,e[8]=c,e[9]=p,e[10]=s.items.length,e[11]=x):x=e[11];let w;e[12]!==i||e[13]!==c||e[14]!==n||e[15]!==p||e[16]!==s.items.length||e[17]!==o?(w=[i,c,n,p,s.items.length,o],e[12]=i,e[13]=c,e[14]=n,e[15]=p,e[16]=s.items.length,e[17]=o,e[18]=w):w=e[18],m.useEffect(x,w);let S;e[19]!==c||e[20]!==p?(S=N=>{var B,W;if(!c||!p)return[[],!1];const I=(B=N.entries[p])!=null?B:Ra;return[(W=I.news)!=null?W:[],$a(I,"news")]},e[19]=c,e[20]=p,e[21]=S):S=e[21];const[h,M]=Ia(S);let v;e[22]!==s.items?(v=new Set(s.items.map(n1)),e[22]=s.items,e[23]=v):v=e[23];const k=v;let j;if(e[24]!==a||e[25]!==s.items||e[26]!==k||e[27]!==h){let N;e[29]!==k?(N=I=>!k.has(Fa(I.url)),e[29]=k,e[30]=N):N=e[30];const T=h.filter(N).slice(0,vi).map(s1);j=a?[...s.items,...T]:s.items,e[24]=a,e[25]=s.items,e[26]=k,e[27]=h,e[28]=j}else j=e[28];const y=j,E=a&&M;let C;return e[31]!==y||e[32]!==E?(C={items:y,isLoading:E},e[31]=y,e[32]=E,e[33]=C):C=e[33],C}function s1(t){const e=t.pub_date?new Date(t.pub_date).getTime()/1e3:null;return Q(z({},t),{pub_date:e,attribution:t.domain})}function n1(t){return Fa(t.url)}const o1=/^navlist[\s\S]*$/;function r1(t){"use forget";const e=je.c(28),{metadata:s,trackContentReferenceEvent:n,isFirstAssistantContent:o,superWidgetContent:a,lastUserMsgOfPrevTurn:i}=t,l=Me();let c;e[0]!==l?(c=at(l),e[0]=l,e[1]=c):c=e[1];const d=c,f=s.items.length>0,u=m.useRef(n);let g,p;e[2]!==n?(g=()=>{u.current=n},p=[n],e[2]=n,e[3]=g,e[4]=p):(g=e[3],p=e[4]),m.useEffect(g,p);let x,w;e[5]!==f?(x=()=>{f&&u.current("Search Content Reference Shown","search_content_reference_shown","nav_list")},w=[f],e[5]=f,e[6]=x,e[7]=w):(x=e[6],w=e[7]),m.useEffect(x,w);let S;e[8]!==n?(S=($,A)=>{n("link_action",null,"nav_list",Q(z({},sa($,A)),{action:"click"}))},e[8]=n,e[9]=S):S=e[9];const h=S;let M;e[10]!==n?(M=($,A)=>{n("link_action",null,"nav_list",Q(z({},sa($,A)),{action:"show"}))},e[10]=n,e[11]=M):M=e[11];const v=M,k=d&&o,j=s.title&&!k;if(s.items.length===0)return null;const y=!k&&"mt-6";let E;e[12]!==y?(E=D("mb-1",y),e[12]=y,e[13]=E):E=e[13];let C;e[14]!==s.title||e[15]!==j?(C=j&&r.jsx("div",{className:"text-token-text-primary -mb-1 pb-3 font-semibold",children:s.title}),e[14]=s.title,e[15]=j,e[16]=C):C=e[16];let _;e[17]!==h||e[18]!==v||e[19]!==d||e[20]!==i||e[21]!==s||e[22]!==a?(_=d?r.jsx(i1,{metadata:s,lastUserMsgOfPrevTurn:i,superWidgetContent:a,onCardShown:v,onCardClicked:h}):r.jsx(yi,{items:s.items,onCardRender:a1,onCardShown:v,onCardClicked:h,cardClassName:"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden"}),e[17]=h,e[18]=v,e[19]=d,e[20]=i,e[21]=s,e[22]=a,e[23]=_):_=e[23];let R;return e[24]!==C||e[25]!==_||e[26]!==E?(R=r.jsxs("div",{className:E,"data-testid":"nav-list-widget",children:[C,_]}),e[24]=C,e[25]=_,e[26]=E,e[27]=R):R=e[27],R}function a1(t){return r.jsx(ki,{item:t})}function i1(t){"use forget";var j;const e=je.c(19),{metadata:s,lastUserMsgOfPrevTurn:n,superWidgetContent:o,onCardShown:a,onCardClicked:i}=t,l=Me();let c;e[0]!==l?(c=()=>[eo(l),Zs(l)],e[0]=l,e[1]=c):c=e[1];const[d,f]=rt(c);let u;e[2]!==s.matched_text?(u=o1.test((j=s.matched_text)!=null?j:""),e[2]=s.matched_text,e[3]=u):u=e[3];const g=u;let p;e[4]!==g||e[5]!==n||e[6]!==s||e[7]!==o?(p={metadata:s,lastUserMsgOfPrevTurn:n,superWidgetContent:o,isContentReferenceComplete:g},e[4]=g,e[5]=n,e[6]=s,e[7]=o,e[8]=p):p=e[8];const{items:x,isLoading:w}=t1(p),S=w&&d?vi:0,h=f?"-mx-[var(--thread-content-margin)]":"-mx-6";let M;e[9]!==h?(M=D("relative mb-6",h),e[9]=h,e[10]=M):M=e[10];let v;e[11]!==x||e[12]!==S||e[13]!==i||e[14]!==a?(v=r.jsx(nn,{items:x,getItemKey:c1,onRenderItem:l1,className:"min-h-36",itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)] thread-lg:w-61! w-50! shrink-0",onShown:a,onClick:i,numLoadingItems:S}),e[11]=x,e[12]=S,e[13]=i,e[14]=a,e[15]=v):v=e[15];let k;return e[16]!==M||e[17]!==v?(k=r.jsx("div",{className:M,children:v}),e[16]=M,e[17]=v,e[18]=k):k=e[18],k}function l1(t){return r.jsx(ki,{item:t})}function c1(t){return t.url}function ki({item:t}){var i,l;const{isSuccess:e}=Rn((i=t.thumbnail_url)!=null?i:void 0,"NavListItem"),s=_e(),n=Me(),o=at(n),a=Jl(s,t.pub_date);return r.jsxs(Et,{className:"flex flex-col items-center gap-4 overflow-hidden pb-6",href:t.url,children:[e&&t.thumbnail_url?r.jsx("div",{className:"relative h-36 w-full overflow-hidden",children:r.jsx("img",{src:t.thumbnail_url,className:"m-0 h-full w-full",style:{objectFit:"cover"},alt:t.title})}):r.jsxs("div",{className:D("icon-bg relative flex h-36 w-full shrink-0 items-center justify-center overflow-hidden",o&&"bg-token-bg-secondary"),children:[r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-cover bg-center bg-no-repeat blur-3xl",children:r.jsx(Rs,{url:t.url,size:256,minSize:128,className:"mix-soft-light opacity-30 dark:opacity-20"})}),r.jsx("div",{className:"absolute flex h-10 w-10 items-center justify-center",children:r.jsx(Rs,{url:t.url,size:128,minSize:80,className:"icon-xl rounded-full"})})]}),r.jsxs("div",{className:D("flex flex-col gap-2 overflow-hidden px-4 text-ellipsis",o&&"w-full items-start"),children:[r.jsxs("div",{className:"text-token-text-primary flex items-center gap-1.5 text-xs",children:[r.jsx(Rs,{url:t.url,size:32,minSize:16,className:"icon-xs my-0 rounded-full"}),(l=t.attribution)!=null?l:on(t.url)]}),r.jsx("div",{className:"text-token-text-primary decoration-token-link line-clamp-5 text-sm font-medium",children:t.title}),a&&r.jsx("div",{className:"text-token-text-secondary text-xs",children:a})]})]})}const sa=(t,e)=>({url:t.url,title:t.title,section_index:e,link_type:"text",section:"nav_list",section_location:"response"}),d1="/assets/missing-logo-h96s4tk9.webp",na={src:d1};function ji({team:t,className:e}){var a;const[s,n]=m.useState((a=t.logo)!=null?a:na.src),o=()=>{Vt.addError("Unable to load sports widget logo",{name:t.name,logo:t.logo}),n(na.src)};return r.jsx("img",{src:s,alt:t.name,className:e,onError:o})}const cs=["ipl"],u1=ne(()=>se(()=>import("./bqk4d9uy5l3d6vsz.js").then(t=>t._),__vite__mapDeps([46,1])),{loading:t=>ae(t)}),f1=ne(()=>se(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yA),__vite__mapDeps([12,1,8,9,13])),{loading:t=>ae(t)}),oa=6,wt="home",vt="away";function m1({scheduleRef:t,trackContentReferenceEvent:e}){var x,w,S,h;const[s,n]=m.useState(!0),o=_e(),a=t.games.length>0,i=t.league.id,l=Ql(),c=xs();if(m.useEffect(()=>{a&&e("Search Content Reference Shown","search_content_reference_shown","sports",{hasSchedule:!0})},[a]),!a)return null;const f=((w=(x=o.formatDateToParts(new Date,{timeZoneName:"long"}).find(M=>M.type==="timeZoneName"))==null?void 0:x.value)!=null?w:Intl.DateTimeFormat().resolvedOptions().timeZone).replace(/Daylight|Standard/g,"");let u=t.games;const g=M=>Math.abs(new Date().getTime()-new Date(M.date).getTime());g(u[0])>g(u[u.length-1])&&(u=u.slice().reverse());const p=s?u.slice(0,oa):u;return r.jsxs("div",{className:"not-prose mb-3","data-testid":"sports-schedule-widget",children:[r.jsx("div",{className:"font-semibold",children:r.jsx(q,{id:"LA6z9q",defaultMessage:"{league} Schedule",values:{league:t.league.display_name}})}),r.jsx("div",{className:"text-token-text-secondary text-sm",children:f}),p.length===1?r.jsx("div",{children:r.jsx(Lo,{children:r.jsx(rs.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-15},transition:{duration:.2},children:r.jsx("div",{className:"border-token-border-medium mt-3 rounded-xl border py-3",children:r.jsx(p1,{game:p[0],useAlias:cs.includes(i),leagueId:i,activeTeam:(h=(S=p[0])==null?void 0:S.active_team)!=null?h:null,isMobile:c})})})})}):r.jsx("div",{className:"grid grid-cols-1 pt-3 lg:grid-cols-2",children:r.jsx(Lo,{children:p.map((M,v)=>{var k;return r.jsx(rs.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0,transition:{delay:v*.04}},exit:{opacity:0,y:-15},transition:{duration:.2},children:r.jsx("div",{className:D("border-token-border-medium border-b py-3",v%2===0&&"lg:border-e lg:pe-4",v%2===1&&"lg:ps-4",Math.floor(v/2)===Math.ceil(u.length/2)-1&&"lg:border-b-0",v===u.length-1&&"border-b-0"),children:r.jsx(h1,{game:M,useAlias:(l||c)&&cs.includes(i),leagueId:i,activeTeam:(k=M.active_team)!=null?k:null})})},v)})})}),u.length>oa&&r.jsx("div",{className:"mt-2 flex items-center justify-between",children:r.jsx("button",{className:"flex items-center text-sm font-semibold",onClick:()=>n(!s),children:s?r.jsx(q,{id:"BH/Ee5",defaultMessage:"Show more {icon}",values:{icon:r.jsx(f1,{className:"mb-[-2px]"})}}):r.jsx(q,{id:"Z9BlEu",defaultMessage:"Show less {icon}",values:{icon:r.jsx(u1,{className:"mb-[-2px]"})}})})})]})}function h1({game:t,useAlias:e=!1,leagueId:s,activeTeam:n}){var f,u;const o=Mi(t),a=[t.first_team_info,t.second_team_info],i=(f=a.find(g=>g.location===wt))!=null?f:t.first_team_info,l=(u=a.find(g=>g.location===vt))!=null?u:t.second_team_info,c=(o==null?void 0:o.team.name)===(i==null?void 0:i.team.name),d=(o==null?void 0:o.team.name)===(l==null?void 0:l.team.name);return r.jsxs("div",{className:"flex w-full gap-1.5 py-3 text-base",children:[r.jsxs("div",{className:"flex flex-auto flex-col items-start gap-1 pe-3",children:[r.jsx(qs,{team:l.team,isWinner:d,isActive:n===vt,logoSize:"small",useAlias:e}),r.jsx(qs,{team:i.team,isWinner:c,isActive:n===wt,logoSize:"small",useAlias:e})]}),r.jsxs("div",{className:D("flex flex-none flex-col items-start gap-1",cs.includes(s)&&"me-4"),children:[r.jsx(Ks,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"right"}:null,isWinner:d,negateScore:Vs(s,vt,n)}),r.jsx(Ks,{score:i.score,scoreSuffix:i.score_suffix,scoreParenthetical:i.score_parenthetical?{message:i.score_parenthetical,position:"right"}:null,isWinner:c,negateScore:Vs(s,wt,n)})]}),r.jsx("div",{className:"flex min-w-24 flex-none flex-col items-end justify-center gap-1 text-sm",children:r.jsx(Ci,{game:t})})]})}function p1({game:t,useAlias:e=!1,leagueId:s,activeTeam:n,isMobile:o}){var u,g;const a=Mi(t),i=[t.first_team_info,t.second_team_info],l=(u=i.find(p=>p.location===wt))!=null?u:t.first_team_info,c=(g=i.find(p=>p.location===vt))!=null?g:t.second_team_info,d=(a==null?void 0:a.team.name)===(l==null?void 0:l.team.name),f=(a==null?void 0:a.team.name)===(c==null?void 0:c.team.name);return r.jsxs("div",{className:"flex w-full py-3 text-base",children:[r.jsx("div",{className:"flex flex-1 items-center justify-center px-2",children:r.jsx(qs,{team:c.team,isWinner:f,isActive:n===vt,useAlias:e,layoutDirection:o?"column":"row"})}),r.jsx("div",{className:"ms-2 flex items-center justify-start sm:ms-8",children:r.jsx(Ks,{score:c.score,scoreSuffix:c.score_suffix,scoreParenthetical:c.score_parenthetical?{message:c.score_parenthetical,position:"bottom"}:null,isWinner:f,negateScore:Vs(s,vt,n),className:"text-sm font-semibold sm:text-lg"})}),r.jsx("div",{className:"mx-2 flex w-24 shrink flex-col items-center justify-center gap-1 align-middle text-sm",children:r.jsx(Ci,{game:t})}),r.jsx("div",{className:"me-2 flex items-center justify-end sm:me-8",children:r.jsx(Ks,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"bottom"}:null,isWinner:d,negateScore:Vs(s,wt,n),className:"text-sm font-semibold sm:text-lg"})}),r.jsx("div",{className:"flex flex-1 items-center justify-center md:px-2",children:r.jsx(qs,{team:l.team,isWinner:d,isActive:n===wt,useAlias:e,layoutDirection:o?"column":"row"})})]})}function Si(t){return t.live?"live":new Date(t.date)<new Date?"complete":"scheduled"}function Mi(t){return Si(t)!=="complete"||t.first_team_info.score==null||t.second_team_info.score==null?null:t.first_team_info.score>t.second_team_info.score?t.first_team_info:t.second_team_info}function Vs(t,e,s){return cs.includes(t)&&e===wt&&s===vt}function qs({team:t,isWinner:e,isActive:s,logoSize:n,useAlias:o=!1,layoutDirection:a="row"}){return r.jsxs("span",{className:D("flex items-center gap-1",e&&"font-semibold","max-w-64 lg:max-w-52 xl:max-w-64",a==="column"&&"flex-col"),children:[t.logo&&r.jsx(ji,{team:{name:t.name,logo:t.logo},className:D(n==="small"?"w-6":"w-8")}),r.jsx("span",{className:"truncate",children:o?t.alias:t.name}),s&&r.jsx("span",{className:"bg-token-surface-error inline-block h-2 w-2 rounded-full"})]})}function Ks({score:t,scoreSuffix:e,scoreParenthetical:s,isWinner:n,negateScore:o=!1,className:a}){const i=_e();return t==null?null:r.jsxs("span",{className:D(n&&"font-semibold",a),children:[o?i.formatMessage({id:"sports.dash",defaultMessage:"-"}):t,e&&!o&&r.jsx("span",{children:e}),s&&!o&&r.jsx("span",{className:D("text-token-text-secondary font-normal",s.position==="right"&&"ms-1",s.position==="bottom"&&"mx-auto block text-center"),children:"(".concat(s.message,")")})]})}function Ci({game:t}){const e=_e();switch(Si(t)){case"live":return r.jsxs(r.Fragment,{children:[r.jsx(g1,{}),r.jsx("div",{children:t.details})]});case"complete":return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"font-semibold",children:r.jsx(q,{id:"q/iMZL",defaultMessage:"Final"})}),r.jsx("div",{className:"text-token-text-secondary",children:Fn(e,new Date(t.date))})]});case"scheduled":{const s=new Date(t.date);return isNaN(s.getTime())?null:r.jsxs(r.Fragment,{children:[r.jsx("div",{children:Fn(e,s)}),r.jsx("div",{className:"text-token-text-secondary",children:e.formatDate(s,{timeStyle:"short"})})]})}}}function g1(){return r.jsx("div",{className:"bg-token-surface-error rounded-[4px] px-1.5 py-1 text-xs font-semibold text-white",children:r.jsx(q,{id:"vObALn",defaultMessage:"Live"})})}function x1({standingsRef:t,trackContentReferenceEvent:e}){const[s,n]=m.useState(0),o=t.conferences.length>0,a=xs(),i=t.league.id;m.useEffect(()=>{o&&e("Search Content Reference Shown","search_content_reference_shown","sports",{hasStandings:!0})},[o]);const l=t.conferences[s],c=t.conferences.length>1?t.conferences.map((d,f)=>r.jsx("button",{className:D(s===f?"text-token-text-primary":"text-token-text-tertiary","text-sm font-semibold"),onClick:()=>n(f),children:d.name},d.name)):null;return r.jsxs("div",{"data-testid":"sports-standings-widget",children:[c&&r.jsx("div",{className:"flex gap-4",children:c}),r.jsx("div",{className:"mt-3",children:l.divisions.map(d=>d.name?r.jsx("div",{className:"mt-3",children:r.jsx(ra,{division:d,teamsColumnHeader:d.name})},d.name):r.jsx(ra,{division:d,useAlias:a&&cs.includes(i)}))})]})}function ra({division:t,teamsColumnHeader:e,useAlias:s}){const n=t.headers.map(o=>o.key);return r.jsxs(De.Root,{size:"compact",className:"not-prose",children:[r.jsxs(De.Header,{children:[r.jsx(b1,{children:e!=null?e:r.jsx(q,{id:"kKSGje",defaultMessage:"Team"})}),t.headers.map(o=>r.jsx(Ei,{textAlign:"center",className:"min-w-11 px-0!",children:r.jsx(aa,{data:o})},o.key))]}),r.jsx(De.Body,{children:t.teams.map(({team:o,data:a},i)=>{const l=a.reduce((c,d)=>(c[d.key]=d,c),{});return r.jsxs(De.Row,{children:[r.jsx(De.Cell,{className:"w-full border-0! py-0! ps-0!",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"text-token-text-tertiary me-2 w-4 whitespace-nowrap tabular-nums",children:i+1}),r.jsxs("div",{className:"flex items-center justify-start gap-2",children:[r.jsx(ji,{team:o,className:"w-6"}),r.jsx("span",{className:"text-base whitespace-nowrap",children:s?o.alias:o.name})]})]})}),n.map(c=>r.jsx(De.Cell,{className:"min-w-11 border-0! px-0! py-0! text-start whitespace-nowrap tabular-nums",textAlign:"center",children:r.jsx(aa,{data:l[c]})},c))]},o.name)})})]})}function aa({data:t}){switch(t.type){case"text":return r.jsx(r.Fragment,{children:t.text});default:return r.jsx(r.Fragment,{children:t.alt})}}var da;const Ei=ka(De.HeaderCell)(da||(da=vs(["text-token-text-secondary font-normal! text-sm static! bg-transparent! border-token-border-default! border-t-0! border-s-0! border-e-0!"])));var ua;const b1=ka(Ei)(ua||(ua=vs(["text-token-text-primary ps-0!"])));function y1({metadata:t,trackContentReferenceEvent:e}){m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=_e(),n=ss(t.utc_time,t.utc_offset),o=s.formatDate(n,{hour:"numeric",minute:"numeric"});return r.jsx("span",{children:o})}function _1({metadata:t,trackContentReferenceEvent:e}){return m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]),r.jsx("div",{children:t.url?r.jsx(Cu,{webpageItem:{url:t.url,title:t.description,pub_date:null,snippet:"",attributions:null},className:"inline-flex flex-col",children:r.jsx(Et,{href:t.url,className:"font-semibold!",children:t.description})}):r.jsx("div",{className:"font-semibold!",children:t.description})})}function w1({videoId:t,title:e="YouTube video player",fallbackText:s,cookieLess:n=!0,timeoutMs:o=5e3,className:a=""}){const i=m.useRef(null),l=m.useRef(null),c=m.useRef(!1),[d,f]=m.useState("idle"),u=()=>{c.current=!0,l.current&&(clearTimeout(l.current),l.current=null)};if(m.useEffect(()=>{f("loading"),c.current=!1;let p=null;return v1().then(()=>{if(!i.current)return;i.current.textContent="",p=document.createElement("div"),p.style.width="200px",p.style.height="150px",i.current.appendChild(p),l.current=window.setTimeout(()=>{c.current||f("timeout")},o);const x=n?"https://www.youtube-nocookie.com":"https://www.youtube.com";new window.YT.Player(p,{width:200,height:150,videoId:t,host:x,playerVars:{rel:0,playsinline:1,origin:window.location.origin},events:{onReady:()=>{u(),f("ready")},onError:()=>{u(),f("error")}}})}).catch(()=>f("error")),()=>{u()}},[t,n,o]),d==="error"||d==="timeout")return r.jsx("a",{href:"https://www.youtube.com/watch?v=".concat(t),target:"_blank",rel:"noopener noreferrer",children:s});const g=n?"https://www.youtube-nocookie.com":"https://www.youtube.com";return r.jsxs(r.Fragment,{children:[r.jsx("div",{ref:i,"aria-hidden":!0,inert:!0,className:"hidden"}),r.jsx("iframe",{src:"".concat(g,"/embed/").concat(t),allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,className:a,title:e})]})}function v1(){return new Promise(t=>{var s;if((s=window.YT)!=null&&s.Player)return t();const e=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{e==null||e(),t(),window.onYouTubeIframeAPIReady=e||(()=>{})},!document.querySelector("script[src*='youtube.com/iframe_api']")){const n=document.createElement("script");n.src="https://www.youtube.com/iframe_api",document.head.appendChild(n)}})}function k1({url:t,className:e,iframeClassName:s,iframeTitle:n}){let o;const a=D("aspect-video w-full",s),i=j1(t);i&&(o=r.jsx(w1,{className:a,videoId:i,title:n,fallbackText:n!=null?n:r.jsx(q,{id:"sonic.video.youtube.title",defaultMessage:"YouTube video link"}),cookieLess:!1}));const l=S1(t);return l&&(o=r.jsx(M1,{videoId:l,className:a,iframeTitle:n})),o?r.jsx("div",{className:e,children:o}):null}function j1(t){const e=/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/|embed\/|v\/|live\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,s=t.match(e);return s?s[1]:null}function S1(t){const e=/vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/[^/]+\/videos\/|video\/|)(\d+)/,s=t.match(e);return s?s[1]:null}function M1({videoId:t,className:e,iframeTitle:s}){return r.jsx(r.Fragment,{children:r.jsx("iframe",{className:e,src:"https://player.vimeo.com/video/".concat(t),frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,title:s})})}function C1({video:t,trackContentReferenceEvent:e}){const s={url:t.url,title:t.title};return m.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type,s)},[]),t.url==null||t.url===""?null:r.jsx("div",{className:"not-prose mb-3 flex flex-col gap-4 text-base","data-testid":"video-widget",children:r.jsx(k1,{url:t.url,iframeClassName:"rounded-lg"})})}const E1="webp",N1=96,T1=96,I1="srgb",P1=4,R1="uchar",$1=288,A1=!1,L1=!1,D1=!0,O1="/assets/cloud-foggy-o4a3hmky.webp",F1={format:E1,width:N1,height:T1,space:I1,channels:P1,depth:R1,density:$1,isProgressive:A1,hasProfile:L1,hasAlpha:D1,src:O1},z1="webp",B1=96,W1=96,H1="srgb",U1=4,G1="uchar",V1=288,q1=!1,K1=!1,X1=!0,Z1="/assets/cloudy-co8vwrk7.webp",Y1={format:z1,width:B1,height:W1,space:H1,channels:U1,depth:G1,density:V1,isProgressive:q1,hasProfile:K1,hasAlpha:X1,src:Z1},J1="webp",Q1=96,eb=96,tb="srgb",sb=4,nb="uchar",ob=288,rb=!1,ab=!1,ib=!0,lb="/assets/heavy-snow-mke52kag.webp",cb={format:J1,width:Q1,height:eb,space:tb,channels:sb,depth:nb,density:ob,isProgressive:rb,hasProfile:ab,hasAlpha:ib,src:lb},db="webp",ub=96,fb=96,mb="srgb",hb=4,pb="uchar",gb=288,xb=!1,bb=!1,yb=!0,_b="/assets/light-snow-mcy1l7t9.webp",wb={format:db,width:ub,height:fb,space:mb,channels:hb,depth:pb,density:gb,isProgressive:xb,hasProfile:bb,hasAlpha:yb,src:_b},vb="webp",kb=96,jb=96,Sb="srgb",Mb=4,Cb="uchar",Eb=288,Nb=!1,Tb=!1,Ib=!0,Pb="/assets/moon-drizzle-cplxr2ub.webp",Rb={format:vb,width:kb,height:jb,space:Sb,channels:Mb,depth:Cb,density:Eb,isProgressive:Nb,hasProfile:Tb,hasAlpha:Ib,src:Pb},$b="webp",Ab=96,Lb=96,Db="srgb",Ob=4,Fb="uchar",zb=288,Bb=!1,Wb=!1,Hb=!0,Ub="/assets/moon-hazy-jvgt25bp.webp",Gb={format:$b,width:Ab,height:Lb,space:Db,channels:Ob,depth:Fb,density:zb,isProgressive:Bb,hasProfile:Wb,hasAlpha:Hb,src:Ub},Vb="webp",qb=96,Kb=96,Xb="srgb",Zb=4,Yb="uchar",Jb=288,Qb=!1,ey=!1,ty=!0,sy="/assets/moon-mostly-cloudy-cia3do0v.webp",ny={format:Vb,width:qb,height:Kb,space:Xb,channels:Zb,depth:Yb,density:Jb,isProgressive:Qb,hasProfile:ey,hasAlpha:ty,src:sy},oy="webp",ry=96,ay=96,iy="srgb",ly=4,cy="uchar",dy=288,uy=!1,fy=!1,my=!0,hy="/assets/moon-mostly-sunny-n3mh1b6a.webp",py={format:oy,width:ry,height:ay,space:iy,channels:ly,depth:cy,density:dy,isProgressive:uy,hasProfile:fy,hasAlpha:my,src:hy},gy="webp",xy=96,by=96,yy="srgb",_y=4,wy="uchar",vy=288,ky=!1,jy=!1,Sy=!0,My="/assets/moon-shower-ntzhti9o.webp",Cy={format:gy,width:xy,height:by,space:yy,channels:_y,depth:wy,density:vy,isProgressive:ky,hasProfile:jy,hasAlpha:Sy,src:My},Ey="webp",Ny=96,Ty=96,Iy="srgb",Py=4,Ry="uchar",$y=288,Ay=!1,Ly=!1,Dy=!0,Oy="/assets/moon-sunny-eg2emh4d.webp",Fy={format:Ey,width:Ny,height:Ty,space:Iy,channels:Py,depth:Ry,density:$y,isProgressive:Ay,hasProfile:Ly,hasAlpha:Dy,src:Oy},zy="webp",By=96,Wy=96,Hy="srgb",Uy=4,Gy="uchar",Vy=288,qy=!1,Ky=!1,Xy=!0,Zy="/assets/rain-thunder-bx7a0l5g.webp",Yy={format:zy,width:By,height:Wy,space:Hy,channels:Uy,depth:Gy,density:Vy,isProgressive:qy,hasProfile:Ky,hasAlpha:Xy,src:Zy},Jy="webp",Qy=96,e0=96,t0="srgb",s0=4,n0="uchar",o0=288,r0=!1,a0=!1,i0=!0,l0="/assets/rain-cxs76xuj.webp",c0={format:Jy,width:Qy,height:e0,space:t0,channels:s0,depth:n0,density:o0,isProgressive:r0,hasProfile:a0,hasAlpha:i0,src:l0},d0="webp",u0=96,f0=96,m0="srgb",h0=4,p0="uchar",g0=288,x0=!1,b0=!1,y0=!0,_0="/assets/sleet-gc63vwmo.webp",w0={format:d0,width:u0,height:f0,space:m0,channels:h0,depth:p0,density:g0,isProgressive:x0,hasProfile:b0,hasAlpha:y0,src:_0},v0="webp",k0=96,j0=96,S0="srgb",M0=4,C0="uchar",E0=288,N0=!1,T0=!1,I0=!0,P0="/assets/snow-d0k6tmmc.webp",R0={format:v0,width:k0,height:j0,space:S0,channels:M0,depth:C0,density:E0,isProgressive:N0,hasProfile:T0,hasAlpha:I0,src:P0},$0="webp",A0=96,L0=96,D0="srgb",O0=4,F0="uchar",z0=288,B0=!1,W0=!1,H0=!0,U0="/assets/sun-drizzle-g94obr5e.webp",G0={format:$0,width:A0,height:L0,space:D0,channels:O0,depth:F0,density:z0,isProgressive:B0,hasProfile:W0,hasAlpha:H0,src:U0},V0="webp",q0=96,K0=96,X0="srgb",Z0=4,Y0="uchar",J0=288,Q0=!1,e_=!1,t_=!0,s_="/assets/sun-hazy-c3z1j0hy.webp",n_={format:V0,width:q0,height:K0,space:X0,channels:Z0,depth:Y0,density:J0,isProgressive:Q0,hasProfile:e_,hasAlpha:t_,src:s_},o_="webp",r_=96,a_=96,i_="srgb",l_=4,c_="uchar",d_=288,u_=!1,f_=!1,m_=!0,h_="/assets/sun-mostly-cloudy-d4o4zkga.webp",p_={format:o_,width:r_,height:a_,space:i_,channels:l_,depth:c_,density:d_,isProgressive:u_,hasProfile:f_,hasAlpha:m_,src:h_},g_="webp",x_=96,b_=96,y_="srgb",__=4,w_="uchar",v_=288,k_=!1,j_=!1,S_=!0,M_="/assets/sun-mostly-sunny-livrdkgu.webp",C_={format:g_,width:x_,height:b_,space:y_,channels:__,depth:w_,density:v_,isProgressive:k_,hasProfile:j_,hasAlpha:S_,src:M_},E_="webp",N_=96,T_=96,I_="srgb",P_=4,R_="uchar",$_=288,A_=!1,L_=!1,D_=!0,O_="/assets/sun-shower-lvtjthah.webp",F_={format:E_,width:N_,height:T_,space:I_,channels:P_,depth:R_,density:$_,isProgressive:A_,hasProfile:L_,hasAlpha:D_,src:O_},z_="webp",B_=96,W_=96,H_="srgb",U_=4,G_="uchar",V_=288,q_=!1,K_=!1,X_=!0,Z_="/assets/sun-sunny-kqjpjzd8.webp",Y_={format:z_,width:B_,height:W_,space:H_,channels:U_,depth:G_,density:V_,isProgressive:q_,hasProfile:K_,hasAlpha:X_,src:Z_},J_="webp",Q_=96,ew=96,tw="srgb",sw=4,nw="uchar",ow=288,rw=!1,aw=!1,iw=!0,lw="/assets/thunder-jgjqg9ai.webp",cw={format:J_,width:Q_,height:ew,space:tw,channels:sw,depth:nw,density:ow,isProgressive:rw,hasProfile:aw,hasAlpha:iw,src:lw},dw="webp",uw=96,fw=96,mw="srgb",hw=4,pw="uchar",gw=288,xw=!1,bw=!1,yw=!0,_w="/assets/tornado-opa24tq3.webp",ww={format:dw,width:uw,height:fw,space:mw,channels:hw,depth:pw,density:gw,isProgressive:xw,hasProfile:bw,hasAlpha:yw,src:_w},vw="webp",kw=96,jw=96,Sw="srgb",Mw=4,Cw="uchar",Ew=288,Nw=!1,Tw=!1,Iw=!0,Pw="/assets/windy-mw0a3u21.webp",Rw={format:vw,width:kw,height:jw,space:Sw,channels:Mw,depth:Cw,density:Ew,isProgressive:Nw,hasProfile:Tw,hasAlpha:Iw,src:Pw},$w="webp",Aw=96,Lw=96,Dw="srgb",Ow=4,Fw="uchar",zw=288,Bw=!1,Ww=!1,Hw=!0,Uw="/assets/cloud-foggy-fhg0jn0w.webp",Gw={format:$w,width:Aw,height:Lw,space:Dw,channels:Ow,depth:Fw,density:zw,isProgressive:Bw,hasProfile:Ww,hasAlpha:Hw,src:Uw},Vw="webp",qw=96,Kw=96,Xw="srgb",Zw=4,Yw="uchar",Jw=288,Qw=!1,ev=!1,tv=!0,sv="/assets/cloudy-disd26f3.webp",nv={format:Vw,width:qw,height:Kw,space:Xw,channels:Zw,depth:Yw,density:Jw,isProgressive:Qw,hasProfile:ev,hasAlpha:tv,src:sv},ov="webp",rv=96,av=96,iv="srgb",lv=4,cv="uchar",dv=288,uv=!1,fv=!1,mv=!0,hv="/assets/heavy-snow-g6jjwo2d.webp",pv={format:ov,width:rv,height:av,space:iv,channels:lv,depth:cv,density:dv,isProgressive:uv,hasProfile:fv,hasAlpha:mv,src:hv},gv="webp",xv=96,bv=96,yv="srgb",_v=4,wv="uchar",vv=288,kv=!1,jv=!1,Sv=!0,Mv="/assets/light-snow-iz0efpkh.webp",Cv={format:gv,width:xv,height:bv,space:yv,channels:_v,depth:wv,density:vv,isProgressive:kv,hasProfile:jv,hasAlpha:Sv,src:Mv},Ev="webp",Nv=96,Tv=96,Iv="srgb",Pv=4,Rv="uchar",$v=288,Av=!1,Lv=!1,Dv=!0,Ov="/assets/moon-drizzle-b1nfv39c.webp",Fv={format:Ev,width:Nv,height:Tv,space:Iv,channels:Pv,depth:Rv,density:$v,isProgressive:Av,hasProfile:Lv,hasAlpha:Dv,src:Ov},zv="webp",Bv=96,Wv=96,Hv="srgb",Uv=4,Gv="uchar",Vv=288,qv=!1,Kv=!1,Xv=!0,Zv="/assets/moon-hazy-nfnzea7a.webp",Yv={format:zv,width:Bv,height:Wv,space:Hv,channels:Uv,depth:Gv,density:Vv,isProgressive:qv,hasProfile:Kv,hasAlpha:Xv,src:Zv},Jv="webp",Qv=96,e2=96,t2="srgb",s2=4,n2="uchar",o2=288,r2=!1,a2=!1,i2=!0,l2="/assets/moon-mostly-cloudy-e56e3z55.webp",c2={format:Jv,width:Qv,height:e2,space:t2,channels:s2,depth:n2,density:o2,isProgressive:r2,hasProfile:a2,hasAlpha:i2,src:l2},d2="webp",u2=96,f2=96,m2="srgb",h2=4,p2="uchar",g2=288,x2=!1,b2=!1,y2=!0,_2="/assets/moon-mostly-sunny-ffu4gzf4.webp",w2={format:d2,width:u2,height:f2,space:m2,channels:h2,depth:p2,density:g2,isProgressive:x2,hasProfile:b2,hasAlpha:y2,src:_2},v2="webp",k2=96,j2=96,S2="srgb",M2=4,C2="uchar",E2=288,N2=!1,T2=!1,I2=!0,P2="/assets/moon-shower-e5dy9u48.webp",R2={format:v2,width:k2,height:j2,space:S2,channels:M2,depth:C2,density:E2,isProgressive:N2,hasProfile:T2,hasAlpha:I2,src:P2},$2="webp",A2=96,L2=96,D2="srgb",O2=4,F2="uchar",z2=288,B2=!1,W2=!1,H2=!0,U2="/assets/moon-sunny-d9o08xiw.webp",G2={format:$2,width:A2,height:L2,space:D2,channels:O2,depth:F2,density:z2,isProgressive:B2,hasProfile:W2,hasAlpha:H2,src:U2},V2="webp",q2=96,K2=96,X2="srgb",Z2=4,Y2="uchar",J2=288,Q2=!1,ek=!1,tk=!0,sk="/assets/rain-thunder-eplemvu1.webp",nk={format:V2,width:q2,height:K2,space:X2,channels:Z2,depth:Y2,density:J2,isProgressive:Q2,hasProfile:ek,hasAlpha:tk,src:sk},ok="webp",rk=96,ak=96,ik="srgb",lk=4,ck="uchar",dk=288,uk=!1,fk=!1,mk=!0,hk="/assets/rain-ogayr6kt.webp",pk={format:ok,width:rk,height:ak,space:ik,channels:lk,depth:ck,density:dk,isProgressive:uk,hasProfile:fk,hasAlpha:mk,src:hk},gk="webp",xk=96,bk=96,yk="srgb",_k=4,wk="uchar",vk=288,kk=!1,jk=!1,Sk=!0,Mk="/assets/sleet-o8noil7l.webp",Ck={format:gk,width:xk,height:bk,space:yk,channels:_k,depth:wk,density:vk,isProgressive:kk,hasProfile:jk,hasAlpha:Sk,src:Mk},Ek="webp",Nk=96,Tk=96,Ik="srgb",Pk=4,Rk="uchar",$k=288,Ak=!1,Lk=!1,Dk=!0,Ok="/assets/snow-lq4cl3uc.webp",Fk={format:Ek,width:Nk,height:Tk,space:Ik,channels:Pk,depth:Rk,density:$k,isProgressive:Ak,hasProfile:Lk,hasAlpha:Dk,src:Ok},zk="webp",Bk=96,Wk=96,Hk="srgb",Uk=4,Gk="uchar",Vk=288,qk=!1,Kk=!1,Xk=!0,Zk="/assets/sun-drizzle-htsohv65.webp",Yk={format:zk,width:Bk,height:Wk,space:Hk,channels:Uk,depth:Gk,density:Vk,isProgressive:qk,hasProfile:Kk,hasAlpha:Xk,src:Zk},Jk="webp",Qk=96,ej=96,tj="srgb",sj=4,nj="uchar",oj=288,rj=!1,aj=!1,ij=!0,lj="/assets/sun-hazy-nfj7clcd.webp",cj={format:Jk,width:Qk,height:ej,space:tj,channels:sj,depth:nj,density:oj,isProgressive:rj,hasProfile:aj,hasAlpha:ij,src:lj},dj="webp",uj=96,fj=96,mj="srgb",hj=4,pj="uchar",gj=288,xj=!1,bj=!1,yj=!0,_j="/assets/sun-mostly-cloudy-e3pqqgs7.webp",wj={format:dj,width:uj,height:fj,space:mj,channels:hj,depth:pj,density:gj,isProgressive:xj,hasProfile:bj,hasAlpha:yj,src:_j},vj="webp",kj=96,jj=96,Sj="srgb",Mj=4,Cj="uchar",Ej=288,Nj=!1,Tj=!1,Ij=!0,Pj="/assets/sun-mostly-sunny-o99k1c7a.webp",Rj={format:vj,width:kj,height:jj,space:Sj,channels:Mj,depth:Cj,density:Ej,isProgressive:Nj,hasProfile:Tj,hasAlpha:Ij,src:Pj},$j="webp",Aj=96,Lj=96,Dj="srgb",Oj=4,Fj="uchar",zj=288,Bj=!1,Wj=!1,Hj=!0,Uj="/assets/sun-shower-ldwl4jbp.webp",Gj={format:$j,width:Aj,height:Lj,space:Dj,channels:Oj,depth:Fj,density:zj,isProgressive:Bj,hasProfile:Wj,hasAlpha:Hj,src:Uj},Vj="webp",qj=96,Kj=96,Xj="srgb",Zj=4,Yj="uchar",Jj=288,Qj=!1,eS=!1,tS=!0,sS="/assets/sun-sunny-kqjpjzd8.webp",nS={format:Vj,width:qj,height:Kj,space:Xj,channels:Zj,depth:Yj,density:Jj,isProgressive:Qj,hasProfile:eS,hasAlpha:tS,src:sS},oS="webp",rS=96,aS=96,iS="srgb",lS=4,cS="uchar",dS=288,uS=!1,fS=!1,mS=!0,hS="/assets/thunder-xzn1cku3.webp",pS={format:oS,width:rS,height:aS,space:iS,channels:lS,depth:cS,density:dS,isProgressive:uS,hasProfile:fS,hasAlpha:mS,src:hS},gS="webp",xS=96,bS=96,yS="srgb",_S=4,wS="uchar",vS=288,kS=!1,jS=!1,SS=!0,MS="/assets/tornado-diqu61wg.webp",CS={format:gS,width:xS,height:bS,space:yS,channels:_S,depth:wS,density:vS,isProgressive:kS,hasProfile:jS,hasAlpha:SS,src:MS},ES="webp",NS=96,TS=96,IS="srgb",PS=4,RS="uchar",$S=288,AS=!1,LS=!1,DS=!0,OS="/assets/windy-n2v8wtyp.webp",FS={format:ES,width:NS,height:TS,space:IS,channels:PS,depth:RS,density:$S,isProgressive:AS,hasProfile:LS,hasAlpha:DS,src:OS},zS={foggy:{default:F1},cloudy:{default:Y1},"heavy-snow":{default:cb},"light-snow":{default:wb},sleet:{default:w0},drizzle:{default:G0,night:Rb},hazy:{default:n_,night:Gb},"mostly-cloudy":{default:p_,night:ny},"mostly-sunny":{default:C_,night:py},shower:{default:F_,night:Cy},sunny:{default:Y_,night:Fy},"rain-thunder":{default:Yy},rain:{default:c0},snow:{default:R0},thunder:{default:cw},tornado:{default:ww},windy:{default:Rw}},BS={foggy:{default:Gw},cloudy:{default:nv},"heavy-snow":{default:pv},"light-snow":{default:Cv},sleet:{default:Ck},drizzle:{default:Yk,night:Fv},hazy:{default:cj,night:Yv},"mostly-cloudy":{default:wj,night:c2},"mostly-sunny":{default:Rj,night:w2},shower:{default:Gj,night:R2},sunny:{default:nS,night:G2},"rain-thunder":{default:nk},rain:{default:pk},snow:{default:Fk},thunder:{default:pS},tornado:{default:CS},windy:{default:FS}};function WS({weatherCode:t,isDarkMode:e,isNight:s}){const n=e?BS:zS,o=HS(t),a=n[o];return a.night&&s?a.night:a.default}function HS(t){switch(t){case 1:case 33:return"sunny";case 2:case 3:case 34:case 35:case 36:return"mostly-sunny";case 4:case 6:case 13:case 14:case 38:return"mostly-cloudy";case 5:case 37:return"hazy";case 7:case 8:return"cloudy";case 11:return"foggy";case 12:case 39:case 40:return"shower";case 15:case 16:case 17:case 41:case 42:return"thunder";case 18:return"rain";case 19:case 20:case 21:case 43:return"light-snow";case 22:case 23:case 44:return"snow";case 24:case 25:case 26:case 29:return"sleet";case 32:return"windy";default:return"cloudy"}}const US="C";function GS(t,e){return Math.round(t==="F"?e*9/5+32:(e-32)*5/9)}function ia(t,e,s=US){return t===s?"".concat(Math.round(e),"°"):"".concat(GS(t,e),"°")}const VS=ne(()=>se(()=>import("./gryeadru0tqqt3vi.js").then(t=>t._),__vite__mapDeps([47,1])),{loading:t=>ae(t)}),qS=ne(()=>se(()=>import("./gr73ffwzttzymtep.js").then(t=>t._),__vite__mapDeps([48,1])),{loading:t=>ae(t)}),KS=ne(()=>se(()=>import("./b0k25fupgmbv7hs2.js").then(t=>t._),__vite__mapDeps([49,1])),{loading:t=>ae(t)}),XS=7,la=8,ZS=m.memo(function({weatherResults:e,dateRange:s,turnIndex:n,trackContentReferenceEvent:o}){const[a,i]=iM(),l=QS(e);m.useEffect(()=>{o("Search Content Reference Shown","search_content_reference_shown","forecast")},[o]);const{daily:c,hourly:d,historical:f}=e;let u="daily";if(s||d&&c.length<2)u="hourly";else if(c.length>0)u="daily";else if(f&&(f==null?void 0:f.length)>0)u="historical";else return null;return r.jsxs("div",{className:"relative","data-testid":"weather-widget",children:[l?r.jsxs(r.Fragment,{children:[r.jsx(JS,{weatherResults:e}),r.jsx(eM,{weatherResults:e,temperatureUnit:a,setTemperatureUnit:i})]}):r.jsx("div",{className:"bg-token-main-surface-primary absolute end-0 top-3 z-10 rounded-sm",children:r.jsx(Ni,{onTemperatureUnitChange:i,temperatureUnit:a})}),r.jsx(oM,{turnIndex:n}),u==="hourly"&&r.jsx(tM,{weatherResults:e,temperatureUnit:a,dateRange:s}),u==="daily"&&r.jsx(sM,{dailyForecast:c.slice(0,XS),temperatureUnit:a}),u==="historical"&&r.jsx(nM,{historical:f,temperatureUnit:a})]})});function YS({weatherAlert:t}){const[e,s]=m.useState(!1),n=_e(),o=va(),a=ot(t.start_timestamp,t.utc_offset_sec),i=t.end_timestamp?ot(t.end_timestamp,t.utc_offset_sec):null,l=r.jsxs(r.Fragment,{children:[r.jsx("div",{children:r.jsx(q,{id:"JnuGPS",defaultMessage:"{start}{separator}{end}",values:{start:n.formatDate(a,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),separator:i?" - ":"",end:i?n.formatDate(i,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""}})}),r.jsx("div",{children:t.summary})]});return r.jsxs("button",{className:"my-2 flex w-full flex-col gap-2 rounded-xl border border-red-200 bg-red-100 px-4 py-3 text-start text-sm text-red-800",onClick:()=>s(!e),children:[r.jsxs("div",{className:"flex w-full items-center gap-4",children:[r.jsx(qS,{className:"h-9 w-9 shrink-0"}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("div",{className:"font-bold",children:r.jsx(q,{id:"y+fy/l",defaultMessage:"Severe Weather: {name}",values:{name:t.name}})}),o&&l]}),r.jsx("div",{className:"grow"}),r.jsx("div",{className:"opacity-30",children:e?r.jsx(Gu,{className:"icon-lg"}):r.jsx(Uu,{className:"icon-lg"})})]}),e&&t.details&&r.jsxs(r.Fragment,{children:[!o&&l,r.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:t.details.trim()})]})]})}function JS({weatherResults:t}){const{severe:e}=t;return e?r.jsx("div",{className:"my-2",children:e.map((s,n)=>r.jsx(YS,{weatherAlert:s},n))}):null}function QS(t){const{historical:e,daily:s,hourly:n,current:o}=t;if(!o)return!1;let a=!1;const i=ot(o.timestamp,o.utc_offset_sec);for(const l of[e,s,n])l&&(a=a||(l==null?void 0:l.some(c=>tc(i,ot(c.timestamp,c.utc_offset_sec)))));return a}function eM({weatherResults:t,temperatureUnit:e,setTemperatureUnit:s}){const n=_e(),{current:o}=t;if(!o)return null;const a=o.temperature.current,i=o.description,l=a!=null&&i&&" · ";return r.jsxs("div",{className:"not-prose flex items-center gap-4",children:[r.jsxs("div",{className:"grow",children:[r.jsxs("div",{className:"text-lg font-semibold",children:[a!=null&&r.jsx(q,{id:"FiwByI",defaultMessage:"Currently {temperature}",values:{temperature:kt(n,a,e)}}),l,i.description]}),r.jsx("div",{className:"text-token-text-secondary",children:aM(t.location)})]}),r.jsxs("div",{className:"flex",children:[r.jsx(Ni,{onTemperatureUnitChange:s,temperatureUnit:e}),r.jsx(wo,{weatherDescriptionData:i,isNight:o.night})]})]})}function _o({children:t}){return r.jsx("div",{className:"no-scrollbar not-prose mt-1 overflow-auto sm:overflow-hidden",children:r.jsx(De.Root,{className:"min-w-0",children:r.jsx(De.Body,{className:"border-token-border-medium border-b-[0.5px] [&_tr:last-child]:border-b-0",children:t})})})}function tM({weatherResults:t,temperatureUnit:e,dateRange:s}){const n=_e(),{hourly:o,current:a}=t;let i=o!=null?o:[];s&&(i=i.filter(f=>f.timestamp>=s.start_timestamp&&f.timestamp<s.end_timestamp));const[l,c]=m.useState(!1),d=i.length>la;if(!l&&d){const f=i[0],u=ot(f.timestamp,f.utc_offset_sec);let g=!1;if(a){const p=ot(a.timestamp,a.utc_offset_sec);u.getTime()-p.getTime()>480*60*1e3&&i.length>18&&(i=i.slice(7,18),g=!0)}g||(i=i.slice(0,la))}return r.jsxs(_o,{children:[i.map((f,u)=>r.jsxs(De.Row,{children:[r.jsxs(Xe,{className:"w-44",children:[r.jsx(wo,{weatherDescriptionData:f.description,isNight:f.night,size:"small"}),r.jsx("div",{className:"ms-3 whitespace-nowrap",children:r.jsx("span",{className:"lowercase",children:rM(n,f)})})]}),r.jsx(Xe,{className:"w-[60px] tabular-nums",children:r.jsx("div",{children:kt(n,f.temperature.current,e)})}),r.jsx(Xe,{children:f.description.description})]},u)),d&&r.jsx(De.Row,{children:r.jsx(Xe,{className:"w-44",children:r.jsx(Ve,{color:"secondary",onClick:()=>c(!l),size:"small",children:l?r.jsx(q,{id:"KoC8Ym",defaultMessage:"Show less"}):r.jsx(q,{id:"X8F8Y/",defaultMessage:"Show more"})})})})]})}function sM({dailyForecast:t,temperatureUnit:e}){const s=_e();return r.jsx(_o,{children:t.map((n,o)=>r.jsxs(De.Row,{children:[r.jsxs(Xe,{className:"w-[7.5rem] min-w-[7.5rem]",children:[r.jsx(wo,{weatherDescriptionData:n.description,isNight:n.night,size:"small"}),r.jsx("div",{className:"ms-3 whitespace-nowrap",children:Fn(s,ot(n.timestamp,n.utc_offset_sec))})]}),r.jsxs(Xe,{className:"tabular-nums",children:[r.jsx("div",{children:kt(s,n.temperature.max,e)}),r.jsx("div",{className:"text-token-text-secondary ms-1",children:kt(s,n.temperature.min,e)})]}),r.jsx(Xe,{className:"min-w-80",children:n.description.description})]},o))})}function nM({historical:t,temperatureUnit:e}){const s=_e();return t?r.jsx(_o,{children:t.map((n,o)=>{const a=ot(n.timestamp,n.utc_offset_sec);return r.jsxs(De.Row,{children:[r.jsx(Xe,{className:"w-[250px]",children:r.jsx("div",{className:"ms-3 whitespace-nowrap",children:s.formatDate(a,{weekday:"long",month:"short",day:"numeric"})})}),r.jsx(Xe,{className:"tabular-nums",children:n.temperature.max&&n.temperature.min?r.jsxs(r.Fragment,{children:[r.jsx("div",{children:kt(s,n.temperature.max,e)}),r.jsx("div",{className:"text-token-text-secondary ms-1",children:kt(s,n.temperature.min,e)})]}):r.jsx("div",{children:kt(s,n.temperature.current,e)})}),r.jsx(Xe,{})]},o)})}):null}function Xe({className:t,children:e}){return r.jsx(De.Cell,{className:D("border-token-border-xlight! border-s-0! border-e-0! py-2! ps-4! pe-3! first:ps-0! last:pe-0!",t),divClassName:"items-start leading-relaxed",children:e})}function oM({turnIndex:t}){const e=Cd(n=>{var o,a;return(a=(o=n.thread)==null?void 0:o.turns[t])==null?void 0:a.use_location}),[s]=Ed();return!s.useLocation&&e?r.jsx("div",{className:"mt-3",children:r.jsx(Ve,{color:"secondary",icon:VS,onClick:()=>{vd.setSettingsModalOpen(!0)},children:r.jsx(q,{id:"f47VEc",defaultMessage:"Share precise location"})})}):null}function Ni({temperatureUnit:t,onTemperatureUnitChange:e}){const s=n=>t===n?"font-bold":"font-light";return r.jsx(ba,{size:"small",triggerButton:r.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-primary flex items-center justify-center p-1.5",children:r.jsx(KS,{className:"icon-sm"})}),children:r.jsxs(He.Item,{onClick:()=>{e(t==="C"?"F":"C")},className:"text-token-text-primary",children:[r.jsx(q,{id:"bQIoe/",defaultMessage:"Temperature"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:s("F"),children:r.jsx(q,{id:"bvDeBB",defaultMessage:"°F"})}),r.jsx("div",{className:"mx-1 h-4 border-s border-gray-300"}),r.jsx("div",{className:s("C"),children:r.jsx(q,{id:"iNiz6O",defaultMessage:"°C"})})]})]})})}function wo({weatherDescriptionData:t,isNight:e=!1,size:s="normal"}){const n=Ys(),o=s==="small"?30:50;return r.jsx("img",{draggable:!1,alt:t.description,src:WS({weatherCode:t.id,isDarkMode:n,isNight:e}).src,width:o,height:o})}function rM(t,e){const s=ot(e.timestamp,e.utc_offset_sec);return t.formatDate(s,{hour:"numeric"})}function kt(t,e,s){return e==null?"-":ia(s?s!=null?s:"F":Ti(t),e)}function Ti(t){const e=["en-US","en-BZ","en-BS","en-KY","en-PW"],s=t.locale||"en-US";return e.includes(s)?"F":"C"}function aM(t){const e=t.name.split(",").map(s=>s.trim());return t.country&&!e.includes(t.country)&&e.push(t.country),e.join(", ")}const iM=()=>{const t=_e(),[e,s]=ec("USER_TEMPERATURE_UNIT",Ti(t),n=>["F","C"].includes(n));return[e,s]};function lM({contentReference:t,clientThreadId:e,messageId:s,trackContentReferenceEvent:n,contentReferenceIndex:o}){var x;const a=Me(),i=Pe(a,"1950533395"),l=io(),c=l?"sidebar":"primary",d="metadata"in t&&((x=t.metadata)!=null&&x.location)?String(t.metadata.location):void 0,f=m.useMemo(()=>({content_reference_start_index:t.start_idx,entity_name:t.name,category:t.category,conversation_type:c,contentReferenceIndex:o,metadata_location:d}),[t.start_idx,t.name,t.category,c,o,d]);m.useEffect(()=>{n("Entity Anchor Content Reference Shown","entity_anchor_content_reference_shown","entity",f)},[n,f]);const{openThreadSidebar:u}=bs(),{resetSidebarHistory:g}=Aa(),p=m.useCallback(w=>{var S,h;w.preventDefault(),n("Entity Anchor Content Reference Clicked","entity_anchor_content_reference_clicked","entity",f),e&&(l||g(),u({type:"entity",debugThreadId:void 0,messageId:s,contentReferenceStartIndex:t.start_idx,query:t.name,category:(S=t.category)!=null?S:void 0,extraParams:(h=t.extra_params)!=null?h:void 0}))},[n,f,e,l,u,s,t.start_idx,t.name,t.category,t.extra_params,g]);return t.category==="product_link"?i?r.jsx(Ve,{size:"medium",color:"secondary",className:"my-2",onClick:p,children:r.jsx(q,{id:"entityAnchor.buyingOptions",defaultMessage:"Buying Options"})}):r.jsx("span",{className:"text-token-text-primary font-semibold",children:r.jsx(q,{id:"entityAnchor.buyingOptions",defaultMessage:"Buying Options"})}):!i||t.status==="loading"?r.jsx("span",{className:"text-token-text-primary font-semibold",children:t.name}):r.jsx("span",{className:"hover:entity-accent entity-underline inline cursor-pointer align-baseline",onClick:p,children:r.jsx("span",{className:"whitespace-normal",children:t.name})})}const cM=ne(()=>se(()=>import("./irdjjmg8z2875a0t.js"),__vite__mapDeps([50,1,8,9,51,12,13,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,11,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127])).then(t=>t.BusinessesMap));function dM(t){"use forget";var B,W,X,H;const e=je.c(171),{index:s,FormattedText:n,node:o,wordFadeType:a}=t,i=parseInt(s,10),l=m.useContext(jt),c=Me(),f=sc({id:(X=(W=(B=l==null?void 0:l.message)==null?void 0:B.metadata)==null?void 0:W.model_slug)!=null?X:""},c)||Pe(c,"2137702454");let u;e[0]!==c?(u=at(c),e[0]=c,e[1]=u):u=e[1];const g=u;let p;e[2]!==l||e[3]!==g?(p=b=>{if(!g||(l==null?void 0:l.analyticsMetadata.turnIndex)===void 0)return[void 0,void 0];const P=ft.getConversationTurns(b),L=l.analyticsMetadata.turnIndex,K=P.findIndex(mM)===L,U=L>0?ft.getConversationTurnAtIndex(b,L-1):null,G=nc(U==null?void 0:U.messages.filter(oc));return[K,G]},e[2]=l,e[3]=g,e[4]=p):p=e[4];const[x,w]=us(l==null?void 0:l.clientThreadId,p),S=x===!0&&i===0,h=La(l==null?void 0:l.analyticsMetadata),M=m.useRef(!1);if(l==null)return null;const{contentReferences:v,onShowSearchResults:k,numImageResults:j,analyticsMetadata:y,message:E,superWidgetContent:C}=l,_=v==null?void 0:v[i];if(!_||y.turnIndex===void 0||_.type===void 0)return null;let R;e[5]===Symbol.for("react.memo_cache_sentinel")?(R={img:fM},e[5]=R):R=e[5];let $;e[6]!==_.alt?($=r.jsx(lo,{components:R,children:_.alt}),e[6]=_.alt,e[7]=$):$=e[7];const A=$;let N=null;e:switch(_.type){case"title_citation":{let b;e[8]!==_||e[9]!==h?(b=r.jsx(_1,{metadata:_,trackContentReferenceEvent:h}),e[8]=_,e[9]=h,e[10]=b):b=e[10],N=b;break e}case"link_title":{let b;e[11]!==_||e[12]!==h?(b=r.jsx(Yx,{metadata:_,trackContentReferenceEvent:h}),e[11]=_,e[12]=h,e[13]=b):b=e[13],N=b;break e}case"location_search":{let b;e[14]!==_||e[15]!==h?(b=r.jsx(Qx,{metadata:_,trackContentReferenceEvent:h}),e[14]=_,e[15]=h,e[16]=b):b=e[16],N=b;break e}case"time":{let b;e[17]!==_||e[18]!==h?(b=r.jsx(y1,{metadata:_,trackContentReferenceEvent:h}),e[17]=_,e[18]=h,e[19]=b):b=e[19],N=b;break e}case"image_v2":{const b=j!=null?j:0;let P;e[20]!==y||e[21]!==_||e[22]!==h||e[23]!==S||e[24]!==C||e[25]!==b?(P=r.jsx(ho,{metadata:_,numImageResults:b,analyticsMetadata:y,trackContentReferenceEvent:h,superWidgetContent:C,isFirstAssistantContent:S}),e[20]=y,e[21]=_,e[22]=h,e[23]=S,e[24]=C,e[25]=b,e[26]=P):P=e[26],N=P;break e}case"nav_list":{const b=w!=null?w:null,P=C!=null?C:null;let L;e[27]!==_||e[28]!==h||e[29]!==S||e[30]!==b||e[31]!==P?(L=r.jsx(r1,{metadata:_,trackContentReferenceEvent:h,isFirstAssistantContent:S,lastUserMsgOfPrevTurn:b,superWidgetContent:P}),e[27]=_,e[28]=h,e[29]=S,e[30]=b,e[31]=P,e[32]=L):L=e[32],N=L;break e}case"file_navlist":{let b;e[33]!==_||e[34]!==h?(b=r.jsx(Rx,{metadata:_,trackContentReferenceEvent:h}),e[33]=_,e[34]=h,e[35]=b):b=e[35],N=b;break e}case"file":{if(f){let b;e[36]!==_||e[37]!==v||e[38]!==h||e[39]!==i?(b=r.jsx(Tu,{contentReferences:v,fileRef:_,index:i,trackContentReferenceEvent:h}),e[36]=_,e[37]=v,e[38]=h,e[39]=i,e[40]=b):b=e[40],N=b}else{let b;e[41]!==_||e[42]!==h||e[43]!==i?(b=r.jsx(Iu,{fileRef:_,index:i,trackContentReferenceEvent:h}),e[41]=_,e[42]=h,e[43]=i,e[44]=b):b=e[44],N=b}break e}case"grouped_webpages_model_predicted_fallback":{let b;e[45]!==_||e[46]!==l.message.id||e[47]!==h||e[48]!==i||e[49]!==o?(b=r.jsx(Nu,{webpageRef:_,node:o,trackContentReferenceEvent:h,messageId:l.message.id,index:i}),e[45]=_,e[46]=l.message.id,e[47]=h,e[48]=i,e[49]=o,e[50]=b):b=e[50],N=b;break e}case"grouped_webpages":{let b;e[51]!==_||e[52]!==l.message.id||e[53]!==h||e[54]!==i||e[55]!==o?(b=r.jsx(Eu,{webpageRef:_,node:o,trackContentReferenceEvent:h,messageId:l.message.id,index:i}),e[51]=_,e[52]=l.message.id,e[53]=h,e[54]=i,e[55]=o,e[56]=b):b=e[56],N=b;break e}case"tldr":break e;case"navigation":{let b;e[57]!==_||e[58]!==h||e[59]!==k?(b=r.jsx(td,{navigation:_,onShowSearchResults:k,trackContentReferenceEvent:h}),e[57]=_,e[58]=h,e[59]=k,e[60]=b):b=e[60],N=b;break e}case"stock":{let b;e[61]!==_||e[62]!==h?(b=r.jsx(Kx,{contentReference:_,trackContentReferenceEvent:h}),e[61]=_,e[62]=h,e[63]=b):b=e[63],N=b;break e}case"calculator":{let b;e[64]!==_||e[65]!==h?(b=r.jsx(_x,{data:_,trackContentReferenceEvent:h}),e[64]=_,e[65]=h,e[66]=b):b=e[66],N=b;break e}case"python":case"container":{let b;e[67]!==y.turnIndex||e[68]!==_||e[69]!==l.clientThreadId?(b=r.jsx(Mx,{clientThreadId:l.clientThreadId,turnIndex:y.turnIndex,contentReference:_}),e[67]=y.turnIndex,e[68]=_,e[69]=l.clientThreadId,e[70]=b):b=e[70],N=b;break e}case"code_execution":{let b;e[71]!==n||e[72]!==_||e[73]!==h?(b=r.jsx(jx,{FormattedText:n,displayInfo:_,trackContentReferenceEvent:h}),e[71]=n,e[72]=_,e[73]=h,e[74]=b):b=e[74],N=b;break e}case"forecast":{let b;e[75]!==y||e[76]!==_.date_range||e[77]!==_.forecast||e[78]!==h?(b=(_==null?void 0:_.forecast)&&r.jsx(ZS,{weatherResults:_.forecast,dateRange:_.date_range,turnIndex:y.turnIndex,trackContentReferenceEvent:h}),e[75]=y,e[76]=_.date_range,e[77]=_.forecast,e[78]=h,e[79]=b):b=e[79],N=b;break e}case"businesses_map":{let b;e[80]!==_||e[81]!==h?(b=r.jsx(cM,{contentReference:_,trackContentReferenceEvent:h}),e[80]=_,e[81]=h,e[82]=b):b=e[82],N=b;break e}case"map":{let b;e[83]!==_||e[84]!==l.clientThreadId||e[85]!==l.message.id||e[86]!==h?(b=r.jsx(Ug,{contentReference:_,trackContentReferenceEvent:h,clientThreadId:l.clientThreadId,messageId:l.message.id}),e[83]=_,e[84]=l.clientThreadId,e[85]=l.message.id,e[86]=h,e[87]=b):b=e[87],N=b;break e}case"video":{let b;e[88]!==_||e[89]!==h?(b=r.jsx(C1,{video:_,trackContentReferenceEvent:h}),e[88]=_,e[89]=h,e[90]=b):b=e[90],N=b;break e}case"sports_standings":{let b;e[91]!==_||e[92]!==h?(b=r.jsx(x1,{standingsRef:_,trackContentReferenceEvent:h}),e[91]=_,e[92]=h,e[93]=b):b=e[93],N=b;break e}case"sports_schedule":{let b;e[94]!==_||e[95]!==h?(b=r.jsx(m1,{scheduleRef:_,trackContentReferenceEvent:h}),e[94]=_,e[95]=h,e[96]=b):b=e[96],N=b;break e}case"attribution":{let b;e[97]!==_||e[98]!==a?(b=r.jsx(px,{attribution:_,wordFadeType:a}),e[97]=_,e[98]=a,e[99]=b):b=e[99],N=b;break e}case"debug":{let b;e[100]!==_?(b=r.jsx(r.Fragment,{children:Object.entries(_).map(uM)}),e[100]=_,e[101]=b):b=e[101],N=b;break e}case"image_inline":{let b;e[102]!==_||e[103]!==l.clientThreadId||e[104]!==h||e[105]!==E?(b=(H=E.metadata)!=null&&H.b1de6e2_rm?r.jsx(bp,{reference:_,clientThreadId:l.clientThreadId,trackContentReferenceEvent:h,message:E}):r.jsx(_p,{reference:_,clientThreadId:l.clientThreadId,trackContentReferenceEvent:h,message:E}),e[102]=_,e[103]=l.clientThreadId,e[104]=h,e[105]=E,e[106]=b):b=e[106],N=b;break e}case"image_group":{const b=w!=null?w:null,P=C!=null?C:null;let L;e[107]!==y||e[108]!==_||e[109]!==h||e[110]!==x||e[111]!==b||e[112]!==P?(L=r.jsx(Xh,{contentReference:_,trackContentReferenceEvent:h,analyticsMetadata:y,isFirstAssistantTurn:x,lastUserMsgOfPrevTurn:b,superWidgetContent:P}),e[107]=y,e[108]=_,e[109]=h,e[110]=x,e[111]=b,e[112]=P,e[113]=L):L=e[113],N=L;break e}case"product_entity":{let b;e[114]!==y.turnIndex||e[115]!==_||e[116]!==l.clientThreadId||e[117]!==l.message.id||e[118]!==h?(b=r.jsx(nx,{contentReference:_,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:y.turnIndex,trackContentReferenceEvent:h}),e[114]=y.turnIndex,e[115]=_,e[116]=l.clientThreadId,e[117]=l.message.id,e[118]=h,e[119]=b):b=e[119],N=b;break e}case"entity_metadata":{let b;e[120]!==_||e[121]!==l.clientThreadId||e[122]!==l.message.id||e[123]!==h?(b=r.jsx(Ix,{contentReference:_,clientThreadId:l.clientThreadId,messageId:l.message.id,trackContentReferenceEvent:h}),e[120]=_,e[121]=l.clientThreadId,e[122]=l.message.id,e[123]=h,e[124]=b):b=e[124],N=b;break e}case"checkout_confirmation":{let b;e[125]!==_||e[126]!==h?(b=r.jsx(Th,{metadata:_,trackContentReferenceEvent:h}),e[125]=_,e[126]=h,e[127]=b):b=e[127],N=b;break e}case"entity":{let b;e[128]!==y.turnIndex||e[129]!==_||e[130]!==l.clientThreadId||e[131]!==l.message.id||e[132]!==h||e[133]!==i?(b=r.jsx(lM,{contentReference:_,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:y.turnIndex,trackContentReferenceEvent:h,contentReferenceIndex:i}),e[128]=y.turnIndex,e[129]=_,e[130]=l.clientThreadId,e[131]=l.message.id,e[132]=h,e[133]=i,e[134]=b):b=e[134],N=b;break e}case"product":{let b;e[135]!==y||e[136]!==_||e[137]!==l.clientThreadId||e[138]!==l.message||e[139]!==h||e[140]!==i?(b=null,e[135]=y,e[136]=_,e[137]=l.clientThreadId,e[138]=l.message,e[139]=h,e[140]=i,e[141]=b):b=e[141],N=b;break e}case"products":{let b;e[142]!==y||e[143]!==_||e[144]!==l.clientThreadId||e[145]!==l.message.id?(b=r.jsx(dx,{contentReference:_,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:y.turnIndex,analyticsMetadata:y}),e[142]=y,e[143]=_,e[144]=l.clientThreadId,e[145]=l.message.id,e[146]=b):b=e[146],N=b;break e}case"product_reviews":{let b;e[147]!==_||e[148]!==h?(b=r.jsx(gc,{contentReference:_,disableAnimation:!0,trackContentReferenceEvent:h}),e[147]=_,e[148]=h,e[149]=b):b=e[149],N=b;break e}case"product_rationale":{let b;e[150]!==_||e[151]!==h?(b=r.jsx(pc,{contentReference:_,trackContentReferenceEvent:h,disableAnimation:!0}),e[150]=_,e[151]=h,e[152]=b):b=e[152],N=b;break e}case"dil":{let b;e[153]!==_.dil||e[154]!==_.name||e[155]!==h?(b=r.jsx(Cx,{dil:_.dil,trackContentReferenceEvent:h,widgetName:_.name}),e[153]=_.dil,e[154]=_.name,e[155]=h,e[156]=b):b=e[156],N=b;break e}case"strix":break e;case"sources_footnote":return null}"dil"in _&&_.dil;let T;e[164]!==A||e[165]!==_||e[166]!==h?(T=b=>(M.current||(h("Search Content Reference Failed","search_content_reference_failed",_.type),Vt.addError("Error rendering content reference: ".concat(_.type),Q(z({},b),{contentReference:_})),M.current=!0),_!=null&&_.alt?A:r.jsx("span",{className:"errored-object-".concat(_.type)})),e[164]=A,e[165]=_,e[166]=h,e[167]=T):T=e[167];let I;return e[168]!==N||e[169]!==T?(I=r.jsx(ja,{name:"content-reference-renderer",fallback:T,children:N}),e[168]=N,e[169]=T,e[170]=I):I=e[170],I}function uM(t){const[e,s]=t;return r.jsx("sub",{className:"ms-1 w-fit rounded-md border-2 border-solid border-orange-500 px-1 leading-none",children:s},e)}function fM(t){const{src:e,alt:s}=t;return r.jsx("img",{src:e,alt:s,className:"max-h-28"})}function mM(t){return t.role===rc.Assistant}var fa;const hM=new RegExp(String.raw(fa||(fa=vs(["]((?!<)(","[^)\r\n]+?))"],["\\]\\((?!<)(","[^)\\r\\n]+?)\\)"])),In),"g"),pM=/\s/;function ca(t){return t.replace(hM,(e,s)=>pM.test(s)?"](".concat("<".concat(s,">"),")"):e)}const gM=ne(()=>se(()=>import("./fwyctp3zfyh6emd2.js").then(t=>t._),__vite__mapDeps([29,1])),{loading:t=>ae(t)}),xM=ne(()=>se(()=>import("./c8sj5q0wb2w4qlno.js").then(t=>t._),__vite__mapDeps([30,1])),{loading:t=>ae(t)}),bM=({onClick:t})=>{const[e,s]=m.useState(!1),n=sd(),o=_e(),a=c=>{t(c),s(!0),setTimeout(()=>{n()&&s(!1)},2e3)},i=e?xM:gM,l=o.formatMessage({id:"uG/ayY",defaultMessage:"Copy table"});return r.jsx(Ct,{label:l,side:"bottom",align:"center",alignOffset:0,children:r.jsx("button",{"aria-label":l,onClick:a,className:"hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0",children:r.jsx(i,{className:"icon"})})})},yM=o=>{var a=o,{onClickCopy:t,children:e,unstyledContainer:s}=a,n=Le(a,["onClickCopy","children","unstyledContainer"]);const i=Me(),l=m.useRef(null),c=m.useRef(null),d=rt(()=>eo(i));return ya(()=>{var f;nd({axis:"height",target:(f=l.current)==null?void 0:f.firstElementChild,onChange:({height:u})=>{c.current&&(c.current.style.height="".concat(u,"px"))}})},[]),r.jsx("div",{className:D(s?void 0:d?"-mx-6":Vo.tableContainer),children:r.jsxs("div",{tabIndex:-1,className:D("group",d?"flex w-full max-w-full overflow-x-auto overscroll-x-contain px-6":D(s?void 0:Vo.tableWrapper,"flex w-fit flex-col-reverse")),children:[r.jsx("table",Q(z({},n),{className:D(d?"w-full":"w-fit min-w-(--thread-content-width)"),ref:l,children:e})),r.jsx("div",{className:D("sticky h-0 select-none",d?"end-0 self-start":D(s?"end-0 self-end":"end-(--thread-content-margin) self-end")),children:r.jsx("div",{className:"absolute end-0 flex items-end",ref:c,children:r.jsx(bM,{onClick:t})})})]})})},_M=n=>{var o=n,{node:t,children:e}=o,s=Le(o,["node","children"]);return r.jsx("td",Q(z({},s),{children:m.Children.map(e,(a,i)=>a==="<br>"?r.jsx("br",{},i):a)}))},Is=(t,e,s)=>{ic(s,t,void 0,e),Xn.count(Zn.WRITING_BLOCKS,t)};function wM(t){const l=t,{src:e,conversation:s}=l,n=Le(l,["src","conversation"]),o=rt(()=>s==null?void 0:s.serverId$()),a=m.useContext(jt),i=dd(o,e,a==null?void 0:a.useSafeUrls);return i==null?r.jsx("div",{}):r.jsx("img",Q(z({},n),{src:i}))}function vM(t){return r.jsx(dM,Q(z({},t),{FormattedText:Ii}))}function Ii({size:t="medium",children:e,className:s,conversation:n,messageId:o,isActivelyStreaming:a=!1,componentOverrides:i,isDeepResearchResultMessage:l,forceDarkMode:c,disableWordFade:d}){const f=Ys()||c,{wordFadeType:u}=od(),g=rd(),p=m.useRef(!1),x=m.useRef(!1);p.current=!1;const w=Me(),S=Jn(so.DisableWritingBlockRendering),h=m.useMemo(()=>{var K;if(!i)return;const U=i,{[K=hn]:P}=U;return Le(U,[Po(K)])},[i]),M=m.useMemo(()=>i==null?void 0:i[hn],[i]),v=m.useMemo(()=>z(z(Q(z({pre:({children:P,"data-start":L,"data-end":K,"data-is-last-node":U})=>r.jsx("pre",{className:"overflow-visible!","data-start":L,"data-end":K,"data-is-last-node":U,children:P}),code:P=>r.jsx(id,z({},P)),[ac]:P=>r.jsx(vM,z({wordFadeType:u},P)),[ad]:P=>n==null?null:r.jsx(Af,Q(z({},P),{conversation:n,messageId:o})),[wd]:_d,[Pd]:Ff,[Id]:Qf,[Td]:Zf,[Nd]:Hf,a:P=>{var oe,re,me,he;const te=P,{node:L,children:K}=te,U=Le(te,["node","children"]),G=(oe=L==null?void 0:L.properties)==null?void 0:oe.href;if(typeof G=="string"&&G.startsWith(In))return n!=null&&o!=null?r.jsx(Ui,Q(z({},U),{conversation:n,messageId:o,href:G,children:K})):null;if(typeof G=="string"&&G===Gi){if(n==null||o==null)return K;const ie=(re=L==null?void 0:L.children)==null?void 0:re.map(pe=>typeof pe.value=="string"?pe.value:"").join("").trim();return r.jsx(Vi,Q(z({},P),{text:ie,conversation:n,messageId:o,className:"cursor-pointer"}))}if(typeof G=="string"&&G===qi){if(n==null||o==null)return K;const ie=(me=L==null?void 0:L.children)==null?void 0:me.map(pe=>typeof pe.value=="string"?pe.value:"").join("").trim();return r.jsx(Ki,Q(z({},P),{text:ie,conversation:n,messageId:o}))}if(typeof G=="string"&&G===Xi){if(n==null||o==null)return K;const ie=(he=L==null?void 0:L.children)==null?void 0:he.map(pe=>typeof pe.value=="string"?pe.value:"").join("").trim();return r.jsx(Zi,Q(z({},P),{text:ie,conversation:n,messageId:o}))}return G&&typeof G=="string"&&Lf(G)?K:r.jsx(qu,Q(z({},P),{messageId:o}))},table:K=>{var U=K,{node:P}=U,L=Le(U,["node"]);return r.jsx(yM,Q(z({},L),{onClickCopy:G=>{var oe;st.logEvent("ChatGPT Table Copy Clicked");const te=n!=null&&o!=null?ft.getNode(Do(n.id),o).message:void 0;to(ha(P.markdownSource,(oe=te==null?void 0:te.metadata)==null?void 0:oe.content_references),void 0,G)}}))},td:_M},g?{h1:K=>{var U=K,{node:P}=U,L=Le(U,["node"]);return r.jsx("h1",z({"data-section-id":Ss(P.markdownSource)},L))},h2:K=>{var U=K,{node:P}=U,L=Le(U,["node"]);return r.jsx("h2",z({"data-section-id":Ss(P.markdownSource)},L))},h3:K=>{var U=K,{node:P}=U,L=Le(U,["node"]);return r.jsx("h3",z({"data-section-id":Ss(P.markdownSource)},L))},li:K=>{var U=K,{node:P}=U,L=Le(U,["node"]);return r.jsx("li",z({"data-section-id":Ss(P.markdownSource)},L))}}:{}),{img:K=>{var U=K,{node:P}=U,L=Le(U,["node"]);var te;const G=(te=P==null?void 0:P.properties)==null?void 0:te.src;return typeof G=="string"&&(G.startsWith(In)||G.startsWith("attachment:"))?null:r.jsx(wM,Q(z({},L),{conversation:n}))}}),u==="delay"?Ku:[]),h!=null?h:{}),[g,u,h,n,o]),k=m.useCallback((P,L)=>{var K,U,G,te;if(P==null||n==null||o==null)return L;try{const oe=Do(n.id),re=ft.getNode(oe,o),me=(te=(G=(U=(K=re==null?void 0:re.message)==null?void 0:K.metadata)==null?void 0:U.writing_blocks)==null?void 0:G[P])==null?void 0:te.content;return me!=null?me:L}catch(oe){return L}},[n,o]),j=m.useCallback((P,L)=>P?r.jsx(Gn,{components:v,remarkPlugins:Nn,rehypePlugins:Tn,urlTransform:En,children:ca(P)}):r.jsx(r.Fragment,{children:L}),[v]),y=m.useCallback(P=>{var K,U;if(p.current=!0,S){const G=(K=P.id)!=null?K:P.index!=null?String(P.index):void 0,te=k(G,P.content);return j(te,P.children)}if(typeof M=="function")return M(P);const L=sm(P.variant);return r.jsx(Eh,{messageId:o,title:P.title,originalContent:P.content,variant:L,recipient:P.recipient,isStreaming:a,index:P.index,id:(U=P.id)!=null?U:String(P.index),children:P.children})},[S,k,j,M,o,a]),E=m.useMemo(()=>Q(z({},v),{[hn]:y}),[v,y]),C=Pe(w,"1839283687"),[_,R]=m.useState(!1),$=m.useMemo(()=>{const P=e!=null?e:"",L=a&&e?Xu(e):P;return ca(L)},[e,a]),A=m.useMemo(()=>ld($),[$]),N=m.useMemo(()=>_?cd($):$,[$,_]),T=Da(),I=m.useMemo(()=>[...Tn,[Yi,N]],[N]),B=m.useRef(!1);a&&(B.current=!0);const W=m.useMemo(()=>u==="indexed"&&!d?{handlers:{text:(P,L,K)=>{const U=[];for(const G of T(L.value))U.push({type:"element",tagName:"span",properties:{className:Oa.fadeIn},children:[{type:"text",value:G}]});return U}}}:void 0,[u,T,d]),X=m.useMemo(()=>a||!A?!1:$.includes(":::writing"),[a,A,$]),H=m.useMemo(()=>{var P;return{contains_writing_directive:A?"true":"false",uses_old_syntax:X?"true":"false",client_thread_id:(P=n==null?void 0:n.id)!=null?P:"",message_id:o!=null?o:""}},[A,X,o,n]),b=m.useRef(!1);return m.useEffect(()=>{!X||b.current||(Is("chatgpt_writing_block_uses_old_syntax",H,w),B.current&&Is("chatgpt_new_writing_block_uses_old_syntax",H,w),b.current=!0)},[H,X,w]),m.useEffect(()=>{A&&(a||p.current||x.current||(Is("chatgpt_writing_block_render_failed",H,w),B.current&&Is("chatgpt_writing_block_first_render_failed",H,w),x.current=!0,R(!0)))},[w,n,a,o,A,R,X,H]),C?!1:r.jsx(ja,{name:"formatted_text_error",fallback:()=>r.jsx(r.Fragment,{children:N}),children:r.jsx(Gn,{rehypePlugins:I,remarkPlugins:Nn,remarkRehypeOptions:W,className:D(s,"markdown prose dark:prose-invert w-full break-words",f?"dark":"light",t==="small"&&"prose-xs",l&&"deep-research-result","markdown-new-styling"),urlTransform:En,components:E,children:N})})}const Gn=m.memo(lo),g3=Object.freeze(Object.defineProperty({__proto__:null,FormattedText:Ii,ReactMarkdownMemo:Gn},Symbol.toStringTag,{value:"Module"}));export{g3 as F,Mg as M,Hs as W,Dg as a,Cg as b,Yp as c,Kp as f,hi as p,ut as r,Xp as t};
//# sourceMappingURL=lpn18ascydaxcdfj.js.map
