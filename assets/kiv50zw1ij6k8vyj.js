import{gG as H}from"./ghewn7l2ynbm32fm.js";import{a as A,u as I,c as y}from"./cb0ba83bmi83mjz2.js";import{C as l}from"./6ji8ehbh56ghw0zw.js";import{H as P}from"./ce3hgmw4iyyhicud.js";import{S as u,b as f,E as c,D as i}from"./gdq1l97elemowxcc.js";function D(t,e){const n=L(t);if(n.length===0)return e;let o=e;return n.forEach(s=>{o=F(s,o)}),o}function F(t,e){return A(e,{start:t.fromA,end:t.toA},w(t))}function w(t){const{fromA:e,toA:n,fromB:o,toB:s}=t;return s-o-(n-e)}function L(t){const e=[],n=(o,s,r,a)=>{e.push({fromA:o,toA:s,fromB:r,toB:a})};return t.changes.iterChangedRanges(n,!0),e}function R(t,e){const n=Array.from(t.keys()),o=Array.from(e.keys());if(n.length!==o.length)return!1;n.sort(),o.sort();for(let s=0;s<n.length;s++)if(n[s]!==o[s])return!1;for(const s of n){const r=t.get(s),a=e.get(s);if(!r||!a||r.start!==a.start||r.end!==a.end)return!1}return!0}const S=u.define(),b=u.define(),B=u.define(),T=u.define();function j(t){return new Map(t.map(e=>[e.id,e.at]))}const d=f.define({create(){return null},update(t,e){for(const n of e.effects)if(n.is(S))return n.value;return t}}),m=f.define({create(){return[]},update(t,e){for(const a of e.effects)if(a.is(b))return a.value;const n=t,o=j(n),s=D(e,o);return R(o,s)?n:I(n,s)}}),g=f.define({create(){return null},update(t,e){for(const n of e.effects)if(n.is(B))return n.value;return t}}),C=f.define({create(){return null},update(t,e){for(const n of e.effects)if(n.is(T))return n.value;return t}});function p(t){if(!t||t.to-t.from===0)return i.none;const e=i.mark({class:P.code});return i.set([e.range(t.from,t.to)])}function h(t,e,n){if(t.length===0)return i.none;const s=[...t].sort((r,a)=>r.at.start-a.at.start).map(r=>{if(r.at.end-r.at.start===0)return null;const a=r.id===e,v=r.id===n,k=y({isHovered:a,isFocused:v,isCode:!0,diffStatus:r.diffStatus});return i.mark({class:k,attributes:{"data-comment-id":r.id}}).range(r.at.start,r.at.end)}).filter(H);return i.set(s)}const G=f.define({create(t){const e=t.field(d,!1);return p(e!=null?e:null)},update(t,e){const n=e.state.field(d,!1);return p(n!=null?n:null)},provide:t=>c.decorations.from(t)}),x=f.define({create(t){const e=t.field(m,!1),n=t.field(g,!1),o=t.field(C,!1);return h(e!=null?e:[],n!=null?n:null,o!=null?o:null)},update(t,e){const n=e.state.field(m,!1),o=e.state.field(g,!1),s=e.state.field(C,!1);return h(n!=null?n:[],o!=null?o:null,s!=null?s:null)},provide:t=>c.decorations.from(t)});function M(t){t.state.selection.main.empty&&t.dispatch({effects:S.of(null)})}function E(t){let e=t.dataset.commentId;for(let n=0;n<10&&!e&&t.parentElement;n++)t=t.parentElement,e=t.dataset.commentId;return e}function N(t){const e=t.target,n=E(e);n&&l.focusComment(n)}function _(t){const e=t.target,n=E(e);n?l.mouseEnterComment(n):l.mouseLeaveComment()}function K(t,e=null,n=null){return[m.init(()=>t),d,g.init(()=>e),C.init(()=>n),G,x,c.updateListener.of(o=>{o.selectionSet&&M(o.view)}),c.domEventHandlers({click:N,mouseover:_})]}export{S as a,B as b,K as c,T as d,m as e,b as s};
//# sourceMappingURL=kiv50zw1ij6k8vyj.js.map
