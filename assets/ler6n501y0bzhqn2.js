const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mtsfsh7z74bmo6ig.js","assets/i8clt0mfz495j7ii.js","assets/ntuoxtu7ohytvwjv.js","assets/f2itj05whsmn3kgs.js","assets/kkginmfs5ty8sze2.js","assets/e216z3zqjas1rma2.js"])))=>i.map(i=>d[i]);
var Z=Object.defineProperty,J=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var F=(s,l,a)=>l in s?Z(s,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[l]=a,v=(s,l)=>{for(var a in l||(l={}))ee.call(l,a)&&F(s,a,l[a]);if(P)for(var a of P(l))se.call(l,a)&&F(s,a,l[a]);return s},N=(s,l)=>J(s,Y(l));import{f as te,e as W,r as I,j as e,_ as D,M as S}from"./i8clt0mfz495j7ii.js";import{o as O,L as R,co as U,cn as G,u as ae,lV as ne,pE as B,R as re,kh as q,j as oe,bN as V}from"./ghewn7l2ynbm32fm.js";import{bQ as K,km as le,m as X,kn as ie,ko as ce,cs as de,dc as ue,bx as me}from"./j0yo6uv6652vva62.js";import{T as Q}from"./b6hyii2315xk7j19.js";const fe=["Not relevant","Inaccurate","Incomplete","Missing sources","I don't like it","Shouldn't have searched Google Drive","Prompt was misunderstood","Didn't like the response style","Other"],ge=["Good sources","Answered my question","I like it","Other"],he=["Not relevant","Out of date","Content is wrong"],xe=["Relevant","Up to date","Accurate"];function pe(s){switch(s){case"Not relevant":return f.tagNotRelevant;case"Inaccurate":return f.tagInaccurate;case"Incomplete":return f.tagIncomplete;case"Missing sources":return f.tagMissingSources;case"I don't like it":return f.tagDontLikeIt;case"Shouldn't have searched Google Drive":return f.tagShouldntHaveSearched;case"Prompt was misunderstood":return f.tagPromptMisunderstood;case"Didn't like the response style":return f.tagDidntLikeResponseStyle;case"Other":return f.tagOther;case"Good sources":return f.tagGoodSources;case"Answered my question":return f.tagAnsweredMyQuestion;case"I like it":return f.tagLike;case"Out of date":return f.tagOutOfDate;case"Content is wrong":return f.tagContentWrong;case"Relevant":return f.tagRelevant;case"Up to date":return f.tagUpToDate;case"Accurate":return f.tagAccurate}}function $(s,l){let a;try{a=pe(s)}catch(g){}return a?l.formatMessage(a):s}function z(s,l){return s.map(a=>({label:$(a,l),value:a}))}const f=te({tagNotRelevant:{id:"T24lap",defaultMessage:"Not relevant"},tagInaccurate:{id:"USOv/g",defaultMessage:"Inaccurate"},tagIncomplete:{id:"Lk26Q8",defaultMessage:"Incomplete"},tagMissingSources:{id:"Fng4pl",defaultMessage:"Missing sources"},tagDontLikeIt:{id:"6eAB3A",defaultMessage:"I don't like it"},tagShouldntHaveSearched:{id:"Y22bKM",defaultMessage:"Shouldn't have searched Google Drive"},tagPromptMisunderstood:{id:"NjmgTt",defaultMessage:"Prompt was misunderstood"},tagDidntLikeResponseStyle:{id:"np+P/8",defaultMessage:"Didn't like the response style"},tagOther:{id:"BK4DWm",defaultMessage:"Other"},tagGoodSources:{id:"SpXc0X",defaultMessage:"Good sources"},tagAnsweredMyQuestion:{id:"jbur49",defaultMessage:"Answered my question"},tagLike:{id:"w9iwLl",defaultMessage:"I like it"},tagOutOfDate:{id:"qzHvzr",defaultMessage:"Out of date"},tagContentWrong:{id:"gGDbwI",defaultMessage:"Content is wrong"},tagRelevant:{id:"G4D31U",defaultMessage:"Relevant"},tagUpToDate:{id:"CsRBPs",defaultMessage:"Up to date"},tagAccurate:{id:"ohD9UA",defaultMessage:"Accurate"}}),_e=O(()=>D(()=>import("./mtsfsh7z74bmo6ig.js").then(s=>s._),__vite__mapDeps([0,1])),{loading:s=>R(s)}),ye=O(()=>D(()=>import("./ntuoxtu7ohytvwjv.js").then(s=>s._),__vite__mapDeps([2,1])),{loading:s=>R(s)}),ve=O(()=>D(()=>import("./f2itj05whsmn3kgs.js").then(s=>s._),__vite__mapDeps([3,1])),{loading:s=>R(s)}),be=O(()=>D(()=>import("./kkginmfs5ty8sze2.js").then(s=>s._),__vite__mapDeps([4,1])),{loading:s=>R(s)}),H=O(()=>D(()=>import("./e216z3zqjas1rma2.js").then(s=>s._),__vite__mapDeps([5,1])),{loading:s=>R(s)});function je({citationMetadata:s,noBottomBorder:l=!1,sourceFeedback:a,setSourceFeedback:g}){var k;const m=W(),[b,h]=I.useMemo(()=>{if(s.type!=="file")return["",""];const d=s.name.split(".");return d.length>1?[d.slice(0,-1).join("."),d[d.length-1]]:[s.name,""]},[s]),_=I.useMemo(()=>{var T,j,A;if(s.type!=="file")return()=>null;const d=(j=s.cloud_doc_url)!=null?j:(T=s.extra)==null?void 0:T.cloud_doc_url;if(!d)return H;const x=K(d);return(A=x==null?void 0:x.Icon)!=null?A:(()=>null)},[s]),u=I.useMemo(()=>{var d;if(s.type==="file"&&((d=s.extra)!=null&&d.cloud_doc_url))try{return new URL(s.extra.cloud_doc_url).hostname}catch(x){return}},[s]),y=I.useCallback(d=>{g({rating:d,tags:[]})},[g]);return s.type!=="file"?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center justify-between py-2",children:[e.jsxs("div",{className:"max-width-full me-2 flex grow flex-row items-center overflow-hidden",children:[e.jsx(_,{className:"icon me-1.5"}),e.jsx("a",{href:(k=s.extra)==null?void 0:k.cloud_doc_url,className:"text-token-primary flex-shrink-1 flex-grow-1 overflow-hidden text-sm text-ellipsis whitespace-nowrap",target:"_blank",rel:"noreferrer",children:b}),u&&e.jsx("div",{className:"text-token-text-secondary ms-2 text-sm",children:u})]}),e.jsxs("div",{className:"flex shrink-0 flex-row items-center",children:[e.jsx("button",{className:"hover:bg-token-main-surface-secondary rounded-md p-1",children:(a==null?void 0:a.rating)==="thumbsUp"?e.jsx(ye,{className:"icon text-token-text-primary",onClick:()=>y(void 0)}):e.jsx(_e,{className:"icon text-token-text-secondary",onClick:()=>y("thumbsUp")})}),e.jsx("button",{className:"hover:bg-token-main-surface-secondary rounded-md p-1",children:(a==null?void 0:a.rating)==="thumbsDown"?e.jsx(be,{className:"icon text-token-text-primary",onClick:()=>y(void 0)}):e.jsx(ve,{className:"icon text-token-text-secondary",onClick:()=>y("thumbsDown")})})]})]}),(a==null?void 0:a.rating)&&e.jsx("div",{className:"mb-4 flex flex-row",children:(a.rating==="thumbsDown"?he:xe).map(d=>e.jsx(le,{className:"me-2",$selected:a.tags.includes(d),onClick:()=>g(N(v({},a),{tags:a.tags.includes(d)?a.tags.filter(x=>x!==d):[...a.tags,d]})),children:$(d,m)},d))}),!l&&e.jsx("div",{className:"border-token-border-default w-full border-[0.5px]"})]})}function Me({documentId:s,title:l,externalUrl:a,noBottomBorder:g=!1,shouldHaveBeenIncluded:m,setShouldHaveBeenIncluded:b}){const h=I.useMemo(()=>{var k;const u=a;if(!u)return H;const y=K(u);return(k=y==null?void 0:y.Icon)!=null?k:(()=>null)},[a]),_=I.useMemo(()=>{if(a)try{return new URL(a).hostname}catch(u){return}},[a]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center justify-between py-2",children:[e.jsxs("div",{className:"max-width-full me-2 flex grow flex-row items-center overflow-hidden",children:[e.jsx(h,{className:"icon me-1.5"}),e.jsx("a",{href:a,className:"text-token-primary flex-shrink-1 flex-grow-1 overflow-hidden text-sm text-ellipsis whitespace-nowrap",target:"_blank",rel:"noreferrer",children:l}),_&&e.jsx("div",{className:"text-token-text-secondary ms-2 text-sm",children:_})]}),e.jsx("div",{className:"flex shrink-0 flex-row items-center px-2",children:e.jsx(X,{checked:m,onChange:u=>b==null?void 0:b(u.currentTarget.checked),id:"should-have-been-included-".concat(s)})})]}),!g&&e.jsx("div",{className:"border-token-border-default w-full border-[0.5px]"})]})}function Ne(s,l){var b,h,_,u,y,k,d,x,T,j,A;const{messageId:a}=l;let g=a;const m=[];for(;g;){const E=s.getNodeByIdOrMessageId(g);if(!E){g=null;break}const n=E.message;if(!n)continue;const p=(b=ie(n))!=null?b:"",L=Array.isArray((h=n.metadata)==null?void 0:h.citations)?n.metadata.citations:[],t=Array.isArray((_=n.metadata)==null?void 0:_.attachments)?n.metadata.attachments:[],i={id:String(n.id),author:n.author.role,recipient:(u=n.recipient)!=null?u:"",createTime:n.create_time,updateTime:n.update_time};switch(n.author.role){case U.System:m.push(N(v({},i),{type:"system",content:n.content,citations:L,attachments:t}));break;case U.Assistant:if(n.recipient&&["user","all"].includes(n.recipient)&&p)m.push(N(v({},i),{type:"visible_text",text:p,citations:L,attachments:t}));else if(n.recipient&&n.recipient.includes("file_search")){const o=(k=(y=n.metadata)==null?void 0:y.command)!=null?k:"";let r=[];try{const c=JSON.parse(p);typeof c=="object"&&c!=null&&Array.isArray(c.queries)&&(r=c.queries.map(M=>String(M)))}catch(c){}r?m.push(N(v({},i),{type:"query",command:o,content:n.content,queries:r})):m.push(N(v({},i),{type:"generic_file_search_tool",command:o,content:n.content}))}break;case U.User:(p||t.length>0)&&m.push(N(v({},i),{type:"visible_text",text:p,citations:L,attachments:t}));break;case U.Tool:if((d=n.author.name)!=null&&d.includes("file_search")&&n.recipient==="all"){const o=(T=(x=n.metadata)==null?void 0:x.command)!=null?T:"";if(o==="msearch"&&n.content.content_type===G.TetherBrowsingDisplay){const r=n.content.result,c=(j=n.metadata)==null?void 0:j.cloud_doc_urls;if(r){let M=null;const w=(A=n.metadata)==null?void 0:A.raw_response;if(typeof w=="object"&&w!=null)try{M=ce(w)}catch(C){}m.push(N(v({},i),{type:"result",command:o,content:n.content,result:de(r,c),searchResponse:M}))}}else o==="context_stuff"&&n.content.content_type===G.TetherQuote?m.push(N(v({},i),{type:"fetch",command:o,content:n.content})):m.push(N(v({},i),{type:"generic_file_search_tool",command:o,content:n.content}))}break}g=E.parentId||null}return l.orderRootToLeaf&&m.reverse(),{messages:m}}const ke=O(()=>D(()=>import("./ntuoxtu7ohytvwjv.js").then(s=>s._),__vite__mapDeps([2,1])),{loading:s=>R(s)}),we=O(()=>D(()=>import("./kkginmfs5ty8sze2.js").then(s=>s._),__vite__mapDeps([4,1])),{loading:s=>R(s)}),Ie="considered-source-should-have-been-used";function De({citations:s,rating:l,onClose:a,messageId:g,conversationId:m,nodeId:b,conversationTree:h}){const _=ae(),u=W(),y=ne(_),[k,d]=I.useState(""),[x,T]=I.useState(()=>{var i,o;const t={};for(const r of s)((i=r.metadata)==null?void 0:i.type)==="file"&&(t[r.metadata.id]={rating:void 0,tags:[],url:(o=r.metadata.extra)==null?void 0:o.cloud_doc_url});return t}),j=h==null?void 0:h.getNodeByIdOrMessageId(g).message,A=I.useMemo(()=>{var o,r,c,M;const t=new Set,i=[];for(const w of(r=(o=j==null?void 0:j.metadata)==null?void 0:o.citations)!=null?r:[])!w.metadata||w.metadata.type!=="file"||t.has(w.metadata.id)||(i.push(w.metadata),t.add(w.metadata.id));for(const w of(M=(c=j==null?void 0:j.metadata)==null?void 0:c.content_references)!=null?M:[])if(w.type==="file_navlist")for(const C of w.items)t.has(C.id)||(i.push({type:"file",id:C.id,name:C.name,source:"my_files",text:C.description,cloud_doc_url:C.cloud_doc_url,extra:{cloud_doc_url:C.cloud_doc_url}}),t.add(C.id));return i},[j]),[E,n]=I.useState(!0),p=I.useMemo(()=>{const t={hasQuery:!1,lastAssistantMessage:null,lastUserMessage:null,referencedSyncedFiles:[]};if(!h||!b||!h.containsNodeOrMessageId(b))return t;const i=Ne(h,{messageId:b});for(const o of i.messages)switch(o.type){case"fetch":case"generic_file_search_tool":case"system":continue;case"result":{o.result.chunks.forEach(r=>{r.documentId&&!t.referencedSyncedFiles.some(c=>c.fileId===r.documentId)&&!A.some(c=>c.type==="file"&&c.id===r.documentId)&&t.referencedSyncedFiles.push({fileId:r.documentId,title:r.title,url:r.cloudDocUrl})});continue}case"query":{t.hasQuery=!0;continue}case"visible_text":{if(o.author===U.User){if(!t.lastUserMessage){const r=B(h,o.id),c=r[r.length-1].messages,M=c[c.length-1];t.lastUserMessage=M}}else if(o.author===U.Assistant&&!t.lastAssistantMessage){const r=B(h,o.id),c=r[r.length-1].messages,M=c[c.length-1];t.lastAssistantMessage=M,t.lastUserMessage=null}continue}}return t},[h,A,b]),L=I.useCallback(async t=>{const i=N(v({},t),{additionalSources:k,sourcesFeedback:x,consentedToShareConvoLink:E});try{await re.safePost("/ca/feedback",{requestBody:{feedback_format:y,message_id:g,conversation_id:m,text:i.textFeedback,rating:l,tags:i.tags.map(o=>o.value),tag_choices:i.tagChoices,additional_sources:i.additionalSources,sources_feedback:i.sourcesFeedback,consented_to_share_convo_link:i.consentedToShareConvoLink}}),q(_).success(u.formatMessage({id:"ZzqQBa",defaultMessage:"Thanks for providing feedback!"})),a()}catch(o){o instanceof oe&&q(_).danger(u.formatMessage({id:"4d5bOS",defaultMessage:"There was an error submitting your feedback. Please try again later."}))}},[_,k,x,E,y,g,m,l,u,a]);return e.jsxs(ue,{multiple:!0,allowEmptySubmit:!0,onSubmit:L,onCancel:a,tagOptions:z(l==="thumbsDown"?fe:ge,u),modalOnly:!0,modalTitle:e.jsxs("div",{className:"flex items-center gap-2",children:[l==="thumbsDown"?e.jsx(we,{className:"mb-[-6px]"}):e.jsx(ke,{className:"mb-[-6px]"}),e.jsx(S,{id:"h5nasL",defaultMessage:"Provide feedback"})]}),children:[A.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-6 text-base font-semibold",children:e.jsx(S,{id:"G6+7UX",defaultMessage:"Sources"})}),e.jsx("div",{children:A.map((t,i)=>(t==null?void 0:t.type)!=="file"?null:e.jsx(je,{citationMetadata:t,noBottomBorder:i===A.length-1,sourceFeedback:x[t.id],setSourceFeedback:o=>T(r=>{var c;return N(v({},r),{[t.id]:N(v({},o),{url:(c=t.extra)==null?void 0:c.cloud_doc_url})})})},t.id))})]}),p.referencedSyncedFiles.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 flex items-baseline justify-between",children:[e.jsxs("div",{className:"flex-start flex",children:[e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(S,{id:"xvBe/T",defaultMessage:"Considered Sources"})}),e.jsx("p",{className:"text-token-text-secondary ms-2",children:e.jsx(S,{id:"nX81fN",defaultMessage:"({numSources} sources)",values:{numSources:p.referencedSyncedFiles.length}})})]}),e.jsx("p",{className:"text-token-text-tertiary text-sm",children:e.jsx(S,{id:"0+Uivl",defaultMessage:"Good Source?"})})]}),e.jsx("div",{className:"mt-2 max-h-[200px] overflow-auto",children:p.referencedSyncedFiles.map((t,i)=>e.jsx(Me,{title:t.title,documentId:t.fileId,externalUrl:t.url,noBottomBorder:i===p.referencedSyncedFiles.length-1,shouldHaveBeenIncluded:!!x[t.fileId],setShouldHaveBeenIncluded:o=>T(r=>{const c=v({},Object.fromEntries(Object.entries(r).filter(([M])=>M!==t.fileId)));return o&&(c[t.fileId]={tags:[Ie],rating:"thumbsUp",url:t.url}),c})},t.fileId))})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-token-text-primary text-sm",children:e.jsx(S,{id:"1ApJVo",defaultMessage:"Add any additional sources"})}),e.jsx(me,{name:"feedback",className:"mt-2",placeholder:u.formatMessage({id:"CAFeedbackModal.additionalSourcePlaceholder",defaultMessage:"(Optional) Additional sources"}),value:k,onChange:t=>d(t.target.value)})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-2 text-base font-semibold",children:e.jsx(S,{id:"9NcQBu",defaultMessage:"Latest Exchange"})}),e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"mb-4",children:[p.lastUserMessage&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-token-text-secondary mb-1 ps-4 text-xs",children:e.jsx(S,{id:"QTWrtR",defaultMessage:"Your message"})}),e.jsx("div",{className:"flex justify-start",children:e.jsx("p",{className:"dark:bg-token-main-surface-secondary relative max-w-[var(--user-chat-width,70%)] rounded-3xl bg-[#f4f4f4] px-5 py-2.5",children:p.lastUserMessage?e.jsx(Q,{message:p.lastUserMessage,isCompletionInProgress:!1,hasActiveRequest:!1,conversation:V(_,m),isFinalUserTurn:!1,isUserTurn:!1,turnIndex:0,isFeedbackEnabled:!1}):null})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-token-text-secondary mb-1 ps-4 text-xs",children:e.jsx(S,{id:"ZCTm4h",defaultMessage:"ChatGPT's response"})}),e.jsx("div",{className:"bg-token-main-surface-secondary relative rounded-lg p-4 text-sm",children:p.lastAssistantMessage?e.jsx(Q,{message:p.lastAssistantMessage,isCompletionInProgress:!1,hasActiveRequest:!1,conversation:V(_,m),isFinalUserTurn:!1,isUserTurn:!1,turnIndex:1,isFeedbackEnabled:!1}):null})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"mt-6 text-base font-semibold",children:e.jsx(S,{id:"c95uEW",defaultMessage:"Full conversation"})}),e.jsx("p",{className:"text-token-text-secondary mt-1 mb-2 text-sm",children:e.jsx(S,{id:"3E3ZSm",defaultMessage:"If previous portions of this conversation are important to understand your feedback, we encourage you to include it."})}),e.jsx(X,{id:"consented-to-share-entire-convo",label:u.formatMessage({id:"5CC8r8",defaultMessage:"Share Entire Conversation"}),checked:E,onChange:t=>{n(t.currentTarget.checked)}})]})]})]})}export{De as C,Ie as a,$ as g};
//# sourceMappingURL=ler6n501y0bzhqn2.js.map
