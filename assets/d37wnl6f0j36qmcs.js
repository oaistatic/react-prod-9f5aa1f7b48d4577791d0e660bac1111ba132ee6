var H=Object.defineProperty;var w=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var z=(e,n,o)=>n in e?H(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,A=(e,n)=>{for(var o in n||(n={}))_.call(n,o)&&z(e,o,n[o]);if(w)for(var o of w(n))$.call(n,o)&&z(e,o,n[o]);return e};var D=(e,n)=>{var o={};for(var a in e)_.call(e,a)&&n.indexOf(a)<0&&(o[a]=e[a]);if(e!=null&&w)for(var a of w(e))n.indexOf(a)<0&&$.call(e,a)&&(o[a]=e[a]);return o};import{j as h,r}from"./i8clt0mfz495j7ii.js";import{e_ as U,dd as q}from"./ghewn7l2ynbm32fm.js";import{p as s}from"./ecfi069fherkr66q.js";import"./joa8jajuiu4xqpzn.js";function ee(o){var a=o,{drawingCanvasRef:e}=a,n=D(a,["drawingCanvasRef"]);return h.jsx(G,A({ref:e},n))}const G=r.forwardRef(function({color:n,dashedOutlineColor:o,cursorWidth:a,canvasWidth:d,canvasHeight:m,currentDrawnShape:i,onNewDrawnShape:M},N){const c=r.useRef(null),l=r.useRef(null),[C,x]=r.useState(),[X,T]=r.useState(!1);r.useImperativeHandle(N,()=>({getImageData:()=>{var f;const t=v(c);i!=null&&(F(i),s.view.update());const u=(f=t.getContext("2d"))==null?void 0:f.getImageData(0,0,t.width,t.height);if(u==null)throw new Error("Failed to get image data from canvas");return i!=null&&o!=null&&O(i,new s.Color(o)),u},sendEventToCanvas:t=>{v(c).dispatchEvent(t)}}));const p=r.useMemo(()=>U(t=>{if(l.current!=null){const u=I(t.point,v(c)),f=K(l.current.prevPoint,u,a);if(l.current.shape!=null){const B=l.current.shape;l.current.shape=l.current.shape.unite(f),B.remove(),f.remove()}else l.current.shape=f;l.current.shape.fillColor=new s.Color(n),l.current.prevPoint=u}},50),[n,a]),P=r.useCallback(t=>p(t),[p]),E=r.useCallback(()=>{var t;if(p.cancel(),((t=l.current)==null?void 0:t.shape)!=null){const u=new s.Path.Rectangle({point:[0,0],size:s.view.size}),f=l.current.shape.intersect(u);f.fillColor=new s.Color(n),o!=null&&O(f,new s.Color(o)),M(f),l.current.shape.remove(),u.remove()}l.current=null,T(!1)},[p,n,o,M]),b=r.useCallback(t=>{let u=null;i!=null&&(u=i.clone(),F(u),i.remove()),l.current={shape:u,prevPoint:I(t.point,v(c))},T(!0)},[i]),k=r.useCallback(()=>{i!=null&&i.dashArray.length>0&&(i.dashOffset+=.2)},[i]),y=r.useCallback(t=>{t.preventDefault()},[]),L=r.useCallback(t=>{t.pointerType==="mouse"&&x(new s.Point([t.offsetX,t.offsetY]))},[]),R=r.useCallback(t=>{t.pointerType==="mouse"&&x(new s.Point([t.offsetX,t.offsetY]))},[]),j=r.useCallback(t=>{t.pointerType==="mouse"&&x(void 0)},[]);r.useEffect(()=>{s.setup(v(c)),s.view.viewSize=new s.Size(d,m)},[]),r.useEffect(()=>{s.project.activeLayer.removeChildren(),i!=null&&s.project.activeLayer.addChild(i)},[i]),r.useEffect(()=>{const t=v(c);return t.addEventListener("pointerover",L),t.addEventListener("pointermove",R),t.addEventListener("pointerout",j),t.addEventListener("touchstart",y),()=>{t.removeEventListener("pointerover",L),t.removeEventListener("pointermove",R),t.removeEventListener("pointerout",j),t.removeEventListener("touchstart",y)}},[L,R,j,y]),r.useEffect(()=>(s.view.on("mousedown",b),s.view.on("mousedrag",P),s.view.on("mouseup",E),s.view.on("frame",k),()=>{s.view.off("mousedown",b),s.view.off("mousedrag",P),s.view.off("mouseup",E),s.view.off("frame",k)}),[b,P,E,k]);const Y=r.useCallback(t=>{t.preventDefault(),t.stopPropagation()},[]),g=c.current?J(a,c.current):a;return h.jsxs("div",{className:"relative h-full w-full cursor-none",children:[h.jsx("canvas",{ref:c,width:d,height:m,className:"h-full w-full","data-paper-hidpi":"off",onContextMenu:Y}),C&&h.jsx("div",{className:"pointer-events-none absolute start-0 top-0 rounded-full border-[3px] shadow-[0_2px_3px_0_rgba(0,0,0,0.25)]",style:{width:"".concat(g,"px"),height:"".concat(g,"px"),transform:"translate(".concat(C.x-g/2,"px, ").concat(C.y-g/2,"px) scale(").concat(X?1:1.05,")")}})]})});function v(e){return q(e.current)}function J(e,n){return e*n.offsetWidth/n.width}function I(e,n){return e.multiply(n.width/n.offsetWidth)}function K(e,n,o){const a=e.getDistance(n),d=new s.Rectangle(e.subtract([o/2,o/2]),new s.Size(a+o,o)),m=new s.Size(o/2,o/2),i=new s.Path.Rectangle(d,m);return i.rotate(n.subtract(e).angle,e),i}function O(e,n){e.strokeColor=n,e.strokeWidth=2,e.strokeCap="round",e.dashArray=[6,8],e.dashOffset=0}function F(e){e.strokeColor=null,e.strokeWidth=0,e.dashArray=[],e.dashOffset=0}export{ee as DynamicDrawingCanvas};
//# sourceMappingURL=d37wnl6f0j36qmcs.js.map
