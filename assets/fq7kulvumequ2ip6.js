const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ceivmd4pm4umbvdn.js","assets/i8clt0mfz495j7ii.js","assets/j0yo6uv6652vva62.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/fobvway9e4v0s6vc.js","assets/cv4rvmad80hmdgot.js","assets/rsi9kppw43ykrsgk.js"])))=>i.map(i=>d[i]);
var Re=Object.defineProperty,Le=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var xe=(e,t,a)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,k=(e,t)=>{for(var a in t||(t={}))Ue.call(t,a)&&xe(e,a,t[a]);if(_e)for(var a of _e(t))Fe.call(t,a)&&xe(e,a,t[a]);return e},S=(e,t)=>Le(e,Oe(t));import{v as ke,e as B,h as Ce,r as j,j as s,c as je,_ as Q,M as ye}from"./i8clt0mfz495j7ii.js";import{p as Be,m as we,C as K,a as qe,P as We,f as ze,D as Ve,g as Ge,R as $e,b as Qe,c as oe,u as He,d as Je,S as Ye,e as Xe}from"./bcsmd88fr52ce3nx.js";import{l as Ze,d as Ke,m as et,e as tt,g as ve,i as V,v as Se,f as Ee,a as at,h as st,s as it,c as P,j as le,k as nt,n as ee,o as ie,u as q,b as ne,p as rt}from"./mnf9y116wq0a5kdn.js";import{g as lt,c as ot,u as Z}from"./kmo5unuf793khl43.js";import{bR as ct,P as L,gj as O,dd as be,J as Ne,a5 as ae,d as F,oG as Me,dv as dt,o as H,L as J,u as pt,h as ut,C as mt}from"./ghewn7l2ynbm32fm.js";import{m as ht,kI as gt}from"./j0yo6uv6652vva62.js";import{a as se,u as ce,E as ft,P as _t,A as Pe}from"./fhcba4quxj2lit4k.js";import{a as xt,u as yt}from"./zl0env7yrga8vz86.js";import{r as vt}from"./mjbhy8c4bs0n8qw2.js";import{M as bt}from"./mzyl3pd4zxnxoe9i.js";import"./pbvsc3do5o365cxq.js";import"./nfccle6oyncifphl.js";import"./hu1bt0oauegdhua6.js";import"./h1em0bjkpkjv8ykw.js";import"./gy1lpvuoewmzh42c.js";import"./hxdh3tr5l8kut4ed.js";import"./i03gut32e8jn5ajq.js";const Mt=async({intl:e,store:t,clientThreadId:a})=>{var o,l,m,h;const n=window.location.href,r=n.includes("/share/");try{const f=ct(a),d=await lt(S(k({items:t.items},r?{sharedConversationUrl:n}:{conversationId:f}),{existing_customer_session_client_secret:t.preloadCustomerSessionClientSecret}));return((o=d.cart.errors)==null?void 0:o.length)>0?(L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((l=t.cartMetadata)!=null?l:{})),{action:"cart_load_failed",reason:"error_response_from_endpoint",error_message:d.cart.errors[0].message})),{error:d.cart.errors[0].message}):d.customer_session_client_secret&&d.publishable_key?(t.setInitialCart(d),d.cart.shipping_option_id&&Ze(t,d.id,d.cart.shipping_options,d.cart.shipping_option_id,"prefill"),d.cart.shipping_address&&Ke(t,d.id,S(k({},et(d.cart.shipping_address)),{complete:!0}),"prefill"),{client_secret:d.customer_session_client_secret,publishable_key:d.publishable_key}):(L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((m=t.cartMetadata)!=null?m:{})),{action:"cart_load_failed",reason:"error_response_from_endpoint",error_message:"Missing customer_session_client_secret or publishable_key"})),{error:e.formatMessage({id:"imEcZX",defaultMessage:"Failed to load cart session (1300)"})})}catch(f){return L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((h=t.cartMetadata)!=null?h:{})),{action:"cart_load_failed",reason:"error_thrown_from_endpoint",error_message:f instanceof Error?f.message:"Unknown error"})),{error:f instanceof Error?f.message:e.formatMessage({id:"S86mYy",defaultMessage:"Failed to load cart session (1301)"})}}};async function Ae({store:e,merchant:t,elements:a,stripe:n,userEmail:r,intl:o,finalShippingAddress:l,expressPaymentType:m,paymentAttemptId:h,onConfirm:f,onComplete:d}){var y,p,i,C,x;const v=performance.now();e.setCartStatus("submitting"),h||(h=ke());try{if(kt({store:e,merchant:t,finalShippingAddress:l,expressPaymentType:m,paymentAttemptId:h}),!Ct({elements:a,stripe:n,userEmail:r,intl:o,store:e,paymentAttemptId:h}))return;const u=m!==void 0;let c=null;if(e.cachedPaymentDetailsResponse&&!u)c=e.cachedPaymentDetailsResponse;else if(c=await Be({stripe:be(n),elements:be(a),intl:o,billingName:(i=(p=l==null?void 0:l.name)!=null?p:(y=e.billingAddress)==null?void 0:y.name)!=null?i:"",billingEmail:r!=null?r:"",isExpressCheckout:u}),c!=null&&c.isError)return W(S(k({},c),{store:e,paymentAttemptId:h}));if(c)u||e.setCachedPaymentDetailsResponse(c);else return;f==null||f(),await jt({store:e,paymentMethod:c,intl:o,onComplete:d,paymentAttemptId:h,finalShippingAddress:l,startMs:v,expressPaymentType:m})}catch(u){const c=u;let b="payment_failed_general_error";const{stripe_error_code:_,stripe_decline_code:g}=((C=c==null?void 0:c.json)==null?void 0:C.detail)||{};let w=_&&g?await n.localizeError({code:_,decline_code:g}):void 0;c.message==="Failed to fetch"&&!w&&(b="payment_failed_network_error",w=o.formatMessage({id:"DPyhFG",defaultMessage:"Failed to submit payment (1347). Please refresh the page and try again."})),W({store:e,action:"payment_failed",reason:b,uiMessage:(x=w!=null?w:c.message)!=null?x:o.formatMessage({id:"nyG5lS",defaultMessage:"Failed to submit payment (1350)"}),internalMessage:(_!=null?_:g)?"Stripe error code: ".concat(_,"  ::  Stripe decline code: ").concat(g):c.message,paymentAttemptId:h})}finally{e.setCartStatus("idle")}}function kt({store:e,merchant:t,finalShippingAddress:a,expressPaymentType:n,paymentAttemptId:r}){var l,m,h,f,d,v,y,p;const o=e.shippingOptions.find(i=>i.id===e.shippingMethodId);te(e,{merchant_name:t==null?void 0:t.title,merchant_url:t==null?void 0:t.url,totals:e.totals,total_price:e.grandTotal.value,shipping_city:(m=a==null?void 0:a.city)!=null?m:(l=e.shippingAddress)==null?void 0:l.city,shipping_state:(f=a==null?void 0:a.state)!=null?f:(h=e.shippingAddress)==null?void 0:h.state,shipping_zip:(v=a==null?void 0:a.postal_code)!=null?v:(d=e.shippingAddress)==null?void 0:d.postalCode,shipping_country:(p=a==null?void 0:a.country)!=null?p:(y=e.shippingAddress)==null?void 0:y.country,payment_method:Ie(e,n),shipping_method_name:o==null?void 0:o.title,shipping_method_price:o==null?void 0:o.subtotal,shipping_method_index:e.shippingOptions.findIndex(i=>i.id===e.shippingMethodId),items:e.items.map(i=>({product_id:i.id,product_title:"title"in i?i.title:void 0,variant:"variant"in i?i.variant:void 0,quantity:i.quantity,price:"price"in i?i.price:void 0})),action:"pay_button_clicked",attempt_id:r})}function Ct({elements:e,stripe:t,userEmail:a,intl:n,store:r,paymentAttemptId:o}){return!e||!t?(W({store:r,action:"payment_failed",reason:"elements_or_stripe_null",uiMessage:n.formatMessage({id:"/MYGq8",defaultMessage:"Failed to submit payment (1340)"}),internalMessage:"elements or stripe is null",paymentAttemptId:o}),!1):a?!0:(W({store:r,action:"payment_failed",reason:"user_email_empty",uiMessage:n.formatMessage({id:"Zs2vbs",defaultMessage:"Failed to submit payment (1346)"}),internalMessage:"userEmail is empty",paymentAttemptId:o}),!1)}async function jt({store:e,paymentMethod:t,intl:a,onComplete:n,paymentAttemptId:r,finalShippingAddress:o,startMs:l,expressPaymentType:m}){var d,v,y,p,i,C,x,u;const h=(d=t.billing_details)!=null&&d.address?we(t.billing_details.name,t.billing_details.address,t.billing_details.phone):e.billingAddress?tt(e.billingAddress):null;if(!t.id||!t.type||!h){W({store:e,action:"payment_failed",reason:"missing_payment_method_or_billing_address",uiMessage:a.formatMessage({id:"xYuTJ8",defaultMessage:"Failed to submit payment (1344)"}),internalMessage:"Missing payment method or billing address",extraLogData:{error_message:"Missing payment method: ".concat(t.id," with type: ").concat(t.type)},paymentAttemptId:r});return}const f=await ot(e.cartId,e.items,{id:t.id,type:t.type,billing_address:h},r,o);if((v=f.cart.errors)!=null&&v.length){e.setErrors(f.cart.errors),te(e,{action:"payment_failed",reason:"openai_complete_shopping_cart_failed",error_message:f.cart.errors.map(c=>c.message).join(", "),attempt_id:r});return}if((y=f.order)!=null&&y.id&&((p=f.order)==null?void 0:p.status)==="placed")try{te(e,{action:"payment_succeeded",attempt_id:r}),Ne.addAction("shopping_checkout.complete",{durationMs:performance.now()-l,merchant_id:(i=e.merchant)==null?void 0:i.externalId,merchant_network_id:(C=e.merchant)==null?void 0:C.networkId,cart_total:e.grandTotal.value,payment_method:Ie(e,m)}),typeof n=="function"&&await n(f.order),e.closeCheckout()}catch(c){W({store:e,action:"refresh_convo_failed",uiMessage:a.formatMessage({id:"d45UJa",defaultMessage:"Failed to update conversation (1400)"}),internalMessage:c instanceof Error?c.message:"Unknown error",paymentAttemptId:r})}else W({store:e,action:"payment_failed",reason:"openai_complete_shopping_cart_failed",uiMessage:a.formatMessage({id:"QJ9CZQ",defaultMessage:"Failed to create order (1345)"}),internalMessage:"Missing orderID",extraLogData:{error_message:"Missing orderID: ".concat((x=f.order)==null?void 0:x.id," with status: ").concat((u=f.order)==null?void 0:u.status)},paymentAttemptId:r})}function te(e,t){var a,n,r;L.logEventWithStatsig("product_checkout","product_checkout",k(S(k({},O((a=e.cartMetadata)!=null?a:{})),{checkout_id:e.cartId}),t)),Ne.addAction("shopping_checkout.".concat(t.action),{merchant_id:(n=e.merchant)==null?void 0:n.externalId,merchant_network_id:(r=e.merchant)==null?void 0:r.networkId,cart_total:e.grandTotal.value,reason:t.reason})}function W({store:e,action:t,reason:a,uiMessage:n,internalMessage:r,extraLogData:o,paymentAttemptId:l}){const m=n+"";e.setErrors([{group:"general",message:m}]),te(e,k(k(k(k({action:t},a?{reason:a}:{}),r?{error_message:r}:{}),o!=null?o:{}),(t==="payment_failed"||t==="payment_succeeded")&&l?{attempt_id:l}:{}))}function Ie(e,t){var a,n,r;return(r=t==null?void 0:t.toLocaleLowerCase())!=null?r:(n=(a=e.paymentDetails)==null?void 0:a.label)==null?void 0:n.toLocaleLowerCase()}const Te=({store:e,optionOverrides:t,onConfirm:a,onReady:n,onComplete:r,surface:o})=>{var x;const l=se(),m=ce(),h=ae(),f=h==null?void 0:h.email,d=B(),v=Ce(),y=j.useRef(void 0),p=j.useRef(void 0),i=e.items,C=j.useMemo(()=>{var c,b,_,g,w,A;const u={buttonHeight:40,shippingAddressRequired:!0,billingAddressRequired:!0,allowedShippingCountries:e.allowedCountries,business:{name:(b=(c=e.merchant)==null?void 0:c.title)!=null?b:""},phoneNumberRequired:!0,paymentMethods:{applePay:(_=e==null?void 0:e.paymentTypes[o])!=null&&_.includes("apple_pay")?"always":"never",googlePay:(g=e==null?void 0:e.paymentTypes[o])!=null&&g.includes("google_pay")?"always":"never",shopPay:(w=e==null?void 0:e.paymentTypes[o])!=null&&w.includes("shop_pay")?"auto":"never",link:(A=e==null?void 0:e.paymentTypes[o])!=null&&A.includes("link")?"auto":"never"},paymentMethodOrder:["apple_pay","google_pay","shop_pay","link"],shippingRates:ve(i,e.shippingOptions,d)};return k(k({},u),t)},[(x=e.merchant)==null?void 0:x.title,e.allowedCountries,t,o,e.paymentTypes,e.shippingOptions,d,i]);return s.jsx(ft,{options:C,onConfirm:async u=>{var b,_,g;const c=(b=u.shippingAddress)!=null&&b.address&&((_=u.shippingAddress)!=null&&_.name)?we(u.shippingAddress.name,u.shippingAddress.address,(g=u.billingDetails)==null?void 0:g.phone):void 0;await Ae({store:e,merchant:e.merchant,elements:l,stripe:m,userEmail:f,intl:d,finalShippingAddress:c,expressPaymentType:u.expressPaymentType,paymentAttemptId:y.current,onConfirm:a,onComplete:async w=>{await Ee({store:e,order:w,navigate:v}),await(r==null?void 0:r(w))}})},onReady:()=>{n==null||n()},onClick:u=>{var g;const{expressPaymentType:c,resolve:b,reject:_}=u;if(p.current=e.shippingAddress,y.current=ke(),L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((g=e.cartMetadata)!=null?g:{})),{payment_method:c,checkout_id:e.cartId,action:"express_checkout_button_clicked",attempt_id:y.current})),Se(e,d))return b();_()},onShippingAddressChange:async function({address:u,resolve:c,reject:b}){try{const _=await Z(e.cartId,{items:i,shippingAddress:{name:null,addressLine1:null,addressLine2:null,city:u.city,state:u.state,postalCode:u.postal_code,country:u.country,complete:!0}});e.updateCart(_);const g=ve(i,_.cart.shipping_options,d);if(g.length===0){b();return}l&&l.update({amount:_.cart.grand_total.value_minor}),c({shippingRates:g})}catch(_){b()}},onCancel:async()=>{try{if(V(e,p.current)){const u=await Z(e.cartId,{items:i,shippingAddress:p.current});e.updateCart(u),l&&l.update({amount:u.cart.grand_total.value_minor})}}catch(u){}},onShippingRateChange:async function({shippingRate:u,resolve:c,reject:b}){try{const _=await Z(e.cartId,{items:i,shippingMethodId:u.id});e.updateCart(_),l&&l.update({amount:_.cart.grand_total.value_minor}),c()}catch(_){b()}}})},X=({cartErrors:e,section:t})=>{var n;const a=(n=e==null?void 0:e.filter(r=>t?r.group===t:!0))!=null?n:[];return a.length?s.jsx("div",{className:"flex flex-col gap-1 pt-3",children:a.map(r=>s.jsx(K,{message:r.message},r.message))}):null},wt=H(()=>Q(()=>import("./ceivmd4pm4umbvdn.js").then(e=>e._),__vite__mapDeps([0,1])),{loading:e=>J(e)}),St=H(()=>Q(()=>import("./j0yo6uv6652vva62.js").then(e=>e.yq),__vite__mapDeps([2,1,3,4,5])),{loading:e=>J(e)}),Et=H(()=>Q(()=>import("./fobvway9e4v0s6vc.js").then(e=>e._),__vite__mapDeps([6,1])),{loading:e=>J(e)});let re=0;function Nt({store:e,pushPane:t,loadingCartSession:a,loadingPayment:n,loadingAddress:r,cartLoadError:o,stripeLoadingError:l,merchant:m,footerMessage:h,isCurrentPane:f}){var pe,ue,me,he,ge,fe;const d=ae(),v=d==null?void 0:d.email,{cartStatus:y,paymentDetails:p,shippingAddress:i,shippingMethodId:C,shippingOptions:x,totals:u,grandTotal:c,errors:b}=e,_=at(e.items),g=j.useMemo(()=>x.find($=>$.id===C),[x,C]),w=!!(p!=null&&p.complete),A=!!(i!=null&&i.complete),R=(a||n||r)&&!o,D=!R&&!o,U=D&&!_,M=y==="complete",E=y==="updating",N=D&&(w||n||r),I=!!(A&&x.length>0&&g),T=!!h&&!R,z=B(),Y=j.useCallback(()=>{if(!st(e.agreements))return it(e,z),!1;t("paymentMethod")},[t]),G=j.useCallback(()=>{t("shippingAddress")},[t]),De=j.useCallback(()=>{t("shippingMethod")},[t]);return s.jsxs("div",{className:"relative flex h-full flex-col",children:[M&&s.jsx("div",{className:"bg-token-bg-primary absolute inset-0 z-50 flex items-center justify-center",children:s.jsx(qe,{className:"h-44 w-44 text-green-400",loop:!1})}),s.jsxs("div",{className:"flex flex-col px-6 pb-6",children:[s.jsx("div",{className:"mb-4",children:s.jsx(At,{item:e.items[0],store:e,canUpdateQuantity:U,isLoading:a})}),l&&s.jsx(K,{message:l}),o&&s.jsx(K,{message:o}),D&&s.jsxs(s.Fragment,{children:[N&&s.jsxs("div",{className:F(e.cartStatus==="submitting"&&"pointer-events-none opacity-50"),children:[s.jsxs("div",{className:"border-token-border-light border-t",children:[s.jsx(We,{onClick:Y,isComplete:(pe=p==null?void 0:p.complete)!=null?pe:!1,label:(ue=p==null?void 0:p.label)!=null?ue:"",sublabel:(me=p==null?void 0:p.sublabel)!=null?me:"",icon:(he=p==null?void 0:p.icon)!=null?he:void 0,isLoading:n}),s.jsx(X,{cartErrors:b,section:"payment_method"})]}),s.jsxs("div",{className:"border-token-border-light border-t",children:[s.jsx(ze,{name:i==null?void 0:i.name,addressLine1:i==null?void 0:i.addressLine1,addressLine2:i==null?void 0:i.addressLine2,city:i==null?void 0:i.city,state:(ge=i==null?void 0:i.state)!=null?ge:void 0,isComplete:(fe=i==null?void 0:i.complete)!=null?fe:!1,isLoading:r,onClick:G}),s.jsx(X,{cartErrors:b,section:"shipping_address"})]}),_&&s.jsx("div",{className:"border-token-border-light border-t",children:s.jsx(Ve,{emailAddress:v})}),I&&g&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"border-token-border-light border-t",children:s.jsx(Ge,{method:g,onClick:De})}),s.jsx(X,{cartErrors:b,section:"shipping_option"})]})]}),s.jsx(Dt,{totals:u,grandTotal:c,isLoading:E}),s.jsx(Rt,{store:e}),s.jsx(X,{cartErrors:b,section:N?"general":void 0}),s.jsx(Pt,{store:e,merchant:m,hasValidPaymentMethod:w,isCurrentPane:f,pushPane:t})]})]}),T&&s.jsx(de,{className:"bg-token-bg-elevated-secondary text-token-text-tertiary border-token-border-light h-full border-t p-6 text-xs",components:{a:$=>s.jsx("a",S(k({},$),{className:F($.className,"text-blue-400 underline"),target:"_blank",children:$.children}))},children:h})]})}const Pt=e=>{"use forget";var R,D;const t=je.c(26),{store:a,merchant:n,hasValidPaymentMethod:r,isCurrentPane:o,pushPane:l}=e,m=B(),h=ce(),f=se(),d=Ce(),v=(R=ae())==null?void 0:R.email,[y,p]=j.useState(!1);let i,C;t[0]!==r?(i=()=>{r&&p(!1)},C=[r],t[0]=r,t[1]=i,t[2]=C):(i=t[1],C=t[2]),j.useEffect(i,C);let x;t[3]!==a?(x=xt(a),t[3]=a,t[4]=x):x=t[4];const u=!x,c=a.cartStatus==="submitting",b=a.cartStatus==="updating",_=(D=n==null?void 0:n.title)!=null?D:"";let g;t[5]!==o||t[6]!==a?(g=o&&s.jsx(Te,{store:a,surface:"payment_sheet",onReady:()=>p(!0)}),t[5]=o,t[6]=a,t[7]=g):g=t[7];let w;t[8]!==f||t[9]!==m||t[10]!==n||t[11]!==d||t[12]!==a||t[13]!==h||t[14]!==v?(w=async()=>{Se(a,m)&&await Ae({store:a,merchant:n,elements:f,stripe:h,userEmail:v,intl:m,onComplete:async U=>await Ee({store:a,order:U,navigate:d})})},t[8]=f,t[9]=m,t[10]=n,t[11]=d,t[12]=a,t[13]=h,t[14]=v,t[15]=w):w=t[15];let A;return t[16]!==y||t[17]!==r||t[18]!==l||t[19]!==u||t[20]!==c||t[21]!==b||t[22]!==_||t[23]!==g||t[24]!==w?(A=s.jsx(Qe,{isDisabled:u,isSubmitting:c,isUpdating:b,merchantTitle:_,hasValidPaymentMethod:r,expressCheckoutElement:g,expressCheckoutElementReady:y,onClickPay:w,pushPane:l}),t[16]=y,t[17]=r,t[18]=l,t[19]=u,t[20]=c,t[21]=b,t[22]=_,t[23]=g,t[24]=w,t[25]=A):A=t[25],A},At=({item:e,store:t,canUpdateQuantity:a,isLoading:n})=>s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"bg-token-bg-tertiary dark:bg-token-main-surface-primary-inverse overflow-clip rounded-lg",children:n?s.jsx("div",{className:"relative m-0 aspect-square h-32 w-32",children:s.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:s.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:s.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})})}):s.jsx("img",{className:"m-0 aspect-square h-32 w-32 object-cover mix-blend-darken",src:e.imageUrl,alt:e.title})}),s.jsxs("div",{className:"flex flex-1 flex-col",children:[s.jsx("div",{className:"text-normal line-clamp-2 min-h-6 leading-snug font-medium",title:e.title,children:n?s.jsx(Me,{index:1,width:80,heightSize:"sm"}):e.title}),s.jsx("div",{className:"text-token-text-secondary h-[18px] text-[13px]",children:n?s.jsx(Me,{index:2,width:60,heightSize:"sm"}):e.variant}),s.jsx("div",{className:"mt-2 flex flex-1 items-end",children:a&&!n&&s.jsx(Tt,{quantity:e.quantity,store:t,itemId:e.id,isDisabled:t.cartStatus==="submitting"||t.cartStatus==="updating"})})]})]}),It=600,Tt=({quantity:e,store:t,itemId:a,isDisabled:n})=>{const r=B(),o=j.useCallback(dt(async(m,h)=>{var d,v;const f=++re;t.setCartStatus("updating"),t.setErrors([]);try{const y=await Z(m,t);f===re&&(t.updateCart(y),L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((d=t.cartMetadata)!=null?d:{})),{checkout_id:t.cartId,product_id:a,action:"quantity_changed",new_quantity:h[0].quantity.toString()})))}catch(y){f===re&&(t.setErrors([{group:"general",message:r.formatMessage(P.cartUpdateQuantityErrorMessage)}]),L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((v=t.cartMetadata)!=null?v:{})),{action:"cart_update_failed",reason:"error_response_from_endpoint",error_message:y})),t.setCartStatus("idle"))}},It),[]),l="bg-token-bg-tertiary hover:bg-token-bg-secondary text-token-text-primary flex items-center justify-center px-2 py-2 text-xl font-bold";return s.jsxs("div",{className:F("inline-flex items-center select-none",n&&"pointer-events-none opacity-50"),children:[s.jsx("button",{className:F(l,"rounded-s-xl"),onClick:()=>{if(e===1){confirm(r.formatMessage({id:"XvhtH9",defaultMessage:"Are you sure you want to remove this item?"}))&&le(t,"deleted_item");return}const m=t.updateQuantity(a,Math.max(e-1,1));o(t.cartId,m)},children:e===1?s.jsx(wt,{className:"icon"}):s.jsx(Et,{className:"icon"})}),s.jsx("span",{className:"bg-token-bg-tertiary text-token-text-primary flex h-9 w-6 items-center justify-center text-sm font-semibold",children:e}),s.jsx("button",{className:F(l,"rounded-e-xl"),onClick:()=>{const m=t.updateQuantity(a,e+1);o(t.cartId,m)},children:s.jsx(St,{className:"icon"})})]})},Dt=({totals:e,grandTotal:t,isLoading:a})=>t!=null&&t.value?s.jsxs("div",{className:"flex flex-col gap-3 pt-3",children:[s.jsx("div",{children:e==null?void 0:e.map(n=>s.jsxs("div",{className:"text-token-text-secondary flex items-end justify-between text-[13px]",children:[s.jsx("span",{className:"font-medium",children:n.title}),s.jsx(de,{className:F("transition-opacity duration-200",a&&"opacity-50"),remarkPlugins:[[vt,{singleTilde:!1}]],children:n.formatted_value})]},n.title))}),s.jsxs("div",{className:"flex items-end justify-between",children:[s.jsxs("div",{className:"flex flex-col text-[13px]",children:[s.jsx("span",{className:"font-medium",children:t.title}),s.jsx("span",{className:"text-token-text-secondary",children:t.subtitle})]}),s.jsx("div",{className:"text-xl font-medium",children:t.value_minor>0?s.jsx($e,{text:t.formatted_value,className:F("transition-opacity duration-200",a&&"opacity-50")}):"-"})]})]}):null,Rt=e=>{"use forget";const t=je.c(2),{store:a}=e;let n;return t[0]!==a?(n=a.agreements&&a.agreements.length>0&&s.jsx("div",{className:"flex flex-col gap-2 pt-3",children:a.agreements.map(r=>s.jsx(Lt,{store:a,agreement:r},r.id))}),t[0]=a,t[1]=n):n=t[1],n},Lt=({agreement:e,store:t})=>{"use no forget";return j.useEffect(()=>{var a;L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((a=t.cartMetadata)!=null?a:{})),{checkout_id:t.cartId,action:"agreement_shown",agreement_id:e.id}))},[]),s.jsx(ht,{id:e.id,checked:e.is_checked,onChange:a=>{var r;const n=a.currentTarget.checked;t.setHasAcceptedAgreement(e.id,n),L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O((r=t.cartMetadata)!=null?r:{})),{checkout_id:t.cartId,action:"agreement_clicked",agreement_id:e.id,checked:n}))},labelClassName:"ps-3 text-[13px] font-medium select-none text-token",label:s.jsx(de,{components:{a:a=>s.jsx("a",S(k({},a),{className:F(a.className,"text-blue-400 underline"),target:"_blank",children:a.children}))},children:e.content+(e.is_required?" *":"")})},e.id)},de=j.memo(bt),Ot=10*1e3,Ut=({store:e,pushPane:t,resetPanes:a,setLoadingPayment:n,loadingAddress:r,setStripeLoadingError:o,isCurrentPane:l})=>{var R,D,U;const m=B(),h=ae(),f=h==null?void 0:h.email,d=se(),v=ce(),[y,p]=j.useState(null),[i,C]=j.useState(!1),[x,u]=j.useState((R=e.paymentDetails)!=null&&R.complete?e.paymentDetails:null),[c,b]=j.useState(void 0),_=j.useRef(!0),g=j.useRef(!0),w=()=>{_.current=!1,o(m.formatMessage(P.stripeLoadingPaymentMethodError)),n(!1)};j.useEffect(()=>{const M=setTimeout(()=>{_.current&&w()},Ot);return()=>clearTimeout(M)},[]);const A=async M=>{var E,N,I,T,z,Y;if(p(null),_.current){if(_.current=!1,(E=e.paymentDetails)!=null&&E.complete&&((N=e.billingAddress)!=null&&N.complete)&&e.cachedPaymentDetailsResponse){ie(e,(I=e.paymentDetails)==null?void 0:I.label,"prefill"),n(!1);return}if(M.complete&&((T=M.value.payment_method)!=null&&T.id)){e.setPaymentDetails(S(k({},ne(M)),{complete:!0})),e.setCachedPaymentDetailsResponse({id:M.value.payment_method.id,type:M.value.payment_method.type,billing_details:{address:M.value.payment_method.billing_details.address,name:(z=M.value.payment_method.billing_details.name)!=null?z:""}});const G=S(k({},ee(M.value.payment_method.billing_details.address,M.value.payment_method.billing_details.name,M.value.payment_method.billing_details.phone)),{complete:!0});e.setBillingAddress(G),u(S(k({},ne(M)),{complete:M.complete})),!r&&e.isShippingAddressSameAsBilling&&G.addressLine1&&!V(e,e.shippingAddress)&&await q({store:e,fields:{items:e.items,shippingAddress:G},errorMessage:m.formatMessage(P.cartUpdateShippingAddressErrorMessage),source:"prefill"}),ie(e,(Y=M.preview)==null?void 0:Y.label,"prefill")}n(!1);return}M.complete&&u(S(k({},ne(M)),{complete:!0}))};return s.jsxs("div",{className:"flex w-full flex-col gap-4 px-6 pb-6",children:[l&&((D=e.paymentDetails)==null?void 0:D.complete)&&s.jsx("div",{className:"min-h-10",children:s.jsx(Te,{store:e,surface:"payment_sheet",optionOverrides:{layout:{maxRows:1,overflow:"auto"}},onConfirm:()=>{e.setPaymentDetails(void 0),e.setShippingAddress(void 0),a()}})}),!e.paymentTypes.payment_sheet.includes("card")&&!((U=e.paymentDetails)!=null&&U.complete)&&s.jsx("div",{className:"text-token-text-tertiary py-10 text-center text-sm",children:s.jsx(ye,{id:"7t8tjX",defaultMessage:"No other payment methods available"})}),s.jsxs("div",{className:e.paymentTypes.payment_sheet.includes("card")?"":"hidden",children:[s.jsx(_t,{id:"payment-element",options:{fields:{billingDetails:{email:"never",phone:"never"}},wallets:{applePay:"never",googlePay:"never"},defaultValues:{billingDetails:{email:f}},business:{name:"OpenAI"},layout:{type:"accordion",defaultCollapsed:!1}},onLoadError:()=>{_.current&&w()},onChange:A,onSavedPaymentMethodRemove:M=>{var E,N,I,T;((E=e.paymentDetails)==null?void 0:E.paymentMethodId)===((N=M.payment_method)==null?void 0:N.id)&&(e.setPaymentDetails(void 0),u(null)),nt(e,(T=(I=M.payment_method)==null?void 0:I.type)!=null?T:"")}}),y&&s.jsx("div",{className:"mt-2",children:s.jsx(K,{message:y})}),s.jsx("div",{className:"mt-6 mb-2 text-sm font-medium",children:s.jsx(ye,{id:"8pb7do",defaultMessage:"Billing address"})}),s.jsx(Pe,{options:{mode:"billing",allowedCountries:e.allowedCountries,fields:{phone:"always"},validation:{phone:{required:"always"}}},onChange:M=>{if(p(null),g.current){g.current=!1;return}b(S(k({},ee(M.value.address,M.value.name,M.value.phone)),{complete:!0}))}})]}),s.jsx(oe,{isSaving:i,isDisabled:i,onClick:async()=>{var M;if(p(null),!d){p(m.formatMessage(P.cartUpdateGeneralErrorRetryMessage));return}try{if(!x){p(m.formatMessage(P.cartUpdateGeneralErrorMessage));return}if(!(c!=null&&c.name)){p(m.formatMessage(P.stripeLoadingBillingAddressError));return}C(!0);const{error:E,paymentMethod:N}=await v.preparePaymentMethod({elements:d,params:{allow_redisplay:"always",billing_details:{name:c.name,email:f}}});if(C(!1),E){const{code:I,decline_code:T}=E||{},z=I&&T?await v.localizeError({code:I,decline_code:T}):E.message;p(z);return}ie(e,x==null?void 0:x.label,"user"),e.setPaymentDetails(S(k({},x),{complete:!0,paymentMethodId:N==null?void 0:N.id,paymentMethodType:N==null?void 0:N.type,label:x==null?void 0:x.label,sublabel:x==null?void 0:x.sublabel})),e.setBillingAddress(c),e.setCachedPaymentDetailsResponse(N)}catch(E){p(m.formatMessage(P.cartUpdateGeneralErrorMessage)),C(!1);return}e.isShippingAddressSameAsBilling&&q({store:e,fields:{items:e.items,shippingAddress:c},errorMessage:m.formatMessage(P.cartUpdateShippingAddressErrorMessage),source:"prefill"}),(M=e.shippingAddress)!=null&&M.addressLine1?a():t("shippingAddress")}})]})},Ft=10*1e3;function Bt({store:e,resetPanes:t,setLoadingAddress:a,loadingPayment:n,setStripeLoadingError:r,isCurrentPane:o}){var y,p;const l=B(),m=j.useRef(!0),h=se(),f=j.useRef(!1);j.useEffect(()=>{V(e,e.shippingAddress)&&q({store:e,fields:{items:e.items,shippingAddress:e.shippingAddress},errorMessage:l.formatMessage(P.cartUpdateShippingAddressErrorMessage),source:"prefill",skipLogging:!0});const i=setTimeout(()=>{m.current&&(m.current=!1,r(l.formatMessage(P.stripeLoadingShippingAddressError)),a(!1))},Ft);return()=>clearTimeout(i)},[]);const d=async i=>{var C;if(m.current){if(m.current=!1,V(e,e.shippingAddress)){a(!1);return}i.complete&&((C=i.value.address)!=null&&C.line1)?await q({store:e,fields:{items:e.items,shippingAddress:S(k({},ee(i.value.address,i.value.name,i.value.phone)),{complete:i.complete})},errorMessage:l.formatMessage(P.cartUpdateShippingAddressErrorMessage),onLocalMutationComplete:()=>{a(!1)},source:"prefill"}):!n&&V(e,e.billingAddress)&&(e.setIsShippingAddressSameAsBilling(!0),await q({store:e,fields:{items:e.items,shippingAddress:e.billingAddress},errorMessage:l.formatMessage(P.cartUpdateShippingAddressErrorMessage),onLocalMutationComplete:()=>{a(!1)},source:"prefill"})),a(!1);return}o&&(f.current=!0),e.setIsShippingAddressSameAsBilling(i.syncAddress)},v=(y=e.additionalFields)==null?void 0:y.includes("shipping_address_phone_number");return s.jsxs("div",{className:"flex h-full flex-col gap-4 px-6 pb-6",children:[s.jsx(Pe,{id:"address-element",options:{mode:"shipping",allowedCountries:e.allowedCountries,defaultValues:(p=e.shippingAddress)!=null&&p.complete?rt(e.shippingAddress,v):void 0,fields:{phone:v?"always":"never"},validation:k({},v&&{phone:{required:"always"}})},onChange:d,onLoadError:()=>{m.current&&(m.current=!1,r(l.formatMessage(P.stripeLoadingShippingAddressError)),a(!1))}}),s.jsx(oe,{onClick:async()=>{var C;const i=await((C=h==null?void 0:h.getElement("address",{mode:"shipping"}))==null?void 0:C.getValue());if(i!=null&&i.complete){if(f.current){const x=S(k({},ee(i.value.address,i.value.name,i.value.phone)),{complete:i.complete});q({store:e,fields:{items:e.items,shippingAddress:x},errorMessage:l.formatMessage(P.cartUpdateShippingAddressErrorMessage),source:"user"})}t()}}})]})}const qt=H(()=>Q(()=>import("./cv4rvmad80hmdgot.js").then(e=>e._),__vite__mapDeps([7,1])),{loading:e=>J(e)}),Wt=H(()=>Q(()=>import("./rsi9kppw43ykrsgk.js").then(e=>e._),__vite__mapDeps([8,1])),{loading:e=>J(e)});function zt({shippingMethods:e,resetPanes:t,store:a}){const n=B(),[r,o]=j.useState(a.shippingMethodId);return s.jsxs("div",{className:"flex h-full flex-col gap-4 px-6 pb-6",children:[s.jsx("div",{className:"divide-token-border-light -mt-4 flex flex-col gap-2 divide-y",children:e.map(l=>s.jsxs("button",{type:"button",onClick:()=>{o(l.id)},className:"flex w-full items-center gap-3 rounded-lg px-4 py-3 text-start",children:[r===l.id?s.jsx(Wt,{className:"text-token-text-primary h-6 w-6"}):s.jsx(qt,{className:"text-token-text-primary h-6 w-6"}),s.jsxs("div",{className:"flex flex-1 flex-col items-start",children:[s.jsx("span",{className:"text-token-text-primary flex items-center gap-2 text-base",children:l.title}),s.jsx("span",{className:"text-token-text-secondary text-sm leading-tight font-normal",children:l.subtitle})]})]},l.id))}),s.jsx(oe,{onClick:()=>{r&&(q({store:a,fields:{shippingMethodId:r,items:a.items},errorMessage:n.formatMessage(P.cartUpdateShippingAddressErrorMessage),source:"user"}),t())}})]})}function da(){var y,p,i,C,x,u,c,b,_,g,w,A,R,D,U,M;const e=pt(),t=yt(e),a=!!t.items[0],n=He("overview"),r=B(),{currentPane:o,pushPane:l,popPane:m,resetPanes:h}=n,f=ut(e,"3375735072");j.useEffect(()=>{t.isCheckoutOpen||h()},[t.isCheckoutOpen,h]);const d=j.useMemo(()=>{var E,N,I,T;return[...(N=(E=t.paymentTypes)==null?void 0:E.express_checkout)!=null?N:[],...(T=(I=t.paymentTypes)==null?void 0:I.payment_sheet)!=null?T:[]]},[t.paymentTypes]),v=(y=t.cartMetadata)==null?void 0:y.clientThreadId;return!f||!t.isCheckoutOpen||!a||!v?null:s.jsx(mt,{testId:"modal-shopping-checkout",isOpen:!0,hideSeparator:!0,showCloseButton:t.cartStatus!=="submitting",size:"large",type:"success",className:"min-h-36 max-w-[550px]!",headerClassName:"sm:p-0 sm:px-6 sm:py-4 items-center sm:-me-1",contentClassName:"!p-0 pt-3",rootClassName:"z-40",shouldIgnoreClickOutside:!0,onEscapeKeyDown:E=>{E.preventDefault(),le(t,"closed")},onClose:()=>{le(t,"closed")},title:s.jsx(Ye,{currentPane:o,popPane:m,url:(p=t.merchant)==null?void 0:p.url,faviconUrl:(i=t.merchant)==null?void 0:i.logoUrl,title:(x=(C=t.merchant)==null?void 0:C.title)!=null?x:"",subtitle:(c=(u=t.merchant)==null?void 0:u.subtitle)!=null?c:"",PANES:Gt}),children:s.jsx(Je,{grandTotal:t.grandTotal.value_minor>0?t.grandTotal.value_minor:(g=(_=(b=t.totals)==null?void 0:b.find(E=>E.type==="subtotal"))==null?void 0:_.value_minor)!=null?g:0,merchantExternalId:(A=(w=t.merchant)==null?void 0:w.externalId)!=null?A:"",merchantNetworkId:(D=(R=t.merchant)==null?void 0:R.networkId)!=null?D:"",merchantTitle:(M=(U=t.merchant)==null?void 0:U.title)!=null?M:"",paymentMethodTypes:d,clientThreadId:v,fetchSession:()=>Mt({intl:r,store:t,clientThreadId:v}),children:({loadingCartSession:E,cartLoadError:N})=>s.jsx(Vt,{paneStack:n,pushPane:l,store:t,loadingCartSession:E,cartLoadError:N,resetPanes:h})})})}function Vt({paneStack:e,pushPane:t,store:a,loadingCartSession:n,cartLoadError:r,resetPanes:o}){var i,C;const[l,m]=j.useState(!V(a,a.shippingAddress)),[h,f]=j.useState(!((i=a.paymentDetails)!=null&&i.complete)),[d,v]=j.useState(null),y=gt({namespace:"shopping_checkout"}),p=(n||h||l)&&!r;return j.useEffect(()=>{var x,u,c,b,_;if(a.isCheckoutOpen&&!p&&a.cartMetadata&&a.cartId){const g=a.items[0];L.logEventWithStatsig("product_checkout","product_checkout",S(k({},O(a.cartMetadata)),{checkout_id:a.cartId,merchant_name:(x=a.merchant)==null?void 0:x.title,merchant_url:(u=a.merchant)==null?void 0:u.url,hadSavedPaymentMethod:!!((c=a.paymentDetails)!=null&&c.complete),items:[{quantity:g.quantity.toString(),price:"price"in g?g.price:void 0,variants:"variant"in g?g.variant:void 0,product_id:g.id,product_title:"title"in g?g.title:void 0}],action:"shown"})),y.endBlock("shown",{context:{merchant_id:(b=a.merchant)==null?void 0:b.externalId,merchant_network_id:(_=a.merchant)==null?void 0:_.networkId,cart_total:a.grandTotal.value,product_id:"productId"in g?g.productId:void 0}})}},[(C=a.cartMetadata)==null?void 0:C.clientThreadId,a.isCheckoutOpen,a.cartId,p]),s.jsx("div",{className:"relative w-full",children:s.jsx(Xe,{className:"min-h-[755px] w-full",paneStack:e,useDelayedEnteringPane:!0,alwaysMountedPanes:["paymentMethod","overview","shippingAddress"],renderPane:x=>{switch(x){case"overview":return s.jsx(Nt,{store:a,pushPane:u=>{a.setErrors([]),v(null),t(u)},loadingCartSession:n,loadingPayment:h,loadingAddress:l,cartLoadError:r,stripeLoadingError:d,merchant:a.merchant,footerMessage:a.footerMessage,isCurrentPane:e.currentPane==="overview"});case"paymentMethod":return!n&&!r&&s.jsx(Ut,{store:a,pushPane:t,resetPanes:o,loadingPayment:h,setLoadingPayment:f,loadingAddress:l,setStripeLoadingError:v,isCurrentPane:e.currentPane==="paymentMethod"});case"shippingAddress":return!n&&!r&&s.jsx(Bt,{store:a,resetPanes:o,setLoadingAddress:m,loadingPayment:h,setStripeLoadingError:v,isCurrentPane:e.currentPane==="shippingAddress"});case"shippingMethod":return s.jsx(zt,{shippingMethods:a.shippingOptions,store:a,resetPanes:o})}}})})}const Gt={overview:{name:{id:"shopping-checkout.pane.overview.title",defaultMessage:"Overview",description:"Title for shopping checkout overview pane"}},shippingAddress:{name:{id:"shopping-checkout.pane.shippingAddress.title",defaultMessage:"Add Shipping Address",description:"Title for shopping checkout shipping address pane"}},shippingMethod:{name:{id:"shopping-checkout.pane.shippingMethod.title",defaultMessage:"Select Shipping Method",description:"Title for shopping checkout shipping method pane"}},paymentMethod:{name:{id:"shopping-checkout.pane.paymentMethod.title",defaultMessage:"Add payment method",description:"Title for shopping checkout payment method pane"}}};export{da as CheckoutModal};
//# sourceMappingURL=fq7kulvumequ2ip6.js.map
