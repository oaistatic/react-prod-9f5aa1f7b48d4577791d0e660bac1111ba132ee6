var D=Object.defineProperty,H=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?D(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,C=(e,o)=>{for(var n in o||(o={}))W.call(o,n)&&U(e,n,o[n]);if(b)for(var n of b(o))z.call(o,n)&&U(e,n,o[n]);return e},B=(e,o)=>H(e,G(o));var K=(e,o)=>{var n={};for(var r in e)W.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&b)for(var r of b(e))o.indexOf(r)<0&&z.call(e,r)&&(n[r]=e[r]);return n};import{j as v,m as I,e as J,r as ee,f as te,v as ne}from"./i8clt0mfz495j7ii.js";import{co as E,nL as Q,eI as oe,hr as se,hD as ie,eu as re,cJ as w,eK as ae,jU as ce,bR as de,cj as ue,aT as le,nM as me,cn as Y}from"./ghewn7l2ynbm32fm.js";import{bV as fe,bW as ge,bP as pe,bX as _e,bO as y,bY as he}from"./j0yo6uv6652vva62.js";import{C as ye}from"./t1g128396k0dnr32.js";import"./fe8pomto0j6jsca5.js";function Te({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a}){var l,m,u,f,g;const t=e.find(c=>c.author.role===E.Tool&&c.recipient==="assistant"||c.author.role===E.Assistant&&c.recipient==="user");if(!t)return null;const i=(m=(l=t.metadata)==null?void 0:l.elicitation_metadata)==null?void 0:m.tool_call_message;if(!i)return null;const s=(f=(u=t.metadata)==null?void 0:u.elicitation_metadata)==null?void 0:f.plugin_data;return!s||!s.from_server||!("body"in((g=s.from_server)!=null?g:{}))?null:v.jsx(Me,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:s.from_server,toolCallMessage:i})}function Me({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:t,toolCallMessage:i}){var s;if(!("body"in t))return null;if(t.type=="oauth_required"){const m=((s=t.body.actions)!=null?s:[]).find(ve);return m?v.jsx(Se,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:i,oauthTargetMessageId:m.oauth_redirect.target_message_id}):null}}function Se({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:t,oauthTargetMessageId:i}){var x;const[s,l]=I(),m=J(),u=e.find(M=>{var _,S,k;return(k=(S=(_=M.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:S.plugin_data)==null?void 0:k.from_client}),f=Q(t==null?void 0:t.recipient),g=(x=Q(o==null?void 0:o.recipient))==null?void 0:x.namespace,{connectorId:c,connectorToolStatus:A,connectorStatusMessage:j}=Pe(f==null?void 0:f.namespace,g,e,r),h=oe(!0,se.JIT_PLUGIN).platformConnectors.get(c!=null?c:""),L=!!(c&&h&&!u&&d),q=ie(),p=re();ee.useEffect(()=>{var _,S,k,V;if(((V=(k=(S=(_=u==null?void 0:u.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:S.plugin_data)==null?void 0:k.from_client)==null?void 0:V.type)==="oauth_success")return;s.get("oauth_success")&&(l(F=>(F.delete("oauth_success"),F),{replace:!0}),N({eventSource:"url",assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:w.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful."}))},[t,e,n,a,r,s,l,p,i,u]);const X=ae({skip:!1,fetchValidLinksOnly:!0,productSku:"n7jupd"}),Z=Array.from(X.connectorLinks.values()).some(M=>M.some(_=>_.connector_id===c)),{addSource:$,selectedSources:R}=fe(n),{selectedRepos:O}=ge(n);return v.jsxs(v.Fragment,{children:[j&&v.jsx(pe,{highlightedCommand:h?m.formatMessage(j,{domain:h.name}):v.jsx("br",{}),status:A,showWorkUserSetting:!1}),L&&h&&v.jsx("div",{className:"mb-2 flex gap-2",children:v.jsx(ye,{connector:h,hasWidget:_e(e),onConnect:M=>{if(Z){$(ce[c!=null?c:""]),N({sourceEvent:M,assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:w.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful.",selectedSources:R,selectedRepos:O});return}const _=de(n),S=_?new URL(ue(_),window.location.origin):new URL(window.location.href);S.searchParams.set("oauth_success","true"),q({connectorId:h.id,redirectAfter:S.toString(),referrer:le.JitPluginMessage})},onProceedWithoutConnecting:M=>{N({sourceEvent:M,assistantMessage:t,onRequestCompletion:a,actionData:{type:"deny",target_message_id:i},messageTextContent:"Login declined.",conversationMode:{kind:w.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,selectedSources:R,selectedRepos:O})}})})]})}function ve(e){var o;return(e==null?void 0:e.type)==="oauth_redirect"&&typeof((o=e==null?void 0:e.oauth_redirect)==null?void 0:o.target_message_id)=="string"}function Pe(e,o,n,r){var m,u,f,g,c,A,j,T,h;var d=(m=me(e))!=null?m:void 0;const a=n[n.length-1],t=(u=a==null?void 0:a.metadata)==null?void 0:u.jit_plugin_data;if(!d&&((f=t==null?void 0:t.from_server)==null?void 0:f.type)==="oauth_required"&&(d=(g=t==null?void 0:t.from_server)==null?void 0:g.body.connector_id),!d)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(o===e)return{connectorId:d,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var i=y.Running,s=null,l=!1;return n.some(L=>L.content.content_type===Y.SystemError)?(i=y.Error,s=P.error):a?((c=t==null?void 0:t.from_server)==null?void 0:c.type)==="oauth_required"&&r?(i=y.Paused,s=null,l=!0):((A=t==null?void 0:t.from_server)==null?void 0:A.type)==="oauth_required"&&!r?(i=y.Stopped,s=P.connectorDeclined):((j=t==null?void 0:t.from_client)==null?void 0:j.type)==="deny"?(i=y.Stopped,s=P.connectorDeclined):((T=t==null?void 0:t.from_client)==null?void 0:T.type)==="oauth_success"?(i=y.Stopped,s=P.connectorAccepted):(h=a==null?void 0:a.metadata)!=null&&h.invoked_plugin?(i=y.Finished,s=P.finished):(i=y.Stopped,s=P.stopped):(i=y.Running,s=P.running),{connectorId:d,connectorToolStatus:i,connectorStatusMessage:s,showConnectorConnect:l}}function N(m){var u=m,{actionData:e,assistantMessage:o,turnGizmo:n,onRequestCompletion:r,conversationMode:d,activeSystemHint:a,messageTextContent:t,selectedSources:i,selectedRepos:s}=u,l=K(u,["actionData","assistantMessage","turnGizmo","onRequestCompletion","conversationMode","activeSystemHint","messageTextContent","selectedSources","selectedRepos"]);var g;const f={id:ne(),author:{role:E.Tool,name:o.recipient},content:{content_type:Y.Text,parts:[t!=null?t:""]},recipient:"all",metadata:C(C({jit_plugin_data:{from_client:e},gizmo_id:n==null?void 0:n.gizmo.id,elicitation_metadata:{plugin_data:{from_client:e}}},i&&{selected_sources:he(i)}),s&&{selected_github_repos:[...(g=s.selectedRepos)!=null?g:[]],selected_all_github_repos:s.selectedAllRepos}),clientMetadata:{completionSampleFinishTime:Date.now()}};r(B(C({},l),{promptMessage:f,completionMetadata:{conversationMode:d!=null?d:{kind:w.PrimaryAssistant},systemHints:a?[a]:void 0}}))}const P=te({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorAccepted:{id:"jitPluginMessage.connectorAccepted",defaultMessage:"Accepted using {domain}"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{Te as APIToolElicitationMessage};
//# sourceMappingURL=mmc5ux7i5qpxobsz.js.map
