const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/efb0ptkjeizm7i6w.js","assets/i8clt0mfz495j7ii.js","assets/gwr2pvbuyyllrq8x.js","assets/jo0yr7ku7v9ac6ge.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/j0yo6uv6652vva62.js","assets/conversation-small-lq38g8zw.css","assets/kq8d654gegx6snmr.js","assets/zul7780usssm7kro.js","assets/ansi-1f6vhsjh.css","assets/i84uy1p9ly5pjwpt.js","assets/g5lgy1otfli5p2x7.js","assets/ieykhlrsk25lij4e.js","assets/i03gut32e8jn5ajq.js","assets/h1em0bjkpkjv8ykw.js","assets/e26n6uhwwtwdmiki.js","assets/mjq17q47489shd3e.js","assets/hxdh3tr5l8kut4ed.js","assets/hu1bt0oauegdhua6.js","assets/o6tyvbjf9zh9qku3.js","assets/lptwpbjabrvjmhsj.js","assets/gf67njbmurwfkel2.js","assets/dntm9op0tz5bndrs.js","assets/fzrn137102spawew.js","assets/eflwd0j5c3pxruh8.js","assets/l2r1du6tfxyv7jaj.js","assets/ln88gzx578175chd.js","assets/c80gqv0732s10rnu.js","assets/fr2n5yqcoayleu1k.js","assets/ghnvrdqxofgwprfv.js","assets/g69peh4qbpo7a7d7.js","assets/wham-task-turn-grouping-e50ctjec.css","assets/mqebxepg7t6q2tie.js","assets/abaiei0at0999ntu.js","assets/cgpsp6f7jvechnd8.js","assets/ivhm4b1s5w1b1cuw.js","assets/i94vqq9eycryltby.js","assets/hf1acpjenvjtaqkn.js","assets/ozgq3nk5vhninx80.js","assets/pn83wqr6w775mq4b.js","assets/chs4g5r39qlnqw6r.js","assets/nzsqhqpna1ee8hwf.js","assets/eh21clr7cewe9q6y.js","assets/gutjuo0v1j4y19t1.js","assets/gzhyo73bmtx9f3d9.js","assets/o56jrqjpjpipvc65.js","assets/hfx63ilakvlo6bm4.js","assets/1u88i8jf4mwk3mc5.js","assets/j5l6f6jzcmdadw3x.js","assets/ef28lc1b3o54kec9.js","assets/j4nmkdkymh0gf9lt.js","assets/b3nbyz21c52nzclw.js","assets/88dcy8w0nw3pooi2.js","assets/dyie70wwv508ud8r.js"])))=>i.map(i=>d[i]);
var Mt=Object.defineProperty,Pt=Object.defineProperties;var jt=Object.getOwnPropertyDescriptors;var et=Object.getOwnPropertySymbols;var St=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable;var tt=(t,e,o)=>e in t?Mt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,je=(t,e)=>{for(var o in e||(e={}))St.call(e,o)&&tt(t,o,e[o]);if(et)for(var o of et(e))It.call(e,o)&&tt(t,o,e[o]);return t},Se=(t,e)=>Pt(t,jt(e));import{r as p,j as a,_ as fe,c as ct,e as ge,M as z,h as Xe,d as dt,a as Me,b as Nt,u as De}from"./i8clt0mfz495j7ii.js";import{aF as Lt,gr as Ft,aC as Oe,aD as $e,aH as Et,bG as Rt,d6 as Ke,i0 as Ot,mi as Wt,q as Bt,t as Dt,y as Ue,ae as qt,la as Ht,vl as Ut,vm as Vt,jI as Qt,dp as $t}from"./j0yo6uv6652vva62.js";import{cE as mt,d as we,b0 as Kt,a$ as zt,o as pe,L as be,$ as ve,dw as Gt,C as Yt,u as Je,e as Pe,e0 as Xt,jH as Jt,h as Ce,aV as ht,rB as Zt,iX as Tt,R as Ze,ed as qe,B as ut,tD as At,T as ft,aW as ea,bk as ta,x as aa,mU as oa}from"./ghewn7l2ynbm32fm.js";import{M as Ve,a as ze,W as sa,f as ia,p as Ee,b as ra,c as at,d as na}from"./jo0yr7ku7v9ac6ge.js";import{Y as Ne,o as gt,z as la,Z as ca,W as re,f as Ge,w as Ye,g as _e,l as We,_ as Le,m as da,u as ma,b as ha}from"./g5lgy1otfli5p2x7.js";import{u as ua}from"./mqebxepg7t6q2tie.js";import{T as fa,a as ga,b as pa}from"./fr2n5yqcoayleu1k.js";import{D as xa,P as _a}from"./abaiei0at0999ntu.js";import{u as pt}from"./ivhm4b1s5w1b1cuw.js";import{W as Be}from"./i94vqq9eycryltby.js";import{I as wa,W as va}from"./hf1acpjenvjtaqkn.js";import{i as ba,g as Te,W as ya,a as xt}from"./ozgq3nk5vhninx80.js";import{u as ka,g as Ca,N as Ma}from"./gzhyo73bmtx9f3d9.js";import{W as ot,O as Pa}from"./hfx63ilakvlo6bm4.js";import{s as Re,B as ja}from"./1u88i8jf4mwk3mc5.js";import{W as Sa}from"./c80gqv0732s10rnu.js";const _t=p.createContext(null);function No({value:t,children:e}){return a.jsx(_t.Provider,{value:t,children:e})}function Fe(){const t=p.useContext(_t);if(!t)throw new Error("useWhamTaskPageContext must be used within its provider");return t}function Ia(t){var l,h;const e={},o={};let s;for(const c of t)Ne(c)?c.previous_turn_id?o[c.previous_turn_id]=c:s=c:c.previous_turn_id&&((h=e[l=c.previous_turn_id])!=null?h:e[l]=[]).push(c);if(!s)return null;const r=c=>{var n;const d=(n=e[c.id])!=null?n:[],i={};for(const x of d){const b=o[x.id];b&&(i[x.id]=r(b))}return{userTurn:c,assistantTurns:d,children:i}};return r(s)}function Na(t){for(let e=t.length-1;e>=0;e--){const o=t[e];if(Ne(o)&&o.previous_turn_id)return o.previous_turn_id}return null}function La(t,e){var r,l,h,c;if(!t)return[];const o=[];if(e){const d=n=>{for(const x of n.assistantTurns){if(x.id===e)return[{node:n,activeId:x.id}];const b=n.children[x.id],v=b&&d(b);if(v)return[{node:n,activeId:x.id},...v]}return null},i=d(t);i&&o.push(...i)}o.length===0&&o.push({node:t,activeId:(l=(r=t.assistantTurns[0])==null?void 0:r.id)!=null?l:null});let s=o[o.length-1];for(;s!=null&&s.activeId;){const d=s.node.children[s.activeId];if(!d)break;o.push({node:d,activeId:(c=(h=d.assistantTurns[0])==null?void 0:h.id)!=null?c:null}),s=o[o.length-1]}return o}function Fa(t){return t==null?void 0:t.assistantTurns.some(e=>gt(e.turn_status))}function Ea({className:t,focusedAssistantTurn:e,currentTab:o,permissions:s,task:r,turns:l,containerHeight:h,onClickFile:c,setFocusedAssistantTurnId:d,onTabChange:i,latestTurnRef:n,latestUserMessageRef:x,hasComments:b,clearComments:v,showFullDiff:_,loadingTurnMapping:g,reserveComposerSpace:R=!0}){var U;p.useEffect(()=>{if(!e){const P=Na(l);P&&d(P)}},[e,l,d]);const w=p.useMemo(()=>Ia(l),[l]),f=p.useMemo(()=>{var P;return La(w,(P=e==null?void 0:e.id)!=null?P:null)},[w,e==null?void 0:e.id]),y=f.length-1,F=f.slice(0,y),j=mt(f),O=R&&Fa(j==null?void 0:j.node),{data:u}=la(r==null?void 0:r.id),E=p.useMemo(()=>{var G,ee,V;if(!g||!(u!=null&&u.current_assistant_turn))return null;const P=u.current_assistant_turn,N=((ee=(G=P.sibling_turn_ids)==null?void 0:G.length)!=null?ee:0)+1,Q=(V=P.attempt_placement)!=null?V:0,$=Array.from({length:N},(W,H)=>H===Q?P.id:"placeholder-".concat(H)),q={};return $.forEach((W,H)=>q[W]=H),{attemptIds:$,idToIdxMap:q}},[g,u==null?void 0:u.current_assistant_turn]);return a.jsx("div",{className:we("relative flex h-full w-full flex-col",t),children:a.jsx("div",{className:"flex h-fit min-h-full shrink-0 flex-col gap-6 pt-6 text-sm",children:g&&r&&(u!=null&&u.current_user_turn)&&(u!=null&&u.current_assistant_turn)?a.jsxs("div",{ref:n,className:we("flex min-h-full shrink-0 flex-col gap-6",O&&"pb-36"),style:{minHeight:h-24},children:[a.jsx("div",{className:"text-token-text-secondary flex w-full items-center justify-center gap-2",children:a.jsx(Kt,{className:"text-xl"})}),a.jsx(Ve,{isLatest:!0,task:r,userTurn:u.current_user_turn,assistantTurns:[u.current_assistant_turn],selectedAssistantId:u.current_assistant_turn.id,focusedAssistantTurn:u.current_assistant_turn,setFocusedAssistantTurnId:d,onClickFile:c,currentTab:o,onTabChange:i,permissions:s,startOpen:!0,hasComments:b,clearComments:v,showFullDiff:_,attemptIdsOverride:E==null?void 0:E.attemptIds,idToIndexMapOverride:E==null?void 0:E.idToIdxMap,latestUserMessageRef:x})]}):a.jsxs(a.Fragment,{children:[F.length>0&&a.jsx("div",{className:"flex flex-col gap-6",children:F.map(({node:P,activeId:N},Q)=>a.jsx(Ve,{isLatest:Q===y,task:r,userTurn:P.userTurn,assistantTurns:P.assistantTurns,selectedAssistantId:N,focusedAssistantTurn:e,setFocusedAssistantTurnId:d,onClickFile:c,startOpen:Q===y,currentTab:o,onTabChange:i,permissions:s,hasComments:b,clearComments:v,showFullDiff:_},P.userTurn.id))}),j&&a.jsx("div",{ref:n,className:we("flex min-h-full shrink-0 flex-col gap-6",O&&"pb-36"),style:{minHeight:h-24},children:a.jsx(Ve,{isLatest:!0,task:r,userTurn:j.node.userTurn,assistantTurns:j.node.assistantTurns,selectedAssistantId:(U=e==null?void 0:e.id)!=null?U:null,focusedAssistantTurn:e,setFocusedAssistantTurnId:d,onClickFile:c,currentTab:o,onTabChange:i,permissions:s,startOpen:!0,hasComments:b,clearComments:v,showFullDiff:_,latestUserMessageRef:x})})]})})})}const wt=p.createContext(null);function Lo({value:t,children:e}){return a.jsx(wt.Provider,{value:t,children:e})}function Ae(){const t=p.useContext(wt);if(!t)throw new Error("useTaskComments must be used within a TaskCommentsProvider");return t}function Ra({currentTab:t,permissions:e,onClickFile:o,onTabChange:s,showFullDiff:r,loadingTurnMapping:l,footer:h}){const{task:c,focusedAssistantTurn:d,pastTurns:i,setFocusedAssistantTurnId:n}=Fe(),{comments:x,clearComments:b}=Ae(),[{height:v},_]=ua(),g=p.useRef(null),R=p.useRef(null),w=p.useRef(null);return zt(()=>{const f=g.current,y=w.current;!f||!y||!f.contains(y)||y.scrollIntoView({block:"start",behavior:"auto"})},[i.length,l]),a.jsx("div",{ref:Lt(_,g),className:"flex h-full w-full scroll-pt-3 flex-col items-center overflow-y-auto px-6",children:a.jsxs("div",{className:we("@container w-full",ze),children:[a.jsx(Ea,{focusedAssistantTurn:d,currentTab:t,permissions:e,task:c,turns:i,containerHeight:v,onClickFile:o,setFocusedAssistantTurnId:n,onTabChange:s,latestTurnRef:R,latestUserMessageRef:w,hasComments:x.length>0,clearComments:b,showFullDiff:r,loadingTurnMapping:l,reserveComposerSpace:h!=null}),h&&a.jsx("div",{className:"keyboard-open:fixed absolute start-0 end-0 bottom-0",children:h})]})})}const Oa=pe(()=>fe(()=>import("./efb0ptkjeizm7i6w.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>be(t)});function Wa(t){"use forget";const e=ct.c(10),{onRetry:o,isRetrying:s}=t,r=ge();let l;e[0]!==r?(l=r.formatMessage({id:"wham.whamPreviewImageCarousel.retryAriaLabel",defaultMessage:"Retry loading preview images"}),e[0]=r,e[1]=l):l=e[1];const h=l;let c;e[2]===Symbol.for("react.memo_cache_sentinel")?(c=a.jsx("div",{className:"bg-token-bg-tertiary text-token-text-tertiary rounded-full p-3",children:a.jsx(Oa,{className:"icon-lg"})}),e[2]=c):c=e[2];let d;e[3]===Symbol.for("react.memo_cache_sentinel")?(d=a.jsx("p",{className:"text-token-text-primary text-base font-medium",children:a.jsx(z,{id:"wham.whamPreviewImageCarousel.errorTitle",defaultMessage:"Preview unavailable"})}),e[3]=d):d=e[3];let i;e[4]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsxs("div",{className:"flex flex-col gap-2",children:[d,a.jsx("p",{className:"text-token-text-secondary text-sm",children:a.jsx(z,{id:"wham.whamPreviewImageCarousel.errorSubtitle",defaultMessage:"We couldn't load the preview images. Please try again."})})]}),e[4]=i):i=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(z,{id:"wham.whamPreviewImageCarousel.retry",defaultMessage:"Retry"}),e[5]=n):n=e[5];let x;return e[6]!==s||e[7]!==o||e[8]!==h?(x=a.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-4 px-6 text-center",children:[c,i,a.jsx(ve,{color:"secondary",onClick:o,loading:s,label:h,className:"mt-1",children:n})]}),e[6]=s,e[7]=o,e[8]=h,e[9]=x):x=e[9],x}function Ba({previewImages:t}){"use no forget";var w;const e=ge(),o=Ft(t.map(f=>{var y,F,j,O;return{content_type:Gt.ImageAssetPointer,asset_pointer:(y=f.asset_pointer)!=null?y:"",size_bytes:(F=f.size_bytes)!=null?F:0,width:(j=f.width)!=null?j:0,height:(O=f.height)!=null?O:0}})),s=p.useMemo(()=>o.filter(f=>f.data),[o]),r=s.length>0,l=p.useMemo(()=>o.some(f=>f.isError),[o]),h=p.useMemo(()=>o.some(f=>f.isFetching),[o]),[c,d]=p.useState(0),[i,n]=p.useState(!1),x=Math.min(Math.max(c,0),Math.max(s.length-1,0)),b=p.useCallback(()=>{s.length<=1||(d(f=>(f-1+s.length)%s.length),Be.recordPreviewImagesCarouselPrev())},[s.length]),v=p.useCallback(()=>{s.length<=1||(d(f=>(f+1)%s.length),Be.recordPreviewImagesCarouselNext())},[s.length]),_=p.useCallback(async()=>{n(!0);try{await Promise.all(o.map(f=>f.refetch({throwOnError:!1})))}finally{n(!1)}},[o]);pt([{key:"previewCarouselPrev",action:b,actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.previousPreviewImage",defaultMessage:"Select previous image"}),group:$e.Chat,keyboardBinding:[Oe.ArrowLeft],enabled:s.length>1},{key:"previewCarouselNext",action:v,actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.nextPreviewImage",defaultMessage:"Select next image"}),group:$e.Chat,keyboardBinding:[Oe.ArrowRight],enabled:s.length>1}]);const g=(w=s[x])==null?void 0:w.data,R=!r&&l&&!h;return a.jsxs("div",{className:"relative flex h-full w-full items-center justify-center overflow-hidden p-4",children:[R?a.jsx(Wa,{isRetrying:i,onRetry:()=>{_()}}):g?a.jsx("div",{className:"flex h-full w-full items-start justify-center overflow-auto",children:a.jsx("img",{src:g.url,width:g.width,height:g.height,alt:e.formatMessage({id:"wham.whamTaskPageContentLoaded.previewImageAlt",defaultMessage:"Generated image"}),className:"h-auto max-w-full"},x)}):a.jsx("div",{className:"text-secondary flex h-full w-full items-center justify-center text-sm",children:a.jsx(z,{id:"wham.whamPreviewImageCarousel.loading",defaultMessage:"Loading preview…"})}),s.length>1&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button","aria-label":e.formatMessage({id:"wham.whamPreviewImageCarousel.prev",defaultMessage:"Previous image"}),onClick:b,className:"absolute start-2 top-1/2 -translate-y-1/2 rounded-md bg-black/40 px-2 py-1 text-white hover:bg-black/60 focus:ring-2 focus:ring-white/70 focus:outline-none",children:"‹"}),a.jsx("button",{type:"button","aria-label":e.formatMessage({id:"wham.whamPreviewImageCarousel.next",defaultMessage:"Next image"}),onClick:v,className:"absolute end-2 top-1/2 -translate-y-1/2 rounded-md bg-black/40 px-2 py-1 text-white hover:bg-black/60 focus:ring-2 focus:ring-white/70 focus:outline-none",children:"›"}),a.jsxs("div",{className:"pointer-events-none absolute start-1/2 bottom-2 -translate-x-1/2 rounded-md bg-black/40 px-2 py-0.5 text-xs text-white",children:[x+1," / ",s.length]})]})]})}const vt=pe(()=>fe(()=>import("./gwr2pvbuyyllrq8x.js"),__vite__mapDeps([2,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])).then(t=>t.WhamTaskPageCodeDiffContent),{loading:()=>a.jsx("div",{className:"flex-1"})});function Da(t){"use forget";var he,ue;const e=ct.c(95),{currentTab:o,setCurrentTab:s,defaultTab:r,isMobile:l,hasDiff:h,previewImages:c,diffFiles:d,unifiedDiff:i,handleDiffModeChange:n,showFullDiff:x,setShowFullDiff:b,isPreferencesLoading:v,isSharedExampleTask:_,focusedAssistantTurn:g,leftContent:R}=t,{taskId:w,task:f,canFollowUp:y,pastTurns:F}=Fe(),{comments:j,setComments:O}=Ae(),u=ge();let E;e[0]!==v?(E=[v],e[0]=v,e[1]=E):E=e[1],p.useEffect(Ua,E);let U;if(e[2]!==g||e[3]!==F){e:{if(!g){U=null;break e}const m=F!=null?F:[];let M;e[5]!==g?(M=k=>k.id===g.id,e[5]=g,e[6]=M):M=e[6];const B=m.findIndex(M);if(B>0)for(let k=B-1;k>=0;k=k-1,k){const xe=m[k];if(Ne(xe)){U=xe;break e}}if(g.previous_turn_id){let k;e[7]!==g.previous_turn_id?(k=ke=>Ne(ke)&&ke.id===g.previous_turn_id,e[7]=g.previous_turn_id,e[8]=k):k=e[8];const xe=m.find(k);if(xe){U=xe;break e}}const D=[...m].reverse().find(Ha);U=D!=null?D:null}e[2]=g,e[3]=F,e[4]=U}else U=e[4];const P=U,N=(he=g==null?void 0:g.id)!=null?he:w,Q=!l;let $;e[9]!==u?($=u.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),e[9]=u,e[10]=$):$=e[10];let q;e[11]!==u?(q=u.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),e[11]=u,e[12]=q):q=e[12];let G;e[13]!==R||e[14]!==Q||e[15]!==$||e[16]!==q?(G={key:"chat",isHidden:Q,label:$,ariaLabel:q,children:R},e[13]=R,e[14]=Q,e[15]=$,e[16]=q,e[17]=G):G=e[17];const ee=c.length===0;let V;e[18]!==u?(V=u.formatMessage({id:"wham.whamTaskPageContentLoaded.preview",defaultMessage:"Preview"}),e[18]=u,e[19]=V):V=e[19];let W;e[20]!==u?(W=u.formatMessage({id:"wham.whamTaskPageContentLoaded.previewAriaLabel",defaultMessage:"Tab to view preview images"}),e[20]=u,e[21]=W):W=e[21];let H;e[22]!==c?(H=a.jsx(Ba,{previewImages:c}),e[22]=c,e[23]=H):H=e[23];let ne;e[24]!==W||e[25]!==H||e[26]!==ee||e[27]!==V?(ne={key:"preview",isHidden:ee,label:V,ariaLabel:W,children:H},e[24]=W,e[25]=H,e[26]=ee,e[27]=V,e[28]=ne):ne=e[28];const le=!h;let te;e[29]!==u?(te=u.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),e[29]=u,e[30]=te):te=e[30];let ce;e[31]!==u?(ce=u.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),e[31]=u,e[32]=ce):ce=e[32];let ae;e[33]!==y||e[34]!==j||e[35]!==d||e[36]!==h||e[37]!==v||e[38]!==O||e[39]!==i?(ae=!v&&h&&a.jsx(vt,{diffFiles:d,unifiedDiff:i,enableComments:y,comments:j,setComments:O}),e[33]=y,e[34]=j,e[35]=d,e[36]=h,e[37]=v,e[38]=O,e[39]=i,e[40]=ae):ae=e[40];let Z;e[41]!==le||e[42]!==te||e[43]!==ce||e[44]!==ae?(Z={key:"diff",isHidden:le,label:te,ariaLabel:ce,children:ae},e[41]=le,e[42]=te,e[43]=ce,e[44]=ae,e[45]=Z):Z=e[45];let T;e[46]!==u?(T=u.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),e[46]=u,e[47]=T):T=e[47];let K;e[48]!==u?(K=u.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),e[48]=u,e[49]=K):K=e[49];const de=(ue=g==null?void 0:g.environment)==null?void 0:ue.agent_network_access;let Y;e[50]!==g||e[51]!==de||e[52]!==w?(Y=a.jsx(sa,{taskId:w,focusedAssistantTurn:g,agentNetworkAccess:de}),e[50]=g,e[51]=de,e[52]=w,e[53]=Y):Y=e[53];let C;e[54]!==_||e[55]!==T||e[56]!==K||e[57]!==Y?(C={key:"logs",isHidden:_,label:T,ariaLabel:K,children:Y},e[54]=_,e[55]=T,e[56]=K,e[57]=Y,e[58]=C):C=e[58];let L;e[59]!==u?(L=u.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels",defaultMessage:"Internal Data Models"}),e[59]=u,e[60]=L):L=e[60];let S;e[61]!==u?(S=u.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModelsAriaLabel",defaultMessage:"Tab to view internal data models"}),e[61]=u,e[62]=S):S=e[62];const me=g==null?void 0:g.internal_only_rollouts;let oe;e[63]!==g||e[64]!==me||e[65]!==f||e[66]!==P?(oe=a.jsx(wa,{task:f,userTurn:P,assistantTurn:g,rollout:me}),e[63]=g,e[64]=me,e[65]=f,e[66]=P,e[67]=oe):oe=e[67];let se;e[68]!==L||e[69]!==S||e[70]!==oe?(se={key:"internal_data_models",isHidden:!0,label:L,ariaLabel:S,children:oe},e[68]=L,e[69]=S,e[70]=oe,e[71]=se):se=e[71];let X;e[72]!==ne||e[73]!==Z||e[74]!==C||e[75]!==se||e[76]!==G?(X=[G,ne,Z,C,se],e[72]=ne,e[73]=Z,e[74]=C,e[75]=se,e[76]=G,e[77]=X):X=e[77];let J;e[78]!==n||e[79]!==h||e[80]!==b||e[81]!==x||e[82]!==i?(J=h&&a.jsx(xa,{unifiedDiff:i,setUnifiedDiff:n,showFullDiff:x,setShowFullDiff:b}),e[78]=n,e[79]=h,e[80]=b,e[81]=x,e[82]=i,e[83]=J):J=e[83];let A;e[84]!==l||e[85]!==J?(A=a.jsx(fa,{withUnderline:l,className:"items-center border-b p-3 pe-16 max-md:py-0",children:J}),e[84]=l,e[85]=J,e[86]=A):A=e[86];let I;e[87]===Symbol.for("react.memo_cache_sentinel")?(I=a.jsx(ga,{children:qa}),e[87]=I):I=e[87];let ie;return e[88]!==o||e[89]!==r||e[90]!==s||e[91]!==X||e[92]!==N||e[93]!==A?(ie=a.jsx("div",{className:"relative flex h-full w-full flex-col",children:a.jsxs(pa,{onChange:s,currentTab:o,defaultTab:r,tabs:X,children:[A,I]},N)}),e[88]=o,e[89]=r,e[90]=s,e[91]=X,e[92]=N,e[93]=A,e[94]=ie):ie=e[94],ie}function qa(t){const{content:e}=t;return a.jsx("div",{className:"flex h-full w-full",children:e})}function Ha(t){return Ne(t)}function Ua(){vt.prefetch()}function Va({isOpen:t,onConfirm:e,onClose:o,loading:s}){return a.jsx(Yt,{isOpen:t,onClose:o,testId:"modal-wham-retry-all-turns",type:"warning",title:a.jsx("p",{className:"text-token-text-primary font-semibold",children:a.jsx(z,{id:"wham.retryAllTurnsModal.title",defaultMessage:"Retry all turns"})}),primaryButton:a.jsx(ve,{color:"primary",loading:s,onClick:e,children:a.jsx(z,{id:"wham.retryAllTurnsModal.confirm",defaultMessage:"Retry all turns"})}),secondaryButton:a.jsx(ve,{color:"secondary",onClick:o,children:a.jsx(z,{id:"wham.retryAllTurnsModal.cancel",defaultMessage:"Cancel"})}),children:a.jsx("div",{className:"text-sm",children:a.jsx(z,{id:"wham.retryAllTurnsModal.message",defaultMessage:"All latest turns will restart, including any siblings turns that are in progress or completed."})})})}const Qa=pe(()=>fe(()=>import("./j5l6f6jzcmdadw3x.js").then(t=>t._),__vite__mapDeps([49,1])),{loading:t=>be(t)});function $a({focusedAssistantTurn:t,lastTurn:e,siblings:o}){const s=(e==null?void 0:e.type)==="assistant"?e.turn_status:"completed";return t&&((e==null?void 0:e.id)===t.id||o.some(l=>l.id===(e==null?void 0:e.id)))?t.turn_status:s}function Ka({turnId:t,comments:e,clearComments:o,lastTurn:s,focusedAssistantTurn:r,retry:l,attemptIndex:h,siblings:c}){var Z,T,K,de,Y;const d=Je(),{taskId:i,task:n,setFocusedAssistantTurnId:x}=Fe(),b=Xe(),v=ge(),_=Pe(),g=Xt(),R=Jt(),w=ba(d),f=C=>{Zt(Tt(R)),o(),x(C.turn.id)},y=async()=>{var C,L;if(l){U(!0);try{if(l.previousTurnId){const S=await re.createFollowUpTask(i,l.previousTurnId,l.prompt,(C=l.comments)!=null?C:[],!1,q?(L=l.bestOfN)!=null?L:1:void 0,w?l.attachments:[]);f(S)}else{const S=await re.createNewTask(l.environmentId,l.branch,l.prompt,!1,q?l.bestOfN:void 0,w?l.attachments:[]);b("/codex/tasks/".concat(S.task.id))}N(!1)}catch(S){S instanceof Ge?Ye(S,t,v,_):_.danger(dt({id:"wham.whamTaskPageFooter.errorRetryingTask",defaultMessage:"Error retrying task"}),{toastId:"wham_task_page_footer_error_retrying_task"})}finally{U(!1)}}},F=!!r&&Te(r.output_items).outputDiffs.length>0,j=!s||!r||s.id===(r==null?void 0:r.id)||!F,O=l&&j&&(r==null?void 0:r.turn_status)==="failed",u=(r==null?void 0:r.previous_turn_id)&&(s==null?void 0:s.type)==="assistant"&&r.previous_turn_id===s.previous_turn_id,[E,U]=p.useState(!1),[P,N]=p.useState(!1),Q=Ce(d,"1406552515"),$=Ce(d,"879591222")||void 0,q=Ce(d,"3492040717"),G=p.useMemo(()=>{var S,me,oe,se,X,J,A;const C=[...(oe=(me=(S=r==null?void 0:r.output_items)==null?void 0:S.find(I=>I.type==="review"))==null?void 0:me.suggested_followup_tasks)!=null?oe:[],...(X=(se=r==null?void 0:r.output_items)==null?void 0:se.filter(I=>I.type==="suggested_task"))!=null?X:[]],L=ia((A=(J=r==null?void 0:r.child_turns)==null?void 0:J.filter(I=>I.source.type==="suggested_task"))==null?void 0:A.map(I=>[I.source.suggested_task_id,I]));return C.map(I=>{var ie,he,ue,m;return{suggestion:I,userTurnId:I.id&&(he=(ie=L[I.id])==null?void 0:ie.assistant_turn_id)!=null?he:null,assistantTurnId:I.id&&(m=(ue=L[I.id])==null?void 0:ue.user_turn_id)!=null?m:null}})},[r]),ee=(Z=r==null?void 0:r.id)!=null?Z:t,V=p.useMemo(()=>{var C,L;return(L=(C=r==null?void 0:r.output_items)==null?void 0:C.filter(ca))!=null?L:[]},[r]),W=p.useMemo(()=>V.reduce((C,L)=>C+L.comments.filter(S=>S.priority===0||S.priority===1).length,0),[V]),H=((K=(T=n==null?void 0:n.task_status_display)==null?void 0:T.latest_turn_status_display)==null?void 0:K.intent)==="cr",ne=(j||u)&&V.length>0,le=ka({taskId:i,latestTurnId:ee}),te=le.isPending||!ee||W===0||Q,ce=$a({focusedAssistantTurn:r,lastTurn:s,siblings:c}),ae=(de=c==null?void 0:c.map(C=>C.turn_status))!=null?de:[];return(s==null?void 0:s.type)==="assistant"&&["pending","in_progress"].includes(s.turn_status)&&!$?null:a.jsxs(a.Fragment,{children:[a.jsxs("div",{id:"wham-message-modal-footer",className:"z-50 flex w-full justify-center",children:[(j||u)&&a.jsx("div",{className:"flex w-full justify-center px-4",children:a.jsx("div",{className:we("relative z-1 flex w-full flex-col pt-2 pb-4",ze),children:O?a.jsx(ve,{className:"w-full",color:"primary",size:"large",loading:E&&!P,onClick:()=>{var C;((C=l==null?void 0:l.bestOfN)!=null?C:1)>1?N(!0):y()},children:((Y=l.bestOfN)!=null?Y:1)>1?v.formatMessage({id:"wham.whamTaskPageFooter.retryAllTurns",defaultMessage:"Retry all turns"}):v.formatMessage({id:"wham.whamTaskPageFooter.retry",defaultMessage:"Retry"})}):ne?a.jsxs("div",{className:"flex w-full flex-col gap-3",children:[a.jsx(ot,{}),a.jsx(ve,{className:"w-full",color:"primary",size:"large",disabled:te,loading:le.isPending,onClick:()=>{te||le.mutateAsync(void 0)},children:a.jsx(z,{id:"wham.whamTaskPageFooter.fixIssues",defaultMessage:"{count, plural, one {Fix issue} other {Fix issues}}",values:{count:W}})})]}):o&&!H&&a.jsxs("div",{className:"flex w-full flex-col gap-3",children:[a.jsx(ot,{}),!Q&&a.jsx(ya,{disableAutoFocus:!0,disableDuringSubmit:!0,onSuccess:f,onClearComments:o,followUp:{taskId:i,turnId:t,comments:e,turnStatus:ce,siblingTurnStatuses:ae,followUpSuggestions:G},attemptIndex:h,ariaLabel:v.formatMessage({id:"wham.whamTaskPageFooter.composerAriaLabel",defaultMessage:"Composer to enter a follow up prompt to the task"})})]})})}),!j&&!u&&a.jsx(ht.div,{layout:!0,className:we("dark mx-6 mb-6 w-full",ze),initial:{opacity:0,translateY:10},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:10},transition:{duration:g?0:.25},children:a.jsx(Et,{title:a.jsx(z,{id:"wham.whamTaskPageFooter.previousTurn",defaultMessage:"You are viewing a previous turn"}),primaryCtaText:a.jsx(z,{id:"wham.whamTaskPageFooter.viewLatestTurn",defaultMessage:"View latest"}),content:a.jsx(z,{id:"wham.whamTaskPageFooter.followUpsLatestTurn",defaultMessage:"Follow-ups are only available for the latest turn"}),icon:a.jsx(Qa,{className:"icon"}),onPrimaryCtaClick:()=>x(s.id)})})]}),a.jsx(Va,{isOpen:P,onClose:()=>N(!1),onConfirm:y,loading:E})]})}const bt=window.location.origin+"/s/";function za(t){return"".concat(bt).concat(t)}function yt(t){var e,o;return!t||!t.attachments||t.attachments.length===0||t.attachments[0].kind!=="codex"?null:{postId:t.id,permalink:(e=t.permalink)!=null?e:za(t.id),permissions:(o=t.permissions.share_setting)!=null?o:"public",codexTask:t.attachments[0].task,codexTurn:t.attachments[0].turns}}function Ie(t){return["codex_tasks","result","share",t]}function Ga({taskId:t,enabled:e}){return Nt({enabled:!!t&&e,queryKey:Ie(t),queryFn:async()=>{const o=await Ze.safeGet("/share/post/by_codex_task/{codex_task_id}",{parameters:{path:{codex_task_id:t}}});return o.post?yt(o.post):null}})}function Ya({taskId:t,onSuccess:e,onError:o}){return Me({scope:{id:t},mutationFn:()=>re.forkSharedTask(t),onSuccess:e,onError:o})}function Xa({taskId:t,turnId:e,onSuccess:o,onError:s}){return Me({scope:{id:t},mutationFn:async()=>{const r=await Ze.safePost("/share/post",{requestBody:{attachments_to_create:[{kind:"codex",codex_task_id:t,current_codex_turn_id:e}]}});return yt(r.post)},onSuccess:o,onError:s})}function Ja({taskId:t,sharedResult:e}){var s;const o=De();return Me({scope:{id:(s=e==null?void 0:e.postId)!=null?s:""},mutationFn:async({sharedResultId:r,access:l})=>(await Ze.safePost("/share/post/update_access",{requestBody:{post_id:r,share_settings:l}})).share_setting,onMutate:({access:r})=>{const l=Ie(t),h=o.getQueryData(l);return o.setQueryData(l,h&&Se(je({},h),{permissions:r})),{previousAccess:h==null?void 0:h.permissions}},onSuccess:r=>{const l=Ie(t),h=o.getQueryData(l);h&&o.setQueryData(l,Se(je({},h),{permissions:r}))},onError:(r,l,h)=>{var i;const c=Ie(t),d=o.getQueryData(c);o.setQueryData(c,d&&Se(je({},d),{permissions:(i=h==null?void 0:h.previousAccess)!=null?i:"public"}))}})}function Za({taskId:t}){const e=ge(),o=Pe(),s=Xe(),{mutate:r}=Ya({taskId:t,onSuccess:l=>{var h,c;(h=l==null?void 0:l.task)!=null&&h.id&&s("/codex/tasks/".concat((c=l==null?void 0:l.task)==null?void 0:c.id))},onError:()=>{o.danger(e.formatMessage({id:"wham.codexForkButton.failedToFork",defaultMessage:"Failed to fork task"}))}});return a.jsx(ve,{size:"small",color:"secondary",type:"button",className:"px-3 py-2",onClick:()=>r(),children:a.jsx(z,{id:"wham.share.taskForkButton",defaultMessage:"Fork"})})}const st=pe(()=>fe(()=>import("./ef28lc1b3o54kec9.js").then(t=>t._),__vite__mapDeps([50,1])),{loading:t=>be(t)}),Ta=pe(()=>fe(()=>import("./j4nmkdkymh0gf9lt.js").then(t=>t._),__vite__mapDeps([51,1])),{loading:t=>be(t)}),Aa="".concat(bt,"...");function eo({taskId:t,turnId:e,isLoading:o,sharedResult:s,title:r}){const[l,h]=p.useState(!1),c=(w,f)=>{w&&qt(w,void 0,f).then(()=>{h(!0),setTimeout(()=>h(!1),1500)}).catch(()=>{})},d=De(),i=Pe(),{mutate:n,isPending:x}=Xa({taskId:t,turnId:e,onSuccess:w=>{if(!w){i.danger("Failed to create share link");return}d.setQueryData(Ie(t),w),c(w.permalink)}}),{mutate:b}=Ja({taskId:t,sharedResult:s}),v=p.useRef(null),_=w=>{var f;(f=v.current)==null||f.focus(),s?c(s.permalink,w):n()},g=w=>{s&&b({sharedResultId:s.postId,access:w})},R=w=>{switch(w){case"public":return Ue.PUBLIC;case"private":return Ue.PRIVATE;case"workspace":return Ue.WORKSPACE}};return a.jsx(ja,{inputRef:v,isLoading:o,isPublishedVersionLatest:!0,sharedObject:s&&{id:s.postId,title:r,access:R(s.permissions)},title:r,shareTextPlaceholder:Aa,shareUrl:s==null?void 0:s.permalink,isCopySuccessful:l,isCreateLinkRequestInProgress:x,handlePrivacyChange:g,handlePrimaryButtonClick:_})}function to({taskId:t,turnId:e,isDisabled:o,title:s}){const r=qe(),l=ut(),h=ge(),[c,d]=p.useState(!1),{data:i,isLoading:n}=Ga({taskId:t,enabled:c&&!o}),{triggerRef:x,container:b}=At({isOpen:c,onClose:()=>d(!1)}),v=(l==null?void 0:l.isWorkspaceAccount())&&!(l!=null&&l.features.includes(Rt.WorkspaceShareLinks));return o||v?a.jsx(ft,{label:v?h.formatMessage(Re.workspaceSharingDisabled):h.formatMessage(Re.share),children:a.jsx(Ke,{disabled:!0,icon:Ta,"aria-label":h.formatMessage(v?Re.workspaceSharingDisabled:Re.share)})}):a.jsxs(Ot,{open:c,onOpenChange:d,children:[a.jsx(Wt,{ref:x,asChild:!0,children:r?a.jsx(Ke,{icon:st,"aria-label":h.formatMessage({id:"wham.whamTaskPageHeader.shareAriaLabel",defaultMessage:"Share task"})}):a.jsx(ve,{icon:st,color:"ghost","aria-label":h.formatMessage({id:"wham.whamTaskPageHeader.shareAriaLabel",defaultMessage:"Share task"}),children:a.jsx(z,{id:"wham.whamTaskPageHeader.share",defaultMessage:"Share"})})}),a.jsx(ea,{children:c&&a.jsx(Bt,{forceMount:!0,container:b,children:a.jsx(Dt,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:a.jsx(eo,{title:s,taskId:t,turnId:e,sharedResult:i,isLoading:n})})})})]})}function ao({assistantTurn:t}){var v,_,g,R,w,f;const e=ge(),o=Pe(),s=qe(),r=(g=(_=(v=t==null?void 0:t.pull_request_data)==null?void 0:v.head)!=null?_:t==null?void 0:t.branch)!=null?g:"",l=Ca(r),h=r&&r!==l,{outputDiffs:c}=Te(t==null?void 0:t.output_items),d=c[0],i=(f=(w=t==null?void 0:t.base_commit_sha)!=null?w:(R=t==null?void 0:t.pull_request_data)==null?void 0:R.base_sha)!=null?f:d==null?void 0:d.base_commit_sha;if(s||!r)return null;const n=i!=null&&r!==i,b=n?a.jsx("span",{className:"text-token-text-secondary hover:text-token-text-primary cursor-pointer",onClick:()=>{navigator.clipboard.writeText(i!=null?i:""),o.success(e.formatMessage({id:"wham.baseSha.copied",defaultMessage:"Copied branch commit SHA to clipboard"}))},children:i}):h?r:void 0;return a.jsx(ft,{label:b,side:"bottom",disabled:!b,interactive:n,children:a.jsx("span",{className:"text-token-text-secondary hover:text-token-text-primary cursor-pointer truncate",onClick:()=>{navigator.clipboard.writeText(r),o.success(e.formatMessage({id:"wham.branchName.copied",defaultMessage:"Copied branch name to clipboard"}))},children:l})})}const oo=({assistantTurn:t})=>{const e=ge(),o=p.useMemo(()=>t!=null&&t.created_at?new Date(t.created_at*1e3):null,[t==null?void 0:t.created_at]),s=p.useMemo(()=>(o==null?void 0:o.getFullYear())===new Date().getFullYear(),[o]);return o?o.toLocaleDateString(e.locale,{month:"short",day:"numeric",year:s?void 0:"numeric"}):null},so=" · ";function io({title:t,assistantTurn:e}){var d,i,n,x;const{linesAdded:o,linesRemoved:s}=xt(e),r=(d=e==null?void 0:e.environment)==null?void 0:d.label,l=(x=(n=(i=e==null?void 0:e.pull_request_data)==null?void 0:i.head)!=null?n:e==null?void 0:e.branch)!=null?x:"",c=[{key:"created-at",element:a.jsx("span",{className:"text-token-text-secondary truncate empty:hidden max-md:hidden",children:a.jsx(oo,{assistantTurn:e})}),hideOnMobile:!0,shouldShow:!!(e!=null&&e.created_at)},{key:"environment",element:a.jsx("span",{className:"text-token-text-secondary truncate",children:r}),hideOnMobile:!1,shouldShow:!!r},{key:"branch",element:a.jsx(ao,{assistantTurn:e}),hideOnMobile:!0,shouldShow:!!l,noSeparator:!0},{key:"stats",element:a.jsx("span",{className:"max-md:hidden",children:a.jsx(Sa,{linesAdded:o,linesRemoved:s})}),hideOnMobile:!0,shouldShow:!!(o||s)}].filter(b=>b.shouldShow);return a.jsxs("div",{className:"flex min-w-0 flex-col text-sm",children:[a.jsx("div",{className:"flex items-center gap-1",children:a.jsx("span",{className:"truncate font-medium",children:t})}),a.jsx("div",{className:"flex gap-2 max-md:flex-wrap max-md:gap-1",children:c.map((b,v)=>{const _=c[v-1],g=(_==null?void 0:_.hideOnMobile)||b.hideOnMobile||b.noSeparator;return a.jsxs(p.Fragment,{children:[v>0&&a.jsx("span",{"aria-hidden":"true",className:we("text-token-text-secondary",g?"max-md:hidden":""),children:so}),b.element]},b.key)})})]})}const it=pe(()=>fe(()=>import("./b3nbyz21c52nzclw.js").then(t=>t._),__vite__mapDeps([52,1])),{loading:t=>be(t)}),ro=pe(()=>fe(()=>import("./88dcy8w0nw3pooi2.js").then(t=>t._),__vite__mapDeps([53,1])),{loading:t=>be(t)}),rt=pe(()=>fe(()=>import("./dyie70wwv508ud8r.js").then(t=>t._),__vite__mapDeps([54,1])),{loading:t=>be(t)});function no({focusedAssistantTurn:t,onClose:e,shouldShowShare:o,shouldShowFork:s,permissions:r,title:l,isSharedExampleTask:h=!1}){"use no forget";var I,ie,he,ue;const{taskId:c,task:d,currentDiffTaskTurn:i}=Fe(),n=ut(),x=(I=n==null?void 0:n.id)!=null?I:null,b=(ie=d==null?void 0:d.creator_workspace)!=null?ie:null,[v,_]=p.useState((i==null?void 0:i.pull_request_status)==="creating"),[g,R]=p.useState(void 0),w=Pe(),f=De(),y=ge(),F=Ht(_e(i)),j=r==="write",O=We(m=>m.getTurnsForTask(c).filter(Le)),u=We(m=>m.getTurnsForTask(c)),E=new Map(u.map(m=>[m.id,m])),U=m=>{if(Le(m)){const B=d==null?void 0:d.external_pull_requests;if(B&&B.length)for(let D=B.length-1;D>=0;D--){const k=B[D];if(k.assistant_turn_id===m.id)return k}}const M=m.previous_turn_id?E.get(m.previous_turn_id):void 0;return M?U(M):void 0},P=i!=null?i:t,N=P?U(P):void 0,{linesAdded:Q,linesRemoved:$}=xt(i),{outputDiffs:q,hasPreApplyPatch:G}=Te(i==null?void 0:i.output_items),ee=j&&!G,V=((ue=(he=d==null?void 0:d.task_status_display)==null?void 0:he.latest_turn_status_display)==null?void 0:ue.intent)==="cr",W=Xe(),H=Je(),le=(Ce(H,"2665240312")||void 0)&&!!(t!=null&&t.id)&&j&&!V,te=Ce(H,"369193424"),ae=O.filter(m=>{var M;return(M=i==null?void 0:i.sibling_turn_ids)==null?void 0:M.includes(m.id)}).some(m=>{var M;return(M=m.pull_request_data)==null?void 0:M.url}),Z=te&&r==="write"&&N&&!N.pull_request.merged&&N.pull_request.state!=="closed"&&N.codex_updated_sha!==""&&((i==null?void 0:i.id)!==N.assistant_turn_id||(i==null?void 0:i.pull_request_status)==="externally_created")&&!ae,T=p.useRef(null),{mutate:K,isPending:de}=Me({mutationFn:async()=>{c&&await re.archiveTask(c)},onSuccess:async()=>{await f.invalidateQueries({queryKey:["wham","tasks"]}),await f.invalidateQueries({queryKey:["wham","task",c]}),W("/codex")},onError:()=>{w.danger({id:"wham.whamTaskPageHeader.failedToArchiveTask",defaultMessage:"Failed to archive task",description:"Toast when archive request fails"},{toastId:"wham_task_page_header_failed_to_archive_task"})}}),{mutate:Y,isPending:C}=Me({mutationFn:async()=>{c&&await re.recoverTask(c)},onSuccess:async()=>{await f.invalidateQueries({queryKey:["wham","tasks"]}),await f.invalidateQueries({queryKey:["wham","task",c]})},onError:()=>{w.danger({id:"wham.whamTaskPageHeader.failedToArchiveTask",defaultMessage:"Failed to archive task",description:"Toast when archive request fails"},{toastId:"wham_task_page_header_failed_to_archive_task"})}}),L=de||C;p.useEffect(()=>{(i==null?void 0:i.pull_request_status)==="creating"?(_(!0),f.invalidateQueries({queryKey:["wham","task",c,"turns"]})):_(!1)},[c,i==null?void 0:i.pull_request_status,f]),pt([{key:"copyApplyToClipboard",action:()=>{S()},actionMessageDescriptor:y.formatMessage({id:"wham.keyboardActions.copyApplyToClipboard",defaultMessage:"Copy git apply"}),group:$e.Chat,keyboardBinding:[Oe.Mod,Oe.Shift,";"],enabled:!!F}]);const S=async()=>{F&&(await navigator.clipboard.writeText(" (cd \"$(git rev-parse --show-toplevel)\" && git apply --3way <<'EOF' \n".concat(F," \nEOF\n)")),w.success(y.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}),i!=null&&i.id&&(Be.recordGitAction("diff-copied",Q,$,c,i.id,"regular"),re.copyGitApply(c,i.id,!0)))},me=async()=>{F&&(await navigator.clipboard.writeText(F),w.success(y.formatMessage({id:"wham.whamTaskPageHeader.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}),i!=null&&i.id&&await re.copyGitApply(c,i.id,!1))},oe=async()=>{if(!N||!(i!=null&&i.id)){w.danger({id:"wham.whamTaskPageHeader.noPrToUpdate",defaultMessage:"No PR to update",description:"Toast when no PR is found to update"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_no_pr_to_update"});return}_(!0);try{await re.updatePr(c,i.id,N.id)}catch(m){_(!1),await re.getTaskTurnPR(c,N.assistant_turn_id),m instanceof Ge?Ye(m,i.id,y,w):w.danger({id:"wham.whamTaskPageHeader.failedToUpdatePr",defaultMessage:"Failed to update PR",description:"Toast when failed to update PR"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_failed_to_update_pr"})}finally{await f.refetchQueries({queryKey:["wham","tasks"]}),await f.refetchQueries({queryKey:["wham","task",c]}),_(!1)}},se=async m=>{if(!(i!=null&&i.id))return;R(m);const M=T.current;try{_(!0),await re.createPr(c,i.id,m),await f.refetchQueries({queryKey:["wham","task"]}),await f.fetchQuery(da(c,i.id)).then(B=>{const D=B;D.turn.pull_request_data!=null&&(M&&!M.closed&&D.turn.pull_request_data.url&&M.location.assign(D.turn.pull_request_data.url),Ut({title:D.task.title,clientThreadId:D.turn.conversation_id,subtitle:y.formatMessage({id:"wham.message.modal.footer.prCreatedSuccess",defaultMessage:"Click to view your pull request."}),onClick:()=>{var k;window.open((k=D.turn.pull_request_data)==null?void 0:k.url,"_blank")}}))}),Be.recordGitAction("pr-created",Q,$,c,i.id,m!=null?m:"regular")}catch(B){_(!1),M==null||M.close(),B instanceof Ge?Ye(B,i.id,y,w):w.danger({id:"wham.message.modal.footer.createPrError",defaultMessage:"Failed to create PR",description:"Error message for failed to create PR"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_failed_to_create_pr"})}},X=()=>{if(!(i!=null&&i.id))return;const m=g?"?mode=".concat(g):"";T.current=window.open("/codex/tasks/".concat(c,"/turns/").concat(i.id,"/pr").concat(m),"_blank")},J=!!qe(),A=!!x&&!!b&&x===b;return a.jsxs("div",{className:"border-b-token-border-default flex w-full justify-between gap-2 border-b p-3 transition-colors duration-50",children:[a.jsxs("div",{className:"flex min-w-0 flex-shrink max-md:gap-2",children:[e?a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"hover:bg-token-bg-tertiary group-radix-state-open:bg-token-bg-tertiary rounded-sm p-2 font-semibold",onClick:e,"aria-label":y.formatMessage({id:"wham.taskPageHeader.goBack",defaultMessage:"Go back to tasks"}),children:a.jsx(ro,{className:"icon-lg text-token-text-secondary"})}),a.jsx("div",{className:"bg-token-border-default my-auto ms-[11px] me-4 h-4 w-[1px] max-md:hidden"})]}):a.jsx("div",{className:"ms-3"}),a.jsx(io,{title:l,assistantTurn:t})]}),a.jsxs("div",{className:"relative flex h-10 items-center gap-1.5",children:[!1,s&&(t==null?void 0:t.id)&&A&&a.jsx(Za,{taskId:c}),le&&(J?a.jsx(Ke,{icon:d!=null&&d.archived?it:rt,onClick:()=>d!=null&&d.archived?Y():K(),disabled:L,"aria-label":d!=null&&d.archived?y.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelUnarchive",defaultMessage:"Unarchive Task"}):y.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelArchive",defaultMessage:"Archive Task"})}):a.jsx(ve,{color:"ghost",icon:d!=null&&d.archived?it:rt,loading:L,onClick:()=>d!=null&&d.archived?Y():K(),"aria-label":d!=null&&d.archived?y.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelUnarchive",defaultMessage:"Unarchive Task"}):y.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelArchive",defaultMessage:"Archive Task"}),children:d!=null&&d.archived?a.jsx(z,{id:"wham.whamTaskPageHeader.unarchive",defaultMessage:"Unarchive"}):a.jsx(z,{id:"wham.whamTaskPageHeader.archive",defaultMessage:"Archive"})})),o&&(t==null?void 0:t.id)&&a.jsx(to,{taskId:c,turnId:t==null?void 0:t.id,isDisabled:!1,title:l!=null?l:""}),r==="write"&&!J&&a.jsx(Pa,{taskId:c}),q.length>0&&!V&&a.jsx(_a,{isCreatingPr:v,assistantTurn:i,copyApplyToClipboard:S,copyPatchToClipboard:me,createPr:se,navigateToCreatingPrPage:X,canCreatePr:ee,updateBranch:Z?oe:void 0,permissions:r,showOnlyViewPr:h}),!J&&!h&&a.jsx(Ma,{})]})]})}function lo({focusedAssistantTurn:t,showFullDiff:e,currentDiffTaskTurn:o}){if(!t)return[];const s=!e;if(_e(t,s).length>0)return Ee({assistantTurn:t,followUp:s});if(_e(t,!1).length>0)return Ee({assistantTurn:t,followUp:!1});if(_e(t,!0).length>0)return Ee({assistantTurn:t,followUp:!0});if(!o||o.id===t.id)return[];const c=_e(o,!1),d=_e(o,!0);if(c.length===0&&d.length===0)return[];const i=c.length===0&&d.length>0;return Ee({assistantTurn:o,followUp:i})}const co=pe(()=>fe(()=>import("./ghewn7l2ynbm32fm.js").then(t=>t.vJ),__vite__mapDeps([4,1,5])),{loading:t=>be(t)}),nt=new Set,mo=pe(()=>fe(()=>import("./gwr2pvbuyyllrq8x.js"),__vite__mapDeps([2,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])).then(t=>t.WhamTaskPageCodeDiffContent),{loading:()=>a.jsx("div",{className:"flex-1"})});function Fo({turnId:t,permissions:e,confirmClose:o,setConfirmClose:s,handleClose:r,showForkButton:l,loadingTurnMapping:h,isSharedExampleTask:c=!1}){"use no forget";var ie,he,ue;const{taskId:d,task:i,focusedAssistantTurn:n,pastTurns:x,canFollowUp:b,currentDiffTaskTurn:v}=Fe(),{comments:_,clearComments:g,setComments:R}=Ae(),w=ge(),{data:f,isLoading:y}=ma(),F=De(),[j,O]=p.useState(void 0),u=p.useMemo(()=>_e(n,!0).length>0,[n]),[E,U]=ta(aa.WhamShowFullDiff,!u,Vt),P=p.useMemo(()=>lo({focusedAssistantTurn:n,showFullDiff:E,currentDiffTaskTurn:v}),[n,E,v]),N=p.useMemo(()=>n?n.output_items.filter(m=>m.type==="message").flatMap(m=>m.content).filter(m=>m.content_type==="image_asset_pointer_citation").map(m=>({content_type:"image_asset_pointer_citation",asset_pointer:m.asset_pointer,width:m.width,height:m.height,size_bytes:m.size_bytes})):[],[n]),Q=(n==null?void 0:n.turn_status)==="failed",$=N.length>0,q=P.length>0,G=mt(x),ee=i?(ie=i.title)!=null?ie:w.formatMessage({id:"wham.whamTaskPageContentLoaded.newTask",defaultMessage:"New Task"}):null,V=Pe(),W=!!qe(),H=W||(f==null?void 0:f.git_diff_mode)==="unified",ne=Je(),le=Ce(ne,"3673716873");p.useEffect(()=>{const m=n==null?void 0:n.id;m&&!nt.has(m)&&(n==null?void 0:n.turn_status)==="completed"&&(nt.add(m),re.markTurnViewed(d,m))},[n==null?void 0:n.id,d,n==null?void 0:n.turn_status]);const{mutate:te}=Me({mutationFn:m=>re.updateUserPreferences(m),onSuccess:async()=>{await ha(F)},onError:()=>{V.danger(dt({id:"wham.whamTaskPageContentLoaded.failedToUpdatePreferences",defaultMessage:"Failed to update preferences"}),{toastId:"wham_task_page_content_loaded_failed_to_update_preferences"})}}),ce=m=>{te({diffView:m?"unified":"split"})},ae=$?"preview":W?"chat":q?"diff":void 0,[Z,T]=p.useState(!1);!Z&&i&&(T(!0),O(ae));const K=n!=null&&n.turn_status?gt(n==null?void 0:n.turn_status):null,de=p.useRef(!1),Y=p.useRef({}),C=(he=n==null?void 0:n.id)!=null?he:t,L=p.useCallback(m=>Y.current[m],[]),S=p.useCallback((m,M)=>{Y.current[m]=M},[]),me=p.useMemo(()=>({versionKey:C,getOpenState:L,setOpenState:S}),[C,L,S]);p.useEffect(()=>{K===!1?de.current=!0:K===!0&&de.current&&q&&O("diff")},[K]);const oe=p.useMemo(()=>{var m,M,B,D;if(Q&&(n!=null&&n.environment_id)&&(n!=null&&n.branch)){const k=[...x].reverse().find(ye=>ye.type==="user"),xe=(m=k==null?void 0:k.input_items.find(ye=>ye.type==="message"))==null?void 0:m.content.find(ye=>ye.content_type==="text"),ke=xe==null?void 0:xe.text,He=k==null?void 0:k.input_items.filter(ye=>ye.type==="comment"),kt=((B=(M=n==null?void 0:n.sibling_turn_ids)==null?void 0:M.length)!=null?B:0)+1,Ct=ra((D=k==null?void 0:k.input_items)!=null?D:[]);return{environmentId:n==null?void 0:n.environment_id,branch:n==null?void 0:n.branch,previousTurnId:k==null?void 0:k.previous_turn_id,prompt:ke!=null?ke:"",comments:He!=null?He:[],bestOfN:kt,attachments:Ct}}},[Q,n,x]),{attemptIndex:se,siblings:X}=p.useMemo(()=>{if(!n)return{attemptIndex:null,hasSiblingTurns:!1};const m=x.filter(B=>{var D;return Le(B)&&!!((D=B.sibling_turn_ids)!=null&&D.includes(n.id))}),M=m.findIndex(B=>B.id===n.id);return{attemptIndex:M===-1?null:M+1,siblings:m}},[n,x]),J=e==="write"?a.jsx(Ka,{turnId:(ue=n==null?void 0:n.id)!=null?ue:t,comments:_,clearComments:g,focusedAssistantTurn:n,lastTurn:G,retry:oe,attemptIndex:se,siblings:X!=null?X:[]}):null,A=a.jsx(Ra,{currentTab:j,permissions:e,onClickFile:()=>O("diff"),onTabChange:m=>O(m),showFullDiff:E,loadingTurnMapping:h,footer:J}),I=a.jsx(at.Provider,{value:me,children:a.jsx(Da,{currentTab:j,setCurrentTab:m=>O(m),defaultTab:ae,isMobile:W,hasDiff:q,previewImages:N,diffFiles:P,unifiedDiff:H,handleDiffModeChange:ce,showFullDiff:E,setShowFullDiff:U,isPreferencesLoading:y,isSharedExampleTask:c,focusedAssistantTurn:n,leftContent:A})});return a.jsxs(a.Fragment,{children:[a.jsxs(ht.div,Se(je({className:we("relative flex size-full flex-1 flex-col items-center",W?"[--right-bg:var(--bg-primary)]":"[--right-bg:var(--bg-tertiary)] dark:[--right-bg:black]")},Qt),{children:[a.jsx(no,{title:ee,focusedAssistantTurn:n,onClose:r?()=>r==null?void 0:r({force:!0}):void 0,permissions:e,shouldShowShare:le&&e==="write",shouldShowFork:!!l,isSharedExampleTask:c}),a.jsx("div",{className:"bg-token-bg-primary flex min-h-0 w-full flex-1",children:!i||!Z?a.jsx(oa,{}):W?I:a.jsx(va,{leftContent:A,rightContent:c&&q?a.jsx("div",{className:"relative h-full w-full bg-[var(--right-bg)]",children:a.jsx(at.Provider,{value:me,children:a.jsx(mo,{diffFiles:P,unifiedDiff:H,enableComments:b,comments:_,setComments:R})})}):j?a.jsxs("div",{className:"relative h-full w-full bg-[var(--right-bg)]",children:[I,a.jsx($t,{className:"absolute end-3 top-2.5",icon:a.jsx(co,{}),label:w.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:()=>O(void 0)})]}):void 0})})]})),o&&s&&r&&a.jsx(na,{setConfirmClose:s,handleClose:r})]})}function Eo({taskId:t,task:e,currentUserTurn:o,currentAssistantTurn:s}){var n,x,b,v;const r=We(_=>_.addTurnToTaskMap),l=We(_=>_.getTurnsForTask),[h,c]=p.useState((x=(n=s==null?void 0:s.id)!=null?n:e==null?void 0:e.current_turn_id)!=null?x:null);p.useEffect(()=>{var _;t&&(s&&["pending","in_progress","failed"].includes(s.turn_status)?c(s.id):c((_=s==null?void 0:s.id)!=null?_:null),o&&r(t,o),s&&r(t,s))},[s,o,t,r]);const d=l(t!=null?t:"");let i=(v=(b=d==null?void 0:d.filter(_=>_.type==="assistant"))==null?void 0:b.find(_=>_.id===h))!=null?v:null;return i||(i=s),{focusedAssistantTurn:i,setFocusedAssistantTurnId:c}}function Ro({focusedAssistantTurn:t,pastTurns:e,currentDiffTaskTurnId:o}){if(!t)return null;if(Qe(t))return t;const s=ho(e);if(o){const l=s.get(o);if(l&&Le(l)&&Qe(l))return l}let r=lt(t,s);for(;r;){const l=s.get(r);if(!l||!Le(l))return null;if(Qe(l))return l;r=lt(l,s)}return null}function Qe(t){return _e(t,!1).length>0||_e(t,!0).length>0}function ho(t){const e=new Map;for(const o of t)e.set(o.id,o);return e}function lt(t,e){var s,r;const o=e.get((s=t.previous_turn_id)!=null?s:"");return o&&(r=o.previous_turn_id)!=null?r:null}export{Lo as T,No as W,Fe as a,Eo as b,Fo as c,Ro as g,Ae as u};
//# sourceMappingURL=ou9nacxkrsdx0eej.js.map
