var at=Object.defineProperty,ot=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var M=(t,e,n)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,F=(t,e)=>{for(var n in e||(e={}))rt.call(e,n)&&M(t,n,e[n]);if(W)for(var n of W(e))ct.call(e,n)&&M(t,n,e[n]);return t},H=(t,e)=>ot(t,it(e));import{r as m,m as lt,e as dt,j as c}from"./i8clt0mfz495j7ii.js";import{u as S,a as j,hl as ut,w as U,qQ as mt,cH as Y,bO as w,cI as ht,eR as pt,ht as ft,jz as xt,hv as K,el as Ct,aW as gt,qR as vt,aV as T}from"./ghewn7l2ynbm32fm.js";import{bq as P,n7 as Tt,n8 as X,fe as It,C as I,n9 as wt,na as bt,kO as Et,nb as St,nc as yt,nd as _t,ne as At,n6 as Rt,nf as Nt,ng as Dt,nh as Ft,ni as z,nj as $,n4 as Ot,u as jt,f8 as k,nk as G,aP as V,nl as q,nm as Pt,nn as kt,es as Lt,no as Wt}from"./j0yo6uv6652vva62.js";import{L as Mt}from"./lo4w8zafp8iqjpvk.js";import{T as Ht}from"./lbjflerr8tmfc11q.js";import{g as Ut}from"./bj1ejin6tzi0v3v8.js";import"./ce3hgmw4iyyhicud.js";import"./mstl8wgfzorpgdoe.js";import"./pc7u7c6vz2ia5xux.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./jh95iaetowvobxaf.js";import"./dxyrjy681bkwlnj8.js";import"./mqebxepg7t6q2tie.js";import"./deakbbf27g8e7ba0.js";import"./omoqxnq6po1pmb00.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./hu1kfuw35sk0pi95.js";import"./ixwp0fvcs3jhuh48.js";import"./o564tkn3ln8nzryq.js";import"./ns51nblw8ziscsgd.js";import"./drmwaklva7v056il.js";import"./6ji8ehbh56ghw0zw.js";import"./cb0ba83bmi83mjz2.js";import"./f76gy0b8ieo4s693.js";import"./icuos2x1zai4tnyd.js";import"./iakvhqfu6nmvphq6.js";import"./kiv50zw1ij6k8vyj.js";import"./gdq1l97elemowxcc.js";import"./inhyojyded8f1i4q.js";import"./e4uyedc9wylrl0pu.js";import"./f5qlxxpahyz6p72m.js";import"./jdfzk1zd468oela3.js";import"./l2r1du6tfxyv7jaj.js";import"./ln88gzx578175chd.js";import"./hlon4mihnqp86jji.js";import"./b6hyii2315xk7j19.js";import"./olrcssu7duieo6m7.js";import"./irqko7c1s7qpl41n.js";import"./1u88i8jf4mwk3mc5.js";import"./mpzbsmypy64alaao.js";import"./fvjpw0lui4wq7vv3.js";import"./kgnykbdth8mb50na.js";import"./g8i6bixylsxyemsr.js";import"./pajs134rv9yn6t4z.js";const B="oai/apps/canmoreSidebarWidth",zt=.25,Gt=400,Q=400;function J(t){return t-Gt}function R(t,e){return mt(Q,J(t),e!=null?e:zt*t)}function Vt(){const t=S(),e=j(()=>P(t).width),n=R(e,ut(U.DANGER_SECRET_FOLDERS_ONLY_getItem(B))),o=Z(),[s,r]=m.useState(n);m.useEffect(()=>{(s<Q||s>J(e))&&r(R(e,s))},[e]);function l(u){r(f=>R(e,f+=u.delta.x))}function i(u){r(u),U.DANGER_SECRET_FOLDERS_ONLY_setItem(B,u)}function d(){const u=R(e,void 0);i(u)}const a="calc(100vw - ".concat(s,"px)");return o?{chatWidth:s,canvasWidth:e-s,canvasWidthCalc:a,viewportWidth:e,handleDrag:l,handleDoubleClick:d,persist:i}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function Z(t){const e=S();return j(()=>(t!=null?t:P(e).width)>1e3)}const O="sharedCanvas";function qt(){const[t,e]=lt(),n=t.get(O),o=dt();m.useEffect(()=>{const s=n&&Tt.createRemixTempTextdoc(n,o);if(!s)return;requestAnimationFrame(()=>{X(s)});const r=new URLSearchParams(t);r.delete(O),e(r);const l=new URL(window.location.href);l.searchParams.delete(O),history.replaceState(null,"",l)},[n,t,e,o])}const Bt="textdocId",Yt=t=>{const n=new URLSearchParams(window.location.search).get(Bt),o=Y(t,s=>{var r,l,i;return(i=(l=(r=w.findNode(s,({message:d})=>{var u;const a=(u=d.metadata)==null?void 0:u.canvas;return(a==null?void 0:a.create_source)===It.HIVE&&(n?(a==null?void 0:a.textdoc_id)===n:!0)}))==null?void 0:r.message.metadata)==null?void 0:l.canvas)==null?void 0:i.textdoc_id});m.useEffect(()=>{o&&requestAnimationFrame(()=>{X(o)})},[o])};function Kt(t,e){let n;return(e==null?void 0:e.type)===I.Textdoc&&(e.textdocId.startsWith(wt)||(n={type:"canvas_textdoc",id:e.textdocId})),bt(t,{promptMessage:{metadata:{open_in_canvas_view:n}}})}const tt=({isFullScreen:t=!1,clientThreadId:e,focusedObject:n,onClose:o,isAnimating:s=!1,width:r})=>{const{setTargetedContent:l}=Et(),i=m.useRef(!1);if(m.useEffect(()=>(i.current&&l(void 0),i.current=!0,()=>{i.current=!1}),[n]),n==null)return null;switch(n.type){case I.Textdoc:return c.jsx(Ht,{isFullScreen:t,onClose:o,clientThreadId:e,focusedTextdoc:n,isAnimating:s,width:r});case I.ADAVisualization:return null}},Xt=300,$t=t=>{switch(t==null?void 0:t.type){case I.Textdoc:return t.textdocId;default:return null}};function Qt({clientThreadId:t,isDisabled:e,disabledTypes:n}){const[o,s,r,l,i]=Y(t,p=>[w.getRequestId(p),w.getConversationLastTurn(p),w.isMessageTurnEnded(p),w.getVariantIds(p).length>1,w.lastUserMessage(p)],{disablePerfDetector:!0}),d=ht(o),a=St(),[u,f]=m.useMemo(()=>{if(s&&l)return[void 0,null];if(e===!0)return[void 0,null];if(i!=null){const h=yt(i);if(h)return[i.id,{type:I.Textdoc,textdocId:h}]}let p;return!r&&s&&(p=pt(s.messageGroups,h=>h.type!==ft)),Jt({groupedMessage:p,isRequestActive:d,latestTextdocId:a,disabledTypes:n})},[r,s,l,e,d,a,n,i]),y=f!=null,b=$t(f),D=_t("canvas");m.useEffect(()=>{if(f&&u&&!xt()&&(D(),At(f,u),f.type===I.Textdoc)){const{textdocId:p}=f,h=Ut(p);Rt(document.getElementById(h))}},[y,b])}function Jt({groupedMessage:t,isRequestActive:e,latestTextdocId:n,disabledTypes:o}){var s,r;if(t!=null&&t.type&&o.includes(t.type))return[void 0,null];switch(t==null?void 0:t.type){case K.Canmore:{const[l,i]=t.messages;if(!Nt(l))break;const d=Dt(e,l,i!=null?i:null),a=(s=d.textdocId)!=null?s:n;if(a&&(d.function===Ft.CreateTextdoc?((r=d.content)!=null?r:"").length>Xt||d.status===z.WAITING:d.status===z.STREAMING))return[d.messageId,{type:I.Textdoc,textdocId:a}];break}}return[void 0,null]}const N={bounce:.12,duration:.64},Zt={bounce:0,duration:.58},C={duration:0},te=({clientThreadId:t,focusedObject:e,onClose:n})=>{const o=S(),{chatWidth:s,canvasWidthCalc:r,handleDrag:l,handleDoubleClick:i,persist:d}=Vt(),a=k(o),[u,f]=m.useState(!a),[y,b]=m.useState(!1),D=a?C:N,p=a?C:Zt,h=Pt(({rect:v})=>v),{height:E,width:_}=j(()=>P(o));let x=h!=null?h:{top:0,left:s,width:_-s,height:E},L=!1;if(h&&(x.top<0||x.top+x.height>E)){L=!0;const v={width:(_-s)*.75,height:E*.75};x={top:E/2-v.height/2,left:(_-s-v.width)/2+s,width:v.width,height:v.height}}const A=h==null?void 0:h.borderRadius,g=kt(),et=(g==null?void 0:g.history)!=null||(g==null?void 0:g.showChangesAtVersion)!=null,st=Lt();return c.jsxs(c.Fragment,{children:[et&&c.jsx(Mt,{onClick:()=>Wt(g.textdocId),zIndexKey:"chatOverlay"}),c.jsxs(T.div,{initial:{marginInlineEnd:st?-260:0},animate:{marginInlineEnd:0},transition:p,children:[c.jsx(T.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:a?C:H(F({},N),{delay:.22}),className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),c.jsx(T.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:a?C:{bounce:0,duration:.1}})]}),c.jsx(T.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:{borderRadius:A,opacity:L?0:1,x:x.left,y:x.top,height:x.height,width:x.width},animate:{opacity:1,x:s,y:0,width:r,height:E,borderRadius:0},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:a?C:{opacity:{duration:.14,bounce:.1}},borderRadius:A},transition:y||a?C:N,onAnimationComplete:()=>f(!1),children:c.jsx(T.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:{borderRadius:A},animate:{borderRadius:0},exit:{borderRadius:A},transition:D,children:c.jsxs("div",{className:"h-full",children:[c.jsx(T.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:a?C:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>b(!0),onPointerUp:()=>b(!1),onDrag:(v,nt)=>l(nt),onDragEnd:()=>{b(!1),d(s)},onDoubleClick:()=>i()}),y&&c.jsx("div",{className:"absolute inset-0 z-10"}),c.jsx(tt,{onClose:n,clientThreadId:t,isAnimating:!a&&u,focusedObject:e,width:_-s})]})})})]})},ee=m.memo(te),se=({clientThreadId:t,focusedObject:e,onClose:n})=>{const o=S(),s=k(o);return c.jsx(vt,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:c.jsx(T.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:s?C:N,children:c.jsx(tt,{isFullScreen:!0,clientThreadId:t,focusedObject:e,onClose:n})})})},ne=({clientThreadId:t,overrideWidth:e,isAutoFocusDisabled:n=!1})=>{const o=S(),s=jt(),r=Z(e),l=k(o);Qt({clientThreadId:t,isDisabled:n,disabledTypes:l?[K.Canmore]:[]}),qt(),Yt(t);const i=m.useRef(!1);m.useEffect(()=>{i.current?$():i.current=!0},[t]);const d=s&&(r?c.jsx(ee,{clientThreadId:t,onClose:q,focusedObject:s},"canvas-sidebar"):c.jsx(se,{clientThreadId:t,onClose:q,focusedObject:s},"canvas-modal"));m.useEffect(()=>{if(s)return G(u=>Kt(u,s)),()=>G(null)},[s]);const a=d!=null;return m.useEffect(()=>(V.setActiveStageSidebar(a),()=>{a&&V.setActiveStageSidebar(!1)}),[a]),l?d:c.jsx(gt,{children:d},t)},Je=t=>{const e=m.useRef(null);return c.jsx(Ct,{ref:e,onError:(n,o)=>{$(),setTimeout(()=>{var s;(s=e.current)==null||s.resetErrorBoundary()}),Ot.logError("Error boundary hit",n,{componentStack:o})},name:"canmore-focused-view",children:c.jsx(ne,F({},t))})};export{Je as CanvasFocusedViewManager};
//# sourceMappingURL=nh47jjy84g9yfx3d.js.map
