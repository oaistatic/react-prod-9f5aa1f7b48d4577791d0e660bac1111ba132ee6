const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cwvii49m4h3oz7sn.js","assets/i8clt0mfz495j7ii.js","assets/1zc8cfpus30jg7jo.js"])))=>i.map(i=>d[i]);
var tt=Object.freeze,nt=Object.defineProperty,At=Object.defineProperties;var Nt=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var It=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var rt=a=>{throw TypeError(a)};var st=(a,t,s)=>t in a?nt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,R=(a,t)=>{for(var s in t||(t={}))It.call(t,s)&&st(a,s,t[s]);if(at)for(var s of at(t))Pt.call(t,s)&&st(a,s,t[s]);return a},te=(a,t)=>At(a,Nt(t));var it=(a,t,s)=>t.has(a)||rt("Cannot "+s);var m=(a,t,s)=>(it(a,t,"read from private field"),s?s.call(a):t.get(a)),ae=(a,t,s)=>t.has(a)?rt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,s),se=(a,t,s,e)=>(it(a,t,"write to private field"),e?e.call(a,s):t.set(a,s),s);var ot=(a,t)=>tt(nt(a,"raw",{value:tt(t||a.slice())}));import{F as Et,C as ht,M as Ne,b1 as Ft,u as Tt,z as Lt,p as Rt,B as Fe,eo as mt,P as Ut,S as Bt,o as pt,L as vt,ed as Dt,d as me,cG as ue,cF as fe,e as xt,a5 as qt,cq as $t,tw as Ot,cv as zt,cx as Wt}from"./ghewn7l2ynbm32fm.js";import{r as B,e as xe,j as n,M as pe,_ as yt,L as Gt,c as ke,l as kt,b as Te,u as bt}from"./i8clt0mfz495j7ii.js";import{P as lt,ex as Vt,d$ as Ht,o as Qt,x as U}from"./j0yo6uv6652vva62.js";import{d as Kt}from"./mpzbsmypy64alaao.js";import{L as Yt,A as Jt}from"./fvjpw0lui4wq7vv3.js";import{r as Xt}from"./mewip4u74thselsp.js";var gt;const Ua=Et.div(gt||(gt=ot(["draggable no-draggable-children sticky top-0 p-3 flex items-center justify-between z-20 h-header-height font-semibold bg-token-bg-primary"])));function Ba(){const[a,t]=B.useState(!0),s=xe();return B.useEffect(()=>{try{typeof window<"u"&&window.localStorage.getItem("aardvarkDisclaimerAck")==="1"&&t(!1)}catch(e){}},[]),B.useEffect(()=>(globalThis.__aardvarkDisclaimerOpen=a,()=>{globalThis.__aardvarkDisclaimerOpen=!1}),[a]),n.jsx(ht,{testId:"modal-aardvark-disclaimer",isOpen:a,rootClassName:"z-[2000]",title:s.formatMessage({id:"aardvark.disclaimer.title",defaultMessage:"Aardvark Early Preview"}),size:"large",onClose:()=>{},shouldIgnoreClickOutside:!0,primaryButton:n.jsx(Ne.Button,{color:"primary",title:s.formatMessage({id:"aardvark.disclaimer.acknowledge",defaultMessage:"I understand"}),onClick:e=>{e.preventDefault(),e.stopPropagation();try{typeof window<"u"&&window.localStorage.setItem("aardvarkDisclaimerAck","1")}catch(i){}t(!1)}}),children:n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsx("p",{children:n.jsx(pe,{id:"aardvark.disclaimer.desc1",defaultMessage:"Aardvark is a code scanning tool developed by the OpenAI Security Products and Research team for detecting security bugs in code."})}),n.jsx("p",{children:n.jsx(pe,{id:"aardvark.disclaimer.desc2",defaultMessage:"This feature is only available internally and for select trusted external testers. Please do not share this with anyone outside of OpenAI."})}),n.jsx("p",{children:n.jsx(pe,{id:"aardvark.disclaimer.desc3",defaultMessage:"You can explore and manage findings on the Aardvark dashboard. This is a specialized tool, intended primarily for developers and security engineers."})}),n.jsx("p",{children:n.jsx(pe,{id:"aardvark.disclaimer.feedback",defaultMessage:"Have feedback? Please fill out the <link>feedback survey</link>.",values:{link:e=>n.jsx("a",{href:"https://forms.gle/arrj4MzLN1YqdR8S6",target:"_blank",rel:"noopener noreferrer",className:"underline",onClick:i=>{i.stopPropagation()},children:e})}})})]})})}function Zt(){const{isUnauthenticated:a}=Ft();return lt.markStart("AardvarkLoginOrProfileMenu"),lt.markRendered("AardvarkLoginOrProfileMenu"),a?n.jsx(Kt,{}):n.jsx(ea,{})}function ea(){const a=Tt(),t=Lt(a),s=xe(),{data:e}=Rt(),i=Fe();if(!t)return n.jsx("div",{className:"flex h-10 w-10 items-center justify-center",children:n.jsx("div",{className:"bg-token-bg-tertiary h-8 w-8 rounded-full"})});const o=e&&e.accountItems.length>1,r=!!i&&i.isWorkspaceAccount();return n.jsxs(mt,{triggerButton:n.jsx("button",{onClick:()=>{Ut.logEvent("Account: Open Profile Menu"),Bt.logEvent("chatgpt_account_open_profile_menu")},"aria-label":s.formatMessage({id:"aardvark.aardvarkProfile.openProfileMenu",defaultMessage:"Open Profile Menu"}),"data-testid":"profile-button",className:"text-token-text-secondary hover:text-token-text-primary hover:bg-token-interactive-bg-secondary-hover radix-state-open:text-token-text-secondary flex h-10 w-10 items-center justify-center rounded-full px-1 transition focus-visible:outline-0",children:n.jsx(Vt,{showPlanTypeBadge:!0})}),children:[n.jsx(Yt,{currentAccount:i}),(o||r)&&n.jsx(n.Fragment,{children:n.jsx(Jt,{accountSwitcherRedirectUrl:"/aardvark?refresh_account=true"})})]})}const ta=pt(()=>yt(()=>import("./cwvii49m4h3oz7sn.js"),__vite__mapDeps([0,1])),{loading:a=>vt(a)});function Da({className:a}){const t=!!Dt();return n.jsxs("div",{className:me(t?"grid w-full grid-cols-[1fr_auto_1fr] items-center gap-2":"sticky top-0 flex w-full justify-end py-3 ps-3 pe-1",a),children:[n.jsx("div",{className:me(t?"flex items-center gap-3 self-center":"absolute start-0 top-5 ms-2 flex items-center gap-3 self-center"),children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(ta,{className:"h-6 w-6"}),n.jsx(Gt,{to:"/aardvark",className:me("text-token-text-primary flex items-center gap-2 hover:cursor-pointer",!t&&"ms-[5px]"),children:n.jsx(pe,{id:"S7fvqc",defaultMessage:"Aardvark"})})]})}),n.jsx("div",{className:me("flex items-center gap-2",t&&"justify-end"),children:n.jsx(Zt,{})})]})}const aa={success:"bg-green-700/15 text-green-700 dark:bg-green-900/40 dark:text-green-300",warning:"bg-yellow-700/15 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-300",critical:"bg-red-700/15 text-red-700 dark:bg-red-900/60 dark:text-red-300",danger:"bg-red-500/15 text-red-500 dark:bg-red-500/15 dark:text-red-300",muted:"bg-token-bg-elevated-secondary text-token-text-tertiary dark:bg-token-bg-elevated-secondary/70 dark:text-token-text-tertiary",purple:"bg-purple-400/15 text-purple-400"};function sa(a){"use forget";const t=ke.c(7),{variant:s,children:e,className:i,size:o}=a,d=(o===void 0?"md":o)==="sm"?"px-1.5 py-0 text-[11px]":"px-2 py-0.5 text-xs",c=aa[s];let l;t[0]!==i||t[1]!==d||t[2]!==c?(l=me("inline-flex items-center rounded-full",d,c,i),t[0]=i,t[1]=d,t[2]=c,t[3]=l):l=t[3];let u;return t[4]!==e||t[5]!==l?(u=n.jsx("span",{className:l,children:e}),t[4]=e,t[5]=l,t[6]=u):u=t[6],u}function qa(a){return a.slice(0,7)}function $a(a){if(!a)return"";try{const t=new URL(a);if(t.pathname.endsWith(".git")&&(t.pathname=t.pathname.slice(0,-4)),t.hostname.includes("github.com")){const s=t.pathname.split("/").filter(Boolean);if(s.length>=2)return"".concat(s[0],"/").concat(s[1])}return t.hostname}catch(t){return a}}function Oa(a,t){if(!a)return null;try{const s=new URL(a.replace(/\.git$/,""));if(s.hostname.includes("github.com"))return"".concat(s.origin).concat(s.pathname,"/commit/").concat(t)}catch(s){}return null}function za(a){try{const t=typeof a=="string"?JSON.parse(a):a;if(t&&typeof t=="object"){const s=t,e={};return Array.isArray(s.relevant_lines)&&(e.relevant_lines=s.relevant_lines),typeof s.cvss_score=="number"&&(e.cvss_score=s.cvss_score),typeof s.criticality_cvss_reason=="string"&&(e.criticality_cvss_reason=s.criticality_cvss_reason),e}}catch(t){}return null}function Wa(a){if(!a)return"—";try{const t=new Date(a);return Number.isNaN(t.getTime())?"—":t.toLocaleString()}catch(t){return"—"}}function Ga(a){if(typeof a!="number"||!Number.isFinite(a))return"—";try{const t=new Date(a*1e3);return Number.isNaN(t.getTime())?"—":t.toLocaleString()}catch(t){return"—"}}const de={new:{id:"aardvark.status.new",defaultMessage:"New",description:"New status"},triaged:{id:"aardvark.status.triaged",defaultMessage:"Triaged",description:"Triaged status"},in_progress:{id:"aardvark.status.inProgress",defaultMessage:"In progress",description:"In progress status"},fixed:{id:"aardvark.status.fixed",defaultMessage:"Fixed",description:"Fixed status"},wontfix:{id:"aardvark.status.wontfix",defaultMessage:"Won't fix",description:"Won't fix status"},duplicate:{id:"aardvark.status.duplicate",defaultMessage:"Duplicate",description:"Duplicate status"}},na={critical:{id:"aardvark.crit.critical",defaultMessage:"Critical",description:"Critical severity"},high:{id:"aardvark.crit.high",defaultMessage:"High",description:"High severity"},medium:{id:"aardvark.crit.medium",defaultMessage:"Medium",description:"Medium severity"},low:{id:"aardvark.crit.low",defaultMessage:"Low",description:"Low severity"}},ra={none:{id:"aardvark.assignee.none",defaultMessage:"None",description:"None assignee option label"}},ct={search:{id:"aardvark.filter.assignee.search",defaultMessage:"Search by name or email",description:"Search assignees by name or email"}},Va={success:{id:"aardvark.proposedPatch.generation.validation.success",defaultMessage:"Success",description:"Badge label indicating the patch generation or validation is successful."},failed:{id:"aardvark.proposedPatch.generation.validation.failed",defaultMessage:"Failed",description:"Badge label indicating the patch generation or validation is failed."},pending:{id:"aardvark.proposedPatch.generation.validation.pending",defaultMessage:"Pending",description:"Badge label indicating the patch generation or validation is pending."},running:{id:"aardvark.proposedPatch.generation.validation.running",defaultMessage:"Running",description:"Badge label indicating the patch generation or validation is running."},unknown:{id:"aardvark.proposedPatch.generation.validation.unknown",defaultMessage:"Unknown",description:"Badge label indicating the patch generation or validation is unknown."}},Ha={security:{id:"aardvark.finding.signal.security",defaultMessage:"Security",description:"Security signal"},privacy:{id:"aardvark.finding.signal.privacy",defaultMessage:"Privacy",description:"Privacy signal"},validated:{id:"aardvark.finding.signal.validated",defaultMessage:"Validated",description:"Validated signal"}},ia=["application/json"];function oa(a){return ia.includes(a)}function je(a){const t={};for(const[s,e]of Object.entries(a))e!=null&&(t[s]="".concat(e));return t}function la(a,t){for(const[s,e]of Object.entries(t))a=a.replace("{".concat(s,"}"),e);return a}var K,ne,re,G,Y,J;const ve=class ve{constructor(t,s,e,i,o,r){ae(this,K);ae(this,ne);ae(this,re);ae(this,G);ae(this,Y);ae(this,J);var d;if(/\/+$/.test(e))throw new Error("The prefix is not allowed to have trailing slashes");if(/\/+$/.test(s))throw new Error("The baseUrl is not allowed to have trailing slashes");se(this,ne,e),se(this,J,s),se(this,re,i),se(this,G,o),se(this,K,t),se(this,Y,{fetchFn:(d=r==null?void 0:r.fetchFn)!=null?d:fetch.bind(globalThis)})}withProduces(t){return new ve(m(this,K),m(this,J),m(this,ne),t,m(this,G),m(this,Y))}withConsumes(t){return new ve(m(this,K),m(this,J),m(this,ne),m(this,re),t,m(this,Y))}withPrefix(t){return new ve(m(this,K),m(this,J),t,m(this,re),m(this,G),m(this,Y))}async _request(t,s,e,i){var f,h,k,g;let o=new URLSearchParams(je((f=e==null?void 0:e.query)!=null?f:{})).toString();o&&(o="?"+o);const r=m(this,J)+m(this,ne)+s,d=e==null?void 0:JSON.stringify(e.body),c=d?{"Content-Type":m(this,re)}:null,l=await m(this,Y).fetchFn(la(r,je((h=e==null?void 0:e.path)!=null?h:{}))+o,te(R({credentials:"same-origin"},i!=null?i:{}),{method:t,headers:te(R(R(te(R({},c!=null?c:{}),{Accept:m(this,G)}),(k=i==null?void 0:i.headers)!=null?k:{}),je((g=e==null?void 0:e.headers)!=null?g:{})),{"X-OpenAI-Client":m(this,K)}),body:d})),u=l.headers.get("Content-Type");if(!u)throw new Error("Content-Type was not provided with the response");if(!oa(u))throw new Error("Unsupported return content type ".concat(u));if(u!==m(this,G))throw new Error("Return content type ".concat(u," was provided but this client only accepts ").concat(m(this,G),"."));switch(u){case"application/json":const b=await l.json();return{status:l.status,data:b,raw:l}}}async get(t,...s){return await this._request("GET",t,...s)}async post(t,...s){return await this._request("POST",t,...s)}async put(t,...s){return await this._request("PUT",t,...s)}async patch(t,...s){return await this._request("PATCH",t,...s)}async delete(t,...s){return await this._request("DELETE",t,...s)}async head(t,...s){return await this._request("HEAD",t,...s)}};K=new WeakMap,ne=new WeakMap,re=new WeakMap,G=new WeakMap,Y=new WeakMap,J=new WeakMap;let Ie=ve;class ge extends Ie{constructor(t,s){super("aardvark",t,"","application/json","application/json",s)}}var ca=Xt();const da=kt(ca);function ua(a){const{data:t,isLoading:s,refetch:e,isFetching:i}=Te({queryKey:["aardvark","scan-configs",a!=null?a:"personal"],enabled:!0,queryFn:async()=>{var h;const c=new ge(ue,{fetchFn:(k,g)=>globalThis.fetch.call(globalThis,k,g)}),l={limit:1e3};return((h=(await c.get("/aardvark/scan_configurations",{headers:fe(),query:l})).data.items)!=null?h:[]).map(k=>{var g;return te(R({},k),{lookback_days:(g=k.lookback_days)!=null?g:null})})},refetchOnWindowFocus:!0}),{scanMap:o,configIdByRepo:r,configVersionById:d}=B.useMemo(()=>{const c=new Map,l=new Map,u=new Map;for(const f of t!=null?t:[])l.set(f.repo_id,f.id),u.set(f.id,f.version),c.set(f.repo_id,f);return{scanMap:c,configIdByRepo:l,configVersionById:u}},[t]);return{scanMap:o,configIdByRepo:r,configVersionById:d,isLoading:s||i,refetch:e}}function Qa(a,t,s){const e=["aardvark","scan-configs",a!=null?a:"personal"];s.setQueryData(e,i=>{const o=Array.isArray(i)?[...i]:[],r=da(o,d=>d.id===t.id);return r>=0?o[r]=t:o.push(t),o})}function Ka(a){var t;return(t=a.created_at)!=null?t:null}function fa(a){const t=a.status;return t==="fixed"?"Resolved":t==="wontfix"||t==="duplicate"?"Closed":"Open"}function Ya(a,t){return a?a.length<=t?a:a.slice(0,t-1)+"…":""}function Ja(a,t){var o;const s=decodeURIComponent(a),[e,i]=s.split("::");return(o=t.find(r=>{var d,c,l;return((c=(d=r.commit_analysis)==null?void 0:d.commit_hash)!=null?c:"")===e&&((l=r.repo_url)!=null?l:"")===(i!=null?i:"")}))!=null?o:null}function ga(a){return a?typeof a=="object"&&"proposed_patch"in a:!1}function be(a){return typeof a=="object"&&a!=null}function wt(a){if(!be(a))return;const t=a.detail;return typeof t=="string"?t:void 0}function Le(a){return be(a)?typeof a.id=="string"&&typeof a.hid=="string"&&typeof a.repo_id=="string"&&typeof a.status=="string":!1}function ha(a){if(!be(a))return{items:[]};const t=Array.isArray(a.items)?a.items.filter(Le):[],s=typeof a.total=="number"?a.total:void 0,e=typeof a.next_cursor=="string"?a.next_cursor:void 0;return{items:t,total:s,nextCursor:e}}function ma(a){var o,r,d;if(!be(a))return{items:[]};const t=c=>{if(typeof c=="number")return Number.isFinite(c)?c:null;if(typeof c=="string"){const l=Number(c);return Number.isFinite(l)?l:null}return null},s=[],e=t(a.ranking_end_time),i=a.ranking_item_list;if(Array.isArray(i))for(const c of i){if(!Le(c))continue;const l=c,u=c.ranking_reason,f=c.ranking_score,h=c.ranking_end_time,k=(d=(r=(o=t(h))!=null?o:t(l.ranking_end_time))!=null?r:e)!=null?d:null,g=typeof u=="string"?u:u===null?null:l.ranking_reason,b=typeof f=="number"?f:f===null?null:l.ranking_score;s.push(te(R({},l),{ranking_reason:g,ranking_score:b,ranking_end_time:k}))}return{items:s,total:s.length,ranking_end_time:e!=null?e:null}}function Xa(a,t,s){"use forget";var V,ye,Re,Ue,Be,De,qe;const e=ke.c(57),i=t===void 0?!0:t;let o;e:{if(!a){let _;e[0]===Symbol.for("react.memo_cache_sentinel")?(_={repoCsv:"",validationFilter:"all",recommended:!1,statusesCsv:"",critCsv:"",assigneesCsv:"",assigneeEmailsCsv:"",authorsCsv:"",sortParam:""},e[0]=_):_=e[0],o=_;break e}let v,D,T,z,P,q,H,$,O;if(e[1]!==a){const _=new URLSearchParams(a),le=_.get("repo");O=le!=null?le:"";const ce=_.get("validated");$=ce==="true"?"validated":ce==="false"?"unvalidated":"all",P=_.get("recommended")==="true",q=(V=_.get("status"))!=null?V:"",z=(ye=_.get("criticality"))!=null?ye:"",D=(Re=_.get("assignee"))!=null?Re:"",v=(Ue=_.get("assignee_email"))!=null?Ue:"",T=(Be=_.get("author"))!=null?Be:"",H=(De=_.get("sort"))!=null?De:"",e[1]=a,e[2]=v,e[3]=D,e[4]=T,e[5]=z,e[6]=P,e[7]=q,e[8]=H,e[9]=$,e[10]=O}else v=e[2],D=e[3],T=e[4],z=e[5],P=e[6],q=e[7],H=e[8],$=e[9],O=e[10];const ee=H;let Q;e[11]!==v||e[12]!==D||e[13]!==T||e[14]!==z||e[15]!==P||e[16]!==ee||e[17]!==q||e[18]!==$||e[19]!==O?(Q={repoCsv:O,validationFilter:$,recommended:P,statusesCsv:q,critCsv:z,assigneesCsv:D,assigneeEmailsCsv:v,authorsCsv:T,sortParam:ee},e[11]=v,e[12]=D,e[13]=T,e[14]=z,e[15]=P,e[16]=ee,e[17]=q,e[18]=$,e[19]=O,e[20]=Q):Q=e[20],o=Q}const{repoCsv:r,validationFilter:d,recommended:c,statusesCsv:l,critCsv:u,assigneesCsv:f,assigneeEmailsCsv:h,authorsCsv:k,sortParam:g}=o,b=s==null?void 0:s.limit,x=s==null?void 0:s.cursor,y=Fe();let w;e[21]!==y?(w=y==null?void 0:y.getWorkspaceId(),e[21]=y,e[22]=w):w=e[22];const I=w,{scanMap:S}=ua(I);let E;if(e[23]!==r||e[24]!==S){e:{if(!r){E=void 0;break e}const v=r.split(",").map(_a).filter(wa);if(v.length===0){E=void 0;break e}const[D]=v;for(const T of S.values())if(((qe=T.repo_url)!=null?qe:"").trim()===D){E=T.id;break e}E=void 0}e[23]=r,e[24]=S,e[25]=E}else E=e[25];const F=E,X=c&&!F,ie=F!=null?F:null,oe=b!=null?b:null,p=x!=null?x:null,C=g||null;let M;e[26]!==h||e[27]!==f||e[28]!==k||e[29]!==u||e[30]!==c||e[31]!==r||e[32]!==l||e[33]!==ie||e[34]!==oe||e[35]!==p||e[36]!==C||e[37]!==d?(M=["aardvark","findings",r,ie,d,c,l,u,f,h,k,oe,p,C],e[26]=h,e[27]=f,e[28]=k,e[29]=u,e[30]=c,e[31]=r,e[32]=l,e[33]=ie,e[34]=oe,e[35]=p,e[36]=C,e[37]=d,e[38]=M):M=e[38];let A;e[39]!==h||e[40]!==f||e[41]!==k||e[42]!==F||e[43]!==u||e[44]!==x||e[45]!==b||e[46]!==c||e[47]!==r||e[48]!==X||e[49]!==g||e[50]!==l||e[51]!==d?(A=async()=>{if(X)return;const v={},D=typeof b=="number"&&Number.isFinite(b)&&b>0?b:500,T=typeof x=="number"&&Number.isFinite(x)&&x>=0,z=T?x:0,P=ya,q=r?P(r):[],H=l?P(l):[],$=u?P(u):[],O=f?P(f):[],ee=h?P(h):[],Q=k?P(k):[],_=new Set(H),le=new Set($),ce=new Set(O),$e=new Set(ee.map(xa)),Oe=new Set(Q.map(va)),L=c&&!!F;L||(v.limit=String(D),T&&(v.cursor=String(z))),q.length>0&&!L&&(v.repo=q.join(",")),d==="validated"?v.validated="true":d==="unvalidated"&&(v.validated="false"),!L&&c&&(v.recommended="true"),!L&&g&&(v.sort=g),H.length>0&&!L&&(v.status=H.join(",")),$.length>0&&!L&&(v.criticality=$.join(",")),O.length>0&&!L&&(v.assignee=O.join(",")),ee.length>0&&!L&&(v.assignee_email=ee.join(",")),Q.length>0&&!L&&(v.author=Q.join(","));const _t=new ge(ue,{fetchFn:pa}),Mt=L&&F?{configured_scan_id:F}:v,he=await _t.get(L?"/aardvark/rankings":"/aardvark/scan-findings",{headers:fe(),query:Mt});if(he.status>=400){const ze=wt(he.data);throw new Error("Failed to load findings: ".concat(ze," (").concat(he.status,")"))}if(L){const We=ma(he.data).items.filter(W=>{var He,Qe,Ke,Ye,Je,Xe,Ze,et;if(q.length>0){const N=((He=W.repo_url)!=null?He:"").trim();if(!q.includes(N))return!1}if(_.size>0){const N=fa(W);if(!(_.has(W.status)||_.has("open")&&N==="Open"||_.has("closed")&&N==="Closed"||_.has("resolved")&&N==="Resolved"))return!1}if(le.size>0&&!le.has(W.criticality)||d==="validated"&&((Qe=W.commit_analysis)==null?void 0:Qe.validated)!==!0||d==="unvalidated"&&((Ke=W.commit_analysis)==null?void 0:Ke.validated)===!0)return!1;if(ce.size>0){const N=(Ye=W.assignee_id)!=null?Ye:"",Me=typeof N=="string"?N.trim():"",Ct=ce.has("none");if(Me){if(!ce.has(Me))return!1}else if(!Ct)return!1}if($e.size>0){const N=((Xe=(Je=W.assignee)==null?void 0:Je.email)!=null?Xe:"").toLowerCase();if(!N||!$e.has(N))return!1}if(Oe.size>0){const N=((et=(Ze=W.commit_analysis)==null?void 0:Ze.author_email)!=null?et:"").toLowerCase();if(!N||!Oe.has(N))return!1}return!0}),Ge=We.length,Ve=Math.max(0,z),_e=Ve+D,jt=We.slice(Ve,_e),St=_e<Ge?String(_e):void 0;return{items:jt,total:Ge,next_cursor:St}}const we=ha(he.data);return{items:we.items,total:we.total,next_cursor:we.nextCursor}},e[39]=h,e[40]=f,e[41]=k,e[42]=F,e[43]=u,e[44]=x,e[45]=b,e[46]=c,e[47]=r,e[48]=X,e[49]=g,e[50]=l,e[51]=d,e[52]=A):A=e[52];const j=i&&!X;let Z;return e[53]!==j||e[54]!==M||e[55]!==A?(Z={queryKey:M,queryFn:A,staleTime:3e4,refetchOnWindowFocus:!0,enabled:j},e[53]=j,e[54]=M,e[55]=A,e[56]=Z):Z=e[56],Te(Z)}function pa(a,t){return globalThis.fetch.call(globalThis,a,t)}function va(a){return a.toLowerCase()}function xa(a){return a.toLowerCase()}function ya(a){return a.split(",").map(ba).filter(ka)}function ka(a){return a&&a.toLowerCase()!=="all"}function ba(a){return a.trim()}function wa(a){return a&&a.toLowerCase()!=="all"}function _a(a){return a.trim()}function Za(a,t){"use forget";const s=ke.c(8),e=t===void 0?!0:t,i=a!=null?a:null;let o;s[0]!==i?(o=["aardvark","finding",i],s[0]=i,s[1]=o):o=s[1];let r;s[2]!==a?(r=async()=>{if(!a)return;const u=await new ge(ue,{fetchFn:ja}).get("/aardvark/scan-findings/".concat(encodeURIComponent(a)),{headers:fe()});if(u.status>=400){const f=wt(u.data);throw new Error("Failed to load finding: ".concat(f," (").concat(u.status,")"))}return Le(u.data)?u.data:void 0},s[2]=a,s[3]=r):r=s[3];const d=e&&!!a;let c;return s[4]!==o||s[5]!==r||s[6]!==d?(c={queryKey:o,queryFn:r,staleTime:3e4,refetchInterval:Ma,refetchIntervalInBackground:!0,refetchOnWindowFocus:!0,enabled:d},s[4]=o,s[5]=r,s[6]=d,s[7]=c):c=s[7],Te(c)}function Ma(a){const t=a.state.data,s=ga(t)?t.proposed_patch:void 0;return s?s.status!=="finished"?5e3:s.status==="finished"&&s.success!==!0?1e4:!1:!1}function ja(a,t){return globalThis.fetch.call(globalThis,a,t)}function Pe(a,t,s){a.setQueriesData({queryKey:["aardvark","findings"],exact:!1},e=>{var o;if(!e)return e;const i=((o=e.items)!=null?o:[]).map(r=>r.hid===t?R(R({},r),s):r);return te(R({},e),{items:i})})}function Ee(a,t,s){a.setQueryData(["aardvark","finding",t],e=>e&&R(R({},e),s))}const Se=pt(()=>yt(()=>import("./1zc8cfpus30jg7jo.js").then(a=>a._),__vite__mapDeps([2,1])),{loading:a=>vt(a)});function dt({name:a,email:t}){var o;const s=(a!=null?a:"").trim();if(s.length>0){const r=s.split(/\s+/).filter(Boolean);return r.length>=2?(r[0][0]+r[r.length-1][0]).toUpperCase():r[0].slice(0,2).toUpperCase()}const e=(o=(t!=null?t:"").split("@")[0])!=null?o:"";if(!e)return"?";const i=e.split(/[._-]+/).filter(Boolean);return i.length>=2?(i[0][0]+i[1][0]).toUpperCase():e.slice(0,2).toUpperCase()}function es({finding:a}){var E,F,X,ie,oe;const t=bt(),s=xt(),e=xe(),i=Fe(),o=i==null?void 0:i.getWorkspaceId(),r=i==null?void 0:i.normalizedAccountUserId,[d,c]=B.useState(""),[l,u]=B.useState(!1),f=qt(),{data:h,isLoading:k}=Ht(o!=null?o:void 0,0,d,100),g=B.useMemo(()=>{var p,C;return{id:r!=null?r:"",email:(p=f==null?void 0:f.email)!=null?p:"",name:(C=f==null?void 0:f.name)!=null?C:void 0}},[r,f==null?void 0:f.email,f==null?void 0:f.name]),b=B.useMemo(()=>{var C;const p=((C=h==null?void 0:h.items)!=null?C:[]).map(M=>{var A,j;return{id:M.account_user_id,email:(A=M.email)!=null?A:"",name:(j=M.name)!=null?j:void 0}}).filter(M=>M.email.length>0);return g.id&&g.email&&(p.some(A=>A.id===g.id||A.email.toLowerCase()===g.email.toLowerCase())||p.unshift(g)),p},[h==null?void 0:h.items,g]),x=(E=a.assignee_id)!=null?E:"none",y=x==="none"?"":(X=(F=a.assignee)==null?void 0:F.email)!=null?X:"",w=x==="none"?void 0:(oe=(ie=a.assignee)==null?void 0:ie.name)!=null?oe:"",I=x==="none"?"—":dt({name:w,email:y}),S=async p=>{var C,M;try{u(!0);const j=await new ge(ue,{fetchFn:(V,ye)=>globalThis.fetch.call(globalThis,V,ye)}).patch("/aardvark/scan-findings/".concat(a.id),{headers:fe(),body:{version:a.version,assignee_user_email:p}}),Z=(C=j==null?void 0:j.status)!=null?C:200;if(Z>=400){const V=await((M=j==null?void 0:j.json)==null?void 0:M.call(j).catch(()=>null));throw new Error((V==null?void 0:V.detail)||"HTTP ".concat(Z))}Pe(t,a.hid,j.data),Ee(t,a.hid,j.data),s.successNeutral(e.formatMessage({id:"aardvark.toast.assigneeUpdated",defaultMessage:"Assignee updated"}),{duration:3e3,hasCloseButton:!0})}catch(A){s.danger(e.formatMessage({id:"aardvark.toast.assigneeUpdateFailed",defaultMessage:"Failed to update assignee"}))}finally{u(!1)}};return l?n.jsx("button",{disabled:!0,title:y,className:"border-token-border-light bg-token-bg-primary inline-flex h-8 w-8 cursor-not-allowed items-center justify-center rounded-full border text-[11px] font-semibold opacity-60","aria-disabled":!0,children:x==="none"?n.jsx(Se,{className:"icon-sm","aria-hidden":!0}):I}):n.jsx(mt,{triggerButton:n.jsx("button",{title:y,className:"border-token-border-light bg-token-bg-primary inline-flex h-8 w-8 items-center justify-center rounded-full border text-[11px] font-semibold","aria-busy":k,children:x==="none"?n.jsx(Se,{className:"icon-sm","aria-hidden":!0}):I}),children:n.jsxs("div",{className:"p-2.5",children:[n.jsx(Qt,{color:"search",name:"assignee-search",type:"text",value:d,onChange:p=>c(p.target.value),placeholder:e.formatMessage(ct.search),ariaLabel:e.formatMessage(ct.search),className:"text-token-text-tertiary flex h-8 w-full items-center rounded-sm",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full"}),n.jsxs("div",{className:"mt-2 max-h-60 overflow-y-auto",children:[n.jsxs("button",{type:"button",onClick:()=>S(null),className:"hover:bg-token-bg-tertiary flex w-full items-center gap-2 rounded-sm px-2 py-1 text-start text-sm ".concat(x==="none"?"bg-token-bg-tertiary":""),children:[n.jsx("div",{className:"border-token-border-light bg-token-bg-primary inline-flex h-7 w-7 items-center justify-center rounded-full border text-[11px] font-semibold",children:n.jsx(Se,{className:"icon-sm","aria-hidden":!0})}),n.jsx("div",{className:"flex flex-col",children:n.jsx("span",{className:"leading-4",children:e.formatMessage(ra.none)})})]},"none"),b.map(p=>{var M;const C=dt({name:p.name,email:p.email});return n.jsxs("button",{type:"button",onClick:()=>S(p.email),className:"hover:bg-token-bg-tertiary flex w-full items-center gap-2 rounded-sm px-2 py-1 text-start text-sm ".concat(p.id===x?"bg-token-bg-tertiary":""),children:[n.jsx("div",{className:"border-token-border-light bg-token-bg-primary inline-flex h-7 w-7 items-center justify-center rounded-full border text-[11px] font-semibold",children:C}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"leading-4",children:(M=p.name)!=null?M:p.email}),n.jsx("span",{className:"text-token-text-tertiary text-xs leading-4",children:p.email})]})]},p.id)})]})]})})}function ts({finding:a}){const t=xe(),s=a.status,e=bt(),i=xt(),[o,r]=B.useState(!1),[d,c]=B.useState(!1),[l,u]=B.useState(null),[f,h]=B.useState(""),k=async g=>{var b,x;try{if(g==="wontfix"||g==="fixed"||g==="duplicate"){u(g),c(!0);return}r(!0);const w=await new ge(ue,{fetchFn:(S,E)=>globalThis.fetch.call(globalThis,S,E)}).patch("/aardvark/scan-findings/".concat(a.id),{headers:fe(),body:{version:a.version,status:g}}),I=(b=w==null?void 0:w.status)!=null?b:200;if(I>=400){const S=await((x=w==null?void 0:w.json)==null?void 0:x.call(w).catch(()=>null));throw new Error((S==null?void 0:S.detail)||"HTTP ".concat(I))}Pe(e,a.hid,w.data),Ee(e,a.hid,w.data),i.successNeutral(t.formatMessage({id:"aardvark.toast.statusUpdated",defaultMessage:"Status updated"}),{duration:3e3,hasCloseButton:!0})}catch(y){i.danger(t.formatMessage({id:"aardvark.toast.statusUpdateFailed",defaultMessage:"Failed to update status"}))}finally{r(!1)}};return n.jsxs(n.Fragment,{children:[n.jsxs(U.Root,{value:s,onValueChange:k,disabled:o,children:[n.jsx(U.Trigger,{className:"border-token-border-light bg-token-bg-primary h-7 rounded-md border px-2 text-xs",children:n.jsxs("div",{className:"flex w-full items-center justify-between",children:[n.jsx("div",{className:"truncate",children:n.jsx(U.Value,{})}),n.jsx(U.Icon,{})]})}),n.jsx(U.Portal,{children:n.jsxs(U.Content,{align:"start",className:"rounded-lg text-sm",children:[n.jsx(U.Item,{value:"new",children:t.formatMessage(de.new)}),n.jsx(U.Item,{value:"triaged",children:t.formatMessage(de.triaged)}),n.jsx(U.Item,{value:"in_progress",children:t.formatMessage(de.in_progress)}),n.jsx(U.Item,{value:"fixed",children:t.formatMessage(de.fixed)}),n.jsx(U.Item,{value:"wontfix",children:t.formatMessage(de.wontfix)}),n.jsx(U.Item,{value:"duplicate",children:t.formatMessage(de.duplicate)})]})})]}),d&&n.jsx(ht,{testId:"modal-wontfix-reason",isOpen:!0,onClose:()=>{c(!1),h(""),u(null)},title:l==="fixed"?t.formatMessage({id:"aardvark.findings.fixed.title",defaultMessage:"Add PR link"}):l==="duplicate"?t.formatMessage({id:"aardvark.findings.duplicate.title",defaultMessage:"Mark as duplicate"}):t.formatMessage({id:"aardvark.findings.wontfix.title",defaultMessage:"Add reason"}),showCloseButton:!0,primaryButton:n.jsx(Ne.Button,{title:l==="fixed"?t.formatMessage({id:"aardvark.findings.fixed.save",defaultMessage:"Save"}):t.formatMessage({id:"aardvark.findings.wontfix.save",defaultMessage:"Save"}),color:"primary",loading:o,onClick:async()=>{var g,b;if(l){if(!f.trim()){i.danger(l==="fixed"?t.formatMessage({id:"aardvark.findings.fixed.required",defaultMessage:"Please paste a PR link"}):l==="duplicate"?t.formatMessage({id:"aardvark.findings.duplicate.required",defaultMessage:"Please paste a link to the original scan finding"}):t.formatMessage({id:"aardvark.findings.wontfix.required",defaultMessage:"Please enter a reason"}));return}try{r(!0);const y=await new ge(ue,{fetchFn:(I,S)=>globalThis.fetch.call(globalThis,I,S)}).patch("/aardvark/scan-findings/".concat(a.id),{headers:fe(),body:{version:a.version,status:l,resolution_reason:f.trim()}}),w=(g=y==null?void 0:y.status)!=null?g:200;if(w>=400){const I=await((b=y==null?void 0:y.json)==null?void 0:b.call(y).catch(()=>null));throw new Error((I==null?void 0:I.detail)||"HTTP ".concat(w))}Pe(e,a.hid,y.data),Ee(e,a.hid,y.data),i.successNeutral(t.formatMessage({id:"aardvark.toast.statusUpdated",defaultMessage:"Status updated"}),{duration:3e3,hasCloseButton:!0}),c(!1),h(""),u(null)}catch(x){i.danger(t.formatMessage({id:"aardvark.toast.statusUpdateFailed",defaultMessage:"Failed to update status"}))}finally{r(!1)}}}}),secondaryButton:n.jsx(Ne.Button,{title:l==="fixed"?t.formatMessage({id:"aardvark.findings.fixed.cancel",defaultMessage:"Cancel"}):t.formatMessage({id:"aardvark.findings.wontfix.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:()=>{c(!1),h(""),u(null)}}),children:n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{children:n.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:l==="fixed"?t.formatMessage({id:"aardvark.findings.fixed.prompt",defaultMessage:"Which PR merged the fix? Paste the URL."}):l==="duplicate"?t.formatMessage({id:"aardvark.findings.duplicate.prompt",defaultMessage:"Which scan finding does this duplicate? Paste a link to the original finding."}):t.formatMessage({id:"aardvark.findings.wontfix.prompt",defaultMessage:"Why won't this be fixed?"})})}),n.jsx("div",{children:n.jsx("textarea",{value:f,onChange:g=>h(g.target.value),className:"border-token-border-default bg-token-bg-primary text-token-text-primary placeholder:text-token-text-tertiary w-full rounded-lg border p-3 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:l==="fixed"?t.formatMessage({id:"aardvark.findings.fixed.placeholder",defaultMessage:"Paste PR URL (required)"}):l==="duplicate"?t.formatMessage({id:"aardvark.findings.duplicate.placeholder",defaultMessage:"Paste link (required)"}):t.formatMessage({id:"aardvark.findings.wontfix.placeholder",defaultMessage:"Add a short reason (required)"}),rows:5})})]})})]})}var Ce,ut;function Sa(){if(ut)return Ce;ut=1;var a=$t();function t(s,e){var i=[];return a(s,function(o,r,d){e(o,r,d)&&i.push(o)}),i}return Ce=t,Ce}var Ae,ft;function Ca(){if(ft)return Ae;ft=1;var a=Ot(),t=Sa(),s=zt(),e=Wt();function i(o,r){var d=e(o)?a:t;return d(o,s(r,3))}return Ae=i,Ae}var Aa=Ca();const as=kt(Aa),Na={critical:"critical",high:"danger",medium:"purple",low:"warning"};function ss(a){"use forget";const t=ke.c(6),{level:s}=a,e=xe(),i=Na[s];let o;t[0]!==e||t[1]!==s?(o=e.formatMessage(na[s]),t[0]=e,t[1]=s,t[2]=o):o=t[2];const r=o;let d;return t[3]!==r||t[4]!==i?(d=n.jsx(sa,{variant:i,children:r}),t[3]=r,t[4]=i,t[5]=d):d=t[5],d}export{es as A,Ha as F,Va as P,ts as S,sa as a,as as b,Oa as c,Ga as d,ss as e,Wa as f,Ba as g,Ua as h,Da as i,ge as j,ua as k,de as l,Ka as m,Qa as n,Xa as o,za as p,Ja as q,$a as r,qa as s,Ya as t,Za as u};
//# sourceMappingURL=lc139kj9junmhgwh.js.map
