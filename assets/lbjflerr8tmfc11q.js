const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j0yo6uv6652vva62.js","assets/i8clt0mfz495j7ii.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/m53ly4eu8e9c6q19.js","assets/bgxcag65uz54fc39.js","assets/mbhfxri3syrb9rbq.js","assets/ef28lc1b3o54kec9.js","assets/j5l6f6jzcmdadw3x.js","assets/fdkwc23ton7ihjd6.js","assets/nju52ppu7cxhyzrm.js","assets/otyqbgm5k20lfbwp.js","assets/k8bvofl8txmce9x3.js"])))=>i.map(i=>d[i]);
var Qs=Object.defineProperty,Ws=Object.defineProperties;var Zs=Object.getOwnPropertyDescriptors;var qt=Object.getOwnPropertySymbols;var Ys=Object.prototype.hasOwnProperty,Xs=Object.prototype.propertyIsEnumerable;var Kt=(e,n,s)=>n in e?Qs(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,V=(e,n)=>{for(var s in n||(n={}))Ys.call(n,s)&&Kt(e,s,n[s]);if(qt)for(var s of qt(n))Xs.call(n,s)&&Kt(e,s,n[s]);return e},ee=(e,n)=>Ws(e,Zs(n));import{e as se,j as t,M as dt,r as m,_ as G,u as Ge,a as ge,b as ms,f as Js,o as $s}from"./i8clt0mfz495j7ii.js";import{u as Vs,C as en,a as tn,H as sn,T as nn}from"./ixwp0fvcs3jhuh48.js";import{ft as on,fV as an,vt as Qe,n4 as M,n5 as U,n7 as qe,vu as fs,vv as rn,vw as cn,m$ as zt,uA as ln,s7 as un,vx as dn,vy as mn,vz as fn,vA as gn,ns as Gt,d6 as Ae,bG as hn,i0 as pn,mi as Cn,q as vn,t as xn,vB as Ue,ae as yn,y as _n,ab as bn,n9 as Tn,fd as be,vC as Sn,vD as gs,vE as En,vF as An,vG as mt,vH as In,nI as wn,vI as kn,no as Te,vJ as Pn,vK as jn,kO as Rn,vL as Dn,c as Mn,vM as Nn,vN as On,vO as Ln,vP as Bn,f9 as Hn,fa as Fn,fb as Un,nr as Qt,kT as Wt,fc as Zt,vQ as qn,vR as Kn,b as zn,vS as Gn,gu as Qn,m4 as Wn,A as Zn,vT as Yt,fe as Xt,vU as ct,vV as Jt,vW as He,vX as Fe,vY as $t}from"./j0yo6uv6652vva62.js";import{k4 as hs,C as Yn,aR as Xn,M as Vt,dK as Jn,aV as ie,$ as es,pG as $n,q as Vn,cH as ft,aW as We,bO as ps,co as ts,o as Q,L as W,u as Ze,bN as eo,a as to,d as Ee,gV as so,J as Cs,R as te,ff as vs,tD as xs,e4 as k,l$ as ss,T as Ke,B as no,ed as oo,h as ys,dv as ao,d_ as ns,cE as ro,hl as io,cI as co,jH as lo,iX as uo,l0 as mo,P as fo}from"./ghewn7l2ynbm32fm.js";import{O as go,b as ce,u as ho,c as po,j as Co,g as vo,A as xo,a as yo,f as os,C as me,D as _o}from"./lo4w8zafp8iqjpvk.js";import{e as bo}from"./kiv50zw1ij6k8vyj.js";import{C as To}from"./inhyojyded8f1i4q.js";import{i as So,c as Eo,d as Ao,a as Io,b as wo,g as ko}from"./o564tkn3ln8nzryq.js";import{C as ze,e as as,S as rs}from"./6ji8ehbh56ghw0zw.js";import{a as Po}from"./e4uyedc9wylrl0pu.js";import{D as jo}from"./f5qlxxpahyz6p72m.js";import{i as Ro}from"./l2r1du6tfxyv7jaj.js";import{C as Do}from"./hlon4mihnqp86jji.js";import{g as lt,S as Mo}from"./irqko7c1s7qpl41n.js";import{s as ut,B as No}from"./1u88i8jf4mwk3mc5.js";import{N as Oo}from"./ce3hgmw4iyyhicud.js";import{L as Lo}from"./mpzbsmypy64alaao.js";import{i as is}from"./pajs134rv9yn6t4z.js";import{g as Bo}from"./iakvhqfu6nmvphq6.js";var _s=(e=>(e.Close="close",e.Loaded="loaded",e.Streaming="streaming",e.Download="download",e))(_s||{});const Ho=({isOpen:e,dismissModal:n,closeTextdocEditor:s,textdocVersion:o,clientThreadId:i})=>{const r=se(),a=on(i),l=an(i),h=hs(),c=Qe(o==null?void 0:o.textdocId),u=async x=>{M.logButtonClick(U.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!((o==null?void 0:o.versionInt)==null||h)&&(l({sourceEvent:x,promptMessage:Jn("",{canvas:{user_created_textdocs:o!=null&&o.status===fs.ATTACHED_PENDING&&c!=null?[{user_created_temp_textdoc_id:o.textdocId,type:o.type,title:o.title,content:o.content,create_source:c.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:o.textdocId}}),completionMetadata:a?{conversationMode:a}:void 0}),c&&qe.markAsSent(c.tempTextdocId),n(),s())};return t.jsx(Yn,{testId:"modal-confirm-close-editor",isOpen:e,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:t.jsx("span",{className:"text-xl",children:t.jsx(dt,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:t.jsx(Vt.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:u}),secondaryButton:t.jsx(Vt.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Donâ€™t save and close"}),color:"secondary",onClick:()=>{M.logButtonClick(U.CLOSE_WITHOUT_SAVING),c&&qe.removeTempTextdoc(c.tempTextdocId),n(),s()}}),showCloseButton:!0,closeButton:t.jsx(Xn,{onClick:n}),children:t.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:t.jsx(dt,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})};function bs(e){const n=rn();if(!e)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const s=So(e==null?void 0:e.type,e==null?void 0:e.content),o=Eo(e.type);return{isCodePreviewable:s,isCodeExecutable:o,hasCanvasCodeExecution:n}}const Fo=({isTextdocStreaming:e,isRequestActive:n,value:s,comments:o})=>{const[i,r]=m.useState(!1);return m.useEffect(()=>{e&&i&&(r(!1),ze.reset())},[s,o]),m.useEffect(()=>{n||(r(!1),ze.reset())},[n]),[i,r]};function Uo({onClickRestore:e,onClickResetLatest:n}){const s=se();return t.jsx(ie.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:t.jsx(ie.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:t.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[t.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[t.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:s.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),t.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:s.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[t.jsx(es,{as:"button",color:"primary",onClick:e,children:s.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),t.jsx(es,{as:"button",color:"secondary",onClick:n,children:s.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const qo={type:"spring",bounce:.2,duration:.56},Ko=({conversation:e,turn:n})=>{const s=$n();return t.jsxs(ie.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[t.jsx(ie.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),t.jsx(ie.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:qo,children:t.jsx(Do,{conversation:e,onRequestCompletion:Vn,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:s})})]},"user-message")},zo=({conversation:e})=>{const n=e.id,{lastUserTurn:s,lastAssistantTurn:o}=ft(n,r=>{const a=ps.getConversationTurns(r);let l=null,h=null;for(let c=a.length-1;c>0;c--){const u=a[c];if(!l&&u.role===ts.User?l=u:!h&&u.role===ts.Assistant&&(h=u),l&&h)break}return{lastUserTurn:l,lastAssistantTurn:h}}),i=s&&!(o!=null&&o.messages.some(r=>{var a;return(a=r.recipient)==null?void 0:a.startsWith(cn)}));return t.jsx(We,{initial:!1,children:i&&t.jsx(Ko,{turn:s,conversation:e})})},Go=Q(()=>G(()=>import("./j0yo6uv6652vva62.js").then(e=>e.yn),__vite__mapDeps([0,1,2,3,4])),{loading:e=>W(e)}),Qo=({isRequestActive:e=!1,clientThreadId:n,readonlyReason:s,onCancel:o,onSubmit:i,onSubmitAccelerator:r,acceleratorActions:a=[]})=>{var j;const l=Ze(),h=eo(l,n),[c,u]=m.useState(!1),[x,b]=m.useState(""),[f,S]=m.useState(!0),I=se(),[T,g]=m.useState(!1),v=to(so),_=d=>{i==null||i(d,x),b("")},E=d=>{if(d.nativeEvent.isComposing)return;const{metaKey:A,shiftKey:w,key:P}=d;P==="Enter"&&x.trim()&&!(w||A)&&(_(d),d.preventDefault())};return t.jsxs(t.Fragment,{children:[c&&!v&&t.jsx(go,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),t.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:t.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[t.jsx(zo,{conversation:h}),t.jsx("div",{className:"flex flex-auto items-start",children:t.jsx("div",{className:Ee("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":f,"rounded-2xl":!f,"bg-transparent":T}),children:t.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[t.jsx(Ro,{placeholder:I.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:e,value:x,className:Ee("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":T}),maxRows:4,onChange:({target:{value:d}})=>b(d),onKeyDown:E,onHeightChange:(d,{rowHeight:A})=>S(Math.floor(d/A)<=1)}),x?t.jsx(ie.button,{className:Ee("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!f}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:_,children:t.jsx(Go,{className:"text-token-text-primary h-8 w-8"})}):((j=a==null?void 0:a.length)!=null?j:0)>0&&t.jsx(jo,{disableHint:!0,isVisuallyHidden:(s==null?void 0:s.isReadonly)&&!s.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:e,actions:a,onCancel:o,onExpandedChange:d=>{v||g(d),u(d)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function Wo(e,n){const s=new Set(e.map(l=>l.id)),o=new Set(n.map(l=>l.id)),i=e.filter(l=>!o.has(l.id)).map(l=>ee(V({},l),{diffStatus:zt.REMOVED})),r=n.filter(l=>!s.has(l.id)).map(l=>ee(V({},l),{diffStatus:zt.ADDED})),a=e.filter(l=>o.has(l.id));return i.concat(r,a)}const Zo=e=>{const{textdocId:n}=e,s=ln(o=>{var i;return(i=o==null?void 0:o.resolveTempTextdocId[n])!=null?i:n});return m.useMemo(()=>ee(V({},e),{textdocId:s}),[s,e])};async function Yo({textdocId:e,newTitle:n}){n!=null&&await te.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:e}},requestBody:{title:n}}).catch(s=>{Cs.addError("renameCanvasTitle Error:",s)})}const Xo=({serverThreadId:e,textdocVersion:n,initialTitle:s="Untitled Document",isEditingTitle:o,setIsEditingTitle:i})=>{const r=Ge(),{mutateAsync:a}=ge({mutationKey:[e,"textdocs"],mutationFn:Yo,onMutate:async({textdocId:g,newTitle:v})=>{await r.cancelQueries({queryKey:[e,"textdocs"]});const _=r.getQueryData([e,"textdocs"]);return r.setQueryData([e,"textdocs"],E=>{if(!E)return E;const j=new Map(E.persistedTextdocVersionById),d=j.get(g);if(d){const R=ee(V({},d),{title:v!=null?v:""});j.set(g,R)}const A=E.persistedTextdocVersions.map(R=>R.textdocId===g?ee(V({},R),{title:v!=null?v:""}):R),w=new Map(E.persistedTextdocById),P=w.get(g);if(P){const R=ee(V({},P),{title:v!=null?v:""});w.set(g,R)}return ee(V({},E),{persistedTextdocVersionById:j,persistedTextdocVersions:A,persistedTextdocById:w})}),{previousTextDocData:_}},retry:2,onError:(g,v,_)=>{_!=null&&_.previousTextDocData&&r.setQueryData([e,"textdocs"],_.previousTextDocData),Cs.addError("Error updating title:",g)},onSettled:()=>{r.invalidateQueries({queryKey:[e,"textdocs"]})}}),l=async g=>{var v;n&&await a({textdocId:(v=n.textdocId)!=null?v:"",newTitle:g})},[h,c]=m.useState(s),u=m.useRef(null),x=m.useRef(h),b=m.useRef(!1);m.useEffect(()=>{o&&u.current&&(u.current.focus(),u.current.select())},[o]);const f=g=>{c(g.target.value)},S=()=>{x.current=h},I=async()=>{b.current||await l(h),b.current=!1,i(!1)},T=g=>{(g.key==="Enter"||g.key==="Escape")&&g.preventDefault(),g.key==="Enter"?g.currentTarget.blur():g.key==="Escape"&&(c(x.current),b.current=!0,g.currentTarget.blur())};return t.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:u,value:h,onChange:f,onFocus:S,onBlur:I,onKeyDown:T,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function Jo(e){const{voiceName:n}=un(),s=e?()=>$o(e.textdocId,n,mn()):null,o="".concat(e==null?void 0:e.textdocId,".").concat(e==null?void 0:e.versionInt,".").concat(n);return dn(s,o)}function $o(e,n,s){return te.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:e},query:{voice:n,format:s}},skipJsonTransform:!0})}const Vo=Q(()=>G(()=>import("./m53ly4eu8e9c6q19.js").then(e=>e._),__vite__mapDeps([5,1])),{loading:e=>W(e)}),ea=Q(()=>G(()=>import("./bgxcag65uz54fc39.js").then(e=>e._),__vite__mapDeps([6,1])),{loading:e=>W(e)}),ta=Q(()=>G(()=>import("./j0yo6uv6652vva62.js").then(e=>e.yA),__vite__mapDeps([0,1,2,3,4])),{loading:e=>W(e)}),sa=({textdocVersion:e,isPersisting:n=!1,isTextdocAttachedPending:s,isTextdocStreaming:o,hasDebug:i,shouldShowPlayButton:r=!1,hideRenameButton:a=!1,toggleDebugView:l,isDebugVisible:h,toggleConsoleVisibility:c,isConsoleOpen:u,clientThreadId:x})=>{var B,Z;const b=Ze(),f=se();fn(b),Jo(e);const[S,I]=m.useState(!1),T=(B=e==null?void 0:e.title)!=null?B:"",g=(Z=vs(x))!=null?Z:"",v=Qe(e==null?void 0:e.textdocId),_=!T||(v==null?void 0:v.status)===gn.INFERRING,E=()=>{I(!0)},[j,d]=m.useState(!1),{container:A,triggerRef:w}=xs({isOpen:j,onClose:()=>d(!1)}),P=[!v&&!a&&!o?t.jsx(k.Item,{icon:ea,onClick:E,children:f.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?t.jsx(k.Item,{icon:Vo,onClick:c,children:u?f.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):f.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(P.length===0)return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:t.jsx(ce.Title,{className:"@[0px]:hidden @[150px]:block",children:_?t.jsx("div",{className:"w-52",children:t.jsx(ss,{lines:1,size:"base",width:100,widthVariance:0})}):T})}),n&&t.jsx(Gt,{size:12,className:"text-token-text-tertiary ps-1"})]});const R=e&&t.jsx(k.Portal,{container:A,children:t.jsx(k.Content,{onCloseAutoFocus:oe=>oe.preventDefault(),children:P})});return t.jsx(t.Fragment,{children:S?t.jsx(Xo,{serverThreadId:g,textdocVersion:e,initialTitle:T,isEditingTitle:S,setIsEditingTitle:I}):t.jsxs(t.Fragment,{children:[!1,t.jsxs(k.Root,{open:j,onOpenChange:d,children:[t.jsxs(k.Trigger,{ref:w,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[t.jsx(ce.Title,{className:"max-w-[270px] truncate overflow-hidden",children:_?t.jsx("div",{className:"w-52",children:t.jsx(ss,{lines:1,size:"base",width:100,widthVariance:0})}):T}),t.jsx("div",{className:"flex items-center ps-1",children:n?t.jsx(Gt,{size:12,className:"text-token-text-tertiary"}):t.jsx(ta,{className:"icon-sm text-token-text-tertiary"})})]}),R]})]})})};function na({textdocVersion:e,clientThreadId:n,color:s}){const{handleCopy:o,Icon:i,copyLabel:r}=ho({textdocVersion:e,clientThreadId:n});return t.jsx(Ke,{label:r,children:t.jsx(Ae,{icon:i,onClick:o,color:s})})}const cs=Q(()=>G(()=>import("./mbhfxri3syrb9rbq.js").then(e=>e._),__vite__mapDeps([7,1])),{loading:e=>W(e)});function oa({textdocVersion:e,disabled:n,clientThreadId:s}){const o=se(),{handleFileDownload:i,handleBlobDownload:r,isLoading:a,downloadCopyLabel:l,isDocument:h}=po({textdocVersion:e,clientThreadId:s});return h?t.jsxs(k.Sub,{children:[t.jsx(k.SubMenuTrigger,{icon:cs,label:l,disabled:a||n}),t.jsx(k.Portal,{children:t.jsxs(k.SubContent,{align:"end",children:[t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("pdf")},children:o.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("docx")},children:o.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("md")},children:o.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):t.jsx(k.Item,{label:l,icon:cs,disabled:a||n,onClick:r})}function aa(e){for(const n of ra){const s=e.match(n);if(s)return s[0]}return null}const ra=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],ls=Q(()=>G(()=>import("./ef28lc1b3o54kec9.js").then(e=>e._),__vite__mapDeps([8,1])),{loading:e=>W(e)}),ia="".concat(Mo,"...");function fe(e){return["canvas","textdoc","share",e]}function ca({isLoading:e,isPublishedVersionLatest:n,sharedTextdoc:s,textdocVersion:o,title:i}){const{textdocId:r}=o,[a,l]=m.useState(!1),h=aa(o.content),c=(d,A)=>{d&&yn(d,void 0,A).then(()=>{l(!0),setTimeout(()=>{l(!1)},1500)}).catch(()=>{})},u=Ge(),{mutate:x,isPending:b}=ge({scope:{id:r},mutationFn:d=>te.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:d}}}).then(A=>Ue(A.shared_textdoc)),onSuccess:d=>{u.setQueryData(fe(r),d),c(lt(d.sharedTextdocId))}}),{mutate:f,isSuccess:S}=ge({scope:{id:r},mutationFn:d=>te.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:d}}}).then(A=>Ue(A.shared_textdoc)),onSuccess:d=>{u.setQueryData(fe(r),d)}}),{mutate:I}=ge({scope:{id:r},mutationFn:({sharedTextdocId:d,access:A})=>te.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:d}},requestBody:{shared_textdoc_access:A}}).then(w=>Ue(w.shared_textdoc)),onMutate:({access:d})=>{const A=fe(r),w=u.getQueryData(A);return u.setQueryData(A,w&&ee(V({},w),{access:d})),{previousAccess:w==null?void 0:w.access}},onSuccess:d=>{u.setQueryData(fe(r),d)},onError:(d,A,w)=>{const P=fe(r),R=u.getQueryData(P);u.setQueryData(P,R&&ee(V({},R),{access:w==null?void 0:w.previousAccess}))}}),T=m.useRef(null),g=d=>{var A;(A=T.current)==null||A.focus(),s?(M.logButtonClick(U.COPY_SHARE_LINK,Se(o)),c(lt(s.sharedTextdocId),d)):(M.logButtonClick(U.CREATE_SHARE_LINK,Se(o)),x(r))},v=d=>{s&&(M.logButtonClick(d===_n.PUBLIC?U.UPDATE_SHARE_LINK_PUBLIC:U.UPDATE_SHARE_LINK_PRIVATE,Se(o)),I({sharedTextdocId:s.sharedTextdocId,access:d}))},_=s?lt(s.sharedTextdocId):void 0,E=()=>{s&&(M.logButtonClick(U.UPDATE_SHARE_LINK_TO_LATEST,Se(o)),f(s.sharedTextdocId))},j=h||(s==null?void 0:s.isAnonifyApiKeyDetected);return t.jsx(No,{inputRef:T,isLoading:e,isPublishedVersionLatest:n,sharedObject:s&&{id:s.sharedTextdocId,title:i,access:s.access,versionInt:s.versionInt,isModerationBlocked:s.isModerationBlocked,isAnonifyApiKeyDetected:s.isAnonifyApiKeyDetected},title:i,shareTextPlaceholder:ia,shareUrl:_,isCopySuccessful:a,didPublishUpdates:S,isCreateLinkRequestInProgress:b,handleUpdateLatestSharedVersion:E,handlePrivacyChange:v,handlePrimaryButtonClick:g,maybeRenderWarndingContent:()=>t.jsx(t.Fragment,{children:j&&t.jsx(ua,{})})})}function Se(e){return{textdocType:e.type,textdocId:e.textdocId}}function la({textdocVersion:e,isDisabled:n,title:s}){const o=no(),i=se(),r=e==null?void 0:e.textdocId,{data:a,isLoading:l}=ms({enabled:!!r&&!n,queryKey:fe(r),queryFn:()=>!r||r.startsWith(Tn)?Promise.resolve(null):te.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(T=>T.shared_textdoc&&Ue(T.shared_textdoc))}),[h,c]=m.useState(!1),{triggerRef:u,container:x}=xs({isOpen:h,onClose:()=>c(!1)}),b=(o==null?void 0:o.isWorkspaceAccount())&&!(o!=null&&o.features.includes(hn.WorkspaceShareLinks));if(n||b||!e)return t.jsx(Ke,{label:b?i.formatMessage(ut.workspaceSharingDisabled):i.formatMessage(ut.share),children:t.jsx(Ae,{disabled:!0,icon:ls})});const f=()=>{M.logButtonClick(U.OPEN_SHARE_MENU,Se(e))},S=(a==null?void 0:a.versionInt)===e.versionInt&&(a==null?void 0:a.title)===e.title,I=({className:T})=>t.jsxs("div",{className:"relative h-fit w-fit",children:[t.jsx(ls,{className:T}),!S&&a&&t.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:t.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return t.jsxs(pn,{open:h,onOpenChange:c,children:[t.jsx(Ke,{label:i.formatMessage(ut.share),children:t.jsx(Cn,{ref:u,asChild:!0,children:t.jsx(Ae,{icon:I,onClick:f})})}),t.jsx(We,{children:h&&t.jsx(vn,{forceMount:!0,container:x,children:t.jsx(xn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:t.jsx(ca,{title:s,sharedTextdoc:a,isLoading:l,isPublishedVersionLatest:S,textdocVersion:e})})})})]})}function ua(){return t.jsx(bn,{type:"danger",className:"w-auto md:p-3",children:t.jsx(dt,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}const da=Q(()=>G(()=>import("./j5l6f6jzcmdadw3x.js").then(e=>e._),__vite__mapDeps([9,1])),{loading:e=>W(e)});function ma({disabled:e=!1,isShowingChanges:n,onMouseEnter:s,onClick:o,onEsc:i}){const r=se(),a=m.useRef(null);return m.useEffect(()=>{if(n){const l=h=>{h.key==="Escape"&&(i==null||i(),a.current&&a.current===document.activeElement&&a.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[n,i]),t.jsx(Ke,{label:!e&&r.formatMessage(n?us.hideChanges:us.showChanges),children:t.jsx(Ae,{icon:da,ref:a,disabled:e,onClick:o,onMouseEnter:s,className:Ee("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&Oo)})})}const us=Js({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),fa=Q(()=>G(()=>import("./fdkwc23ton7ihjd6.js").then(e=>e._),__vite__mapDeps([10,1])),{loading:e=>W(e)}),ga=Q(()=>G(()=>import("./nju52ppu7cxhyzrm.js").then(e=>e._),__vite__mapDeps([11,1])),{loading:e=>W(e)}),ha=Q(()=>G(()=>import("./otyqbgm5k20lfbwp.js").then(e=>e._),__vite__mapDeps([12,1])),{loading:e=>W(e)}),pa=Q(()=>G(()=>import("./k8bvofl8txmce9x3.js").then(e=>e._),__vite__mapDeps([13,1])),{loading:e=>W(e)}),Ca=({clientThreadId:e,isHistoricalVersion:n,textdocVersion:s,readonlyReason:o,hasDebug:i,isEmbedded:r,isPersisting:a,isShowingChanges:l,hideRunCode:h=!1,hideHistoryActions:c=!1,hideRenameButton:u=!1,onHoverPrevious:x,onHoverShowChanges:b,onToggleShowChanges:f,onClickPrevious:S,onClickNext:I,onClickCodePreview:T,onClose:g,toggleDebugView:v,toggleConsoleVisibility:_,isCodeRunning:E,isTextdocAttachedPending:j,isTextdocStreaming:d,isConsoleOpen:A,isDebugVisible:w})=>{var xe,Y;const P=se(),R=oo(),B=Qe(s==null?void 0:s.textdocId),Z=(xe=s==null?void 0:s.title)!=null?xe:"",{isCodePreviewable:oe,isCodeExecutable:H,hasCanvasCodeExecution:O}=bs(s),ae=(Y=s==null?void 0:s.metadata)==null?void 0:Y.hive_id,q=Ze(),he=ae!=null&&ys(q,"292227286"),{mutate:Ie,isPending:Ye}=ge({scope:{id:ae!=null?ae:""},mutationFn:Pe=>te.safePost("/hive/{hive_id}/send_summary_to_slack",{parameters:{path:{hive_id:Pe}}})}),Xe=()=>{ae&&Ie(ae)},pe=!h&&(oe||H),F=s==null?void 0:s.versionInt,ne=F!=null&&F>1,le=n,Ce=!c,ve=oe&&E,we=s==null||B!=null||n||o.isStreaming,ke=s==null||o.isStreaming;return t.jsxs(ce.Header,{className:Ee("@container",oe&&E&&"bg-transparent!"),children:[t.jsx(ce.CloseButton,{onClick:g}),t.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:t.jsx(sa,{hasDebug:i,isConsoleOpen:A,isDebugVisible:w,toggleConsoleVisibility:_,toggleDebugView:v,isPersisting:a,textdocVersion:s,isTextdocAttachedPending:j,isTextdocStreaming:d,shouldShowPlayButton:pe,hideRenameButton:u,clientThreadId:e})}),t.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[t.jsx(na,{clientThreadId:e,textdocVersion:s}),t.jsx(la,{isDisabled:we,textdocVersion:s,title:Z}),Ce&&t.jsx(We,{children:t.jsx(ie.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:t.jsx(ma,{disabled:ve||o.isStreaming||!ne,isShowingChanges:l,onMouseEnter:b,onClick:f,onEsc:f})})}),t.jsxs(k.Root,{children:[t.jsx(k.BasicTrigger,{children:t.jsx(Ae,{icon:ga})}),t.jsx(k.Portal,{children:t.jsxs(k.Content,{align:"end",children:[t.jsx(k.Item,{icon:pa,disabled:!ne,onClick:S,onMouseOver:x,label:P.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),t.jsx(k.Item,{icon:ha,disabled:!le,onClick:I,label:P.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),t.jsxs(k.Group,{children:[s&&s.type!==be.LOADING&&B==null&&t.jsx(oa,{disabled:ke,textdocVersion:s,clientThreadId:e}),he&&t.jsx(k.Item,{icon:fa,disabled:Ye,onClick:Xe,label:P.formatMessage({id:"CRHbjv",defaultMessage:"Send to Slack"})})]})]})})]}),pe&&t.jsx(Ao,{clientThreadId:e,isCodePreviewable:oe,isDisabled:!O||o.isTextdocStreaming&&!E,disabledTooltip:O?void 0:P.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:T,isCodeRunning:E}),!r&&!R&&t.jsx(Lo,{clientThreadId:e})]})]})};function va(e){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,s=new Set,o=e.matchAll(n);for(const i of o){const r=i[2];try{let a=r;a.startsWith("www.")&&(a="http://"+r),new URL(a),s.add(r)}catch(a){}}return s}const xa=async({lastVersion:e,textdocId:n,content:s,comments:o})=>{const i=Sn(o,s);return(await te.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:e,content:s,comments:i}})).version},ya=()=>{const e=m.useRef([]),n=m.useRef(null),{mutateAsync:s,isPending:o}=ge({mutationKey:["canvas","textdoc","persist"],mutationFn:xa});return[m.useCallback(async(r,a,l)=>{const h=new AbortController,u=(async()=>{var I,T;const[S]=e.current;try{await(S==null?void 0:S.promise)}catch(g){M.logError("Saving document",g)}if(!h.signal.aborted)try{const g=Math.max((I=n.current)!=null?I:0,(T=r.versionInt)!=null?T:gs);let v="";try{is(a)?v=a():v=a}catch(d){M.logError("Serializing document",d)}let _=[];try{is(l)?_=l():_=l}catch(d){M.logError("Adjusting comments",d)}const{textdocId:E}=r;En({textdocId:E,basedOnVersionInt:g,content:v,comments:_});const j=await s({textdocId:E,lastVersion:g,content:v,comments:_});An({textdocId:E,basedOnVersionInt:g,newVersion:j}),n.current=j}catch(g){M.logError("Error saving document",g)}finally{e.current.shift()}})(),x={abort:()=>h.abort(),promise:u},[b,f]=e.current;return f&&(f.abort(),e.current=b?[b]:[]),e.current=b?[b,x]:[x],u},[s]),e,o]},_a=3e3,ba=e=>{const[n,s,o]=ya(),i=se(),r=m.useRef(null),a=m.useCallback(ao(async(c,u,x)=>{if(!mt(c))return n(c,u,x);qe.replaceTempTextdocContent(c.textdocId,typeof u=="string"?u:u())},_a,{leading:!1}),[n]),l=In(e);return m.useEffect(()=>{if(!l)return;const c=ns(window,{pagehide:()=>a.flush(),beforeunload:x=>{a.flush(),x.returnValue=i.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),u=ns(document,{visibilitychange:()=>a.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&a.flush(),r.current="mouse"}});return()=>{r.current=null,u(),c()}},[i,l,a]),m.useEffect(()=>()=>{a.flush()},[e,a]),wn(async()=>{var c,u;await a.flush(),await Promise.allSettled((u=(c=s.current)==null?void 0:c.map(({promise:x})=>x))!=null?u:[])}),[m.useCallback((c,u,x)=>{const{textdocId:b}=c;return mt(c)||kn(b),a(c,u,x)},[a]),a.flush,o||l]};function Ta(e,n,s){const o=Ge(),i=s!=null&&n!=null,{data:r,error:a,fetchNextPage:l,hasNextPage:h,isFetching:c}=$s(ds(e,n,i)),u=m.useCallback(async()=>{const I=n!=null;await o.prefetchInfiniteQuery(ds(e,n,I))},[o,e,n]);m.useEffect(()=>{const I=n;return()=>{o.removeQueries({queryKey:Ts(e,I),exact:!0})}},[o,e,n]);const[x,b,f,S]=m.useMemo(()=>{var T;if(r&&s){const g=r.pages.flatMap(_=>_),v=g.findIndex(_=>{var E;return"beforeVersion"in s?((E=_.versionInt)!=null?E:gs)<s.beforeVersion:_.versionInt===s.version});if(v!==-1)return[v===g.length-1,g[v],v>0?g[v-1]:null,v<g.length-1?g[v+1]:null]}const I=(T=r==null?void 0:r.pages.flatMap(g=>g))!=null?T:[];return[!0,null,null,I.length===0?null:I[0]]},[r,s]);return m.useEffect(()=>{!c&&i&&h&&x&&l()},[c,i,h,x,l]),m.useEffect(()=>{!b&&a&&Te(e)},[b,a,e]),{historicalTextdocVersion:b,nextHistoricalTextdocVersion:f,prefetchHistoricalTextdocVersion:u,previousHistoricalTextdocVersion:S}}function Ts(e,n=null){return["textdocHistory",e,n]}function ds(e,n,s=!0){return{queryKey:Ts(e,n),queryFn:({pageParam:o})=>Sa(e,o),initialPageParam:n!=null?n:void 0,getNextPageParam:o=>{var r;const i=(r=ro(o))==null?void 0:r.versionInt;if(i&&i>1)return i},enabled:s,staleTime:1/0,retry:2}}async function Sa(e,n){return n===void 0||n<=1?[]:(await te.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:e},query:{before_version:n}}})).previous_doc_states.map(({id:o,version:i,textdoc_type:r,title:a,content:l,updated_at:h,comments:c,metadata:u})=>({textdocId:o,versionInt:i,messageId:null,title:a,type:jn(r),content:l,status:fs.COMPLETE,createdAt:io(h),comments:Pn(c,l),metadata:{content_references:u==null?void 0:u.content_references,hive_id:u==null?void 0:u.hive_id}}))}const Wa=({isFullScreen:e=!1,isEmbedded:n=!1,hideHeader:s=!1,hideRunCode:o=!1,isReadonlyFromQueryParam:i=!1,hideRenameButton:r=!1,clientThreadId:a,focusedTextdoc:l,onClose:h,isAnimating:c=!1,width:u,hideBottomComposer:x=!1})=>{"use no forget";var Bt,Ht,Ft,Ut;const b=Ze(),{textdocId:f,history:S,showChangesAtVersion:I=null,shouldRunCodeOnOpen:T=!1}=Zo(l),g=se(),[v,_,E]=ba(f),{targetedContent:j}=Rn(),d=Dn(b),[A,w]=m.useState(!1),[P,R]=m.useState(!1),B=Mn(f),Z=Nn(),oe=ft(a,ps.getRequestId),H=co(oe),{data:O,isLoading:ae}=ms(ct(f,I)),[q,he]=m.useState(!1),[Ie,Ye]=m.useState(null),Xe=On(a),pe=m.useRef(null),F=(Bt=B==null?void 0:B.versions)!=null?Bt:[],ne=(Ht=F[0])==null?void 0:Ht.versionInt,{historicalTextdocVersion:le,nextHistoricalTextdocVersion:Ce,previousHistoricalTextdocVersion:ve,prefetchHistoricalTextdocVersion:we}=Ta(f,ne,S),ke=Ge();m.useEffect(()=>{ze.reset()},[f]);const xe=F.length>0?F[F.length-1]:null,Y=F.length>1?F[F.length-2]:null,Pe=vs(a),{restoreHistoricalTextdocVersion:Ss,optimisticRestoredTextdocVersion:Es}=Ln(Pe,xe,le),ue=S!=null,p=ue?le:xe,X=I!=null,ye=Vs(a,p),je=c?null:O,Re=(()=>{if(c||p==null)return[];const C=os(p.comments);return!X&&le!=null?le.comments:!X||O==null?C:O.contentBefore!==O.contentAfter?[]:Wo(O.commentsBefore,O.commentsAfter)})(),N=(Ft=p==null?void 0:p.type)!=null?Ft:be.LOADING,gt=Co({textdocVersion:p,clientThreadId:a}),As=m.useCallback(()=>{var y,D;const C=(D=(y=window.getSelection())==null?void 0:y.toString())!=null?D:"";gt({source:"keyboard",selectedText:C,productLogOnly:!0})},[gt]),Je=Bn(),ht=mt(p),re=Hn(p),$e=Fn(p),pt=Un(p),Is=pt&&!n,ws=Qt(Z),ks=Qt(H);m.useEffect(()=>{!ht&&F.length===0&&Je!==Wt.NATIVE&&(!Z&&ws.current||!H&&ks.current||!Z&&!H)&&(h==null||h())},[F.length,Z,H]);const{content:L,currentlyStreamingLineIndex:De}=(O==null?void 0:O.contentBefore)!=null&&!Zt(N)?{content:O.contentBefore,currentlyStreamingLineIndex:null}:vo(p,Y),Ps=qn(Pe,Array.from(va(L))),[Me,Ve]=Fo({value:L,isRequestActive:H,isTextdocStreaming:re,comments:Re}),Ct=Kn(p),vt=Je===Wt.LAST_TURN||Me||E;m.useEffect(()=>{zn().sendMessage({type:_s.Streaming,streaming:vt})},[vt]);const js=({getSerializedDocument:C,getAdjustedComments:y})=>{p&&v(p,C,y)},Rs=C=>{var D;if(!p)return;const y=C.doc.toString();v(p,y,(D=C.field(bo,!1))!=null?D:[])},xt=(C,y,D,$,de)=>{Ve(!0),ye({sourceEvent:C,action:D,content:y,userMessageType:He.ASK_CHATGPT,sourceRange:$,selectionMetadata:{selection_type:de,selection_position_range:$}})},yt=({id:C})=>{Ct(C,Jt.DISMISS),ze.reset()},_t=async(C,y)=>{Ve(!0);const{id:D,at:$,content:de}=y;if(await Ct(D,Jt.ACCEPT)===!1)return Ve(!1);ye({sourceEvent:C,content:de,userMessageType:He.ACCEPT_COMMENT,sourceRange:$,action:rs.EDIT,selectionMetadata:{selection_type:as.SELECTION,selection_position_range:$}})},et=(C,y,D,$)=>{const{action:de}=$;ye({sourceEvent:C,action:de,content:D,sourceRange:y,userMessageType:He.ACCELERATOR,acceleratorMetadata:{action:de,id:$.id,prompt:D},selectionMetadata:y!=null?{selection_type:as.SELECTION,selection_position_range:y}:void 0})},Ds=(C,y)=>{ye({sourceEvent:C,action:rs.EDIT,content:y,userMessageType:He.FULL_SCREEN_SUBMIT})},tt=Gn(),bt=C=>{var y;return(y=tt==null?void 0:tt[C])!=null?y:C},st=()=>Qn(a,void 0,{clientInitiated:!0,reason:"textdoc_canvas_cancel"}),Ms=()=>{S?Fe(f,S):Te(f)},K=Io({streamingSource:Je,isRestoring:Es!=null,isRequestActive:H,isTextdocStreaming:re,isReadonlyFromQueryParam:i,isHistoricalVersion:ue,isShowingChanges:X});let Ne=null;const Tt=c||K.isReadonly||Me,Oe=hs()||Xe||i||ht,St=()=>c&&Re.length>0?me.ALL_HIDDEN:Oe?me.COMMENTS_READONLY:K.isReadonly?K.isStreaming?me.ENABLED:K.isReadonlyFromQueryParam||K.isShowingChanges||K.isHistoricalVersion?me.COMMENTS_READONLY:me.ALL_HIDDEN:me.ENABLED,Ns=m.useCallback(async C=>{const{suggestion:y}=await te.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:f}},requestBody:{content:C}});return y},[f]),Et=e||c||i;let nt=[];switch(N){case be.LOADING:Ne=t.jsx(_o,{});break;case be.DOCUMENT:Ne=t.jsx(yo,{value:L,comments:Re,previousValue:Y==null?void 0:Y.content,getAutocompleteSuggestion:Ns,previousComments:os(Y==null?void 0:Y.comments),isRewriting:$e,isAnimatingFromPreview:c,isSendDisabled:Oe,getStableCommentId:bt,diff:je,isRequestActive:H,isDisabled:K.isReadonly||Z,isWaitingForCommentResponse:Me,hideAccelerators:Et,hideToolbar:Tt,hideEditOverlay:c,commentsMode:St(),readonlyReason:K,onBlur:_,onSave:_,onChange:js,onCancelRequest:st,targetedContent:j,onAddComment:xt,onAcceptComment:_t,onDismissComment:yt,onSubmitAccelerator:et,onExitShowChanges:Ms,safeUrls:Ps,width:u,modelCursor:pt||re&&!$e?p==null?void 0:p.modelCursor:void 0,shouldResetSelection:(p==null?void 0:p.versionInt)===1,metadata:B==null?void 0:B.metadata}),nt=Po;break;default:Zt(N)&&(Ne=t.jsx(xo,{id:"codemirror",getStableCommentId:bt,language:wo(N),value:L,comments:Re,hideAccelerators:Et,commentsMode:St(),hideToolbar:Tt,onSubmitAccelerator:et,currentlyStreamingLineIndex:De!=null?De:null,readonlyReason:K,isRequestActive:H,isSendDisabled:Oe,isWaitingForCommentResponse:Me,onChange:Rs,onCancelRequest:st,onAddComment:xt,onBlur:_,onSave:_,codemirrorRef:pe,onDismissComment:yt,onAcceptComment:_t,textdocDiff:je!=null?je:void 0,modelCursor:re&&De==null?p==null?void 0:p.modelCursor:void 0}),nt=To)}const _e=m.useRef(null),ot=m.useRef(null),{hasCanvasCodeExecution:at,isCodeExecutable:At,isCodePreviewable:J}=bs(p),It=at&&J,wt=at&&At,Os=Wn(),kt=m.useCallback(()=>{var C,y;!q&&(It||wt)?(he(!0),(C=_e.current)==null||C.runCode(N,L)):((y=_e.current)==null||y.stopCode(),he(!1))},[It,wt,q,L,N]),Pt=Zn(()=>{kt()});m.useEffect(()=>{T&&Pt()},[T,Pt]);const z=p==null?void 0:p.versionInt,Ls=z!=null&&z>1,Bs=ue,Le=ve==null?void 0:ve.versionInt,rt=Ce==null?void 0:Ce.versionInt,Hs=()=>{X?S?Fe(f,S):Te(f):(M.logButtonClick(U.SHOW_CHANGES,{textdocType:N,textdocId:f,versionInt:z,latestVersionInt:ne}),z&&$t(f,z,S))},Fs=()=>{M.logButtonClick(U.HISTORY_PREVIOUS,{textdocType:N,textdocId:f,versionInt:z,latestVersionInt:ne,isShowingChanges:X}),f&&z&&Ls&&Fe(f,{beforeVersion:z},X&&Le!=null?Le:void 0)},Us=()=>{M.logButtonClick(U.HISTORY_NEXT,{textdocType:N,textdocId:f,versionInt:z,latestVersionInt:ne,isShowingChanges:X}),Bs&&(rt?Fe(f,{version:rt},X?rt:void 0):X&&ne?$t(f,ne,null):Te(f))},qs=ys(b,"1804926979"),jt=ft(a,Bo(f)),Ks=lo(),Rt=Qe(p==null?void 0:p.textdocId),zs=!s&&t.jsx(Ca,{hideRunCode:o,clientThreadId:a,isHistoricalVersion:ue,textdocVersion:p,readonlyReason:K,hasDebug:d,isEmbedded:n,isPersisting:E,isShowingChanges:X,isConsoleOpen:P,isDebugVisible:A,hideHistoryActions:i,hideRenameButton:r,onHoverPrevious:()=>{we(),Le&&ke.prefetchQuery(ct(f,Le))},onHoverShowChanges:()=>{we(),z&&ke.prefetchQuery(ct(f,z))},onToggleShowChanges:Hs,onClickPrevious:Fs,onClickNext:Us,toggleDebugView:()=>w(C=>!C),toggleConsoleVisibility:()=>{P||fo.logEvent("Canvas Open Console Clicked"),R(C=>!C)},onClose:()=>{if(M.logButtonClick(U.CLOSE_TEXTDOC,{textdocType:p==null?void 0:p.type}),Rt&&!e){const{create_source:C,hasUserEdits:y,tempTextdocId:D}=Rt;if(y&&C!==Xt.USER_CREATED_COMPOSER){Nt(!0);return}if(qe.removeTempTextdoc(D),C===Xt.USER_CREATED_COMPOSER){const $=uo(Ks);mo($,L)}}h==null||h()},onClickCodePreview:kt,isCodeRunning:q,isTextdocStreaming:re,isTextdocAttachedPending:Yt(p)});let Dt=null;const Be=!o&&at&&(At||J),it=ko(N,L);m.useEffect(()=>{var C;Be&&it&&((C=ot.current)==null||C.prepareEnvironment(L,it))},[Be,it]),m.useEffect(()=>{var C;J&&q&&!re&&((C=_e.current)==null||C.runCode(N,L))},[J,re,L,N]);const Mt=(Ut=p==null?void 0:p.title)!=null?Ut:"";Be&&(Dt=t.jsx(en,{id:f,title:Mt,onChangeBackgroundColor:Ye,onCodeRunComplete:()=>he(!1),visuallyHidden:!J||!q,disableNetworkRequests:!Os,networkAccessDeniedMessage:g.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:J&&N!==be.CODE_HTML,isCodeUpdating:re,ref:ot,onRetryCodeRun:()=>{var C;return(C=_e.current)==null?void 0:C.runCode(N,L)}}));const[Gs,Nt]=m.useState(!1),Ot=t.jsx(Ho,{isOpen:Gs,dismissModal:()=>Nt(!1),closeTextdocEditor:()=>{h==null||h()},textdocVersion:p,clientThreadId:a}),Lt=t.jsxs(t.Fragment,{children:[zs,t.jsx(ce.Content,{scrollToBottomMode:Is?"bottom":"top",shouldScrollToTop:$e,isLoading:ae,hideChildren:J&&q,overlay:Dt,onCopy:As,children:Ne}),Be&&t.jsx(tn,{ref:_e,sandboxRef:ot,textdocId:f,textdocTitle:Mt,textdocContent:L,isTextdocAttachedPending:Yt(p),highlightLine:C=>{var y;return(y=pe.current)==null?void 0:y.highlightLine(C)},isRequestActive:H,createTextdocTurn:ye,isOpen:P,onOpenChange:R}),t.jsx(We,{children:ue&&!i&&t.jsx(Uo,{onClickRestore:Ss,onClickResetLatest:()=>Te(f)})}),e&&!ue&&!x&&!(q&&J)&&!Oe&&t.jsx(Qo,{isRequestActive:H,clientThreadId:a,onSubmitAccelerator:et,onSubmit:Ds,onCancel:st,readonlyReason:K,acceleratorActions:nt})]});if(qs&&jt&&p){const y=new URLSearchParams(window.location.search).get(sn),D=y==null?void 0:parseInt(y);return t.jsxs(t.Fragment,{children:[Ot,t.jsx(ce,{previewBackgroundColor:Ie,isPreviewingCode:J&&q,children:t.jsxs("div",{className:"flex h-full",children:[t.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Lt}),t.jsx(nn,{hiveId:jt,clientThreadId:a,textdocVersion:p,ts:D})]})})]})}return t.jsxs(t.Fragment,{children:[Ot,t.jsx(ce,{previewBackgroundColor:Ie,isPreviewingCode:J&&q,children:Lt})]})};export{_s as C,Wa as T};
//# sourceMappingURL=lbjflerr8tmfc11q.js.map
