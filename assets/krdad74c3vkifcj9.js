var k=Object.defineProperty,E=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var G=(s,e,t)=>e in s?k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,g=(s,e)=>{for(var t in e||(e={}))Z.call(e,t)&&G(s,t,e[t]);if(A)for(var t of A(e))B.call(e,t)&&G(s,t,e[t]);return s},Q=(s,e)=>E(s,L(e));import{c as D,u as _,a as q,e as v,b as M,w as z}from"./i8clt0mfz495j7ii.js";import{e as F,o9 as b,R as p,oB as W,oC as m,oD as R,oE as w}from"./ghewn7l2ynbm32fm.js";const N=s=>{"use forget";const e=D.c(22),{workspaceId:t,currentRoles:i,bootstrapResources:n}=s,r=_(),a=F(),u=v();let o;e[0]!==n||e[1]!==t?(o=K=>p.safePost("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:t},path:{workspace_id:t}},requestBody:{role_name:K.name,description:K.description,bootstrap_resources:n}}),e[0]=n,e[1]=t,e[2]=o):o=e[2];let c;e[3]!==i||e[4]!==r||e[5]!==t?(c=K=>{const{name:T,description:C}=K;r.cancelQueries({queryKey:[t,"roles"]});const S=i;return r.setQueryData([t,"roles"],P=>(P||(P={data:[],object:"list",has_more:!1}),Q(g({},P),{data:[{id:"new",name:T,permissions:[],resource_type:"workspace",predefined_role:!1,description:C,created_at:Date.now(),updated_at:Date.now(),created_by:"system",metadata:{}},...P.data]}))),{previousRoles:S}},e[3]=i,e[4]=r,e[5]=t,e[6]=c):c=e[6];let l;e[7]!==u||e[8]!==r||e[9]!==a||e[10]!==t?(l=(K,T,C)=>{r.setQueryData([t,"roles"],C==null?void 0:C.previousRoles),r.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),K.message==="Role with this name already exists."&&a.warning(u.formatMessage({id:"Hn9Qxu",defaultMessage:"Role with this name already exists"}),{duration:1})},e[7]=u,e[8]=r,e[9]=a,e[10]=t,e[11]=l):l=e[11];let y;e[12]!==r||e[13]!==t?(y=()=>{r.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),r.invalidateQueries({refetchType:"all",queryKey:m(t)})},e[12]=r,e[13]=t,e[14]=y):y=e[14];let d;e[15]!==o||e[16]!==c||e[17]!==l||e[18]!==y?(d={mutationFn:o,onMutate:c,onError:l,onSuccess:y},e[15]=o,e[16]=c,e[17]=l,e[18]=y,e[19]=d):d=e[19];const{mutateAsync:f}=q(d);let h;return e[20]!==f?(h={createRole:f},e[20]=f,e[21]=h):h=e[21],h},H=s=>{"use forget";const e=D.c(10),{workspaceId:t}=s,i=_();let n;e[0]!==t?(n=async c=>await p.safeDelete("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:t},path:{workspace_id:t,role_id:c}}}),e[0]=t,e[1]=n):n=e[1];let r;e[2]!==i||e[3]!==t?(r=()=>{i.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),i.invalidateQueries({refetchType:"all",queryKey:m(t)})},e[2]=i,e[3]=t,e[4]=r):r=e[4];let a;e[5]!==n||e[6]!==r?(a={mutationFn:n,onSuccess:r},e[5]=n,e[6]=r,e[7]=a):a=e[7];const{mutateAsync:u}=q(a);let o;return e[8]!==u?(o={deleteRole:u},e[8]=u,e[9]=o):o=e[9],o},J=({workspaceId:s})=>{const e=_(),t=F(),i=v(),{mutateAsync:n}=q({mutationFn:async r=>(r.permissions.includes(b.SearchAccess)||(r.permissions=r.permissions.filter(a=>a!==b.AgentModeAccess&&a!==b.DeepResearchAccess)),r.permissions.includes(b.GPT5ThinkingAccess)||r.permissions.includes(b.GPT5ThinkingMiniAccess)||r.permissions.push(b.GPT5ThinkingMiniAccess),await p.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:r.id}},requestBody:{role_name:r.name,description:r.description,permissions:r.permissions}})),onMutate:({id:r,name:a,permissions:u})=>{const o=e.getQueryData([s,"role",r]);return e.setQueryData([s,"role",r],c=>Q(g({},c),{name:a,permissions:u})),{previousRoles:o}},onError:(r,a,u)=>{e.setQueryData([s,"role",a.id],u==null?void 0:u.previousRoles),r.message==="Role with this name already exists."?t.warning(i.formatMessage({id:"EDzkz/",defaultMessage:"Role with this name already exists"}),{duration:1}):t.danger(i.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:()=>{e.invalidateQueries({refetchType:"all",queryKey:[s,"roles"]}),t.success(i.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRole:n}},V=({workspaceId:s,roleId:e})=>{const t=_(),i=q({mutationFn:async n=>await p.safePut("/rbac/workspace/{workspace_id}/roles/{role_id}/metadata",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e}},requestBody:n}),onSuccess:n=>{t.setQueryData([s,"role-metadata",e],n)},onSettled:()=>{t.invalidateQueries({queryKey:[s,"role-metadata",e]})}});return{upsertRoleMetadata:i.mutateAsync,isPending:i.isPending}},X=({workspaceId:s,roleId:e})=>{const t=_(),{mutateAsync:i}=q({mutationFn:async({id:n})=>await p.safePost("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:s},path:{workspace_id:s}},requestBody:{role_id:e,principal_id:n,principal_type:"group"}}),onSuccess:(n,r)=>{const a=[s,e,"role-groups"];t.setQueryData(a,u=>{var o,c;return[...u,{id:r.id,name:(o=r.name)!=null?o:"",num_members:(c=r.num_members)!=null?c:0,created_time:new Date().toDateString()}]}),t.invalidateQueries({refetchType:"all",queryKey:a})}});return{assignGroup:i}},Y=({workspaceId:s,roleId:e})=>{const t=_(),{mutateAsync:i}=q({mutationFn:async n=>await p.safeDelete("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:s,role_id:e,principal_id:n,principal_type:"group"},path:{workspace_id:s}}}),onSuccess:(n,r)=>{const a=[s,e,"role-groups"];t.setQueryData(a,u=>u?u.filter(o=>o.id!==r):[]),t.invalidateQueries({refetchType:"all",queryKey:a})}});return{unassignGroup:i}},x=({workspaceId:s,roleId:e,showToast:t=!0})=>{const i=_(),n=F(),r=v(),{mutateAsync:a,isPending:u,variables:o}=q({mutationFn:async c=>await p.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e,connector_id:c.connectorId}},requestBody:{permissions:c.permissions}}),onMutate:({connectorId:c,permissions:l})=>{i.cancelQueries({queryKey:m(s,e)}),i.cancelQueries({queryKey:R(s,c)}),i.cancelQueries({queryKey:w(s,c,e)});const y=i.getQueryData(m(s,e));return i.setQueryData(m(s,e),d=>Q(g({},d),{connectors_with_permissions:d==null?void 0:d.connectors_with_permissions.map(f=>f.connector.id===c?Q(g({},f),{permissions:l}):f)})),{previousConnectors:y}},onError:(c,l,y)=>{i.setQueryData(m(s,e),y==null?void 0:y.previousConnectors),t&&n.danger(r.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(c,l)=>{i.invalidateQueries({refetchType:"all",queryKey:m(s,e)}),i.invalidateQueries({refetchType:"all",queryKey:R(s,l.connectorId)}),i.invalidateQueries({refetchType:"all",queryKey:w(s,l.connectorId,e)}),t&&n.success(r.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRoleConnectorPermission:a,isPending:u,variables:o}},I=({workspaceId:s,connectorId:e,showToast:t=!0})=>{const i=_(),n=F(),r=v(),{mutateAsync:a,isPending:u,variables:o}=q({mutationFn:async c=>await p.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:c.roleId,connector_id:e}},requestBody:{permissions:c.permissions}}),onMutate:({roleId:c,permissions:l})=>{i.cancelQueries({queryKey:R(s,e)}),i.cancelQueries({queryKey:m(s,c)}),i.cancelQueries({queryKey:w(s,e,c)});const y=i.getQueryData(R(s,e));return i.setQueryData(R(s,e),d=>{var f;return Q(g({},d),{roles_with_permissions:(f=d==null?void 0:d.roles_with_permissions)==null?void 0:f.map(h=>h.role.id===c?Q(g({},h),{connector_permissions:l}):h)})}),{previousRoles:y}},onError:(c,l,y)=>{i.setQueryData(R(s,e),y==null?void 0:y.previousRoles),t&&n.danger(r.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(c,l)=>{i.invalidateQueries({refetchType:"all",queryKey:R(s,e)}),i.invalidateQueries({refetchType:"all",queryKey:m(s,l.roleId)}),i.invalidateQueries({refetchType:"all",queryKey:w(s,e,l.roleId)}),t&&n.success(r.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateConnectorRolePermission:a,isPending:u,variables:o}},ee=({workspaceId:s,showToast:e=!0})=>{const t=F(),i=v(),n=_(),r=W(),{mutateAsync:a,isPending:u,variables:o}=q({mutationFn:async c=>await p.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:c.id}},requestBody:{state:c.state}}),onError:()=>{e&&t.danger(i.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(c,l)=>{n.invalidateQueries({refetchType:"all",queryKey:m(s,l.id)}),n.invalidateQueries({refetchType:"all",queryKey:["permissions",s]}),r(),e&&t.success(i.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{toggleAllConnectorsPermissionForRole:a,isPending:u,variables:o}},se=({workspaceId:s,roleId:e})=>M({queryKey:[s,"role",e],enabled:!!e,queryFn:async()=>(await p.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e}}})).role,staleTime:1e3*60*5}),te=({workspaceId:s,enabled:e=!0})=>M({queryKey:[s,"roles"],queryFn:()=>p.safeGet("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s}}}),enabled:e}),re=({workspaceId:s,roleId:e})=>M({queryKey:[s,e,"role-groups"],queryFn:async()=>(await p.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/principals",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e}}})).groups}),ae=({accountId:s,workspaceId:e,roleId:t,enabled:i=!0})=>{var l;const{data:n,isLoading:r,isFetching:a,error:u,refetch:o}=M({queryKey:m(e,t),queryFn:()=>p.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:e,role_id:t}}}),enabled:i});return{connectorsWithPermission:new Map((l=n==null?void 0:n.connectors_with_permissions)==null?void 0:l.map(y=>[y.connector.id,y])),isLoading:r,isFetching:a,error:u,refetch:o}},ie=({workspaceId:s,roleId:e,enabled:t=!0})=>M({queryKey:[s,"role-metadata",e],enabled:t&&!!e,queryFn:()=>p.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/metadata",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e}}})}),ne=s=>{"use forget";const e=D.c(10),{workspaceId:t,connectorId:i,enabled:n}=s,r=n===void 0?!0:n;let a;e[0]!==i||e[1]!==t?(a=m(t,i),e[0]=i,e[1]=t,e[2]=a):a=e[2];let u;e[3]!==i||e[4]!==t?(u=()=>p.safeGet("/rbac/workspace/{workspace_id}/connector/{connector_id}/roles",{parameters:{query:{account_id:t,consistency:"strong"},path:{workspace_id:t,connector_id:i}}}),e[3]=i,e[4]=t,e[5]=u):u=e[5];let o;return e[6]!==r||e[7]!==a||e[8]!==u?(o={queryKey:a,queryFn:u,enabled:r},e[6]=r,e[7]=a,e[8]=u,e[9]=o):o=e[9],M(o)},U=({workspaceId:s,roleId:e,connectorId:t})=>p.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e,connector_id:t}}}),oe=({workspaceId:s,roleId:e,connectorIds:t,enabled:i=!0})=>z({queries:t.map(n=>({queryKey:w(s,n,e),queryFn:async()=>{var r,a,u;try{return await U({workspaceId:s,connectorId:n,roleId:e})}catch(o){if(((u=(a=o==null?void 0:o.status)!=null?a:(r=o==null?void 0:o.response)==null?void 0:r.status)!=null?u:o==null?void 0:o.code)===404)return{permissions:[]};throw o}},enabled:i})),combine:n=>{const r={};return n.forEach((a,u)=>{const o=t[u];a.data?r[o]=a.data.permissions:r[o]=[]}),{results:r,isLoading:n.some(a=>a.isLoading),isFetching:n.some(a=>a.isFetching),isError:n.some(a=>{var u;return a.isError&&((u=a.error)==null?void 0:u.status)!==404}),errors:n.map(a=>a.error).filter(a=>(a==null?void 0:a.status)!==404)}}});export{X as a,Y as b,ee as c,ae as d,oe as e,se as f,H as g,J as h,x as i,ie as j,V as k,te as l,N as m,ne as n,I as o,re as u};
//# sourceMappingURL=krdad74c3vkifcj9.js.map
