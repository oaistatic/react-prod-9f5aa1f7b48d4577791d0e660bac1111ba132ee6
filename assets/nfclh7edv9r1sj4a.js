const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jyroje0qaxw6h3z1.js","assets/i8clt0mfz495j7ii.js","assets/frf0wu8ouyfyu06j.js","assets/j0yo6uv6652vva62.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/gsas8pb1acnf7jnd.js","assets/e23v0up48ofc1v2q.js","assets/bimaydywrdin6h6p.js","assets/e6eptpe9toj61kmv.js","assets/iieayfdj62qz1wzr.js"])))=>i.map(i=>d[i]);
var at=Object.freeze,rt=Object.defineProperty,It=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var xe=Object.getOwnPropertySymbols;var nt=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var ot=(t,s,a)=>s in t?rt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,d=(t,s)=>{for(var a in s||(s={}))nt.call(s,a)&&ot(t,a,s[a]);if(xe)for(var a of xe(s))it.call(s,a)&&ot(t,a,s[a]);return t},G=(t,s)=>It(t,qt(s));var ie=(t,s)=>{var a={};for(var o in t)nt.call(t,o)&&s.indexOf(o)<0&&(a[o]=t[o]);if(t!=null&&xe)for(var o of xe(t))s.indexOf(o)<0&&it.call(t,o)&&(a[o]=t[o]);return a};var lt=(t,s)=>at(rt(t,"raw",{value:at(s||t.slice())}));import{_ as Q,j as e,e as ae,r as g,M as m,f as ee,b as te,L as Wt,l as Rt,A as Bt}from"./i8clt0mfz495j7ii.js";import{tb as oe,tc as Mt,o as Y,L as Z,d as E,$ as q,k6 as O,cc as ve,pA as Ft,td as Ht,te as Se,t9 as ce,iC as de,aV as yt,f as $t,tf as _t,C as bt,tg as J,th as fe,ti as ye,P as j,R as H,tj as we,pB as _e,tk as ct,tl as jt,tm as Kt,tn as wt,T as kt,dv as Vt,b0 as be,gl as Qt,m9 as Yt,u as Te,be as Ct,jR as Zt,to as Xt,h as Jt,F as es,h7 as ts}from"./ghewn7l2ynbm32fm.js";import{r as ss}from"./iguylefzk1dr51wi.js";import{b8 as as,hk as $,gY as Ut,uE as St,o as os,nr as rs,bL as ns,bd as is,kk as ls,hZ as cs}from"./j0yo6uv6652vva62.js";import{S as ds}from"./mq11hu99eist2abq.js";import{d as us}from"./o4m46p2hmbpmbw32.js";import{v as A,p as Tt}from"./m5w9igq1wqtt0i8f.js";import{L as ms}from"./gru2v64zamj4frog.js";import{V as gs,u as ps,O as le}from"./ckubph10k3oeacic.js";import{T as me}from"./zm1ki9l766pgg0bx.js";import{G as hs}from"./mpvcaagn7eiaugto.js";import{e as fs,M as Ce}from"./hr620pwkxf4zlhpg.js";import{c as xs,a as vs}from"./k11vc5v60fqtwe47.js";import{u as Ms,b as ys}from"./3vr3npo27kg7k1gc.js";import"./pajs134rv9yn6t4z.js";import"./eflwd0j5c3pxruh8.js";import"./galyil7vygq0i5a6.js";import"./kf7tqzde2yk57qjr.js";import"./nvrhbbc4qxooogd5.js";import"./l3jkxavl2du23cqn.js";import"./pc8anf0wrjlgogua.js";import"./mewip4u74thselsp.js";import"./fb2095ktsebx1zzy.js";import"./eyao241335injypy.js";import"./ktw3b87sujui39wx.js";import"./nrrhfi0a0bbsg9w2.js";import"./hht3m8p9e0s4tqnx.js";import"./kgnykbdth8mb50na.js";import"./g8i6bixylsxyemsr.js";import"./fvjpw0lui4wq7vv3.js";import"./mpzbsmypy64alaao.js";import"./olrcssu7duieo6m7.js";const V=oe(Mt(new Date,1)),se=new Date,_s=Y(()=>Q(()=>import("./jyroje0qaxw6h3z1.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>Z(t)}),bs=Y(()=>Q(()=>import("./frf0wu8ouyfyu06j.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>Z(t)});function ke({onLeft:t,leftDisabled:s,onRight:a,rightDisabled:o,children:r,className:n,borderLess:i=!1,surpressChildrenWrapper:u=!1}){return e.jsxs("div",{className:E("flex items-stretch",n),children:[e.jsx(q,{className:E("disabled:text-token-text-quaternary pe-1",!i&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:i?"ghost":"secondary",size:"small",onClick:t,disabled:s,icon:bs}),u?r:e.jsx("span",{className:E("flex grow items-center justify-center px-1 text-sm",!i&&"border-token-border-medium border-t border-b"),children:r}),e.jsx(q,{className:E("disabled:text-token-text-quaternary ps-1",!i&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:i?"ghost":"secondary",size:"small",onClick:a,disabled:o,icon:_s})]})}const js=ss(12);function Lt({referenceDate:t,setReferenceDate:s,earliestValidDate:a,latestValidDate:o,motionLayoutId:r}){return e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>s(Mt(t,1),"subYear"),onRight:()=>s(Ft(t,1),"addYear"),leftDisabled:ve(new Date)>=ve(t)+1,rightDisabled:ve(new Date)<=ve(t),children:O(t,"y")}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:js.map(n=>{const i=oe(Ht(t,n)),u=Se(i,t),l=ce(i,a)||de(i,o);return e.jsxs("button",{disabled:l,onClick:()=>s(i,"select"),className:E("relative h-8 w-full rounded-md",!l&&"hover:bg-token-surface-hover"),children:[u&&e.jsx(yt.div,{layoutId:r,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),e.jsx("span",{className:E("relative z-10 transition-colors duration-75",u&&"text-token-main-surface-primary delay-75",!u&&"text-token-text-primary delay-0",l&&"text-token-text-quaternary"),children:O(i,"MMM")})]},n)})})]})}const ws=Y(()=>Q(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yA),__vite__mapDeps([3,1,4,5,6])),{loading:t=>Z(t)});function ks({currentWorkspaceId:t,currentTab:s,onClose:a}){var h;const o=ae(),[r,n]=g.useState(!1),[i,u]=g.useState(s==="gptsTab"?"gpt":"user"),[l,p]=g.useState("thisMonth"),[c,y]=g.useState(),v=(h=$t(_=>{var w;return(w=_.currentWorkspace)==null?void 0:w.name}))!=null?h:t,M=new Date,x=_t(new Date,1);return e.jsxs(bt,{testId:"modal-export",isOpen:!0,onClose:()=>{a(),j.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:e.jsx(m,d({},L.title)),showCloseButton:!0,primaryButton:e.jsx(q,{loading:r,onClick:async()=>{var _,w;n(!0);try{const f=l==="customRange"?{period:(_=c==null?void 0:c.period)!=null?_:he.period,period_start:A((w=c==null?void 0:c.referenceDate)!=null?w:he.referenceDate)}:Ss(l);j.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:i,dateRangeType:l,period:f.period,periodStart:f.period_start});const C=await H.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:t},query:G(d({},f),{report_type:i})}});us({data:C.csv_content,mimeType:"text/csv",filename:o.formatMessage(L.filename,{workspaceName:v,period:f.period,reportType:i,date:f.period_start})})}finally{n(!1)}a()},children:e.jsx(m,d({},L.generateCsvButton))}),children:[e.jsxs(ms,{className:"font-medium",children:[e.jsx(m,d({},L.dataTypeDropdownLabel)),e.jsx(as,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:i,onValueChange:_=>u(_),options:[{label:o.formatMessage(L.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(L.dataTypeDropdownGpts),value:"gpt"}]})]}),e.jsx("div",{className:"mt-6 mb-2 font-medium",children:e.jsx(m,d({},L.dateRangeLabel))}),e.jsxs($.Root,{className:"flex flex-col gap-3",value:l,onValueChange:_=>{p(_),j.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:_})},children:[e.jsx($.Item,{value:"thisMonth",label:e.jsx(m,G(d({},L.thisMonthLabel),{values:{date:O(M,"MMMM y")}})),children:e.jsx($.Indicator,{})}),e.jsx($.Item,{value:"lastMonth",label:e.jsx(m,G(d({},L.lastMonthLabel),{values:{date:O(J(M,1),"MMMM y")}})),children:e.jsx($.Indicator,{})}),e.jsx($.Item,{value:"thisWeek",label:e.jsx(m,G(d({},L.thisWeekLabel),{values:{date:"".concat(O(fe(M),"MMM d")," – ").concat(O(ye(M),"MMM d"))}})),children:e.jsx($.Indicator,{})}),e.jsx($.Item,{value:"lastWeek",label:e.jsx(m,G(d({},L.lastWeekLabel),{values:{date:"".concat(O(fe(x),"MMM d")," – ").concat(O(ye(x),"MMM d"))}})),children:e.jsx($.Indicator,{})}),e.jsx($.Item,{value:"customRange",label:e.jsx(Cs,{customRange:c,setCustomRange:y,onClick:()=>p("customRange")}),children:e.jsx($.Indicator,{})})]})]})}const he={period:"monthly",referenceDate:new Date};function Cs({customRange:t,setCustomRange:s,onClick:a}){const o=ae(),r=(t!=null?t:he).period,n=(t!=null?t:he).referenceDate,i=r==="monthly"?we(n):ye(n),u=({period:l,referenceDate:p})=>s((c=he)=>{const y=l!=null?l:c.period,v=p!=null?p:c.referenceDate,M=y==="monthly"?oe:fe,x=de(v,se)?se:ce(v,V)?V:v;return{period:y,referenceDate:M(x)}});return e.jsx(Ut,{className:"z-50",alignAgainstAnchor:"start",triggerButton:e.jsxs(q,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:a,children:[t?e.jsx(m,G(d({},L.customRangeDisplay),{values:{start:ct(t.referenceDate),end:ct(i)}})):e.jsx(m,d({},L.chooseMonthOrWeekButton)),e.jsx("div",{className:"grow"}),e.jsx(ws,{})]}),children:e.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[e.jsx(ds,{className:"mb-4 rounded-md",value:r,onChange:l=>{u({period:l}),j.logEvent("Workspace Usage: Export Custom Period Changed",{period:l})},ariaLabel:o.formatMessage(L.customRangePeriodToggleAria),leftItem:{className:"rounded-md",ariaLabel:o.formatMessage(L.chooseDateMonthlyLabel),label:o.formatMessage(L.chooseDateMonthlyLabel),value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:o.formatMessage(L.chooseDateWeeklyLabel),label:o.formatMessage(L.chooseDateWeeklyLabel),value:"weekly"}}),r==="monthly"?e.jsx(Lt,{referenceDate:n,setReferenceDate:(l,p)=>{u({referenceDate:l}),j.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:p})},earliestValidDate:V,latestValidDate:se,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{u({referenceDate:J(n,1)}),j.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{u({referenceDate:_e(n,1)}),j.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:ce(J(n,1),V),rightDisabled:de(_e(n,1),se),children:O(n,"MMMM y")}),e.jsx(Us,{referenceDate:n,setReferenceDate:l=>u({referenceDate:l})})]})]})})}const Us=({referenceDate:t,setReferenceDate:s})=>{const a=oe(t),o=jt({start:a,end:we(t)});return e.jsx("div",{className:"flex flex-col gap-1",children:o.map(r=>{const n=Kt(r,t),i=ce(r,V)||de(r,new Date);return e.jsxs("button",{disabled:i,onClick:()=>{s(r),j.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:E("relative h-8 w-full rounded-full",!i&&"hover:bg-token-surface-hover"),children:[n&&e.jsx(yt.div,{layoutId:"workspaceUsage.exportModal.customRange.weekHighlight.".concat(a.toISOString()),className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),e.jsx("div",{className:E("relative z-10 flex w-full justify-around transition-colors duration-75",n&&"text-token-main-surface-primary delay-75",!n&&"text-token-text-primary delay-0"),children:wt({start:r,end:ye(r)}).map(u=>e.jsx("div",{className:E("w-0 grow",{"text-token-text-quaternary":!Se(u,t)||de(u,new Date)||ce(u,V)}),children:O(u,"d")},u.toISOString()))})]},r.toISOString())})})};function Ss(t){const s=new Date;return t==="thisWeek"||t==="lastWeek"?{period:"weekly",period_start:A(fe(t==="thisWeek"?s:_t(s,1)))}:{period:"monthly",period_start:A(oe(t==="thisMonth"?s:J(s,1)))}}const L=ee({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}}),Ts=Y(()=>Q(()=>import("./gsas8pb1acnf7jnd.js").then(t=>t._),__vite__mapDeps([7,1])),{loading:t=>Z(t)});function Le({startDate:t,statsSpec:s,data:a,previousData:o}){return e.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:s.map(({dataKey:r,label:n,helpText:i})=>{const u=a==null?"loading":a[r],l=o==null?"loading":o[r];return e.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[e.jsxs("div",{className:"text-token-text-secondary text-sm",children:[e.jsx(m,d({},n)),e.jsx(St,{}),i&&e.jsx(kt,{label:e.jsx("span",{className:"text-token-main-surface-primary font-normal",children:e.jsx(m,d({},i))}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(Ts,{className:"icon-sm inline"})})]}),e.jsx(gs,{value:u,previousValue:l,hideTrend:Se(t,new Date),className:"h-[28px]"})]},r)})})}const Ls=Y(()=>Q(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yo),__vite__mapDeps([3,1,4,5,6])),{loading:t=>Z(t)});function De({handleSearch:t,clientEventSource:s,className:a}){const r=ae().formatMessage(Ds.filterListInputLabel),n=g.useCallback(Vt(i=>{t(i),j.logEvent("Workspace Usage: Filter Searched",{queryLength:i.length,trigger:"debouncedTyping",source:s})},250),[]);return e.jsx(os,{className:E("max-w-[300px]",a),ariaLabel:r,placeholder:r,type:"text",name:"search",icon:Ls,iconPosition:"left",saveOnBlur:!0,value:"",onChange:i=>n(i.target.value.trim()),onPressEnter:i=>{var l;const u=(l=i==null?void 0:i.trim())!=null?l:"";t(u),j.logEvent("Workspace Usage: Filter Searched",{queryLength:u.length,trigger:"enterKey",source:s})}})}const Ds=ee({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),Es=Y(()=>Q(()=>import("./e23v0up48ofc1v2q.js").then(t=>t._),__vite__mapDeps([8,1])),{loading:t=>Z(t)}),Ns=Y(()=>Q(()=>import("./bimaydywrdin6h6p.js").then(t=>t._),__vite__mapDeps([9,1])),{loading:t=>Z(t)}),dt=20,ut=[{cursor:void 0,queryId:void 0}];function Ee({getQueryKey:t,loader:s,initialSortDirection:a,spec:o,getData:r,clientEventSource:n}){var z,K;const[i,u]=g.useState(a),[l,p]=g.useState(ut),[c,y]=g.useState(0),[v,M]=g.useState(),x=te({queryKey:t({order_by_field:i.metric,order_by_direction:i.direction,cursor:(z=l[c])==null?void 0:z.cursor,query_id:(K=l[c])==null?void 0:K.queryId,page_size:dt}),queryFn:({queryKey:k})=>s(k)}),h=x.data?r(x.data):"loading",_=rs(h),w=h==="loading"&&_.current!=="loading",f=w?_.current:h;g.useEffect(()=>{var k,N;(k=x.data)!=null&&k.next_cursor&&((N=x.data)!=null&&N.query_id)&&l.length===c+1&&p(U=>{var T,W;return[...U,{cursor:(T=x.data)==null?void 0:T.next_cursor,queryId:(W=x.data)==null?void 0:W.query_id}]})},[x.data,l,c]),g.useEffect(()=>{v==null&&x.data&&(x.data.total_count!=null?M(Math.ceil(x.data.total_count/dt)):M(1))},[x.data,l,v]);const C=i.direction==="ASC"?Es:Ns;return e.jsxs("div",{className:"mt-4",children:[e.jsxs(me.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[e.jsx(me.Header,{children:o.map(({metric:k,label:N,defaultSortDirection:U="ASC"})=>e.jsxs(me.HeaderCell,{className:"text-[13px] font-medium text-nowrap",onClick:()=>{y(0),p(ut),u(T=>{let W;return k===T.metric?W=T.direction==="ASC"?"DESC":"ASC":W=U,j.logEvent("Workspace Usage: Table Sort Clicked",{metric:k,direction:W,source:n}),{direction:W,metric:k}})},children:[N,i.metric===k&&e.jsx(C,{className:"icon text-token-icon-secondary ms-1 inline"})]},k))}),e.jsx(me.Body,{children:f&&f!=="loading"&&f.map((k,N)=>e.jsx(me.Row,{children:o.map(({metric:U,render:T},W)=>e.jsx(me.Cell,{className:E(w&&"pt-0 pb-0 [&]:border-0"),divClassName:E("items-center",W>0&&"text-token-text-secondary",!w&&"min-h-[40px]",w&&"h-0 overflow-hidden"),children:T(k[U],k)},U))},N))})]}),h==="loading"&&e.jsx("div",{className:"flex h-[860px] items-center justify-center",children:e.jsx(be,{})}),h!=="loading"&&h.length===0&&e.jsx("div",{className:"flex h-[100px] items-center justify-center",children:e.jsx(m,d({},As.zeroStateMessage))}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(ke,{onLeft:()=>{y(k=>{const N=k-1;return j.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:N,source:n}),N})},leftDisabled:c<=0,onRight:()=>{y(k=>{const N=k+1;return j.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:N,source:n}),N})},rightDisabled:l[c+1]==null,children:[c+1,"/",v!=null?v:e.jsx(be,{})]})})]})}const As=ee({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}}),F=(t,{toastId:s="chatgpt.usageAnalytics.defaultErrorToastId",message:a}={})=>ps(t,{toastId:s,message:a}),Ps=Y(()=>Q(()=>import("./e6eptpe9toj61kmv.js").then(t=>t._),__vite__mapDeps([10,1])),{loading:t=>Z(t)});function je(t,s,a){return te({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:t,startDate:s,gizmoType:a!=null?a:null}],queryFn:F(({queryKey:[o,r]})=>{const n={start_date:r.startDate};return r.gizmoType&&(n.gizmo_type=r.gizmoType),H.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:n,path:{account_id:r.workspaceId}}})})})}async function Dt(o){var[t,r]=o,n=r,{workspaceId:s}=n,a=ie(n,["workspaceId"]);return H.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:s},query:a}})}const Et={direction:"DESC",metric:"active_users"};function Os({currentWorkspaceId:t,startDate:s}){const[a,o]=g.useState(""),r=A(s),n=g.useCallback(c=>["workspace-analytics-gizmos-list",d({workspaceId:t,start_date:r,filter_query:a,gizmo_type:"gpt"},c)],[r,a,t]),i=je(t,r,"gpt"),u=A(J(s,1)),l=je(t,u,"gpt"),p=F(Dt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Le,{startDate:s,data:i.data,previousData:l.data,statsSpec:Gs}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(De,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),e.jsx(q,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(m,d({},I.manageGPTs)),e.jsx(Ps,{className:"icon-sm"})]})})]}),e.jsx(Ee,{getQueryKey:n,loader:p,getData:c=>c.gizmos,spec:Nt,initialSortDirection:Et,clientEventSource:"gizmoList"},"".concat(t,".gpt.").concat(r,".").concat(a))]})}function zs({currentWorkspaceId:t,startDate:s}){const[a,o]=g.useState(""),r=A(s),n=g.useCallback(c=>["workspace-analytics-gizmos-list",d({workspaceId:t,start_date:r,filter_query:a,gizmo_type:"project"},c)],[r,a,t]),i=je(t,r,"project"),u=A(J(s,1)),l=je(t,u,"project"),p=F(Dt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Le,{startDate:s,data:i.data,previousData:l.data,statsSpec:Is}),e.jsx("div",{className:"flex justify-between",children:e.jsx(De,{className:"grow",handleSearch:o,clientEventSource:"projectList"})}),e.jsx(Ee,{getQueryKey:n,loader:p,getData:c=>c.gizmos,spec:Nt,initialSortDirection:Et,clientEventSource:"projectList"},"".concat(t,".project.").concat(r,".").concat(a))]})}const I=ee({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"},totalProjects:{id:"workspaceUsage.gizmoList.stats.totalProjects",defaultMessage:"Total Projects"},projectsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.projectsCreatedThisMonth",defaultMessage:"Projects Created This Month"},projectsActive:{id:"workspaceUsage.gizmoList.stats.projectsActive",defaultMessage:"Projects active"},projectsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.projectsActiveHelpText",defaultMessage:"Projects with at least one message during this month"}}),Gs=[{dataKey:"total_gpt_count",label:I.totalGpts},{dataKey:"gpt_created",label:I.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:I.gptsActive,helpText:I.gptsActiveHelpText}],Is=[{dataKey:"total_gpt_count",label:I.totalProjects},{dataKey:"gpt_created",label:I.projectsCreatedThisMonth},{dataKey:"active_gpt_count",label:I.projectsActive,helpText:I.projectsActiveHelpText}],qs=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function mt(t){return typeof t=="number"?qs.format(t):null}const Nt=[{metric:"gpt_name",label:e.jsx(m,d({},I.nameColumnLabel)),render:(t,{config_type:s})=>e.jsxs("div",{className:"flex grow items-center justify-between",children:[e.jsx("span",{children:t}),s==="draft"&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(m,d({},I.draftFlag))})]})},{label:e.jsx(m,d({},I.creatorNameColumnLabel)),metric:"creator_name",render:t=>t},{metric:"messages",label:e.jsx(m,d({},I.messagesColumnLabel)),render:mt,defaultSortDirection:"DESC"},{metric:"active_users",label:e.jsx(m,d({},I.activeUsersColumnLabel)),render:mt,defaultSortDirection:"DESC"}];function Ws({startDate:t,setStartDate:s}){return e.jsx(ke,{onLeft:()=>{s(a=>{const o=J(a,1);return j.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:A(o)}),o})},leftDisabled:ce(J(t,1),V),onRight:()=>{s(a=>{const o=_e(a,1);return j.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:A(o)}),o})},rightDisabled:de(_e(t,1),se),surpressChildrenWrapper:!0,children:e.jsx(Rs,{startDate:t,setStartDate:s})})}function Rs({startDate:t,setStartDate:s}){return e.jsx(Ut,{triggerButton:e.jsx(q,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:O(t,"MMM y")}),children:e.jsx("div",{className:"w-[210px] p-1 text-xs",children:e.jsx(Lt,{referenceDate:t,setReferenceDate:(a,o)=>{const r=oe(de(a,se)?se:ce(a,V)?V:a);s(r),j.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:A(r)})},earliestValidDate:V,latestValidDate:se,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}function Bs({currentWorkspaceId:t,selectedGroup:s,onSelect:a,onClose:o}){var w;const r=ae(),[n,i]=g.useState(""),u=ns(n,300),[l,p]=g.useState(0),{groups:c,isLoading:y,isPlaceholderData:v}=fs({workspaceId:t,currPage:l,groupFilter:u}),M=((w=c==null?void 0:c.items)!=null?w:[]).filter(f=>!f.system_use_case),x=c&&c.total>0?Math.ceil(c.total/Ce):1;g.useEffect(()=>{if(!c)return;const f=c.total>0?Math.ceil(c.total/Ce):1,C=Math.max(f-1,0);p(z=>z>C?C:z)},[c]);const h=f=>{var C;a(f),j.logEvent("Workspace Usage: Group Modal Selection",{groupId:(C=f==null?void 0:f.id)!=null?C:null})},_=y&&!c;return e.jsx(bt,{testId:"modal-group-selection",isOpen:!0,onClose:()=>o(),showCloseButton:!0,title:e.jsx(m,d({},R.title)),description:e.jsx(m,G(d({},R.description),{values:{br:e.jsx("br",{})}})),footerContent:e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-3 sm:mt-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(q,{as:"link",to:"/admin/groups",color:"secondary",size:"small",className:"self-start sm:self-auto",onClick:()=>{j.logEvent("Workspace Usage: Group Modal Manage Groups Clicked"),o()},children:e.jsx(m,d({},R.manageGroupsCta))}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx(q,{color:"ghost",size:"small",onClick:()=>h(null),children:e.jsx(m,d({},R.clearSelection))}),e.jsx(q,{color:"secondary",size:"small",onClick:()=>o(),children:e.jsx(m,d({},R.closeButton))})]})]}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(is,{value:n,onChange:f=>{const C=f.target.value;i(C),p(0),j.logEvent("Workspace Usage: Group Modal Search Updated",{queryLength:C.length})},placeholder:r.formatMessage(R.searchPlaceholder),inputClassName:"w-full rounded-full! text-sm"}),e.jsx("div",{className:E("border-token-border-subtle max-h-[360px] min-h-[180px] overflow-y-auto rounded-lg border"),children:_?e.jsx("div",{className:"flex h-full items-center justify-center p-6",children:e.jsx(be,{})}):M.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 p-6 text-center",children:[e.jsx("span",{className:"text-token-text-secondary text-sm font-medium",children:e.jsx(m,d({},R.emptyStateTitle))}),e.jsx("span",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,d({},R.emptyStateSubtitle))})]}):e.jsx("ul",{className:E("divide-token-border-subtle divide-y",v&&"opacity-50"),children:M.map(f=>{var k;const C=(s==null?void 0:s.id)===f.id,z=Number((k=f.num_members)!=null?k:0),K=Number.isFinite(z)?z:0;return e.jsxs("li",{className:E("flex flex-col gap-3 p-4 sm:flex-row sm:items-center sm:justify-between",C&&"bg-token-main-surface-secondary"),children:[e.jsxs("div",{className:"flex flex-1 items-start gap-3",children:[e.jsx(hs,{group:f}),e.jsxs("div",{children:[e.jsx(Wt,{to:"/admin/groups/".concat(f.id),className:"text-token-text-primary text-sm font-medium hover:underline focus:outline-none focus-visible:underline",onClick:()=>{j.logEvent("Workspace Usage: Group Modal View Group Clicked",{groupId:f.id})},children:f.name}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,G(d({},R.memberCount),{values:{count:K}}))})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(q,{color:C?"primary":"secondary",size:"small",onClick:()=>h({id:f.id,name:f.name}),children:C?e.jsx(m,d({},R.selectedLabel)):e.jsx(m,d({},R.selectLabel))})})]},f.id)})})}),c&&c.total>Ce&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,G(d({},R.paginationSummary),{values:{page:l+1,totalPages:x}}))}),e.jsx(ls,{currentPage:l,onChangeIndex:f=>p(f),length:x})]})]})})}const R=ee({title:{id:"workspaceUsage.groupModal.title",defaultMessage:"Select a group"},description:{id:"workspaceUsage.groupModal.description",defaultMessage:"Filter analytics for members within a workspace group."},searchPlaceholder:{id:"workspaceUsage.groupModal.searchPlaceholder",defaultMessage:"Search groups"},emptyStateTitle:{id:"workspaceUsage.groupModal.emptyStateTitle",defaultMessage:"No groups found"},emptyStateSubtitle:{id:"workspaceUsage.groupModal.emptyStateSubtitle",defaultMessage:"Try a different search or create a new group from settings."},memberCount:{id:"workspaceUsage.groupModal.memberCount",defaultMessage:"{count, plural, one {# member} other {# members}}"},selectLabel:{id:"workspaceUsage.groupModal.selectLabel",defaultMessage:"Select"},selectedLabel:{id:"workspaceUsage.groupModal.selectedLabel",defaultMessage:"Selected"},paginationSummary:{id:"workspaceUsage.groupModal.paginationSummary",defaultMessage:"Page {page} of {totalPages}"},manageGroupsCta:{id:"workspaceUsage.groupModal.manageGroupsCta",defaultMessage:"Manage groups"},clearSelection:{id:"workspaceUsage.groupModal.clearSelection",defaultMessage:"Clear selection"},closeButton:{id:"workspaceUsage.groupModal.closeButton",defaultMessage:"Close"}});var Ue,gt;function Fs(){if(gt)return Ue;gt=1;var t=Qt(),s=Yt(),a=s(function(o,r,n){t(o,n,r)});return Ue=a,Ue}var Hs=Fs();const $s=Rt(Hs);async function Ks({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return H.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function Vs(t,s,a){return te({queryKey:["workspace-analytics-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:F(Ks)})}async function Qs({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return H.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function Ys(t,s,a){return te({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:F(Qs)})}async function Zs({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return H.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function Xs(t,s,a){return te({queryKey:["workspace-analytics-tool-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:F(Zs)})}async function Js({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return H.safeGet("/accounts/{account_id}/analytics/project_overview",{parameters:{query:{start_date:a,group_id:o!=null?o:void 0},path:{account_id:s}}})}function ea(t,s,a){return te({queryKey:["workspace-analytics-project-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:F(Js)})}async function ta({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return H.safeGet("/accounts/{account_id}/analytics/connector_overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function sa(t,s,a){return te({queryKey:["workspace-analytics-connector-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:F(ta)})}function ge(t,s,a){return g.useMemo(()=>{if(!s)return;const o=$s(s,"date");return wt({start:t,end:we(t)}).map(r=>{var u;const n=A(r),i=o[n];return i&&i.total>0?{date:i.date,total:i.total,values:(u=i[a])!=null?u:{}}:{date:n,blank:0}})},[t,s,a])}function aa(t,s,a){var Ne,Ae,Pe,Oe,ze,Ge,Ie,qe,We,Re,Be,Fe,He,$e,Ke,Ve,Qe,Ye,Ze,Xe,Je,et;const o=A(s),r=Vs(t,o,a),n=g.useMemo(()=>{var b,S;return(S=(b=r.data)==null?void 0:b.active_user_data)==null?void 0:S.daily_data.map(({date:ue,active_users:re})=>({date:ue,total:re,values:{active_users:re}}))},[(Ae=(Ne=r.data)==null?void 0:Ne.active_user_data)==null?void 0:Ae.daily_data]),i=ge(s,n,"values"),u=ge(s,(Oe=(Pe=r.data)==null?void 0:Pe.messages_data)==null?void 0:Oe.daily_data,"messages_by_model"),l=Ys(t,o,a),p=ge(s,(ze=l.data)==null?void 0:ze.daily_gizmo_messages_data,"messages_by_gpt"),c=Xs(t,o,a),y=ge(s,(Ge=c.data)==null?void 0:Ge.daily_tool_messages_data,"messages_by_tool"),v=ea(t,o,a),M=g.useMemo(()=>{var b,S;return(S=(b=v.data)==null?void 0:b.project_names)!=null?S:null},[v.data]),x=ge(s,(Ie=v.data)==null?void 0:Ie.daily_project_messages_data,"messages_by_project"),h=sa(t,o,a),_=ge(s,(qe=h.data)==null?void 0:qe.daily_connector_messages_data,"messages_by_connector"),w=ae(),f=g.useMemo(()=>{var b;return i&&((b=r.data)!=null&&b.active_user_data)?{data:i,metrics:{active_users:{displayName:w.formatMessage(pt.activeUsers)}},monthOverMonth:r.data.active_user_data.month_to_month_data}:"loading"},[i,w,(We=r.data)==null?void 0:We.active_user_data]),C=g.useMemo(()=>{var b;return u&&((b=r.data)!=null&&b.messages_data)?{data:u,metrics:Me(r.data.messages_data.models),monthOverMonth:r.data.messages_data.month_to_month_data}:"loading"},[u,(Re=r.data)==null?void 0:Re.messages_data]),z=g.useMemo(()=>{var tt,st;const b=(st=(tt=r.data)==null?void 0:tt.active_user_data)==null?void 0:st.weekly_data;if(!b)return;const S=new Map,ue=(()=>{if(b.length>0){const P=Tt(b[0].period_start_date).getDay();if(P>=0&&P<=6)return P}return 0})(),re=jt({start:fe(s,{weekStartsOn:ue}),end:we(s)},{weekStartsOn:ue}),Gt=new Set(re.map(P=>A(P)));return re.forEach(P=>{const ne=A(P);S.set(ne,{date:ne,blank:0})}),b.forEach(({period_start_date:P,active_users:ne})=>{Gt.has(P)&&S.set(P,{date:P,total:ne,values:{active_users:ne}})}),Array.from(S.entries()).sort(([P],[ne])=>P.localeCompare(ne)).map(([,P])=>P)},[(Fe=(Be=r.data)==null?void 0:Be.active_user_data)==null?void 0:Fe.weekly_data,s]),K=($e=(He=r.data)==null?void 0:He.active_user_data)==null?void 0:$e.month_to_month_data,k=g.useMemo(()=>z&&K?{data:z,metrics:{active_users:{displayName:w.formatMessage(pt.weeklyActiveUsers)}},monthOverMonth:K}:"loading",[w,z,K]),N=g.useMemo(()=>{var b,S;return p&&((b=l.data)!=null&&b.metrics)&&((S=l.data)!=null&&S.month_to_month_data)?{data:p,metrics:Object.fromEntries(Object.entries(l.data.metrics).map(([ue,re])=>[ue,{displayName:re}])),monthOverMonth:l.data.month_to_month_data}:"loading"},[p,(Ke=l.data)==null?void 0:Ke.metrics,(Ve=l.data)==null?void 0:Ve.month_to_month_data]),U=g.useMemo(()=>{var b,S;return x&&((b=v.data)!=null&&b.project_list)&&((S=v.data)!=null&&S.month_to_month_data)?{data:x,metrics:Me(v.data.project_list,M),monthOverMonth:v.data.month_to_month_data}:"loading"},[x,(Qe=v.data)==null?void 0:Qe.month_to_month_data,(Ye=v.data)==null?void 0:Ye.project_list,M]),T=g.useMemo(()=>{var b,S;return y&&((b=c.data)!=null&&b.tool_list)&&((S=c.data)!=null&&S.month_to_month_data)?{data:y,metrics:Me(c.data.tool_list),monthOverMonth:c.data.month_to_month_data}:"loading"},[y,(Ze=c.data)==null?void 0:Ze.month_to_month_data,(Xe=c.data)==null?void 0:Xe.tool_list]),W=g.useMemo(()=>{var b,S;return _&&((b=h.data)!=null&&b.connector_list)&&((S=h.data)!=null&&S.month_to_month_data)?{data:_,metrics:Me(h.data.connector_list),monthOverMonth:h.data.month_to_month_data}:"loading"},[_,(Je=h.data)==null?void 0:Je.connector_list,(et=h.data)==null?void 0:et.month_to_month_data]);return{dailyActiveUsers:f,weeklyActiveUsers:k,dailyMessages:C,dailyProjectMessages:U,dailyGizmoMessages:N,dailyConnectorMessages:W,dailyToolMessages:T}}function Me(t,s){return Object.entries(t).sort(([,a],[,o])=>a-o).reduce((a,[o,r])=>{var n;return r>0&&(a[o]={displayName:(n=s==null?void 0:s[o])!=null?n:o,total:r}),a},{})}const pt=ee({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Daily unique active users"},weeklyActiveUsers:{id:"workspaceUsage.weeklyActiveUsersMetric",defaultMessage:"Weekly unique active users"}});function At({currentWorkspaceId:t,startDate:s,selectedGroupId:a=null}){const o=ae(),r=Te(),n=aa(t,s,a),i=Ct(r,"3528236309"),u=i.get("show_weekly_active_users_chart",!1),l=i.get("show_connector_overview_chart",!1),p=i.get("show_project_overview_chart",!1),c=g.useCallback(v=>{const M=Tt(v),x=Zt(M,6),h=M.getMonth()===x.getMonth(),_=O(M,"MMM d"),w=h?O(x,"d"):O(x,"MMM d");return"".concat(_," – ").concat(w)},[]),y=!Xt(s,oe(new Date));return e.jsxs("div",{className:"mt-10",children:[e.jsx(le,{title:B.activeUsersChartTitle,data:n.dailyActiveUsers,displayMoM:y,clientEventSource:"activeUsers",hideLegend:!0}),u&&e.jsx(le,{title:B.weeklyActiveUsersChartTitle,data:n.weeklyActiveUsers,displayMoM:!1,clientEventSource:"weeklyActiveUsers",hideLegend:!0,hideTopValue:!0,tooltipLabelFormatter:c}),e.jsx(le,{title:B.messagesChartTitle,data:n.dailyMessages,otherGroupLabel:o.formatMessage(B.otherModels),displayMoM:y,clientEventSource:"totalMessages"}),e.jsx(le,{title:B.gptMessagesChartTitle,data:n.dailyGizmoMessages,otherGroupLabel:o.formatMessage(B.otherGizmos),displayMoM:y,clientEventSource:"gizmoMessages"}),e.jsx(le,{title:B.toolMessagesChartTitle,data:n.dailyToolMessages,otherGroupLabel:o.formatMessage(B.otherTools),displayMoM:y,clientEventSource:"toolMessages"}),p&&e.jsx(le,{title:B.projectMessagesChartTitle,data:n.dailyProjectMessages,otherGroupLabel:o.formatMessage(B.otherProjects),displayMoM:y,clientEventSource:"projectMessages"}),l&&e.jsx(le,{title:B.connectorMessagesChartTitle,data:n.dailyConnectorMessages,otherGroupLabel:o.formatMessage(B.otherConnectors),displayMoM:y,clientEventSource:"connectorMessages"})]})}const B=ee({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Daily unique active users"},weeklyActiveUsersChartTitle:{id:"workspaceUsage.overview.weeklyActiveUsersChartTitle",defaultMessage:"Weekly unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},projectMessagesChartTitle:{id:"workspaceUsage.overview.projectMessagesChartTitle",defaultMessage:"Project messages sent"},connectorMessagesChartTitle:{id:"workspaceUsage.overview.connectorMessagesChartTitle",defaultMessage:"Connector messages received"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherProjects:{id:"workspaceUsage.overview.otherProjects",defaultMessage:"Other Projects"},otherConnectors:{id:"workspaceUsage.overview.otherConnectors",defaultMessage:"Other Connectors"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"}}),oa=Y(()=>Q(()=>import("./e6eptpe9toj61kmv.js").then(t=>t._),__vite__mapDeps([10,1])),{loading:t=>Z(t)}),Pt=Y(()=>Q(()=>import("./iieayfdj62qz1wzr.js").then(t=>t._),__vite__mapDeps([11,1])),{loading:t=>Z(t)});function ra(a){var o=a,{className:t}=o,s=ie(o,["className"]);return e.jsx(Pt,G(d({},s),{className:t}))}function ht(t,s){return te({queryKey:["workspace-analytics-user-stats",{workspaceId:t,startDate:s}],queryFn:F(({queryKey:[a,o]})=>H.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function na(o){var[t,r]=o,n=r,{workspaceId:s}=n,a=ie(n,["workspaceId"]);const p=a,{view_mode:i,limit:u}=p,l=ie(p,["view_mode","limit"]);return H.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:s},query:l}})}const ia={direction:"DESC",metric:"messages"};async function la(o){var[t,r]=o,n=r,{workspaceId:s}=n,a=ie(n,["workspaceId"]);const v=a,{page_size:i,cursor:u,query_id:l,limit:p,view_mode:c}=v,y=ie(v,["page_size","cursor","query_id","limit","view_mode"]);return H.safeGet("/accounts/{account_id}/analytics/user_list/power_users",{parameters:{path:{account_id:s},query:d({},y)}})}function Ot({currentWorkspaceId:t,startDate:s,showAiChampionsButton:a}){const o=ae(),[r,n]=g.useState(""),[i,u]=g.useState(!1),l=a&&i;g.useEffect(()=>{!a&&i&&u(!1)},[a,i]);const p=Te(),c=Jt(p,"2861925050"),y=g.useCallback((U,T)=>{const W=U!=null?U:T.email;return e.jsxs("div",{className:"group flex items-center gap-2",children:[l&&e.jsx(Pt,{className:"icon-sm"}),e.jsx("span",{children:W})]})},[l]),v=g.useMemo(()=>(c?[...ft,{label:e.jsx(m,d({},D.creditsUsedColumnLabel)),metric:"credits_used",render:pe,defaultSortDirection:"DESC"}]:ft).map(T=>T.metric==="name"?G(d({},T),{render:y}):T),[c,y]),M=A(s),x=g.useCallback(U=>["workspace-analytics-users-list",G(d({workspaceId:t,start_date:M,filter_query:r},U),{view_mode:l?"power":"default"})],[M,r,t,l]),h=ht(t,M),_=A(J(s,1)),w=ht(t,_),f=F(na),C=F(la),z=g.useCallback(U=>l?C(U):f(U),[l,f,C]),K=g.useCallback(()=>{a&&u(U=>{const T=!U;return j.logEvent("Workspace Usage: AI Champions Clicked",{source:"userList",state:T?"enabled":"disabled"}),T})},[a]),k=g.useMemo(()=>"".concat(t,".").concat(M,".").concat(r,".").concat(l?"champions":"default"),[l,t,r,M]),N=l?ua:ia;return e.jsxs("div",{className:"mb-8",children:[e.jsx(Le,{startDate:s,data:h.data,previousData:w.data,statsSpec:ca}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsx(De,{className:"grow md:max-w-xs",handleSearch:n,clientEventSource:"userList"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(kt,{label:o.formatMessage(D.aiChampionsButtonTooltip),side:"top",children:e.jsx(q,{size:"small",color:i?"primary":"secondary",icon:ra,onClick:K,"aria-pressed":i,className:"group transition-colors",iconClassName:"icon-sm",children:e.jsx(m,d({},D.aiChampionsButtonLabel))})}),e.jsx(q,{as:"link",to:"/admin/members",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(m,d({},D.manageUsersLink)),e.jsx(oa,{className:"icon-sm"})]})})]})]}),e.jsx(Ee,{getQueryKey:x,loader:z,getData:U=>U.users,spec:v,initialSortDirection:N,clientEventSource:"userList"},k)]})}const D=ee({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Seats enabled"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},projectMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.projectMessages",defaultMessage:"Project Messages"},connectorMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.connectorMessages",defaultMessage:"Connector Messages"},creditsUsedColumnLabel:{id:"workspaceUsage.userList.tableHeader.creditsUsed",defaultMessage:"Credits Used"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"},aiChampionsButtonLabel:{id:"workspaceUsage.userList.aiChampions.buttonLabel",defaultMessage:"AI Champions"},aiChampionsButtonTooltip:{id:"workspaceUsage.userList.aiChampions.buttonTooltip",defaultMessage:'Shows your most engaged users. See "Learn more" above for the selection criteria.'}}),ca=[{dataKey:"purchased_seats",label:D.purchasedSeats},{dataKey:"claimed_seat",label:D.claimedSeats,helpText:D.claimedSeatsHelpText},{dataKey:"active_users",label:D.activeUsers,helpText:D.activeUsersHelpText},{dataKey:"pending_invites",label:D.pendingInvites}],da=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function pe(t){return typeof t=="number"?da.format(t):null}const ft=[{metric:"name",label:e.jsx(m,d({},D.nameColumnLabel)),render:t=>t},{metric:"email",label:e.jsx(m,d({},D.emailColumnLabel)),render:t=>t},{metric:"messages",label:e.jsx(m,d({},D.messagesColumnLabel)),render:pe,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},D.gptMessagesColumnLabel)),metric:"gpt_messages",render:pe,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},D.toolMessagesColumnLabel)),metric:"tool_messages",render:pe,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},D.projectMessagesColumnLabel)),metric:"project_messages",render:pe,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},D.connectorMessagesColumnLabel)),metric:"connector_messages",render:pe,defaultSortDirection:"DESC"}],ua={direction:"DESC",metric:"messages"};function ma(t){return Object.keys(t)}var vt;const ga=es.div(vt||(vt=lt(["flex space-x-4"]))),pa=3;function ha(t,s){const a=t.trim().split(/\s+/);return a.length<=s?t:"".concat(a.slice(0,s).join(" "),"...")}const zt={overviewTab:At,usersTab:Ot,gptsTab:Os,projectsTab:zs};function fa(t){return te({queryKey:["workspace-analytics-last-updated",{workspaceId:t}],queryFn:F(({queryKey:[s,a]})=>H.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:a.workspaceId}}}))})}const xt=ma(zt);function xa({currentWorkspaceId:t,startDate:s,setStartDate:a,currentTab:o,setTab:r,selectedGroup:n,setSelectedGroup:i,showGroupFilter:u,tabs:l}){const p=fa(t),[c,y]=g.useState(!1),[v,M]=g.useState(!1),x=(n==null?void 0:n.name)&&ha(n.name,pa);return g.useEffect(()=>{u||M(!1)},[u]),e.jsx(vs,{title:e.jsx(m,d({},X.title)),actions:e.jsxs(e.Fragment,{children:[e.jsx(Ws,{startDate:s,setStartDate:a}),u&&o==="overviewTab"&&e.jsxs(e.Fragment,{children:[e.jsx(q,{className:E("ms-2",n&&"max-w-[240px]"),color:"secondary",size:"small",title:n==null?void 0:n.name,onClick:()=>{M(!0),j.logEvent("Workspace Usage: Group Modal Opened")},children:n?e.jsx("span",{className:"truncate",children:e.jsx(m,G(d({},X.groupButtonSelected),{values:{groupName:x}}))}):e.jsx(m,d({},X.groupButton))}),v&&e.jsx(Bs,{currentWorkspaceId:t,selectedGroup:n,onSelect:h=>{var _;i(h),M(!1),j.logEvent("Workspace Usage: Group Selected",{groupId:(_=h==null?void 0:h.id)!=null?_:null})},onClose:()=>{M(!1),j.logEvent("Workspace Usage: Group Modal Closed")}})]}),e.jsx(q,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{y(!0),j.logEvent("Workspace Usage: Export Modal Opened")},children:e.jsx(m,d({},X.exportButton))}),c&&e.jsx(ks,{currentWorkspaceId:t,currentTab:o,onClose:()=>y(!1)})]}),tabsHeader:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ga,{children:l.map(h=>e.jsx("a",{className:E("pb-2",o===h?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{r(h),j.logEvent("Workspace Usage: Tab Clicked",{tab:h})},children:e.jsx(m,d({},X[h]))},h))}),e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[p.data?e.jsxs("span",{children:[e.jsx(m,d({},X.dataLastUpdatedLabel)),e.jsx(St,{}),p.data.last_updated_time?O(new Date(p.data.last_updated_time),"MMM d, yyyy"):e.jsx(m,d({},X.dataLastUpdatedUnknown))]}):e.jsx(be,{}),"·",e.jsx(ts,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:e.jsx(m,d({},X.helpCenterLinkText))})]})]})})}function va({currentWorkspaceId:t}){var f;const s=ae(),a=Te(),o=Ct(a,"3528236309"),r=o.get("show_group_filter",!1),n=o.get("show_project_tab",!1),i=o.get("show_ai_champions_button",!1),[u,l]=g.useState("overviewTab"),[p,c]=g.useState(oe(new Date)),[y,v]=g.useState(null),M=g.useMemo(()=>n?xt:xt.filter(C=>C!=="projectsTab"),[n]),x=M.includes(u)?u:"overviewTab";g.useEffect(()=>{r||v(null)},[r]);const h=r?y:null;let _=null;const w=zt[x];return x==="overviewTab"?_=e.jsx(At,{currentWorkspaceId:t,startDate:p,selectedGroupId:(f=h==null?void 0:h.id)!=null?f:null}):x==="usersTab"?_=e.jsx(Ot,{currentWorkspaceId:t,startDate:p,showAiChampionsButton:i}):_=e.jsx(w,{currentWorkspaceId:t,startDate:p,showAiChampionsButton:!1}),g.useEffect(()=>{j.logPageView(),j.logEvent("Workspace Usage: Page Viewed")},[]),e.jsxs(e.Fragment,{children:[e.jsx(cs,{children:e.jsx("title",{children:s.formatMessage(X.title)})}),e.jsx(xa,{currentWorkspaceId:t,startDate:p,setStartDate:c,currentTab:x,setTab:l,selectedGroup:h,setSelectedGroup:v,showGroupFilter:r,tabs:M}),e.jsx(xs,{children:_})]})}const X=ee({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},projectsTab:{id:"workspaceUsage.projectsTab",defaultMessage:"Projects"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},groupButton:{id:"workspaceUsage.groupButton",defaultMessage:"Group"},groupButtonSelected:{id:"workspaceUsage.groupButtonSelected",defaultMessage:"Group: {groupName}"},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),Xa=Bt(function(){const s=Ms();return ys(),e.jsx(va,d({},s))});export{Xa as default};
//# sourceMappingURL=nfclh7edv9r1sj4a.js.map
