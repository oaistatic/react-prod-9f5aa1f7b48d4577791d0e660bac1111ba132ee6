var b=Object.defineProperty,j=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var p=(e,s,t)=>s in e?b(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,T=(e,s)=>{for(var t in s||(s={}))C.call(s,t)&&p(e,t,s[t]);if(x)for(var t of x(s))D.call(s,t)&&p(e,t,s[t]);return e},v=(e,s)=>j(e,E(s));var B=(e,s)=>{var t={};for(var a in e)C.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&x)for(var a of x(e))s.indexOf(a)<0&&D.call(e,a)&&(t[a]=e[a]);return t};import{r as f,j as m,R as k}from"./i8clt0mfz495j7ii.js";import{ff as w,fg as I,fh as U,fi as F,fj as h,fk as _,a4 as L,fl as X}from"./j0yo6uv6652vva62.js";import{iA as q,bX as H,bO as O,bQ as Q,cH as V}from"./ghewn7l2ynbm32fm.js";import{T as S}from"./olrcssu7duieo6m7.js";function $(e){var M;const y=e,{bufferType:s,isActivelyStreaming:t,messages:a,parts:n}=y,g=B(y,["bufferType","isActivelyStreaming","messages","parts"]),c=a[a.length-1].id,[u,d]=f.useState(w(n)),r=f.useRef(void 0),l=q(),i=f.useMemo(()=>l?n.flatMap(o=>{if(typeof o=="string")return o;if(o.content_type==="audio_transcription")return o.text}).filter(o=>o!==void 0):n,[n,l]);if(r.current===void 0)switch(s){case"Adaptive":r.current=new F(i,d,t);break;case"ChunkedCatchup":r.current=new U(i,d,t);break;case"Punctuation":r.current=new I(i,d,t);break}return f.useEffect(()=>{r.current!=null&&(r.current.onMessagePartsUpdated(i,t),r.current.isBuffering()&&h.addDelayedRenderingMessage(c))},[i,c,t]),f.useEffect(()=>{r.current!=null&&r.current.removeDelayedRender()&&h.removeDelayedRenderingMessage(c)},[u,c]),f.useEffect(()=>()=>h.removeDelayedRenderingMessage(c),[c]),f.useEffect(()=>()=>{var o;(o=r.current)==null||o.destroy(),r.current=void 0},[]),m.jsx(S,v(T({},g),{messages:a,parts:n,displayParts:u,isActivelyStreaming:t||!!((M=r.current)!=null&&M.isBuffering())}))}function z({message:e,isCompletionInProgress:s,hasActiveRequest:t,conversation:a,className:n,isUserTurn:g,isFinalUserTurn:c,isWithinFirstAssistantTurns:u,turnIndex:d,isFeedbackEnabled:r,prevGroupedMessageType:l,prevGroupedMessages:i,citableMessages:y,superWidgetContent:M}){var P,A,R;const o=f.useMemo(()=>"parts"in e.content?e.content.parts:[H(e)],[e]);return m.jsxs(m.Fragment,{children:[m.jsx(G,{parts:o,messages:[e],hasActiveRequest:t,isCompletionInProgress:s,className:n,citations:(P=e.metadata)==null?void 0:P.citations,contentReferences:(A=e.metadata)==null?void 0:A.content_references,attachments:(R=e.metadata)==null?void 0:R.attachments,isUserTurn:g,isFinalUserTurn:c,isWithinFirstAssistantTurns:u,turnIndex:d,id:e.id,isFeedbackEnabled:r,conversation:a,prevGroupedMessageType:l,prevGroupedMessages:i,citableMessages:y,superWidgetContent:M}),!1]})}const Z=k.memo(z);function G(e){const s=e.messages.length>1,t=O.isLastActorMessage(Q(e.conversation.id),e.messages[0].id),a=V(e.conversation.id,i=>!!(i!=null&&i.sharedConversationMetadata)),n=s?void 0:_(e.messages[0],t,e.isCompletionInProgress||e.hasActiveRequest,a),g=(n==null?void 0:n.flagSeverity)!=="danger"&&e.isCompletionInProgress,c=!e.parts.some(i=>i!==""),{bufferType:u,wordFadeType:d}=L(),[r,l]=f.useState(()=>d!=="indexed"&&u!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||c&&!n));return n&&r&&l(!1),r?m.jsx($,v(T({},e),{bufferType:u,isActivelyStreaming:g,errorState:n})):m.jsx(S,v(T({},e),{displayParts:X({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:g,errorState:n}))}export{Z as T,G as a};
//# sourceMappingURL=b6hyii2315xk7j19.js.map
