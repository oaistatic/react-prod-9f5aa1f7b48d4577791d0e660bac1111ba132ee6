var R=Object.defineProperty;var w=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var V=(e,t,a)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,_=(e,t)=>{for(var a in t||(t={}))T.call(t,a)&&V(e,a,t[a]);if(w)for(var a of w(t))N.call(t,a)&&V(e,a,t[a]);return e};import{f as A,e as F,r as f,a as x,j as i,M as u}from"./i8clt0mfz495j7ii.js";import{R as j,A as I,P as m,$ as v,j as O,u as k,e as B,pM as L}from"./ghewn7l2ynbm32fm.js";import{I as C}from"./izvx0vf35f3cqx26.js";var W={};async function b(e){return j.safePost("/accounts/add_email/begin",{requestBody:{email:e,auth0_client_id:W.AUTH0_CLIENT_ID},authOption:I.Required})}const o=A({sendEmailFailure:{id:"emailVerify.sendEmailFailure",defaultMessage:"Could not send email verification code, please try again later."},sendEmailFailureInvalidEmail:{id:"emailVerify.invalidEmail",defaultMessage:'The email address "{email}" is not formatted correctly.'},sendEmailFailureInvalidEmailEmpty:{id:"emailVerify.invalidEmailEmpty",defaultMessage:"Please enter a valid email address to continue."},sendEmailFailureRateLimited:{id:"emailVerify.sendEmailFailure.rateLimited",defaultMessage:"You've sent too many requests. Please try again later."},verifyOtpFailure:{id:"emailVerify.verifyOtpFailure",defaultMessage:"Something went wrong, please try again later."},verifyOtpFailureInvalidOtp:{id:"emailVerify.verifyOtpFailure.invalidOtp",defaultMessage:"The code you entered is invalid. Please try again."},verifyOtpFailureInvalidFormat:{id:"emailVerify.verifyOtpFailure.invalidFormat",defaultMessage:"The code you entered is formatted incorrectly."},verifyOtpFailureEmailAlreadyLinked:{id:"emailVerify.verifyOtpFailure.emailAlreadyLinked",defaultMessage:'{branch, select, email {"{emailValue}"} other {Your email}} is already linked to another account.'},verifyOtpFailureRateLimited:{id:"emailVerify.verifyOtpFailure.rateLimited",defaultMessage:"You've sent too many requests. Please try again later."},verifyOtpSuccess:{id:"emailVerify.verifyOtpSuccess",defaultMessage:"Email confirmed."}});class S extends Error{constructor(t){super(t),this.name="EmailValidationError"}}const q=(e,t)=>t.trim()===""?e.formatMessage(o.sendEmailFailureInvalidEmailEmpty):/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?null:e.formatMessage(o.sendEmailFailureInvalidEmail,{email:t}),P=(e,t,a)=>{switch(a.status){case 429:throw new Error(e.formatMessage(o.sendEmailFailureRateLimited));case 403:throw new Error(e.formatMessage(o.verifyOtpFailureEmailAlreadyLinked,{branch:t?"email":"other",emailValue:t}));default:return}};function D(e){const t=F(),[a,c]=f.useState(null),d=x({mutationFn:async n=>{try{const s=q(t,n);if(s)throw new S(s);return await b(n)}catch(s){throw s instanceof S?s:(s instanceof O&&P(t,n,s),new Error(t.formatMessage(o.sendEmailFailure)))}},onSuccess:()=>{e.setStep("verifyOtp")},onError:n=>{c(n.message),m.logEventWithStatsig("Email Verify Enter Email Step - Error Sending Verification Email","chatgpt_email_verify_enter_email_step_error",{error:n.message})}});return f.useEffect(()=>{m.logEventWithStatsig("Email Verify Enter Email Step - Shown","chatgpt_email_verify_enter_email_step_shown")},[]),i.jsx("form",{onSubmit:n=>{n.preventDefault(),d.mutate(e.email),m.logEventWithStatsig("Email Verify Enter Email Step - Attempted Continue","chatgpt_email_verify_enter_email_step_continue")},noValidate:!0,children:i.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[i.jsx("p",{className:"text-3xl font-semibold",children:e.title?e.title:i.jsx(u,{id:"emailVerify.enterEmailTitle",defaultMessage:"Add your email"})}),e.description&&i.jsx("p",{className:"text-token-text-primary text-center text-base",children:e.description}),i.jsx(C,{ariaLabel:t.formatMessage({id:"emailVerify.emailAddress",defaultMessage:"Email Address"}),placeholder:t.formatMessage({id:"emailVerify.emailAddressPlaceholder",defaultMessage:"Email Address"}),name:"email",type:"email",className:"mt-6 w-full",value:e.email,onChange:n=>{var s;c(null),(s=e.onEmailChange)==null||s.call(e,n.target.value),m.logEventWithStatsig("Email Verify Enter Email Step - Typed","chatgpt_email_verify_enter_email_step_type")},autoFocus:!0,autoComplete:"email",error:a!=null?a:void 0}),i.jsx(v,{className:"w-full rounded-md",color:"green",type:"submit",loading:d.isPending,disabled:d.isPending,children:i.jsx(u,{id:"emailVerify.continue",defaultMessage:"Continue"})}),e.cancelFlowButton]})})}class M extends Error{constructor(t){super(t),this.name="OtpValidationError"}}const X=(e,t)=>{if(t.length!==6)return e.formatMessage(o.verifyOtpFailureInvalidFormat);try{parseInt(t)}catch(a){return e.formatMessage(o.verifyOtpFailureInvalidFormat)}return null},z=(e,t,a)=>{switch(a.status){case 403:throw new Error(e.formatMessage(o.verifyOtpFailureEmailAlreadyLinked,{branch:t?"email":"other",emailValue:t}));case 429:throw new Error(e.formatMessage(o.verifyOtpFailureRateLimited));case 401:case 422:throw new Error(e.formatMessage(o.verifyOtpFailureInvalidOtp));default:return}};function $(e){var p;const t=k(),a=F(),c=B(),[d,n]=f.useState(null),s=(p=e.showChangeEmailButton)!=null?p:!0,h=f.useCallback(r=>{var E;const l=r.target.value.trim();if(typeof l=="string"){if(l.match(/\D/)){r.preventDefault();return}(E=e.onOtpChange)==null||E.call(e,l.substring(0,6))}},[e]),y=x({mutationFn:async()=>{var r,l;try{return e.onResendOtp?await e.onResendOtp():await b((r=e.email)!=null?r:"")}catch(E){throw E instanceof O&&P(a,(l=e.email)!=null?l:"",E),new Error(a.formatMessage(o.sendEmailFailure))}},onSuccess:()=>{e.setStep("verifyOtp")},onError:r=>{n(r.message),m.logEventWithStatsig("Email Verify Verify OTP Step - Error Resending OTP","chatgpt_email_verify_verify_otp_step_resend_error",{error:r.message})}}),g=x({mutationFn:async r=>{try{const l=X(a,r.code);if(l)throw new M(l);if(e.onVerifyOtp)return await e.onVerifyOtp(r.code,r.email);await j.safePost("/accounts/add_email/verify",{requestBody:r}),await L(t,{reason:"verify_otp"})}catch(l){throw l instanceof M?l:(l instanceof O&&z(a,e.email,l),new Error(a.formatMessage(o.verifyOtpFailure)))}},onSuccess:()=>{var r;c.success(a.formatMessage(o.verifyOtpSuccess)),(r=e.onVerified)==null||r.call(e)},onError:r=>{n(r.message),m.logEventWithStatsig("Email Verify Verify OTP Step - Error Verifying OTP","chatgpt_email_verify_verify_otp_step_error",{error:r.message})}});return f.useEffect(()=>{m.logEventWithStatsig("Email Verify Verify OTP Step - Shown","chatgpt_email_verify_verify_otp_step_shown")},[]),i.jsxs("div",{className:"flex w-full flex-col items-center gap-3",children:[i.jsx("p",{className:"text-3xl font-semibold",children:i.jsx(u,{id:"verifyOtp.title",defaultMessage:"Check your email"})}),i.jsxs("p",{className:"text-center",children:[i.jsx("span",{className:"text-token-text-primary text-base",children:i.jsx(u,{id:"verifyOtp.description",defaultMessage:"Enter the verification code we just sent to"})}),e.email&&i.jsx("br",{}),i.jsx("span",{className:"text-token-text-primary text-base leading-snug ".concat(e.email&&"font-semibold"),children:i.jsx(u,{id:"verifyOtp.email",defaultMessage:"{branch, select, email {{emailValue}} other { your email.}}",values:{branch:e.email?"email":"other",emailValue:e.email}})})]}),i.jsxs("form",{onSubmit:r=>{var l;r.preventDefault(),g.mutate({code:e.otp,email:(l=e.email)!=null?l:""}),m.logEventWithStatsig("Email Verify Verify OTP Step - Attempted Continue","chatgpt_email_verify_verify_otp_step_continue")},className:"flex w-full flex-col items-center gap-3",children:[i.jsx(C,{error:d!=null?d:void 0,ariaLabel:a.formatMessage({id:"emailVerify.otpAriaLabel",defaultMessage:"OTP"}),value:e.otp,onChange:r=>{n(null),h(r),m.logEventWithStatsig("Email Verify Verify OTP Step - Typed","chatgpt_email_verify_verify_otp_step_type")},name:"otp",type:"text",placeholder:"XXXXXX",className:"mt-6 w-full",autoComplete:"off",autoFocus:!0}),i.jsx(v,{className:"w-full rounded-md",color:"green",type:"submit",loading:g.isPending,disabled:g.isPending,children:i.jsx(u,{id:"verifyOtp.continue",defaultMessage:"Continue"})}),e.cancelFlowButton]}),i.jsxs("div",{className:"mt-6 flex w-full flex-col items-center gap-3",children:[i.jsx("p",{className:"text-token-text-primary text-sm",children:i.jsx(u,{id:"verifyOtp.resendMessage",defaultMessage:"Didn't receive the code?"})}),i.jsx(v,{className:"w-full rounded-md",color:"secondary",onClick:()=>{y.mutate(),m.logEventWithStatsig("Email Verify Verify OTP Step - Resend","chatgpt_email_verify_verify_otp_step_resend")},loading:y.isPending,disabled:y.isPending,children:i.jsx(u,{id:"verifyOtp.resend",defaultMessage:"Resend code"})}),s&&i.jsx(v,{className:"w-full rounded-md",color:"secondary",onClick:()=>{e.setStep("enterEmail"),m.logEventWithStatsig("Email Verify Verify OTP Step - Back to Enter Email Step","chatgpt_email_verify_verify_otp_step_change_email")},children:i.jsx(u,{id:"verifyOtp.changeEmail",defaultMessage:"Change email"})})]})]})}function G(e){var g;const[t,a]=f.useState((g=e.initialStep)!=null?g:"enterEmail"),[c,d]=f.useState(""),[n,s]=f.useState(""),h=e.email?{email:e.email,onEmailChange:e.onEmailChange}:{email:c,onEmailChange:d},y=e.otp?{otp:e.otp,onOtpChange:e.onOtpChange}:{otp:n,onOtpChange:s};return t==="enterEmail"?i.jsx(D,_({title:e.enterEmailTitle,description:e.enterEmailDescription,cancelFlowButton:e.cancelFlowButton,step:t,setStep:a},h)):i.jsx($,_({email:h.email,onVerified:e.onVerified,cancelFlowButton:e.cancelFlowButton,step:t,setStep:a,showChangeEmailButton:e.showChangeEmailButton,onResendOtp:e.onResendOtp,onVerifyOtp:e.onVerifyOtp},y))}export{G as E};
//# sourceMappingURL=ji1868fe7hk3rgcl.js.map
