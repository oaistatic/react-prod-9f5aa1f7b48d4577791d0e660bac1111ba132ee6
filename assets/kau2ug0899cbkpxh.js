const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/c1gr2ybddrrv7tor.js","assets/sx3wasy817d4jzke.js","assets/k1t8elp5z7nmkg2d.js","assets/gdq1l97elemowxcc.js","assets/ghewn7l2ynbm32fm.js","assets/i8clt0mfz495j7ii.js","assets/root-c4psboex.css","assets/le7z0uvxgo2qyp1e.js","assets/emk4wjabyazjdxlc.js","assets/o564tkn3ln8nzryq.js","assets/j0yo6uv6652vva62.js","assets/conversation-small-lq38g8zw.css","assets/ns51nblw8ziscsgd.js","assets/ce3hgmw4iyyhicud.js","assets/mqebxepg7t6q2tie.js","assets/o9vew0btr2k0i59c.js","assets/f76gy0b8ieo4s693.js","assets/cb0ba83bmi83mjz2.js","assets/dxyrjy681bkwlnj8.js","assets/6ji8ehbh56ghw0zw.js","assets/d8n0quna9kapa0tt.js","assets/43m9qcj5aeckxr3x.js","assets/b9406ulzxvjxicn5.js","assets/f9yvwzr46p2hsfhu.js","assets/fp4hwlr9rpqkq1fd.js","assets/kfyut10eyj3q3kgs.js","assets/hm0s7uv4ug5ct962.js","assets/kwdsamifo3kf5hxa.js","assets/jynbns95j98ofqey.js","assets/72on327tecpr1xbl.js","assets/bntrd7poxiti85ee.js"])))=>i.map(i=>d[i]);
import{E as D,b as de,P as Re,F as me,V as _n,j as B,a as y,S as V,k as At,m as F,h as vn,s as Tn,c as kt,l as ve,n as Et,o as _t,A as Me,M as Te,p as Pn,T as ie,q as Ne,C as Pe,D as pe,W as Ln,i as vt,d as Ve,r as Y,t as In,u as Dn}from"./gdq1l97elemowxcc.js";import{e as z,o as Tt,q as Pt,r as Lt,u as ce,b as Le,v as q,w as Ie,c as On,S as Bn,H as It,t as g}from"./k1t8elp5z7nmkg2d.js";import{_ as C}from"./i8clt0mfz495j7ii.js";import{e as S}from"./o564tkn3ln8nzryq.js";import{cE as Dt,rN as wn,q6 as Rn,rO as Mn,rP as Ke,rQ as Ot,gG as Nn}from"./ghewn7l2ynbm32fm.js";import{R as Vn,T as ae}from"./o9vew0btr2k0i59c.js";import{g as Je,a as Fn,u as jn,c as Un}from"./cb0ba83bmi83mjz2.js";import{p as Hn}from"./j0yo6uv6652vva62.js";import{C as Ae,e as zn}from"./6ji8ehbh56ghw0zw.js";import{H as $n}from"./ce3hgmw4iyyhicud.js";const qn="_modelCursor_1knkf_1",ys={modelCursor:qn};class Bt{constructor(t,n,o,r){this.state=t,this.pos=n,this.explicit=o,this.view=r,this.abortListeners=[]}tokenBefore(t){let n=z(this.state).resolveInner(this.pos,-1);for(;n&&t.indexOf(n.name)<0;)n=n.parent;return n?{from:n.from,to:this.pos,text:this.state.sliceDoc(n.from,this.pos),type:n.type}:null}matchBefore(t){let n=this.state.doc.lineAt(this.pos),o=Math.max(n.from,this.pos-250),r=n.text.slice(o-n.from,this.pos-n.from),s=r.search(wt(t,!1));return s<0?null:{from:o+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(t,n){t=="abort"&&this.abortListeners&&this.abortListeners.push(n)}}function Qe(e){let t=Object.keys(e).join(""),n=/\w/.test(t);return n&&(t=t.replace(/\w/g,"")),"[".concat(n?"\\w":"").concat(t.replace(/[^\w\s]/g,"\\$&"),"]")}function Wn(e){let t=Object.create(null),n=Object.create(null);for(let{label:r}of e){t[r[0]]=!0;for(let s=1;s<r.length;s++)n[r[s]]=!0}let o=Qe(t)+Qe(n)+"*$";return[new RegExp("^"+o),new RegExp(o)]}function Gn(e){let t=e.map(r=>typeof r=="string"?{label:r}:r),[n,o]=t.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:Wn(t);return r=>{let s=r.matchBefore(o);return s||r.explicit?{from:s?s.from:r.pos,options:t,validFor:n}:null}}function Ss(e,t){return n=>{for(let o=z(n.state).resolveInner(n.pos,-1);o;o=o.parent){if(e.indexOf(o.name)>-1)return null;if(o.type.isTop)break}return t(n)}}class Ye{constructor(t,n,o,r){this.completion=t,this.source=n,this.match=o,this.score=r}}function j(e){return e.selection.main.from}function wt(e,t){var n;let{source:o}=e,r=t&&o[0]!="^",s=o[o.length-1]!="$";return!r&&!s?e:new RegExp("".concat(r?"^":"","(?:").concat(o,")").concat(s?"$":""),(n=e.flags)!==null&&n!==void 0?n:e.ignoreCase?"i":"")}const Fe=Me.define();function Kn(e,t,n,o){let{main:r}=e.selection,s=n-r.from,i=o-r.from;return Object.assign(Object.assign({},e.changeByRange(l=>l!=r&&n!=o&&e.sliceDoc(l.from+s,l.from+i)!=e.sliceDoc(n,o)?{range:l}:{changes:{from:l.from+s,to:o==r.from?l.to:l.from+i,insert:t},range:y.cursor(l.from+s+t.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}const Xe=new WeakMap;function Jn(e){if(!Array.isArray(e))return e;let t=Xe.get(e);return t||Xe.set(e,t=Gn(e)),t}const fe=V.define(),X=V.define();class Qn{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let n=0;n<t.length;){let o=B(t,n),r=F(o);this.chars.push(o);let s=t.slice(n,n+r),i=s.toUpperCase();this.folded.push(B(i==s?s.toLowerCase():i,0)),n+=r}this.astral=t.length!=this.chars.length}ret(t,n){return this.score=t,this.matched=n,this}match(t){if(this.pattern.length==0)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:n,folded:o,any:r,precise:s,byWord:i}=this;if(n.length==1){let x=B(t,0),$=F(x),N=$==t.length?0:-100;if(x!=n[0])if(x==o[0])N+=-200;else return null;return this.ret(N,[0,$])}let l=t.indexOf(this.pattern);if(l==0)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let c=n.length,a=0;if(l<0){for(let x=0,$=Math.min(t.length,200);x<$&&a<c;){let N=B(t,x);(N==n[a]||N==o[a])&&(r[a++]=x),x+=F(N)}if(a<c)return null}let f=0,u=0,h=!1,p=0,d=-1,m=-1,b=/[a-z]/.test(t),L=!0;for(let x=0,$=Math.min(t.length,200),N=0;x<$&&u<c;){let _=B(t,x);l<0&&(f<c&&_==n[f]&&(s[f++]=x),p<c&&(_==n[p]||_==o[p]?(p==0&&(d=x),m=x+1,p++):p=0));let oe,be=_<255?_>=48&&_<=57||_>=97&&_<=122?2:_>=65&&_<=90?1:0:(oe=_t(_))!=oe.toLowerCase()?1:oe!=oe.toUpperCase()?2:0;(!x||be==1&&b||N==0&&be!=0)&&(n[u]==_||o[u]==_&&(h=!0)?i[u++]=x:i.length&&(L=!1)),N=be,x+=F(_)}return u==c&&i[0]==0&&L?this.result(-100+(h?-200:0),i,t):p==c&&d==0?this.ret(-200-t.length+(m==t.length?0:-100),[0,m]):l>-1?this.ret(-700-t.length,[l,l+this.pattern.length]):p==c?this.ret(-900-t.length,[d,m]):u==c?this.result(-100+(h?-200:0)+-700+(L?0:-1100),i,t):n.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,t)}result(t,n,o){let r=[],s=0;for(let i of n){let l=i+(this.astral?F(B(o,i)):1);s&&r[s-1]==i?r[s-1]=l:(r[s++]=i,r[s++]=l)}return this.ret(t-o.length,r)}}class Yn{constructor(t){this.pattern=t,this.matched=[],this.score=0,this.folded=t.toLowerCase()}match(t){if(t.length<this.pattern.length)return null;let n=t.slice(0,this.pattern.length),o=n==this.pattern?0:n.toLowerCase()==this.folded?-200:null;return o==null?null:(this.matched=[0,n.length],this.score=o+(t.length==this.pattern.length?0:-100),this)}}const k=me.define({combine(e){return kt(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:Xn,filterStrict:!1,compareCompletions:(t,n)=>t.label.localeCompare(n.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(t,n)=>t&&n,closeOnBlur:(t,n)=>t&&n,icons:(t,n)=>t&&n,tooltipClass:(t,n)=>o=>Ze(t(o),n(o)),optionClass:(t,n)=>o=>Ze(t(o),n(o)),addToOptions:(t,n)=>t.concat(n),filterStrict:(t,n)=>t||n})}});function Ze(e,t){return e?t?e+" "+t:e:t}function Xn(e,t,n,o,r,s){let i=e.textDirection==vt.RTL,l=i,c=!1,a="top",f,u,h=t.left-r.left,p=r.right-t.right,d=o.right-o.left,m=o.bottom-o.top;if(l&&h<Math.min(d,p)?l=!1:!l&&p<Math.min(d,h)&&(l=!0),d<=(l?h:p))f=Math.max(r.top,Math.min(n.top,r.bottom-m))-t.top,u=Math.min(400,l?h:p);else{c=!0,u=Math.min(400,(i?t.right:r.right-t.left)-30);let x=r.bottom-t.bottom;x>=m||x>t.top?f=n.bottom-t.top:(a="bottom",f=t.bottom-n.top)}let b=(t.bottom-t.top)/s.offsetHeight,L=(t.right-t.left)/s.offsetWidth;return{style:"".concat(a,": ").concat(f/b,"px; max-width: ").concat(u/L,"px"),class:"cm-completionInfo-"+(c?i?"left-narrow":"right-narrow":l?"left":"right")}}function Zn(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(n){let o=document.createElement("div");return o.classList.add("cm-completionIcon"),n.type&&o.classList.add(...n.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),o.setAttribute("aria-hidden","true"),o},position:20}),t.push({render(n,o,r,s){let i=document.createElement("span");i.className="cm-completionLabel";let l=n.displayLabel||n.label,c=0;for(let a=0;a<s.length;){let f=s[a++],u=s[a++];f>c&&i.appendChild(document.createTextNode(l.slice(c,f)));let h=i.appendChild(document.createElement("span"));h.appendChild(document.createTextNode(l.slice(f,u))),h.className="cm-completionMatchedText",c=u}return c<l.length&&i.appendChild(document.createTextNode(l.slice(c))),i},position:50},{render(n){if(!n.detail)return null;let o=document.createElement("span");return o.className="cm-completionDetail",o.textContent=n.detail,o},position:80}),t.sort((n,o)=>n.position-o.position).map(n=>n.render)}function ke(e,t,n){if(e<=n)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let r=Math.floor(t/n);return{from:r*n,to:(r+1)*n}}let o=Math.floor((e-t)/n);return{from:e-(o+1)*n,to:e-o*n}}class eo{constructor(t,n,o){this.view=t,this.stateField=n,this.applyCompletion=o,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:c=>this.placeInfo(c),key:this},this.space=null,this.currentClass="";let r=t.state.field(n),{options:s,selected:i}=r.open,l=t.state.facet(k);this.optionContent=Zn(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=ke(s.length,i,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(t.state),this.dom.addEventListener("mousedown",c=>{let{options:a}=t.state.field(n).open;for(let f=c.target,u;f&&f!=this.dom;f=f.parentNode)if(f.nodeName=="LI"&&(u=/-(\d+)$/.exec(f.id))&&+u[1]<a.length){this.applyCompletion(t,a[+u[1]]),c.preventDefault();return}}),this.dom.addEventListener("focusout",c=>{let a=t.state.field(this.stateField,!1);a&&a.tooltip&&t.state.facet(k).closeOnBlur&&c.relatedTarget!=t.contentDOM&&t.dispatch({effects:X.of(null)})}),this.showOptions(s,r.id)}mount(){this.updateSel()}showOptions(t,n){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t,n,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(t){var n;let o=t.state.field(this.stateField),r=t.startState.field(this.stateField);if(this.updateTooltipClass(t.state),o!=r){let{options:s,selected:i,disabled:l}=o.open;(!r.open||r.open.options!=s)&&(this.range=ke(s.length,i,t.state.facet(k).maxRenderedOptions),this.showOptions(s,o.id)),this.updateSel(),l!=((n=r.open)===null||n===void 0?void 0:n.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(t){let n=this.tooltipClass(t);if(n!=this.currentClass){for(let o of this.currentClass.split(" "))o&&this.dom.classList.remove(o);for(let o of n.split(" "))o&&this.dom.classList.add(o);this.currentClass=n}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let t=this.view.state.field(this.stateField),n=t.open;if((n.selected>-1&&n.selected<this.range.from||n.selected>=this.range.to)&&(this.range=ke(n.options.length,n.selected,this.view.state.facet(k).maxRenderedOptions),this.showOptions(n.options,t.id)),this.updateSelectedOption(n.selected)){this.destroyInfo();let{completion:o}=n.options[n.selected],{info:r}=o;if(!r)return;let s=typeof r=="string"?document.createTextNode(r):r(o);if(!s)return;"then"in s?s.then(i=>{i&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(i,o)}).catch(i=>ve(this.view.state,i,"completion info")):this.addInfoPane(s,o)}}addInfoPane(t,n){this.destroyInfo();let o=this.info=document.createElement("div");if(o.className="cm-tooltip cm-completionInfo",t.nodeType!=null)o.appendChild(t),this.infoDestroy=null;else{let{dom:r,destroy:s}=t;o.appendChild(r),this.infoDestroy=s||null}this.dom.appendChild(o),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(t){let n=null;for(let o=this.list.firstChild,r=this.range.from;o;o=o.nextSibling,r++)o.nodeName!="LI"||!o.id?r--:r==t?o.hasAttribute("aria-selected")||(o.setAttribute("aria-selected","true"),n=o):o.hasAttribute("aria-selected")&&o.removeAttribute("aria-selected");return n&&no(this.list,n),n}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let n=this.dom.getBoundingClientRect(),o=this.info.getBoundingClientRect(),r=t.getBoundingClientRect(),s=this.space;if(!s){let i=this.dom.ownerDocument.defaultView||window;s={left:0,top:0,right:i.innerWidth,bottom:i.innerHeight}}return r.top>Math.min(s.bottom,n.bottom)-10||r.bottom<Math.max(s.top,n.top)+10?null:this.view.state.facet(k).positionInfo(this.view,n,r,o,s,this.dom)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(t,n,o){const r=document.createElement("ul");r.id=n,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-label",this.view.state.phrase("Completions"));let s=null;for(let i=o.from;i<o.to;i++){let{completion:l,match:c}=t[i],{section:a}=l;if(a){let h=typeof a=="string"?a:a.name;if(h!=s&&(i>o.from||o.from==0))if(s=h,typeof a!="string"&&a.header)r.appendChild(a.header(a));else{let p=r.appendChild(document.createElement("completion-section"));p.textContent=h}}const f=r.appendChild(document.createElement("li"));f.id=n+"-"+i,f.setAttribute("role","option");let u=this.optionClass(l);u&&(f.className=u);for(let h of this.optionContent){let p=h(l,this.view.state,this.view,c);p&&f.appendChild(p)}}return o.from&&r.classList.add("cm-completionListIncompleteTop"),o.to<t.length&&r.classList.add("cm-completionListIncompleteBottom"),r}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function to(e,t){return n=>new eo(n,e,t)}function no(e,t){let n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=n.height/e.offsetHeight;o.top<n.top?e.scrollTop-=(n.top-o.top)/r:o.bottom>n.bottom&&(e.scrollTop+=(o.bottom-n.bottom)/r)}function et(e){return(e.boost||0)*100+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}function oo(e,t){let n=[],o=null,r=a=>{n.push(a);let{section:f}=a.completion;if(f){o||(o=[]);let u=typeof f=="string"?f:f.name;o.some(h=>h.name==u)||o.push(typeof f=="string"?{name:u}:f)}},s=t.facet(k);for(let a of e)if(a.hasResult()){let f=a.result.getMatch;if(a.result.filter===!1)for(let u of a.result.options)r(new Ye(u,a.source,f?f(u):[],1e9-n.length));else{let u=t.sliceDoc(a.from,a.to),h,p=s.filterStrict?new Yn(u):new Qn(u);for(let d of a.result.options)if(h=p.match(d.label)){let m=d.displayLabel?f?f(d,h.matched):[]:h.matched;r(new Ye(d,a.source,m,h.score+(d.boost||0)))}}}if(o){let a=Object.create(null),f=0,u=(h,p)=>{var d,m;return((d=h.rank)!==null&&d!==void 0?d:1e9)-((m=p.rank)!==null&&m!==void 0?m:1e9)||(h.name<p.name?-1:1)};for(let h of o.sort(u))f-=1e5,a[h.name]=f;for(let h of n){let{section:p}=h.completion;p&&(h.score+=a[typeof p=="string"?p:p.name])}}let i=[],l=null,c=s.compareCompletions;for(let a of n.sort((f,u)=>u.score-f.score||c(f.completion,u.completion))){let f=a.completion;!l||l.label!=f.label||l.detail!=f.detail||l.type!=null&&f.type!=null&&l.type!=f.type||l.apply!=f.apply||l.boost!=f.boost?i.push(a):et(a.completion)>et(l)&&(i[i.length-1]=a),l=a.completion}return i}class W{constructor(t,n,o,r,s,i){this.options=t,this.attrs=n,this.tooltip=o,this.timestamp=r,this.selected=s,this.disabled=i}setSelected(t,n){return t==this.selected||t>=this.options.length?this:new W(this.options,tt(n,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,n,o,r,s){let i=oo(t,n);if(!i.length)return r&&t.some(c=>c.state==1)?new W(r.options,r.attrs,r.tooltip,r.timestamp,r.selected,!0):null;let l=n.facet(k).selectOnOpen?0:-1;if(r&&r.selected!=l&&r.selected!=-1){let c=r.options[r.selected].completion;for(let a=0;a<i.length;a++)if(i[a].completion==c){l=a;break}}return new W(i,tt(o,l),{pos:t.reduce((c,a)=>a.hasResult()?Math.min(c,a.from):c,1e8),create:ao,above:s.aboveCursor},r?r.timestamp:Date.now(),l,!1)}map(t){return new W(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class ue{constructor(t,n,o){this.active=t,this.id=n,this.open=o}static start(){return new ue(lo,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:n}=t,o=n.facet(k),s=(o.override||n.languageDataAt("autocomplete",j(n)).map(Jn)).map(l=>(this.active.find(a=>a.source==l)||new P(l,this.active.some(a=>a.state!=0)?1:0)).update(t,o));s.length==this.active.length&&s.every((l,c)=>l==this.active[c])&&(s=this.active);let i=this.open;i&&t.docChanged&&(i=i.map(t.changes)),t.selection||s.some(l=>l.hasResult()&&t.changes.touchesRange(l.from,l.to))||!ro(s,this.active)?i=W.build(s,n,this.id,i,o):i&&i.disabled&&!s.some(l=>l.state==1)&&(i=null),!i&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new P(l.source,0):l));for(let l of t.effects)l.is(Nt)&&(i=i&&i.setSelected(l.value,this.id));return s==this.active&&i==this.open?this:new ue(s,this.id,i)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?so:io}}function ro(e,t){if(e==t)return!0;for(let n=0,o=0;;){for(;n<e.length&&!e[n].hasResult;)n++;for(;o<t.length&&!t[o].hasResult;)o++;let r=n==e.length,s=o==t.length;if(r||s)return r==s;if(e[n++].result!=t[o++].result)return!1}}const so={"aria-autocomplete":"list"},io={};function tt(e,t){let n={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(n["aria-activedescendant"]=e+"-"+t),n}const lo=[];function Rt(e,t){if(e.isUserEvent("input.complete")){let o=e.annotation(Fe);if(o&&t.activateOnCompletion(o))return 12}let n=e.isUserEvent("input.type");return n&&t.activateOnTyping?5:n?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class P{constructor(t,n,o=-1){this.source=t,this.state=n,this.explicitPos=o}hasResult(){return!1}update(t,n){let o=Rt(t,n),r=this;(o&8||o&16&&this.touches(t))&&(r=new P(r.source,0)),o&4&&r.state==0&&(r=new P(this.source,1)),r=r.updateFor(t,o);for(let s of t.effects)if(s.is(fe))r=new P(r.source,1,s.value?j(t.state):-1);else if(s.is(X))r=new P(r.source,0);else if(s.is(Mt))for(let i of s.value)i.source==r.source&&(r=i);return r}updateFor(t,n){return this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new P(this.source,this.state,t.mapPos(this.explicitPos))}touches(t){return t.changes.touchesRange(j(t.state))}}class G extends P{constructor(t,n,o,r,s){super(t,2,n),this.result=o,this.from=r,this.to=s}hasResult(){return!0}updateFor(t,n){var o;if(!(n&3))return this.map(t.changes);let r=this.result;r.map&&!t.changes.empty&&(r=r.map(r,t.changes));let s=t.changes.mapPos(this.from),i=t.changes.mapPos(this.to,1),l=j(t.state);if((this.explicitPos<0?l<=s:l<this.from)||l>i||!r||n&2&&j(t.startState)==this.from)return new P(this.source,n&4?1:0);let c=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return co(r.validFor,t.state,s,i)?new G(this.source,c,r,s,i):r.update&&(r=r.update(r,s,i,new Bt(t.state,l,c>=0)))?new G(this.source,c,r,r.from,(o=r.to)!==null&&o!==void 0?o:j(t.state)):new P(this.source,1,c)}map(t){return t.empty?this:(this.result.map?this.result.map(this.result,t):this.result)?new G(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1)):new P(this.source,0)}touches(t){return t.changes.touchesRange(this.from,this.to)}}function co(e,t,n,o){if(!e)return!1;let r=t.sliceDoc(n,o);return typeof e=="function"?e(r,n,o,t):wt(e,!0).test(r)}const Mt=V.define({map(e,t){return e.map(n=>n.map(t))}}),Nt=V.define(),v=de.define({create(){return ue.start()},update(e,t){return e.update(t)},provide:e=>[Tn.from(e,t=>t.tooltip),D.contentAttributes.from(e,t=>t.attrs)]});function je(e,t){const n=t.completion.apply||t.completion.label;let o=e.state.field(v).active.find(r=>r.source==t.source);return o instanceof G?(typeof n=="string"?e.dispatch(Object.assign(Object.assign({},Kn(e.state,n,o.from,o.to)),{annotations:Fe.of(t.completion)})):n(e,t.completion,o.from,o.to),!0):!1}const ao=to(v,je);function re(e,t="option"){return n=>{let o=n.state.field(v,!1);if(!o||!o.open||o.open.disabled||Date.now()-o.open.timestamp<n.state.facet(k).interactionDelay)return!1;let r=1,s;t=="page"&&(s=At(n,o.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:i}=o.open.options,l=o.open.selected>-1?o.open.selected+r*(e?1:-1):e?0:i-1;return l<0?l=t=="page"?0:i-1:l>=i&&(l=t=="page"?i-1:0),n.dispatch({effects:Nt.of(l)}),!0}}const fo=e=>{let t=e.state.field(v,!1);return e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(k).interactionDelay?!1:je(e,t.open.options[t.open.selected])},uo=e=>e.state.field(v,!1)?(e.dispatch({effects:fe.of(!0)}),!0):!1,ho=e=>{let t=e.state.field(v,!1);return!t||!t.active.some(n=>n.state!=0)?!1:(e.dispatch({effects:X.of(null)}),!0)};class mo{constructor(t,n){this.active=t,this.context=n,this.time=Date.now(),this.updates=[],this.done=void 0}}const po=50,go=1e3,yo=_n.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field(v).active)t.state==1&&this.startQuery(t)}update(e){let t=e.state.field(v),n=e.state.facet(k);if(!e.selectionSet&&!e.docChanged&&e.startState.field(v)==t)return;let o=e.transactions.some(s=>{let i=Rt(s,n);return i&8||(s.selection||s.docChanged)&&!(i&3)});for(let s=0;s<this.running.length;s++){let i=this.running[s];if(o||i.updates.length+e.transactions.length>po&&Date.now()-i.time>go){for(let l of i.context.abortListeners)try{l()}catch(c){ve(this.view.state,c)}i.context.abortListeners=null,this.running.splice(s--,1)}else i.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some(s=>s.effects.some(i=>i.is(fe)))&&(this.pendingStart=!0);let r=this.pendingStart?50:n.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(s=>s.state==1&&!this.running.some(i=>i.active.source==s.source))?setTimeout(()=>this.startUpdate(),r):-1,this.composing!=0)for(let s of e.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field(v);for(let n of t.active)n.state==1&&!this.running.some(o=>o.active.source==n.source)&&this.startQuery(n)}startQuery(e){let{state:t}=this.view,n=j(t),o=new Bt(t,n,e.explicitPos==n,this.view),r=new mo(e,o);this.running.push(r),Promise.resolve(e.source(o)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:X.of(null)}),ve(this.view.state,s)})}scheduleAccept(){this.running.every(e=>e.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(k).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],n=this.view.state.facet(k);for(let o=0;o<this.running.length;o++){let r=this.running[o];if(r.done===void 0)continue;if(this.running.splice(o--,1),r.done){let i=new G(r.active.source,r.active.explicitPos,r.done,r.done.from,(e=r.done.to)!==null&&e!==void 0?e:j(r.updates.length?r.updates[0].startState:this.view.state));for(let l of r.updates)i=i.update(l,n);if(i.hasResult()){t.push(i);continue}}let s=this.view.state.field(v).active.find(i=>i.source==r.active.source);if(s&&s.state==1)if(r.done==null){let i=new P(r.active.source,0);for(let l of r.updates)i=i.update(l,n);i.state!=1&&t.push(i)}else this.startQuery(s)}t.length&&this.view.dispatch({effects:Mt.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field(v,!1);if(t&&t.tooltip&&this.view.state.facet(k).closeOnBlur){let n=t.open&&At(this.view,t.open.tooltip);(!n||!n.dom.contains(e.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:X.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:fe.of(!1)}),20),this.composing=0}}}),So=typeof navigator=="object"&&/Win/.test(navigator.platform),Co=Re.highest(D.domEventHandlers({keydown(e,t){let n=t.state.field(v,!1);if(!n||!n.open||n.open.disabled||n.open.selected<0||e.key.length>1||e.ctrlKey&&!(So&&e.altKey)||e.metaKey)return!1;let o=n.open.options[n.open.selected],r=n.active.find(i=>i.source==o.source),s=o.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(e.key)>-1&&je(t,o),!1}})),Vt=D.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"¬∑¬∑¬∑"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'∆í'"}},".cm-completionIcon-class":{"&:after":{content:"'‚óã'"}},".cm-completionIcon-interface":{"&:after":{content:"'‚óå'"}},".cm-completionIcon-variable":{"&:after":{content:"'ùë•'"}},".cm-completionIcon-constant":{"&:after":{content:"'ùê∂'"}},".cm-completionIcon-type":{"&:after":{content:"'ùë°'"}},".cm-completionIcon-enum":{"&:after":{content:"'‚à™'"}},".cm-completionIcon-property":{"&:after":{content:"'‚ñ°'"}},".cm-completionIcon-keyword":{"&:after":{content:"'üîëÔ∏é'"}},".cm-completionIcon-namespace":{"&:after":{content:"'‚ñ¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class xo{constructor(t,n,o,r){this.field=t,this.line=n,this.from=o,this.to=r}}class Ue{constructor(t,n,o){this.field=t,this.from=n,this.to=o}map(t){let n=t.mapPos(this.from,-1,Te.TrackDel),o=t.mapPos(this.to,1,Te.TrackDel);return n==null||o==null?null:new Ue(this.field,n,o)}}class He{constructor(t,n){this.lines=t,this.fieldPositions=n}instantiate(t,n){let o=[],r=[n],s=t.doc.lineAt(n),i=/^\s*/.exec(s.text)[0];for(let c of this.lines){if(o.length){let a=i,f=/^\t*/.exec(c)[0].length;for(let u=0;u<f;u++)a+=t.facet(Tt);r.push(n+a.length-f),c=a+c.slice(f)}o.push(c),n+=c.length+1}let l=this.fieldPositions.map(c=>new Ue(c.field,r[c.line]+c.from,r[c.line]+c.to));return{text:o,ranges:l}}static parse(t){let n=[],o=[],r=[],s;for(let i of t.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(i);){let l=s[1]?+s[1]:null,c=s[2]||s[3]||"",a=-1,f=c.replace(/\\[{}]/g,u=>u[1]);for(let u=0;u<n.length;u++)(l!=null?n[u].seq==l:f&&n[u].name==f)&&(a=u);if(a<0){let u=0;for(;u<n.length&&(l==null||n[u].seq!=null&&n[u].seq<l);)u++;n.splice(u,0,{seq:l,name:f}),a=u;for(let h of r)h.field>=a&&h.field++}r.push(new xo(a,o.length,s.index,s.index+f.length)),i=i.slice(0,s.index)+c+i.slice(s.index+s[0].length)}i=i.replace(/\\([{}])/g,(l,c,a)=>{for(let f of r)f.line==o.length&&f.from>a&&(f.from--,f.to--);return c}),o.push(i)}return new He(o,r)}}let bo=pe.widget({widget:new class extends Ln{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),Ao=pe.mark({class:"cm-snippetField"});class K{constructor(t,n){this.ranges=t,this.active=n,this.deco=pe.set(t.map(o=>(o.from==o.to?bo:Ao).range(o.from,o.to)))}map(t){let n=[];for(let o of this.ranges){let r=o.map(t);if(!r)return null;n.push(r)}return new K(n,this.active)}selectionInsideField(t){return t.ranges.every(n=>this.ranges.some(o=>o.field==this.active&&o.from<=n.from&&o.to>=n.to))}}const te=V.define({map(e,t){return e&&e.map(t)}}),ko=V.define(),Z=de.define({create(){return null},update(e,t){for(let n of t.effects){if(n.is(te))return n.value;if(n.is(ko)&&e)return new K(e.ranges,n.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>D.decorations.from(e,t=>t?t.deco:pe.none)});function ze(e,t){return y.create(e.filter(n=>n.field==t).map(n=>y.range(n.from,n.to)))}function Eo(e){let t=He.parse(e);return(n,o,r,s)=>{let{text:i,ranges:l}=t.instantiate(n.state,r),c={changes:{from:r,to:s,insert:Ne.of(i)},scrollIntoView:!0,annotations:o?[Fe.of(o),ie.userEvent.of("input.complete")]:void 0};if(l.length&&(c.selection=ze(l,0)),l.some(a=>a.field>0)){let a=new K(l,0),f=c.effects=[te.of(a)];n.state.field(Z,!1)===void 0&&f.push(V.appendConfig.of([Z,Lo,Io,Vt]))}n.dispatch(n.state.update(c))}}function Ft(e){return({state:t,dispatch:n})=>{let o=t.field(Z,!1);if(!o||e<0&&o.active==0)return!1;let r=o.active+e,s=e>0&&!o.ranges.some(i=>i.field==r+e);return n(t.update({selection:ze(o.ranges,r),effects:te.of(s?null:new K(o.ranges,r)),scrollIntoView:!0})),!0}}const _o=({state:e,dispatch:t})=>e.field(Z,!1)?(t(e.update({effects:te.of(null)})),!0):!1,vo=Ft(1),To=Ft(-1),Po=[{key:"Tab",run:vo,shift:To},{key:"Escape",run:_o}],nt=me.define({combine(e){return e.length?e[0]:Po}}),Lo=Re.highest(Et.compute([nt],e=>e.facet(nt)));function Cs(e,t){return Object.assign(Object.assign({},t),{apply:Eo(e)})}const Io=D.domEventHandlers({mousedown(e,t){let n=t.state.field(Z,!1),o;if(!n||(o=t.posAtCoords({x:e.clientX,y:e.clientY}))==null)return!1;let r=n.ranges.find(s=>s.from<=o&&s.to>=o);return!r||r.field==n.active?!1:(t.dispatch({selection:ze(n.ranges,r.field),effects:te.of(n.ranges.some(s=>s.field>r.field)?new K(n.ranges,r.field):null),scrollIntoView:!0}),!0)}}),ee={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},H=V.define({map(e,t){let n=t.mapPos(e,-1,Te.TrackAfter);return n==null?void 0:n}}),$e=new class extends Pn{};$e.startSide=1;$e.endSide=-1;const jt=de.define({create(){return vn.empty},update(e,t){if(e=e.map(t.changes),t.selection){let n=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:o=>o>=n.from&&o<=n.to})}for(let n of t.effects)n.is(H)&&(e=e.update({add:[$e.range(n.value,n.value+1)]}));return e}});function xs(){return[Oo,jt]}const Ee="()[]{}<>";function Ut(e){for(let t=0;t<Ee.length;t+=2)if(Ee.charCodeAt(t)==e)return Ee.charAt(t+1);return _t(e<128?e:e+1)}function Ht(e,t){return e.languageDataAt("closeBrackets",t)[0]||ee}const Do=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Oo=D.inputHandler.of((e,t,n,o)=>{if((Do?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let r=e.state.selection.main;if(o.length>2||o.length==2&&F(B(o,0))==1||t!=r.from||n!=r.to)return!1;let s=wo(e.state,o);return s?(e.dispatch(s),!0):!1}),Bo=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let o=Ht(e,e.selection.main.head).brackets||ee.brackets,r=null,s=e.changeByRange(i=>{if(i.empty){let l=Ro(e.doc,i.head);for(let c of o)if(c==l&&ge(e.doc,i.head)==Ut(B(c,0)))return{changes:{from:i.head-c.length,to:i.head+c.length},range:y.cursor(i.head-c.length)}}return{range:r=i}});return r||t(e.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!r},bs=[{key:"Backspace",run:Bo}];function wo(e,t){let n=Ht(e,e.selection.main.head),o=n.brackets||ee.brackets;for(let r of o){let s=Ut(B(r,0));if(t==r)return s==r?Vo(e,r,o.indexOf(r+r+r)>-1,n):Mo(e,r,s,n.before||ee.before);if(t==s&&zt(e,e.selection.main.from))return No(e,r,s)}return null}function zt(e,t){let n=!1;return e.field(jt).between(0,e.doc.length,o=>{o==t&&(n=!0)}),n}function ge(e,t){let n=e.sliceString(t,t+2);return n.slice(0,F(B(n,0)))}function Ro(e,t){let n=e.sliceString(t-2,t);return F(B(n,0))==n.length?n:n.slice(1)}function Mo(e,t,n,o){let r=null,s=e.changeByRange(i=>{if(!i.empty)return{changes:[{insert:t,from:i.from},{insert:n,from:i.to}],effects:H.of(i.to+t.length),range:y.range(i.anchor+t.length,i.head+t.length)};let l=ge(e.doc,i.head);return!l||/\s/.test(l)||o.indexOf(l)>-1?{changes:{insert:t+n,from:i.head},effects:H.of(i.head+t.length),range:y.cursor(i.head+t.length)}:{range:r=i}});return r?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function No(e,t,n){let o=null,r=e.changeByRange(s=>s.empty&&ge(e.doc,s.head)==n?{changes:{from:s.head,to:s.head+n.length,insert:n},range:y.cursor(s.head+n.length)}:o={range:s});return o?null:e.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Vo(e,t,n,o){let r=o.stringPrefixes||ee.stringPrefixes,s=null,i=e.changeByRange(l=>{if(!l.empty)return{changes:[{insert:t,from:l.from},{insert:t,from:l.to}],effects:H.of(l.to+t.length),range:y.range(l.anchor+t.length,l.head+t.length)};let c=l.head,a=ge(e.doc,c),f;if(a==t){if(ot(e,c))return{changes:{insert:t+t,from:c},effects:H.of(c+t.length),range:y.cursor(c+t.length)};if(zt(e,c)){let h=n&&e.sliceDoc(c,c+t.length*3)==t+t+t?t+t+t:t;return{changes:{from:c,to:c+h.length,insert:h},range:y.cursor(c+h.length)}}}else{if(n&&e.sliceDoc(c-2*t.length,c)==t+t&&(f=rt(e,c-2*t.length,r))>-1&&ot(e,f))return{changes:{insert:t+t+t+t,from:c},effects:H.of(c+t.length),range:y.cursor(c+t.length)};if(e.charCategorizer(c)(a)!=Pe.Word&&rt(e,c,r)>-1&&!Fo(e,c,t,r))return{changes:{insert:t+t,from:c},effects:H.of(c+t.length),range:y.cursor(c+t.length)}}return{range:s=l}});return s?null:e.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function ot(e,t){let n=z(e).resolveInner(t+1);return n.parent&&n.from==t}function Fo(e,t,n,o){let r=z(e).resolveInner(t,-1),s=o.reduce((i,l)=>Math.max(i,l.length),0);for(let i=0;i<5;i++){let l=e.sliceDoc(r.from,Math.min(r.to,r.from+n.length+s)),c=l.indexOf(n);if(!c||c>-1&&o.indexOf(l.slice(0,c))>-1){let f=r.firstChild;for(;f&&f.from==r.from&&f.to-f.from>n.length+c;){if(e.sliceDoc(f.to-n.length,f.to)==n)return!1;f=f.firstChild}return!0}let a=r.to==t&&r.parent;if(!a)break;r=a}return!1}function rt(e,t,n){let o=e.charCategorizer(t);if(o(e.sliceDoc(t-1,t))!=Pe.Word)return t;for(let r of n){let s=t-r.length;if(e.sliceDoc(s,t)==r&&o(e.sliceDoc(s-1,s))!=Pe.Word)return s}return-1}function As(e={}){return[Co,v,k.of(e),yo,Uo,Vt]}const jo=[{key:"Ctrl-Space",run:uo},{key:"Escape",run:ho},{key:"ArrowDown",run:re(!0)},{key:"ArrowUp",run:re(!1)},{key:"PageDown",run:re(!0,"page")},{key:"PageUp",run:re(!1,"page")},{key:"Enter",run:fo}],Uo=Re.highest(Et.computeN([k],e=>e.facet(k).defaultKeymap?[jo]:[])),Ho=e=>{let{state:t}=e,n=t.doc.lineAt(t.selection.main.from),o=We(e.state,n.from);return o.line?zo(e):o.block?qo(e):!1};function qe(e,t){return({state:n,dispatch:o})=>{if(n.readOnly)return!1;let r=e(t,n);return r?(o(n.update(r)),!0):!1}}const zo=qe(Ko,0),$o=qe($t,0),qo=qe((e,t)=>$t(e,t,Go(t)),0);function We(e,t){let n=e.languageDataAt("commentTokens",t);return n.length?n[0]:{}}const Q=50;function Wo(e,{open:t,close:n},o,r){let s=e.sliceDoc(o-Q,o),i=e.sliceDoc(r,r+Q),l=/\s*$/.exec(s)[0].length,c=/^\s*/.exec(i)[0].length,a=s.length-l;if(s.slice(a-t.length,a)==t&&i.slice(c,c+n.length)==n)return{open:{pos:o-l,margin:l&&1},close:{pos:r+c,margin:c&&1}};let f,u;r-o<=2*Q?f=u=e.sliceDoc(o,r):(f=e.sliceDoc(o,o+Q),u=e.sliceDoc(r-Q,r));let h=/^\s*/.exec(f)[0].length,p=/\s*$/.exec(u)[0].length,d=u.length-p-n.length;return f.slice(h,h+t.length)==t&&u.slice(d,d+n.length)==n?{open:{pos:o+h+t.length,margin:/\s/.test(f.charAt(h+t.length))?1:0},close:{pos:r-p-n.length,margin:/\s/.test(u.charAt(d-1))?1:0}}:null}function Go(e){let t=[];for(let n of e.selection.ranges){let o=e.doc.lineAt(n.from),r=n.to<=o.to?o:e.doc.lineAt(n.to),s=t.length-1;s>=0&&t[s].to>o.from?t[s].to=r.to:t.push({from:o.from+/^\s*/.exec(o.text)[0].length,to:r.to})}return t}function $t(e,t,n=t.selection.ranges){let o=n.map(s=>We(t,s.from).block);if(!o.every(s=>s))return null;let r=n.map((s,i)=>Wo(t,o[i],s.from,s.to));if(e!=2&&!r.every(s=>s))return{changes:t.changes(n.map((s,i)=>r[i]?[]:[{from:s.from,insert:o[i].open+" "},{from:s.to,insert:" "+o[i].close}]))};if(e!=1&&r.some(s=>s)){let s=[];for(let i=0,l;i<r.length;i++)if(l=r[i]){let c=o[i],{open:a,close:f}=l;s.push({from:a.pos-c.open.length,to:a.pos+a.margin},{from:f.pos-f.margin,to:f.pos+c.close.length})}return{changes:s}}return null}function Ko(e,t,n=t.selection.ranges){let o=[],r=-1;for(let{from:s,to:i}of n){let l=o.length,c=1e9,a=We(t,s).line;if(a){for(let f=s;f<=i;){let u=t.doc.lineAt(f);if(u.from>r&&(s==i||i>u.from)){r=u.from;let h=/^\s*/.exec(u.text)[0].length,p=h==u.length,d=u.text.slice(h,h+a.length)==a?h:-1;h<u.text.length&&h<c&&(c=h),o.push({line:u,comment:d,token:a,indent:h,empty:p,single:!1})}f=u.to+1}if(c<1e9)for(let f=l;f<o.length;f++)o[f].indent<o[f].line.text.length&&(o[f].indent=c);o.length==l+1&&(o[l].single=!0)}}if(e!=2&&o.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:c,indent:a,empty:f,single:u}of o)(u||!f)&&s.push({from:l.from+a,insert:c+" "});let i=t.changes(s);return{changes:i,selection:t.selection.map(i,1)}}else if(e!=1&&o.some(s=>s.comment>=0)){let s=[];for(let{line:i,comment:l,token:c}of o)if(l>=0){let a=i.from+l,f=a+c.length;i.text[f-i.from]==" "&&f++,s.push({from:a,to:f})}return{changes:s}}return null}const De=Me.define(),Jo=Me.define(),Qo=me.define(),qt=me.define({combine(e){return kt(e,{minDepth:100,newGroupDelay:500,joinToEvent:(t,n)=>n},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,n)=>(o,r)=>t(o,r)||n(o,r)})}}),Wt=de.define({create(){return R.empty},update(e,t){let n=t.state.facet(qt),o=t.annotation(De);if(o){let c=T.fromTransaction(t,o.selection),a=o.side,f=a==0?e.undone:e.done;return c?f=he(f,f.length,n.minDepth,c):f=Jt(f,t.startState.selection),new R(a==0?o.rest:f,a==0?f:o.rest)}let r=t.annotation(Jo);if((r=="full"||r=="before")&&(e=e.isolate()),t.annotation(ie.addToHistory)===!1)return t.changes.empty?e:e.addMapping(t.changes.desc);let s=T.fromTransaction(t),i=t.annotation(ie.time),l=t.annotation(ie.userEvent);return s?e=e.addChanges(s,i,l,n,t):t.selection&&(e=e.addSelection(t.startState.selection,i,l,n.newGroupDelay)),(r=="full"||r=="after")&&(e=e.isolate()),e},toJSON(e){return{done:e.done.map(t=>t.toJSON()),undone:e.undone.map(t=>t.toJSON())}},fromJSON(e){return new R(e.done.map(T.fromJSON),e.undone.map(T.fromJSON))}});function ks(e={}){return[Wt,qt.of(e),D.domEventHandlers({beforeinput(t,n){let o=t.inputType=="historyUndo"?Gt:t.inputType=="historyRedo"?Oe:null;return o?(t.preventDefault(),o(n)):!1}})]}function ye(e,t){return function({state:n,dispatch:o}){if(!t&&n.readOnly)return!1;let r=n.field(Wt,!1);if(!r)return!1;let s=r.pop(e,n,t);return s?(o(s),!0):!1}}const Gt=ye(0,!1),Oe=ye(1,!1),Yo=ye(0,!0),Xo=ye(1,!0);class T{constructor(t,n,o,r,s){this.changes=t,this.effects=n,this.mapped=o,this.startSelection=r,this.selectionsAfter=s}setSelAfter(t){return new T(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,n,o;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(n=this.mapped)===null||n===void 0?void 0:n.toJSON(),startSelection:(o=this.startSelection)===null||o===void 0?void 0:o.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(t){return new T(t.changes&&In.fromJSON(t.changes),[],t.mapped&&Dn.fromJSON(t.mapped),t.startSelection&&y.fromJSON(t.startSelection),t.selectionsAfter.map(y.fromJSON))}static fromTransaction(t,n){let o=I;for(let r of t.startState.facet(Qo)){let s=r(t);s.length&&(o=o.concat(s))}return!o.length&&t.changes.empty?null:new T(t.changes.invert(t.startState.doc),o,void 0,n||t.startState.selection,I)}static selection(t){return new T(void 0,I,void 0,void 0,t)}}function he(e,t,n,o){let r=t+1>n+20?t-n-1:0,s=e.slice(r,t);return s.push(o),s}function Zo(e,t){let n=[],o=!1;return e.iterChangedRanges((r,s)=>n.push(r,s)),t.iterChangedRanges((r,s,i,l)=>{for(let c=0;c<n.length;){let a=n[c++],f=n[c++];l>=a&&i<=f&&(o=!0)}}),o}function er(e,t){return e.ranges.length==t.ranges.length&&e.ranges.filter((n,o)=>n.empty!=t.ranges[o].empty).length===0}function Kt(e,t){return e.length?t.length?e.concat(t):e:t}const I=[],tr=200;function Jt(e,t){if(e.length){let n=e[e.length-1],o=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-tr));return o.length&&o[o.length-1].eq(t)?e:(o.push(t),he(e,e.length-1,1e9,n.setSelAfter(o)))}else return[T.selection([t])]}function nr(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function _e(e,t){if(!e.length)return e;let n=e.length,o=I;for(;n;){let r=or(e[n-1],t,o);if(r.changes&&!r.changes.empty||r.effects.length){let s=e.slice(0,n);return s[n-1]=r,s}else t=r.mapped,n--,o=r.selectionsAfter}return o.length?[T.selection(o)]:I}function or(e,t,n){let o=Kt(e.selectionsAfter.length?e.selectionsAfter.map(l=>l.map(t)):I,n);if(!e.changes)return T.selection(o);let r=e.changes.map(t),s=t.mapDesc(e.changes,!0),i=e.mapped?e.mapped.composeDesc(s):s;return new T(r,V.mapEffects(e.effects,t),i,e.startSelection.map(s),o)}const rr=/^(input\.type|delete)($|\.)/;class R{constructor(t,n,o=0,r=void 0){this.done=t,this.undone=n,this.prevTime=o,this.prevUserEvent=r}isolate(){return this.prevTime?new R(this.done,this.undone):this}addChanges(t,n,o,r,s){let i=this.done,l=i[i.length-1];return l&&l.changes&&!l.changes.empty&&t.changes&&(!o||rr.test(o))&&(!l.selectionsAfter.length&&n-this.prevTime<r.newGroupDelay&&r.joinToEvent(s,Zo(l.changes,t.changes))||o=="input.type.compose")?i=he(i,i.length-1,r.minDepth,new T(t.changes.compose(l.changes),Kt(t.effects,l.effects),l.mapped,l.startSelection,I)):i=he(i,i.length,r.minDepth,t),new R(i,I,n,o)}addSelection(t,n,o,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:I;return s.length>0&&n-this.prevTime<r&&o==this.prevUserEvent&&o&&/^select($|\.)/.test(o)&&er(s[s.length-1],t)?this:new R(Jt(this.done,t),this.undone,n,o)}addMapping(t){return new R(_e(this.done,t),_e(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,n,o){let r=t==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1],i=s.selectionsAfter[0]||n.selection;if(o&&s.selectionsAfter.length)return n.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:De.of({side:t,rest:nr(r),selection:i}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let l=r.length==1?I:r.slice(0,r.length-1);return s.mapped&&(l=_e(l,s.mapped)),n.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:De.of({side:t,rest:l,selection:i}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}R.empty=new R(I,I);const Es=[{key:"Mod-z",run:Gt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Oe,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Oe,preventDefault:!0},{key:"Mod-u",run:Yo,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Xo,preventDefault:!0}];function J(e,t){return y.create(e.ranges.map(t),e.mainIndex)}function M(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function w({state:e,dispatch:t},n){let o=J(e.selection,n);return o.eq(e.selection,!0)?!1:(t(M(e,o)),!0)}function Se(e,t){return y.cursor(t?e.to:e.from)}function Qt(e,t){return w(e,n=>n.empty?e.moveByChar(n,t):Se(n,t))}function E(e){return e.textDirectionAt(e.state.selection.main.head)==vt.LTR}const Yt=e=>Qt(e,!E(e)),Xt=e=>Qt(e,E(e));function Zt(e,t){return w(e,n=>n.empty?e.moveByGroup(n,t):Se(n,t))}const sr=e=>Zt(e,!E(e)),ir=e=>Zt(e,E(e));function lr(e,t,n){if(t.type.prop(n))return!0;let o=t.to-t.from;return o&&(o>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function Ce(e,t,n){let o=z(e).resolveInner(t.head),r=n?Le.closedBy:Le.openedBy;for(let c=t.head;;){let a=n?o.childAfter(c):o.childBefore(c);if(!a)break;lr(e,a,r)?o=a:c=n?a.to:a.from}let s=o.type.prop(r),i,l;return s&&(i=n?q(e,o.from,1):q(e,o.to,-1))&&i.matched?l=n?i.end.to:i.end.from:l=n?o.to:o.from,y.cursor(l,n?-1:1)}const cr=e=>w(e,t=>Ce(e.state,t,!E(e))),ar=e=>w(e,t=>Ce(e.state,t,E(e)));function en(e,t){return w(e,n=>{if(!n.empty)return Se(n,t);let o=e.moveVertically(n,t);return o.head!=n.head?o:e.moveToLineBoundary(n,t)})}const tn=e=>en(e,!1),nn=e=>en(e,!0);function on(e){let t=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,n=0,o=0,r;if(t){for(let s of e.state.facet(D.scrollMargins)){let i=s(e);i!=null&&i.top&&(n=Math.max(i==null?void 0:i.top,n)),i!=null&&i.bottom&&(o=Math.max(i==null?void 0:i.bottom,o))}r=e.scrollDOM.clientHeight-n-o}else r=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:o,selfScroll:t,height:Math.max(e.defaultLineHeight,r-5)}}function rn(e,t){let n=on(e),{state:o}=e,r=J(o.selection,i=>i.empty?e.moveVertically(i,t,n.height):Se(i,t));if(r.eq(o.selection))return!1;let s;if(n.selfScroll){let i=e.coordsAtPos(o.selection.main.head),l=e.scrollDOM.getBoundingClientRect(),c=l.top+n.marginTop,a=l.bottom-n.marginBottom;i&&i.top>c&&i.bottom<a&&(s=D.scrollIntoView(r.main.head,{y:"start",yMargin:i.top-c}))}return e.dispatch(M(o,r),{effects:s}),!0}const st=e=>rn(e,!1),Be=e=>rn(e,!0);function U(e,t,n){let o=e.lineBlockAt(t.head),r=e.moveToLineBoundary(t,n);if(r.head==t.head&&r.head!=(n?o.to:o.from)&&(r=e.moveToLineBoundary(t,n,!1)),!n&&r.head==o.from&&o.length){let s=/^\s*/.exec(e.state.sliceDoc(o.from,Math.min(o.from+100,o.to)))[0].length;s&&t.head!=o.from+s&&(r=y.cursor(o.from+s))}return r}const fr=e=>w(e,t=>U(e,t,!0)),ur=e=>w(e,t=>U(e,t,!1)),hr=e=>w(e,t=>U(e,t,!E(e))),dr=e=>w(e,t=>U(e,t,E(e))),mr=e=>w(e,t=>y.cursor(e.lineBlockAt(t.head).from,1)),pr=e=>w(e,t=>y.cursor(e.lineBlockAt(t.head).to,-1));function gr(e,t,n){let o=!1,r=J(e.selection,s=>{let i=q(e,s.head,-1)||q(e,s.head,1)||s.head>0&&q(e,s.head-1,1)||s.head<e.doc.length&&q(e,s.head+1,-1);if(!i||!i.end)return s;o=!0;let l=i.start.from==s.head?i.end.to:i.end.from;return y.cursor(l)});return o?(t(M(e,r)),!0):!1}const yr=({state:e,dispatch:t})=>gr(e,t);function O(e,t){let n=J(e.state.selection,o=>{let r=t(o);return y.range(o.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return n.eq(e.state.selection)?!1:(e.dispatch(M(e.state,n)),!0)}function sn(e,t){return O(e,n=>e.moveByChar(n,t))}const ln=e=>sn(e,!E(e)),cn=e=>sn(e,E(e));function an(e,t){return O(e,n=>e.moveByGroup(n,t))}const Sr=e=>an(e,!E(e)),Cr=e=>an(e,E(e)),xr=e=>O(e,t=>Ce(e.state,t,!E(e))),br=e=>O(e,t=>Ce(e.state,t,E(e)));function fn(e,t){return O(e,n=>e.moveVertically(n,t))}const un=e=>fn(e,!1),hn=e=>fn(e,!0);function dn(e,t){return O(e,n=>e.moveVertically(n,t,on(e).height))}const it=e=>dn(e,!1),lt=e=>dn(e,!0),Ar=e=>O(e,t=>U(e,t,!0)),kr=e=>O(e,t=>U(e,t,!1)),Er=e=>O(e,t=>U(e,t,!E(e))),_r=e=>O(e,t=>U(e,t,E(e))),vr=e=>O(e,t=>y.cursor(e.lineBlockAt(t.head).from)),Tr=e=>O(e,t=>y.cursor(e.lineBlockAt(t.head).to)),ct=({state:e,dispatch:t})=>(t(M(e,{anchor:0})),!0),at=({state:e,dispatch:t})=>(t(M(e,{anchor:e.doc.length})),!0),ft=({state:e,dispatch:t})=>(t(M(e,{anchor:e.selection.main.anchor,head:0})),!0),ut=({state:e,dispatch:t})=>(t(M(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),Pr=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),Lr=({state:e,dispatch:t})=>{let n=xe(e).map(({from:o,to:r})=>y.range(o,Math.min(r+1,e.doc.length)));return t(e.update({selection:y.create(n),userEvent:"select"})),!0},Ir=({state:e,dispatch:t})=>{let n=J(e.selection,o=>{var r;let s=z(e).resolveStack(o.from,1);for(let i=s;i;i=i.next){let{node:l}=i;if((l.from<o.from&&l.to>=o.to||l.to>o.to&&l.from<=o.from)&&(!((r=l.parent)===null||r===void 0)&&r.parent))return y.range(l.to,l.from)}return o});return t(M(e,n)),!0},Dr=({state:e,dispatch:t})=>{let n=e.selection,o=null;return n.ranges.length>1?o=y.create([n.main]):n.main.empty||(o=y.create([y.cursor(n.main.head)])),o?(t(M(e,o)),!0):!1};function ne(e,t){if(e.state.readOnly)return!1;let n="delete.selection",{state:o}=e,r=o.changeByRange(s=>{let{from:i,to:l}=s;if(i==l){let c=t(s);c<i?(n="delete.backward",c=se(e,c,!1)):c>i&&(n="delete.forward",c=se(e,c,!0)),i=Math.min(i,c),l=Math.max(l,c)}else i=se(e,i,!1),l=se(e,l,!0);return i==l?{range:s}:{changes:{from:i,to:l},range:y.cursor(i,i<s.head?-1:1)}});return r.changes.empty?!1:(e.dispatch(o.update(r,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?D.announce.of(o.phrase("Selection deleted")):void 0})),!0)}function se(e,t,n){if(e instanceof D)for(let o of e.state.facet(D.atomicRanges).map(r=>r(e)))o.between(t,t,(r,s)=>{r<t&&s>t&&(t=n?s:r)});return t}const mn=(e,t,n)=>ne(e,o=>{let r=o.from,{state:s}=e,i=s.doc.lineAt(r),l,c;if(n&&!t&&r>i.from&&r<i.from+200&&!/[^ \t]/.test(l=i.text.slice(0,r-i.from))){if(l[l.length-1]=="	")return r-1;let a=Ve(l,s.tabSize),f=a%Ie(s)||Ie(s);for(let u=0;u<f&&l[l.length-1-u]==" ";u++)r--;c=r}else c=Y(i.text,r-i.from,t,t)+i.from,c==r&&i.number!=(t?s.doc.lines:1)?c+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(i.text.slice(c-i.from,r-i.from))&&(c=Y(i.text,c-i.from,!1,!1)+i.from);return c}),we=e=>mn(e,!1,!0),pn=e=>mn(e,!0,!1),gn=(e,t)=>ne(e,n=>{let o=n.head,{state:r}=e,s=r.doc.lineAt(o),i=r.charCategorizer(o);for(let l=null;;){if(o==(t?s.to:s.from)){o==n.head&&s.number!=(t?r.doc.lines:1)&&(o+=t?1:-1);break}let c=Y(s.text,o-s.from,t)+s.from,a=s.text.slice(Math.min(o,c)-s.from,Math.max(o,c)-s.from),f=i(a);if(l!=null&&f!=l)break;(a!=" "||o!=n.head)&&(l=f),o=c}return o}),yn=e=>gn(e,!1),Or=e=>gn(e,!0),Br=e=>ne(e,t=>{let n=e.lineBlockAt(t.head).to;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}),wr=e=>ne(e,t=>{let n=e.moveToLineBoundary(t,!1).head;return t.head>n?n:Math.max(0,t.head-1)}),Rr=e=>ne(e,t=>{let n=e.moveToLineBoundary(t,!0).head;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}),Mr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>({changes:{from:o.from,to:o.to,insert:Ne.of(["",""])},range:y.cursor(o.from)}));return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},Nr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>{if(!o.empty||o.from==0||o.from==e.doc.length)return{range:o};let r=o.from,s=e.doc.lineAt(r),i=r==s.from?r-1:Y(s.text,r-s.from,!1)+s.from,l=r==s.to?r+1:Y(s.text,r-s.from,!0)+s.from;return{changes:{from:i,to:l,insert:e.doc.slice(r,l).append(e.doc.slice(i,r))},range:y.cursor(l)}});return n.changes.empty?!1:(t(e.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function xe(e){let t=[],n=-1;for(let o of e.selection.ranges){let r=e.doc.lineAt(o.from),s=e.doc.lineAt(o.to);if(!o.empty&&o.to==s.from&&(s=e.doc.lineAt(o.to-1)),n>=r.number){let i=t[t.length-1];i.to=s.to,i.ranges.push(o)}else t.push({from:r.from,to:s.to,ranges:[o]});n=s.number+1}return t}function Sn(e,t,n){if(e.readOnly)return!1;let o=[],r=[];for(let s of xe(e)){if(n?s.to==e.doc.length:s.from==0)continue;let i=e.doc.lineAt(n?s.to+1:s.from-1),l=i.length+1;if(n){o.push({from:s.to,to:i.to},{from:s.from,insert:i.text+e.lineBreak});for(let c of s.ranges)r.push(y.range(Math.min(e.doc.length,c.anchor+l),Math.min(e.doc.length,c.head+l)))}else{o.push({from:i.from,to:s.from},{from:s.to,insert:e.lineBreak+i.text});for(let c of s.ranges)r.push(y.range(c.anchor-l,c.head-l))}}return o.length?(t(e.update({changes:o,scrollIntoView:!0,selection:y.create(r,e.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Vr=({state:e,dispatch:t})=>Sn(e,t,!1),Fr=({state:e,dispatch:t})=>Sn(e,t,!0);function Cn(e,t,n){if(e.readOnly)return!1;let o=[];for(let r of xe(e))n?o.push({from:r.from,insert:e.doc.slice(r.from,r.to)+e.lineBreak}):o.push({from:r.to,insert:e.lineBreak+e.doc.slice(r.from,r.to)});return t(e.update({changes:o,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const jr=({state:e,dispatch:t})=>Cn(e,t,!1),Ur=({state:e,dispatch:t})=>Cn(e,t,!0),Hr=e=>{if(e.state.readOnly)return!1;let{state:t}=e,n=t.changes(xe(t).map(({from:r,to:s})=>(r>0?r--:s<t.doc.length&&s++,{from:r,to:s}))),o=J(t.selection,r=>{let s;if(e.lineWrapping){let i=e.lineBlockAt(r.head),l=e.coordsAtPos(r.head,r.assoc||1);l&&(s=i.bottom+e.documentTop-l.bottom+e.defaultLineHeight/2)}return e.moveVertically(r,!0,s)}).map(n);return e.dispatch({changes:n,selection:o,scrollIntoView:!0,userEvent:"delete.line"}),!0};function zr(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let n=z(e).resolveInner(t),o=n.childBefore(t),r=n.childAfter(t),s;return o&&r&&o.to<=t&&r.from>=t&&(s=o.type.prop(Le.closedBy))&&s.indexOf(r.name)>-1&&e.doc.lineAt(o.to).from==e.doc.lineAt(r.from).from&&!/\S/.test(e.sliceDoc(o.to,r.from))?{from:o.to,to:r.from}:null}const $r=xn(!1),qr=xn(!0);function xn(e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let o=t.changeByRange(r=>{let{from:s,to:i}=r,l=t.doc.lineAt(s),c=!e&&s==i&&zr(t,s);e&&(s=i=(i<=l.to?l:t.doc.lineAt(i)).to);let a=new Pt(t,{simulateBreak:s,simulateDoubleBreak:!!c}),f=Lt(a,s);for(f==null&&(f=Ve(/^\s*/.exec(t.doc.lineAt(s).text)[0],t.tabSize));i<l.to&&/\s/.test(l.text[i-l.from]);)i++;c?{from:s,to:i}=c:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let u=["",ce(t,f)];return c&&u.push(ce(t,a.lineIndent(l.from,-1))),{changes:{from:s,to:i,insert:Ne.of(u)},range:y.cursor(s+1+u[1].length)}});return n(t.update(o,{scrollIntoView:!0,userEvent:"input"})),!0}}function Ge(e,t){let n=-1;return e.changeByRange(o=>{let r=[];for(let i=o.from;i<=o.to;){let l=e.doc.lineAt(i);l.number>n&&(o.empty||o.to>l.from)&&(t(l,r,o),n=l.number),i=l.to+1}let s=e.changes(r);return{changes:r,range:y.range(s.mapPos(o.anchor,1),s.mapPos(o.head,1))}})}const Wr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=Object.create(null),o=new Pt(e,{overrideIndentation:s=>{let i=n[s];return i==null?-1:i}}),r=Ge(e,(s,i,l)=>{let c=Lt(o,s.from);if(c==null)return;/\S/.test(s.text)||(c=0);let a=/^\s*/.exec(s.text)[0],f=ce(e,c);(a!=f||l.from<s.from+a.length)&&(n[s.from]=c,i.push({from:s.from,to:s.from+a.length,insert:f}))});return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0},bn=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(Ge(e,(n,o)=>{o.push({from:n.from,insert:e.facet(Tt)})}),{userEvent:"input.indent"})),!0),An=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(Ge(e,(n,o)=>{let r=/^\s*/.exec(n.text)[0];if(!r)return;let s=Ve(r,e.tabSize),i=0,l=ce(e,Math.max(0,s-Ie(e)));for(;i<r.length&&i<l.length&&r.charCodeAt(i)==l.charCodeAt(i);)i++;o.push({from:n.from+i,to:n.from+r.length,insert:l.slice(i)})}),{userEvent:"delete.dedent"})),!0),Gr=e=>(e.setTabFocusMode(),!0),Kr=[{key:"Ctrl-b",run:Yt,shift:ln,preventDefault:!0},{key:"Ctrl-f",run:Xt,shift:cn},{key:"Ctrl-p",run:tn,shift:un},{key:"Ctrl-n",run:nn,shift:hn},{key:"Ctrl-a",run:mr,shift:vr},{key:"Ctrl-e",run:pr,shift:Tr},{key:"Ctrl-d",run:pn},{key:"Ctrl-h",run:we},{key:"Ctrl-k",run:Br},{key:"Ctrl-Alt-h",run:yn},{key:"Ctrl-o",run:Mr},{key:"Ctrl-t",run:Nr},{key:"Ctrl-v",run:Be}],Jr=[{key:"ArrowLeft",run:Yt,shift:ln,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:sr,shift:Sr,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:hr,shift:Er,preventDefault:!0},{key:"ArrowRight",run:Xt,shift:cn,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:ir,shift:Cr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:dr,shift:_r,preventDefault:!0},{key:"ArrowUp",run:tn,shift:un,preventDefault:!0},{mac:"Cmd-ArrowUp",run:ct,shift:ft},{mac:"Ctrl-ArrowUp",run:st,shift:it},{key:"ArrowDown",run:nn,shift:hn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:at,shift:ut},{mac:"Ctrl-ArrowDown",run:Be,shift:lt},{key:"PageUp",run:st,shift:it},{key:"PageDown",run:Be,shift:lt},{key:"Home",run:ur,shift:kr,preventDefault:!0},{key:"Mod-Home",run:ct,shift:ft},{key:"End",run:fr,shift:Ar,preventDefault:!0},{key:"Mod-End",run:at,shift:ut},{key:"Enter",run:$r},{key:"Mod-a",run:Pr},{key:"Backspace",run:we,shift:we},{key:"Delete",run:pn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:yn},{key:"Mod-Delete",mac:"Alt-Delete",run:Or},{mac:"Mod-Backspace",run:wr},{mac:"Mod-Delete",run:Rr}].concat(Kr.map(e=>({mac:e.key,run:e.run,shift:e.shift}))),_s=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cr,shift:xr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:ar,shift:br},{key:"Alt-ArrowUp",run:Vr},{key:"Shift-Alt-ArrowUp",run:jr},{key:"Alt-ArrowDown",run:Fr},{key:"Shift-Alt-ArrowDown",run:Ur},{key:"Escape",run:Dr},{key:"Mod-Enter",run:qr},{key:"Alt-l",mac:"Ctrl-l",run:Lr},{key:"Mod-i",run:Ir,preventDefault:!0},{key:"Mod-[",run:An},{key:"Mod-]",run:bn},{key:"Mod-Alt-\\",run:Wr},{key:"Shift-Mod-k",run:Hr},{key:"Shift-Mod-\\",run:yr},{key:"Mod-/",run:Ho},{key:"Alt-A",run:$o},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Gr}].concat(Jr),vs={key:"Tab",run:bn,shift:An};function A(e){return new On(Bn.define(e))}const ht=()=>C(()=>import("./pbl95wx6493wq92j.js"),[]).then(e=>A(e.shell)),kn={[S.bash]:ht,[S.zsh]:ht,[S.swift]:()=>C(()=>import("./pijqfo56g5y7ss6b.js"),[]).then(e=>A(e.swift)),[S.css]:()=>C(()=>import("./c1gr2ybddrrv7tor.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>e.css()),[S.html]:()=>C(()=>import("./le7z0uvxgo2qyp1e.js"),__vite__mapDeps([7,1,2,3,4,5,6,0,8,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.html()),[S.javascript]:()=>C(()=>import("./emk4wjabyazjdxlc.js"),__vite__mapDeps([8,1,2,3,4,5,6,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.javascript({jsx:!0,typescript:!1})),[S.typescript]:()=>C(()=>import("./emk4wjabyazjdxlc.js"),__vite__mapDeps([8,1,2,3,4,5,6,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.javascript({jsx:!0,typescript:!0})),[S.json]:()=>C(()=>import("./d8n0quna9kapa0tt.js"),__vite__mapDeps([20,1,2,3,4,5,6])).then(e=>e.json()),[S.python]:()=>C(()=>import("./43m9qcj5aeckxr3x.js"),__vite__mapDeps([21,1,2,3,4,5,6,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.python()),[S.sql]:()=>C(()=>import("./b9406ulzxvjxicn5.js"),__vite__mapDeps([22,2,3,4,5,6,1,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.sql()),[S.go]:()=>C(()=>import("./f9yvwzr46p2hsfhu.js"),__vite__mapDeps([23,1,2,3,4,5,6,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.go()),[S.yaml]:()=>C(()=>import("./fp4hwlr9rpqkq1fd.js"),__vite__mapDeps([24,1,2,3,4,5,6])).then(e=>e.yaml()),[S.java]:()=>C(()=>import("./kfyut10eyj3q3kgs.js"),__vite__mapDeps([25,1,2,3,4,5,6])).then(e=>e.java()),[S.rust]:()=>C(()=>import("./hm0s7uv4ug5ct962.js"),__vite__mapDeps([26,1,2,3,4,5,6])).then(e=>e.rust()),[S.cpp]:()=>C(()=>import("./kwdsamifo3kf5hxa.js"),__vite__mapDeps([27,1,2,3,4,5,6])).then(e=>e.cpp()),[S.php]:()=>C(()=>import("./jynbns95j98ofqey.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,0,8,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.php()),[S.xml]:()=>C(()=>import("./72on327tecpr1xbl.js"),__vite__mapDeps([29,1,2,3,4,5,6])).then(e=>e.xml()),[S.vue]:()=>C(()=>import("./bntrd7poxiti85ee.js"),__vite__mapDeps([30,2,3,4,5,6,7,1,0,8,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.vue()),[S.ruby]:()=>C(()=>import("./e4lhyu305wu0fcut.js"),[]).then(e=>A(e.ruby)),[S.haskell]:()=>C(()=>import("./jx84qcn2big2ur6d.js"),[]).then(e=>A(e.haskell)),[S.kotlin]:()=>C(()=>import("./gyh998efshiafl3v.js"),[]).then(e=>A(e.kotlin)),[S.csharp]:()=>C(()=>import("./gyh998efshiafl3v.js"),[]).then(e=>A(e.csharp)),[S.c]:()=>C(()=>import("./gyh998efshiafl3v.js"),[]).then(e=>A(e.c)),[S.objectivec]:()=>C(()=>import("./gyh998efshiafl3v.js"),[]).then(e=>A(e.objectiveC)),[S.r]:()=>C(()=>import("./ejmf57etl4wj4dsl.js"),[]).then(e=>A(e.r)),[S.lua]:()=>C(()=>import("./harowmpdmpnd9wki.js"),[]).then(e=>A(e.lua)),[S.dart]:()=>C(()=>import("./gyh998efshiafl3v.js"),[]).then(e=>A(e.dart)),[S.scala]:()=>C(()=>import("./gyh998efshiafl3v.js"),[]).then(e=>A(e.scala)),[S.perl]:()=>C(()=>import("./gq1ss5v2zpbborxl.js"),[]).then(e=>A(e.perl)),[S.commonlisp]:()=>C(()=>import("./jr6cjysmysifr6mr.js"),[]).then(e=>A(e.commonLisp)),[S.clojure]:()=>C(()=>import("./gf1tfl9d2himhfic.js"),[]).then(e=>A(e.clojure)),[S.ocaml]:()=>C(()=>import("./no1gl1ax0ypay171.js"),[]).then(e=>A(e.oCaml)),[S.powershell]:()=>C(()=>import("./i9u5kd7kvamutmln.js"),[]).then(e=>A(e.powerShell)),[S.verilog]:()=>C(()=>import("./fix340p09fldyqxz.js"),[]).then(e=>A(e.verilog)),[S.dockerfile]:()=>C(()=>import("./cgm5tyzi32u32j10.js"),[]).then(e=>A(e.dockerFile)),[S.other]:()=>null},Qr=e=>e in kn,le={},Ts=async e=>{if(le[e]!=null)return le[e];if(Qr(e)){const t=await kn[e]();return le[e]=t,t}return null},Ps=e=>{var t;return(t=le[e])!=null?t:null},Yr=It.define([{tag:g.variableName,color:"white"},{tag:g.comment,color:"rgb(255 255 255 / 50%)"},{tag:g.meta,color:"rgb(255 255 255 / 60%)"},{tag:[g.typeName],color:"#e9950c"},{tag:[g.keyword,g.literal],color:"#2e95d3"},{tag:[g.string,g.special(g.string),g.regexp],color:"#00a67d"},{tag:[g.number,g.bool,g.atom],color:"#df3079"},{tag:[g.propertyName,g.attributeName],color:"#df3079"},{tag:[g.className,g.labelName],color:"#f22c3d"},{tag:g.emphasis,fontStyle:"italic"},{tag:g.strong,fontWeight:"bold"},{tag:g.link,textDecoration:"underline"}]),Xr=It.define([{tag:[g.comment,g.quote],color:"#a0a1a7",fontStyle:"italic"},{tag:g.meta,color:"#a0a1a7"},{tag:[g.typeName],color:"#c18401"},{tag:[g.keyword,g.literal],color:"#a626a4"},{tag:[g.string,g.special(g.string),g.regexp],color:"#50a14f"},{tag:[g.number,g.bool,g.atom],color:"#986801"},{tag:[g.propertyName,g.attributeName],color:"#986801"},{tag:[g.variableName],color:"black"},{tag:[g.labelName,g.className],color:"#4078f2"},{tag:g.emphasis,fontStyle:"italic"},{tag:g.strong,fontWeight:"bold"},{tag:g.link,textDecoration:"underline"}]),Ls=e=>e?Yr:Xr;function Zr(e){return e.nodeSize-2}function Is(e,t){return t>=0&&t<=Zr(e)}const dt=(e,t)=>{if(!t)return!1;const[n,o]=t;return e>=n&&e<o},En=(e,t)=>e.pmPos-t.pmPos,mt=(e,t)=>{const n=t[t.length-1].sourcePos;return Math.min(Math.max(e,0),n)},pt=(e,t)=>{var o,r;const n=(r=(o=Dt(t))==null?void 0:o.sourcePos)!=null?r:0;return Math.min(Math.max(e,0),n)},gt=({positions:e,sourcePos:t,sourceEndPos:n})=>{var r,s,i;const o=[];for(let l=0;l<e.length;l++){const c=e[l],{sourcePos:a,leafSourceRange:f,isClose:u=!1}=c;if(n!=null&&a>n)break;const h=(r=e[l+1])!=null?r:null,p=d=>{let m=e[d];if(m==null)return d;let b=e[d+1],{leafSourceRange:L}=m;for(;m.nodeTypeName!==ae.proseMirrorNodeName()&&!m.isClose&&b!=null&&!dt(t,L);)o.push(b),m=b,b=e[d+2],L=m.leafSourceRange,d++;return d};if(a===t&&!u||dt(t,f))o.push(c),l=p(l);else if(a<=t&&((s=h==null?void 0:h.sourcePos)!=null?s:Number.POSITIVE_INFINITY)>=t){let d=l+1;const m=[];for(;((i=e[d])==null?void 0:i.isClose)===!0;)m.push(d),d++;if(e[d]){const{sourcePos:b}=e[d];do o.push(e[d]);while(e[++d].sourcePos===b);d=p(d-1)}else{(a===t||u)&&o.push(c);for(const b of m)o.push(e[b])}l=d}}return o.sort(En)},yt=({positions:e,sourcePos:t})=>{var r,s,i;const n=[],o=l=>{l&&n.push(l)};for(let l=0;l<e.length;l++){const c=e[l],{sourcePos:a}=c;if(t==null||a>t)break;const f=(r=e[l-1])!=null?r:null,u=(s=e[l+1])!=null?s:null,h=t>a&&t<((i=u==null?void 0:u.sourcePos)!=null?i:-1),p=c.nodeTypeName===ae.proseMirrorNodeName();if(a===t||h&&!p){if(c.isClose&&!(f!=null&&f.isClose)&&c.nodeTypeName===(f==null?void 0:f.nodeTypeName)||!c.isClose&&u.isClose&&c.nodeTypeName===u.nodeTypeName||c.isClose&&(f!=null&&f.isClose)||!c.isClose&&f!=null&&(f==null?void 0:f.nodeTypeName)!==ae.proseMirrorNodeName()){o(f);let L=l-2,x=e[L];for(;L>=0&&x.isClose;)o(x),x=e[--L]}let d=l,m=c,b=m;do o(m),b=m,m=e[++d];while((m==null?void 0:m.sourcePos)===t||(m==null?void 0:m.depth)<(b==null?void 0:b.depth));break}else if(h&&p){let d=l+1,m=e[d];for(;m!=null&&m.isClose;)o(m),m=e[++d];break}}return n.sort(En)},es=e=>{var r,s;const t=new Map;e.descendants((i,l)=>{var p,d;const c=Je(i);if(!c)return;const{start:a,end:f}=c,u=i.type.name,{depth:h}=e.resolve(l);if(t.set(l,{pmPos:l,sourcePos:a,leafSourceRange:i.isBlock?void 0:[a,f],depth:h,nodeTypeName:u,isClose:!1,parentNodeTypeNameStack:[]}),i.isBlock){const m=l+i.nodeSize-1;t.set(m,{pmPos:m,sourcePos:f,depth:e.resolve(m).depth,nodeTypeName:u,isClose:!0,parentNodeTypeNameStack:[]})}if(i.isText)for(let m=0;m<((d=(p=i.text)==null?void 0:p.length)!=null?d:0);m++){const b=l+m;t.set(b,{pmPos:b,sourcePos:a+m,depth:h,nodeTypeName:u,isClose:!1,parentNodeTypeNameStack:[]})}}),t.set(e.content.size,{pmPos:e.content.size,nodeTypeName:e.type.name,depth:0,isClose:!0,sourcePos:(s=(r=Je(e))==null?void 0:r.end)!=null?s:0,parentNodeTypeNameStack:[]});const n=Array.from(t.entries()).sort(([i],[l])=>i-l).map(([,i])=>i),o=[Vn.proseMirrorNodeName()];for(const i of n)i.isClose?(i.parentNodeTypeNameStack=o.concat(),o.pop()):(i.parentNodeTypeNameStack=o.concat(),i.nodeTypeName!==ae.proseMirrorNodeName()&&Dt(o)!==i.nodeTypeName&&o.push(i.nodeTypeName));return{positions:n,pmRangeToSourceRange:({start:i,end:l})=>({start:n[Math.max(i,0)].sourcePos,end:n[Math.min(l,n.length-1)].sourcePos}),sourceStartToPmPos:i=>gt({sourcePos:mt(i,n),positions:n,sourceEndPos:null}),sourceEndToPmPos:i=>yt({sourcePos:pt(i,n),positions:n}),sourceRangeToPmRange:i=>{const{start:l,end:c}=i,a=pt(c,n),f=gt({sourcePos:mt(l,n),sourceEndPos:a,positions:n}),u=yt({sourcePos:a,positions:n});return{start:f,end:u}}}},ts=Hn(es);function Ds(e,t){var n;return t&&(n=e.getState(t))!=null?n:null}const St=(e,t,n)=>{var r,s;const o=n==="min"?0:t.length-1;for(let i=o;n==="min"?i<t.length:i>=0;n==="min"?i++:i--){const{sourcePos:l,pmPos:c}=t[i];if(l===e)return c;if(n==="min"&&l>e||n==="max"&&l<e)return n==="min"&&(s=(r=t[i-1])==null?void 0:r.pmPos)!=null?s:c}return null};function ns(e,t){const n=ss(e);if(n.length===0)return t;let o=t;return n.forEach(r=>{o=os(r,o)}),o}function os(e,t){return Fn(t,{start:e.from,end:e.to},rs(e))}function rs(e){return e.slice.size-(e.to-e.from)}function ss(e){return e.steps.filter(t=>t instanceof wn)}const Ct=new Mn("comments");function xt(e,t){const{sourceRangeToPmRange:n}=ts(e),o=t.map(({id:r,at:s})=>{const{start:i,end:l}=n(s),c=St(s.start,i,"max"),a=St(s.end,l,"min");return a==null||c==null?null:[r,{start:c,end:a}]}).filter(Nn);return new Map(o)}function is(e,t){var s,i;const{type:n}=t;if(n===zn.SELECTION){const{from:l,to:c}=t;return[l,c]}const{pos:o}=t,r=o+((i=(s=e.nodeAt(o))==null?void 0:s.nodeSize)!=null?i:0);return[o,r]}const bt=(e,t,n=null,o=null)=>{const r=[],s=Array.from(t.entries()).reverse(),i=new Map(e.map(l=>[l.id,l]));for(const[l,c]of s){const a=i.get(l),h=Un({isHovered:n===l,isFocused:o===l,isCode:!1,diffStatus:a==null?void 0:a.diffStatus});r.push(Ot.inline(c.start,c.end,{class:h,"data-comment-id":l,nodeName:"span"}))}return r},Os=e=>new Rn({key:Ct,state:{init:(t,{doc:n})=>{const o=xt(n,e);return{comments:e,commentingOn:null,hoveredOnBlock:null,hoveredCommentId:null,focusedCommentId:null,decorations:bt(e,o),positions:o}},apply:(t,n)=>{var h;const o=(h=t.getMeta(Ct))!=null?h:{},r=o.comments,s=r!=null?r:n.comments,i=r!=null?xt(t.doc,s):n.positions;let l=o.commentingOn;l===void 0&&(l=n.commentingOn);let c=o.hoveredCommentId;c===void 0&&(c=n.hoveredCommentId);let a=o.focusedCommentId;a===void 0&&(a=n.focusedCommentId);const f=ns(t,i),u=jn(s,f);return{comments:u,commentingOn:l,hoveredCommentId:c,focusedCommentId:a,decorations:bt(u,f,c,a),positions:f}}},props:{handleClickOn:(t,n,o,r,s)=>{const{target:i}=s;if(i instanceof HTMLElement){const{commentId:l}=i.dataset;if(!l)return;Ae.focusComment(l)}},handleDOMEvents:{mouseover(t,n){const{target:o}=n;if(o instanceof HTMLElement){const{commentId:r}=o.dataset;r?Ae.mouseEnterComment(r):Ae.mouseLeaveComment()}}},decorations(t){const n=this.getState(t);if(!n)return Ke.empty;const{commentingOn:o,decorations:r}=n,{doc:s}=t;if(o){const[i,l]=is(s,o);i!=null&&l!=null&&r.push(Ot.inline(i,l,{class:$n.document},{comment:{pattern:o}}))}return Ke.create(s,r.concat())}}});export{Is as a,Ct as b,Gn as c,ys as d,xs as e,As as f,Ds as g,ks as h,Ss as i,bs as j,_s as k,jo as l,Es as m,vs as n,Ls as o,Ps as p,Ts as q,ts as r,Cs as s,St as t,Os as u,Zr as v};
//# sourceMappingURL=kau2ug0899cbkpxh.js.map
