const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gsas8pb1acnf7jnd.js","assets/i8clt0mfz495j7ii.js","assets/et3ha0h4bqlxc2uf.js","assets/d69imh1iyv32gaf9.js","assets/kag562m27rmlspt4.js","assets/b7nodduwb2cg7ocy.js","assets/mkqbxg29rgkoa3dk.js","assets/nlen9u31md3gmt0q.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css"])))=>i.map(i=>d[i]);
var ct=Object.defineProperty,lt=Object.defineProperties;var ut=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var Re=(e,n,t)=>n in e?ct(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,_=(e,n)=>{for(var t in n||(n={}))Pe.call(n,t)&&Re(e,t,n[t]);if(ee)for(var t of ee(n))Ie.call(n,t)&&Re(e,t,n[t]);return e},Y=(e,n)=>lt(e,ut(n));var te=(e,n)=>{var t={};for(var o in e)Pe.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(e!=null&&ee)for(var o of ee(e))n.indexOf(o)<0&&Ie.call(e,o)&&(t[o]=e[o]);return t};import{r as s,e as z,j as f,_ as D}from"./i8clt0mfz495j7ii.js";import{hQ as J,kK as $e,kM as pe,ff as We,rX as dt,P as Ve,k_ as mt,e1 as ft,o as H,L as U,u as gt,bQ as je,bO as ce,dM as pt,bN as vt,aV as me,d as fe,T as ht,b0 as ve,$ as bt,a as _t}from"./ghewn7l2ynbm32fm.js";import{gK as he,nM as le,rS as ue,rT as Oe,cF as He,rU as St,rV as Le,rW as Ne,rX as Ae,rY as kt,rZ as yt,r_ as Tt,r$ as Mt,s0 as Et,s1 as Ct,s2 as Ue,s3 as xt,s4 as wt,s5 as W,s6 as Rt,gL as P,mA as Pt,s7 as It,s8 as Vt,gJ as jt,s9 as Ot,sa as Lt}from"./j0yo6uv6652vva62.js";import{a as Nt,$ as At,C as Dt,_ as x,y as Ft,W as Bt,O as qe,N as Kt,I as $t,R as Wt,Y as Ht,F as Ut,S as ne,b as be,u as qt,g as zt,c as Gt,d as Qt,e as Yt,T as Jt,L as Xt,V as Zt}from"./h8pr5f6a9kp0y6hm.js";import{R as en,a as $,M as tn,C as A,T as oe,b as nn,c as on,L as sn,E as rn}from"./bxgk09qvxvkate6l.js";import{u as an,s as cn}from"./eosy1ymy279c5qnc.js";import{V as ln}from"./i1vfxlpgdgslxqwx.js";import{L as un}from"./iiok29s29bpdre61.js";function dn(){const e=he(),n=Nt(),t=s.useCallback(()=>{le.debug("disconnected from room"),ue(e)},[e]),o=s.useCallback(a=>{n.danger("Something went wrong",{toastId:"livekit_room_error"}),le.error("an error occurred within the room",a);const l=Oe(e.getState());J.voiceMode.error(Y(_({},l),{error:a.message})),e.setState(c=>{c.metrics.livekitConnectSuccessTime||(c.metrics.livekitConnectFailTime=new Date)}),ue(e)},[n,e]),i=s.useCallback(a=>{n.danger("Something went wrong",{toastId:"livekit_room_error",loggingTitle:"Encryption error",loggingDescription:a.message}),le.error("an encryption error occurred within the room",a);const l=Oe(e.getState());J.voiceMode.error(_({encryptionError:a.message,eventSource:"voice-session"},l)),e.setState(c=>{c.metrics.livekitConnectSuccessTime||(c.metrics.livekitConnectFailTime=new Date)}),ue(e)},[n,e]);return{onDisconnected:t,onError:o,onEncryptionError:i}}function ze(e){var n,t,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(n=0;n<i;n++)e[n]&&(t=ze(e[n]))&&(o&&(o+=" "),o+=t)}else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function mn(){for(var e,n,t=0,o="",i=arguments.length;t<i;t++)(e=arguments[t])&&(n=ze(e))&&(o&&(o+=" "),o+=n);return o}function fn(...e){return(...n)=>{for(const t of e)if(typeof t=="function")try{t(...n)}catch(o){console.error(o)}}}function Ge(...e){const n=_({},e[0]);for(let t=1;t<e.length;t++){const o=e[t];for(const i in o){const a=n[i],l=o[i];typeof a=="function"&&typeof l=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?n[i]=fn(a,l):(i==="className"||i==="UNSAFE_className")&&typeof a=="string"&&typeof l=="string"?n[i]=mn(a,l):n[i]=l!==void 0?l:a}}return n}const gn={connect:!0,audio:!1,video:!1};function pn(e){const T=_(_({},gn),e),{token:n,serverUrl:t,options:o,room:i,connectOptions:a,connect:l,audio:c,video:u,screen:v,onConnected:S,onDisconnected:g,onError:r,onMediaDeviceFailure:h,onEncryptionError:p,simulateParticipants:b}=T,k=te(T,["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","onEncryptionError","simulateParticipants"]);o&&i&&x.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[d,O]=s.useState();s.useEffect(()=>{O(i!=null?i:new en(o))},[i]);const w=s.useMemo(()=>{const{className:y}=Ft();return Ge(k,{className:y})},[k]);return s.useEffect(()=>{if(!d)return;const y=()=>{const V=d.localParticipant;x.debug("trying to publish local tracks"),Promise.all([V.setMicrophoneEnabled(!!c,typeof c!="boolean"?c:void 0),V.setCameraEnabled(!!u,typeof u!="boolean"?u:void 0),V.setScreenShareEnabled(!!v,typeof v!="boolean"?v:void 0)]).catch(F=>{x.warn(F),r==null||r(F)})},I=V=>{const F=tn.getFailure(V);h==null||h(F)},R=V=>{p==null||p(V)};return d.on($.SignalConnected,y).on($.MediaDevicesError,I).on($.EncryptionError,R),()=>{d.off($.SignalConnected,y).off($.MediaDevicesError,I).off($.EncryptionError,R)}},[d,c,u,v,r,p,h]),s.useEffect(()=>{if(d){if(b){d.simulateParticipants({participants:{count:b},publish:{audio:!0,useRealTracks:!0}});return}if(!n){x.debug("no token yet");return}if(!t){x.warn("no livekit url provided"),r==null||r(Error("no livekit url provided"));return}l?(x.debug("connecting"),d.connect(t,n,a).catch(y=>{x.warn(y),r==null||r(y)})):(x.debug("disconnecting because connect is false"),d.disconnect())}},[l,n,JSON.stringify(a),d,r,t,b]),s.useEffect(()=>{if(!d)return;const y=I=>{switch(I){case A.Disconnected:g&&g();break;case A.Connected:S&&S();break}};return d.on($.ConnectionStateChanged,y),()=>{d.off($.ConnectionStateChanged,y)}},[n,S,g,d]),s.useEffect(()=>{if(d)return()=>{x.info("disconnecting on onmount"),d.disconnect()}},[d]),{room:d,htmlProps:w}}const vn=s.forwardRef(function(e,n){const{room:t,htmlProps:o}=pn(e);return s.createElement("div",_({ref:n},o),t&&s.createElement(At.Provider,{value:t},s.createElement(Dt.Provider,{value:e.featureFlags},e.children)))});function hn(e){return e!==void 0}function bn(...e){return Ge(...e.filter(hn))}function _n(e,n={}){var b;const[t,o]=s.useState(Wt(e)),[i,a]=s.useState(t==null?void 0:t.isMuted),[l,c]=s.useState(t==null?void 0:t.isSubscribed),[u,v]=s.useState(t==null?void 0:t.track),[S,g]=s.useState("landscape"),r=s.useRef(),{className:h,trackObserver:p}=s.useMemo(()=>Ht(e),[(b=e.participant.sid)!=null?b:e.participant.identity,e.source,Ut(e)&&e.publication.trackSid]);return s.useEffect(()=>{const k=p.subscribe(d=>{x.debug("update track",d),o(d),a(d==null?void 0:d.isMuted),c(d==null?void 0:d.isSubscribed),v(d==null?void 0:d.track)});return()=>k==null?void 0:k.unsubscribe()},[p]),s.useEffect(()=>{var k,d;return u&&(r.current&&u.detach(r.current),(k=n.element)!=null&&k.current&&!(qe(e.participant)&&(u==null?void 0:u.kind)==="audio")&&u.attach(n.element.current)),r.current=(d=n.element)==null?void 0:d.current,()=>{r.current&&(u==null||u.detach(r.current))}},[u,n.element]),s.useEffect(()=>{var k,d;if(typeof((k=t==null?void 0:t.dimensions)==null?void 0:k.width)=="number"&&typeof((d=t==null?void 0:t.dimensions)==null?void 0:d.height)=="number"){const O=t.dimensions.width>t.dimensions.height?"landscape":"portrait";g(O)}},[t]),{publication:t,isMuted:i,isSubscribed:l,track:u,elementProps:bn(n.props,_({className:h,"data-lk-local-participant":e.participant.isLocal,"data-lk-source":t==null?void 0:t.source},(t==null?void 0:t.kind)==="video"&&{"data-lk-orientation":S}))}}var Sn=typeof ne=="object"&&ne&&ne.Object===Object&&ne,kn=typeof self=="object"&&self&&self.Object===Object&&self;Sn||kn||Function("return this")();const yn=s.forwardRef(function(l,a){var c=l,{trackRef:e,onSubscriptionStatusChanged:n,volume:t,muted:o}=c,i=te(c,["trackRef","onSubscriptionStatusChanged","volume","muted"]);const u=$t(e),v=s.useRef(null);s.useImperativeHandle(a,()=>v.current);const{elementProps:S,isSubscribed:g,track:r,publication:h}=_n(u,{element:v,props:i});return s.useEffect(()=>{n==null||n(!!g)},[g,n]),s.useEffect(()=>{r===void 0||t===void 0||(r instanceof nn?r.setVolume(t):x.warn("Volume can only be set on remote audio tracks."))},[t,r]),s.useEffect(()=>{h===void 0||o===void 0||(h instanceof on?h.setEnabled(!o):x.warn("Can only call setEnabled on remote track publications."))},[o,h,r]),s.createElement("audio",_({ref:v},S))});function Tn({volume:e,muted:n}){const t=Bt([oe.Source.Microphone,oe.Source.ScreenShareAudio,oe.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(o=>!qe(o.participant)&&o.publication.kind===oe.Kind.Audio);return s.createElement("div",{style:{display:"none"}},t.map(o=>s.createElement(yn,{key:Kt(o),trackRef:o,volume:e,muted:n})))}const De=e=>e.length>0?kt(e):null,M=e=>{var n;return(n=e==null?void 0:e.toISOString())!=null?n:null};async function Mn(e){return await $e(async()=>{const{voiceMode:n,metrics:t}=e.getState(),o=yt(),i=await Tt(),a=await Mt(),l=await Et(),c=await Ct();return{session_create_time:M(t.sessionCreateTime),get_status_sent_time:M(t.getStatusSentTime),get_status_success_time:M(t.getStatusSuccessTime),get_status_failed_time:M(t.getStatusFailedTime),proof_of_work_start_time:M(t.proofOfWorkStartTime),proof_of_work_end_time:M(t.proofOfWorkEndTime),get_token_sent_time:M(t.getTokenSentTime),get_token_success_time:M(t.getTokenSuccessTime),get_token_failed_time:M(t.getTokenFailedTime),conversation_start_success_time:M(t.conversationStartSuccessTime),conversation_start_fail_time:M(t.conversationStartFailTime),livekit_connect_time:M(t.livekitConnectTime),livekit_connect_success_time:M(t.livekitConnectSuccessTime),livekit_connect_fail_time:M(t.livekitConnectFailTime),session_connected_time:M(t.sessionConnectedTime),data_channel_open_time:M(t.dataChannelOpenTime),conversation_latency_ms:t.conversationLatency,voice_mode:n,get_token:_({},o),peer_connection:_({},i),pre_connect:_({},a),connect:_({},c),post_connect:_({},l)}})}async function En(e,n,t){const o=await He();return $e(()=>{const{voiceMode:i,metrics:a}=e.getState(),l=pe(),c=St();return Y(_(_(_(_({session_end_time:M(a.sessionEndTime),avg_total_latency_ms:De(a.totalLatencyMs),avg_rtt_ms:De(a.currentRttMs),num_of_turns_speaking:a.numSpeaking,num_of_turns_thinking:a.numThinking,num_of_turns_listening:a.numListening,protocol:l,voice_session_id:t,reason:n,conversation_latency_ms:a.conversationLatency},Ae().length>0?{status_prefetch_failed_reasons:Ae().join(",")}:{}),Ne().length>0?{status_prefetch_ineligible_reasons:Ne().join(",")}:{}),c?{status_cache_skipped_reason:c}:{}),Le().length>0?{status_prefetch_eligible_reasons:Le().join(",")}:{}),{voice_mode:i,microphone_permission_state:o})})}function Cn({conversationId:e}){const{shouldDelayDisconnect:n,delayDisconnect:t,immediateDisconnect:o}=be({refetchLater:!0}),{toggleMute:i}=Ue(),a=We(e),l=he(),c=dt();return s.useCallback(async u=>{J.voiceSessionEndedByUser.click({reason:u}),l.setState(R=>{R.metrics.sessionEndTime=new Date}),xt({voiceFeedbackThread:a,lastVoiceSessionEndTime:new Date});const v=await En(l,u,c),S=await Mn(l),{metrics:{sessionCreateTime:g,sessionConnectedTime:r,sessionEndTime:h,numSpeaking:p,numThinking:b,numListening:k},voiceMode:d,server:{connectionState:O}}=l.getState(),w=g==null?void 0:g.getTime(),T=h==null?void 0:h.getTime(),y=r==null?void 0:r.getTime(),I=w!==void 0&&T!==void 0?T-w:void 0;Ve.logStructuredEvent(wt,{voiceMode:d!=null?d:void 0,voiceSessionId:c||void 0,protocol:pe(),sessionStartTsMs:w,sessionEndTsMs:T,sessionConnectedTsMs:y,sessionDurationMs:I,numOfTurnsSpeaking:p,numOfTurnsThinking:b,numOfTurnsListening:k,sessionEndReason:u,wasConnectedAtTimeOfExit:O===A.Connected}),Ve.logEvent("Voice Session End Summary",_(_({},v),S)),n?(l.setState(R=>{R.video=W.Stopping,R.screenshare=W.Stopping}),await i(),t()):(await o(),Rt())},[t,o,a,n,i,l,c])}const Qe=H(()=>D(()=>import("./gsas8pb1acnf7jnd.js").then(e=>e._),__vite__mapDeps([0,1])),{loading:e=>U(e)}),Ye="inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary",Fe=({message:e,onClick:n,type:t})=>{const o=z(),i=mt()&&ft;switch(t){case"microphone_denied":return i?f.jsxs("a",{href:"ms-settings:privacy-microphone",className:Ye,children:[e,f.jsx(Qe,{className:"icon-sm ms-1"})]}):f.jsx(Be,{onClick:n,message:e});case"disconnected":return f.jsxs("div",{className:"inline-flex items-center",children:[o.formatMessage(ge.lostConnection),f.jsx("button",{onClick:n,className:"ms-1",children:f.jsx("strong",{children:o.formatMessage(ge.retry)})})]});case"normal":return f.jsx(Be,{onClick:n,message:e})}},Be=({message:e,onClick:n})=>{const t=z();return f.jsxs("button",{onClick:n,className:Ye,"aria-label":t.formatMessage(ge.openInfoModal),children:[e,f.jsx(Qe,{className:"icon-sm ms-1"})]})},ge={openInfoModal:{id:"hintMessage.openInfoModal",defaultMessage:"Open info modal",description:"Open info modal about voice mode usage"},retry:{id:"hintMessage.retry",defaultMessage:"Retry",description:"Retry text next to lost connection message"},lostConnection:{id:"hintMessage.lostConnection",defaultMessage:"Lost connection.",description:"Hint message shown when the voice mode network connection is lost."}},xn=H(()=>D(()=>import("./et3ha0h4bqlxc2uf.js").then(e=>e._),__vite__mapDeps([2,1])),{loading:e=>U(e)});H(()=>D(()=>import("./d69imh1iyv32gaf9.js").then(e=>e._),__vite__mapDeps([3,1])),{loading:e=>U(e)});const wn=H(()=>D(()=>import("./kag562m27rmlspt4.js").then(e=>e._),__vite__mapDeps([4,1])),{loading:e=>U(e)}),Rn=H(()=>D(()=>import("./b7nodduwb2cg7ocy.js").then(e=>e._),__vite__mapDeps([5,1])),{loading:e=>U(e)}),Pn=H(()=>D(()=>import("./mkqbxg29rgkoa3dk.js").then(e=>e._),__vite__mapDeps([6,1])),{loading:e=>U(e)}),In=H(()=>D(()=>import("./nlen9u31md3gmt0q.js").then(e=>e._),__vite__mapDeps([7,1])),{loading:e=>U(e)}),Vn=H(()=>D(()=>import("./ghewn7l2ynbm32fm.js").then(e=>e.vJ),__vite__mapDeps([8,1,9])),{loading:e=>U(e)});function Xn({conversationId:e}){var Me,Ee,Ce,xe,we;const n=gt(),t=z(),o=he(),i=Cn({conversationId:e}),a=P(m=>m.server.usage),l=P(m=>m.server.voiceConnectionQuality),c=m=>m===Gt.LOST,u=Pt(),{voiceName:v}=It(),[S,g]=s.useState(!1),r=P(m=>m.server.toolUpdate),[h,p]=s.useState(!1),[b,k]=s.useState(!0),d=an(),[O,w]=s.useState(null),[T,y]=s.useState(null),[I,R]=s.useState(null),V=s.useRef(!1),F=We(e),{startVoiceMode:ie,stopVoiceMode:_e,isVoiceModeActive:Z}=qt(),C=P(m=>m.server.connectionState),Se=s.useRef(!1),ke=s.useRef(!1),{requestMicrophonePermissions:ye,userDeclinedMicrophonePermissions:B,microphoneAvailable:re,microphoneLabel:Je}=Vt(),Xe=s.useCallback(async()=>{if(Se.current)return;Se.current=!0;let m;const E=await He();E==="prompt"?m="userIgnoredMicrophonePrompt":E==="denied"?m="userDeniedMicrophonePrompt":ke.current?m="limitReached":C==null||C===A.Connecting||C===A.Reconnecting||C===A.SignalReconnecting?m="userAbort":C===A.Connected?m="userRequest":m="networkDisconnected",i(m)},[C,i]);s.useEffect(()=>{ye()},[ye]),s.useEffect(()=>{Z&&B&&(g(!1),R(null),w(t.formatMessage(de.hint)),y({title:t.formatMessage(de.title),description_markdown:t.formatMessage(de.description_markdown),buttons:[]}))},[t,Z,B]),s.useEffect(()=>{var m;if(re&&!C&&!V.current){V.current=!0,w(null),y(null);const E=je(e);let N;d!==void 0?(N=d,cn.set(void 0)):(N=zt({serverThreadId:F,parentMessageId:(m=ce.getCurrentNode(E))==null?void 0:m.id,isAdvancedMode:!0,eventSource:"composer_speech_button",clientThreadId:e,gizmoId:ce.getGizmoId(E)}),J.voiceSessionStarted.click({voice:v}),N.requested_default_model=pt(vt(n,e)).id),ie(N)}},[n,C,e,re,F,ie,v,d]);const Ze=P(m=>m.hasConnectedOnce),{reaching_limit_disclosure:q,exceed_limit_message:j}=(Me=a==null?void 0:a.rate_limit_message)!=null?Me:{},L=u==null?void 0:u.modes.find(m=>m.mode===(u==null?void 0:u.default_voice_mode)),X=L==null?void 0:L.disclosure_message,K=L==null?void 0:L.info_message,et=s.useMemo(()=>C!==A.Connected?!0:!!c(l),[C,l]),[tt,Te]=s.useState(!1);s.useEffect(()=>{C===A.Connected&&Te(!1)},[C]);const ae=(xe=(Ce=(Ee=q==null?void 0:q.hint)!=null?Ee:j==null?void 0:j.title)!=null?Ce:X==null?void 0:X.hint)!=null?xe:null;s.useEffect(()=>{var m,E;L&&!B&&w((E=(m=L.disclosure_message)==null?void 0:m.hint)!=null?E:null)},[L,B]),s.useEffect(()=>{const m=r==null?void 0:r.text;let E,N,Q;return m&&(k(!1),E=setTimeout(()=>{p(!0),N=setTimeout(()=>{p(!1),Q=setTimeout(()=>{k(!0),o.setState(at=>{at.server.toolUpdate=null})},750)},3e3)},750)),()=>{clearTimeout(E),clearTimeout(N),clearTimeout(Q)}},[r,o]),s.useEffect(()=>{if(!B){if(ae&&w(ae),j&&Z){ke.current=!0,_e();const m={title:j.title,description_markdown:j.description_markdown,buttons:j.buttons};S?R(m):(y(m),g(!0));const E=j.buttons.some(Q=>Q.action==="upgrade_to_plus"),N=j.buttons.some(Q=>Q.action==="upgrade_to_pro");J.rateLimitReached.success({upgrade_to_plus:E,upgrade_to_pro:N})}else if(!T){const m=q!=null?q:X;m&&y({title:m.title,description_markdown:m.message_markdown,buttons:m.buttons})}}},[X,j,ae,S,Z,T,q,_e,B,K]);const nt=s.useCallback(()=>{I&&(y(I),R(null)),g(!0)},[I]),ot=s.useCallback(()=>{K&&y({title:K.title,description_markdown:K.message_markdown,buttons:K.buttons}),g(!0)},[K]),st=s.useCallback(()=>{g(!1)},[]),it=P(m=>m.voiceMode),rt=async()=>{try{w(null),Te(!0),await ie({conversation_id:F,eventSource:"lost_connection_hint_message",voice_mode:it,voice:v,clientThreadId:e,gizmo_id:ce.getGizmoId(je(e)),skipCacheReason:"lost-connection-retry",forceDisconnect:!0})}catch(m){const E=m instanceof Error?m.message:String(m);J.voiceMode.error({error:E,eventSource:"lost_connection_hint_message"})}};let G="normal";return B?G="microphone_denied":O?G="normal":et&&!tt&&Ze&&(G="disconnected"),f.jsxs("div",{className:"flex w-full flex-col items-center",children:[f.jsxs("div",{className:"text-token-text-secondary relative mb-6 flex min-h-5 w-full items-center justify-center text-xs",children:[(r==null?void 0:r.text)&&f.jsx(me.div,{initial:{opacity:0},animate:{opacity:h?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:f.jsxs("div",{className:"flex items-center",children:[(r==null?void 0:r.text)&&f.jsx(In,{className:"icon-sm me-1"}),r==null?void 0:r.text]})}),f.jsx(me.div,{initial:{opacity:0},animate:{opacity:b?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",pointerEvents:r!=null&&r.text?"none":"auto",cursor:r!=null&&r.text?"default":"pointer"},children:f.jsx("div",{className:"flex items-center",children:O||G==="disconnected"?f.jsx(Fe,{type:G,message:O,onClick:G==="disconnected"?rt:nt}):K?f.jsx(Fe,{type:"normal",message:K.title,onClick:ot}):null})})]}),f.jsxs("div",{className:fe("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[f.jsx(Ke,{capability:"video",children:f.jsx(jn,{})}),f.jsx(On,{hideTooltip:B,microphoneLabel:Je,isMicrophoneEnabled:re}),f.jsx(Ke,{capability:"screenshare",children:f.jsx(Ln,{})}),f.jsx(Nn,{onClick:Xe})]}),f.jsx(ln,{conversationId:e,isOpen:S,onClose:st,title:T==null?void 0:T.title,description_markdown:T==null?void 0:T.description_markdown,buttons:(we=T==null?void 0:T.buttons)!=null?we:[]}),!1]})}function Ke({children:e,capability:n}){return Qt()[n]?e:null}function jn(){const{cameraTrackState:e,toggleCamera:n}=Ot(),t=z();let o=null;const i=[W.Starting,W.Stopping].includes(e),a=e===W.Started;i?o=ve:o=xn;const l=a?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",c=a?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse",u=t.formatMessage({id:"SRVwhB",defaultMessage:"Toggle video"});return f.jsx(se,{"aria-label":u,onClick:()=>n("ControlButton"),disabled:i,icon:o,className:l,iconColor:c})}function On({hideTooltip:e,microphoneLabel:n,isMicrophoneEnabled:t}){const{isMuting:o,toggleMute:i}=Ue(),a=z(),{disconnectPending:l}=be(),c=!!P(p=>{var b;return(b=p.dev.room)==null?void 0:b.localParticipant.isMicrophoneEnabled}),u=!!P(p=>{var b;return(b=p.dev.room)==null?void 0:b.localParticipant.isMicrophoneForceMuted}),v=t&&c,S=v?Pn:Rn,g=v?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",r=v?"text-token-main-surface-primary-inverse":"text-danger",h=u?a.formatMessage({id:"bVgTcp",defaultMessage:"Microphone muted in system settings / hardware switch"}):v?a.formatMessage({id:"FI36QI",defaultMessage:"Turn off microphone"}):a.formatMessage({id:"j3oMt1",defaultMessage:"Turn on microphone"});return f.jsx(se,{"aria-label":h,onClick:i,icon:S,disabled:o||l||u,className:g,iconColor:r,tooltipPrimaryLabel:!e&&n?h:"",tooltipSecondaryLabel:n})}function Ln(){const{screenshareTrackState:e,toggleScreenShare:n}=Lt(),t=z();let o=null;const i=[W.Starting,W.Stopping].includes(e),a=e===W.Started;i?o=ve:o=wn;const l=a?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",c=a?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse",u=t.formatMessage({id:"ShdqyW",defaultMessage:"Toggle screenshare"});return f.jsx(se,{"aria-label":u,onClick:()=>n("ControlButton"),disabled:i,icon:o,className:l,iconColor:c})}function Nn({className:e,onClick:n}){const t=z(),{disconnectPending:o}=be(),i="bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",a=t.formatMessage({id:"9Mto0a",defaultMessage:"End"});return f.jsx(se,{disabled:o,onClick:n,icon:o?ve:Vn,iconColor:"text-token-main-surface-primary-inverse",className:e!=null?e:i,"aria-label":t.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"}),tooltipPrimaryLabel:a})}function se(e){const k=e,{icon:n,disabled:t,className:o,iconColor:i="text-current",iconSize:a="icon-xl",buttonSize:l="h-16 w-16",tooltipPrimaryLabel:c,tooltipSecondaryLabel:u}=k,v=te(k,["icon","disabled","className","iconColor","iconSize","buttonSize","tooltipPrimaryLabel","tooltipSecondaryLabel"]),[S,g]=s.useState(!1),r=s.useRef(void 0),h=s.useCallback(()=>{clearTimeout(r.current);const d=window.setTimeout(()=>{g(!0)},jt);r.current=d},[]),p=s.useCallback(()=>{clearTimeout(r.current),g(!1)},[]);s.useEffect(()=>()=>{clearTimeout(r.current)},[]);const b=f.jsx(Dn,Y(_({className:fe(o,l,"text-token-text-primary hover:text-token-text-secondary overflow-hidden rounded-full border-none p-0.5 transition-colors duration-200 ease-in-out"),disabled:t},v),{children:f.jsx(n,{className:fe(a,i)})}));return c?f.jsx(ht,{sideOffset:14,label:c,secondaryLabel:u,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:S,side:"top",children:f.jsx("span",{onPointerEnter:h,onPointerLeave:p,children:b})}):b}const An=s.forwardRef(function(n,t){return f.jsx(bt,Y(_({},n),{ref:t}))}),Dn=me.create(An),de={hint:{id:"micMessages.hint",defaultMessage:"Enable microphone access in Settings",description:"Hint to the user to manually enable microphone access for voice mode"},title:{id:"micMessages.title",defaultMessage:"Microphone access required",description:"Title for modal that informs the user that microphone access is required for voice mode"},description_markdown:{id:"micMessages.description_markdown",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again.",description:"Description for modal that informs the user that microphone access is required for voice mode"}},Fn=()=>_t(()=>pe())==="transceiver";function Bn(e={}){const[n,t]=s.useState(!1),[o,i]=s.useState(!1),[a,l]=s.useState(!1);let c=Yt().microphoneTrack;const[u,v]=s.useState();e.trackRef&&(c=e.trackRef.publication);const S=s.useCallback(async g=>{if(g){const{KrispNoiseFilter:r,isKrispNoiseFilterSupported:h}=await D(async()=>{const{KrispNoiseFilter:p,isKrispNoiseFilterSupported:b}=await import("./iveu78zecg5unjye.js");return{KrispNoiseFilter:p,isKrispNoiseFilterSupported:b}},[]);if(!h()){console.warn("Krisp noise filter is not supported in this browser");return}u||v(r(e.filterOptions))}t(r=>(r!==g&&i(!0),g))},[]);return s.useEffect(()=>{var g;if(c&&c.track instanceof sn&&u){const r=c.track.getProcessor();r&&r.name==="livekit-noise-filter"?(i(!0),r.setEnabled(n).finally(()=>{i(!1),l(n)})):!r&&n&&(i(!0),(g=c==null?void 0:c.track)==null||g.setProcessor(u).then(()=>u.setEnabled(n)).then(()=>{l(!0)}).catch(h=>{l(!1),console.error(h)}).finally(()=>{i(!1)}))}},[n,c,u]),{setNoiseFilterEnabled:S,isNoiseFilterEnabled:a,isNoiseFilterPending:o,processor:u}}const Kn=s.memo(function(){const{setNoiseFilterEnabled:n}=Bn();return s.useEffect(()=>{n(!0)},[n]),null}),$n=new un(new URL("/assets/livekit-client.e2ee.worker-CnFd6278.js",import.meta.url),{type:"module"}),Zn=s.memo(function({children:n,executors:t}){const o=s.useRef({keyProvider:new rn}).current,[i,a]=s.useState(!1),{token:l,url:c,e2eeKey:u}=P(p=>p.credentials),v=dn(),S=P(p=>p.isVoiceModeActive),g=P(p=>{var b;return(b=p.audioInputDevice)==null?void 0:b.deviceId}),r=Fn(),h=r?Jt:Xt;return s.useEffect(()=>{const p=l&&c&&u;!i&&p?o.keyProvider.setKey(u).then(()=>{a(!0)}):i&&!p&&a(!1)},[l,c,u,i,o]),S?f.jsx(vn,Y(_({},v),{connect:!0,token:l!=null?l:void 0,serverUrl:c!=null?c:void 0,audio:{deviceId:{ideal:g,exact:g},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:o.keyProvider,worker:$n}},children:f.jsxs(h,{children:[n,r||i&&l&&c?f.jsx(Zt,{}):null,i&&l&&c&&f.jsx(Tn,{}),i&&l&&c&&f.jsx(Kn,{}),!1,t]})})):t});export{se as C,Nn as S,Zn as V,Ke as W,Cn as a,Xn as b,Mn as g,Fn as u};
//# sourceMappingURL=okk8l59g9pi0np0z.js.map
