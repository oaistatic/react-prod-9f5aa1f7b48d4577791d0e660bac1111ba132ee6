const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dzlsnt42nnmwuxsc.js","assets/i8clt0mfz495j7ii.js","assets/kwfwkvlmi7igryyh.js","assets/j0yo6uv6652vva62.js","assets/ghewn7l2ynbm32fm.js","assets/root-c4psboex.css","assets/conversation-small-lq38g8zw.css","assets/nyiv7m02dbt9yeja.js"])))=>i.map(i=>d[i]);
var Me=Object.defineProperty,be=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var ne=(t,s,o)=>s in t?Me(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,T=(t,s)=>{for(var o in s||(s={}))we.call(s,o)&&ne(t,o,s[o]);if(se)for(var o of se(s))_e.call(s,o)&&ne(t,o,s[o]);return t},O=(t,s)=>be(t,Se(s));import{r as d,j as e,l as ke,e as Ne,_ as V}from"./i8clt0mfz495j7ii.js";import{S as q}from"./bqk4d9uy5l3d6vsz.js";import{a$ as Ee,ff as J,bO as X,bQ as Z,eo as Ie,b0 as ie,o as A,L,C as re,e4 as De,aV as ce,aW as le,d as de,cm as $e}from"./ghewn7l2ynbm32fm.js";import{mz as Te,mA as Oe,mB as Ve,gL as N,mC as Ae,mD as ue,gK as Le,mE as U}from"./j0yo6uv6652vva62.js";import{u as Pe,g as Fe}from"./h8pr5f6a9kp0y6hm.js";import{g as Re}from"./okk8l59g9pi0np0z.js";import{u as Be}from"./i1vfxlpgdgslxqwx.js";import{r as We}from"./hu1kfuw35sk0pi95.js";import{M as ze}from"./mzyl3pd4zxnxoe9i.js";import"./bxgk09qvxvkate6l.js";import"./eosy1ymy279c5qnc.js";import"./iiok29s29bpdre61.js";import"./efcqr1k3spvze0uw.js";import"./gy1lpvuoewmzh42c.js";import"./i03gut32e8jn5ajq.js";import"./h1em0bjkpkjv8ykw.js";import"./nfccle6oyncifphl.js";import"./hu1bt0oauegdhua6.js";function Ue(t,s){const o={},r=(n,c="")=>{Object.entries(n).forEach(([h,g])=>{const u=c?"".concat(c,".").concat(h):h;g&&typeof g=="object"&&!Array.isArray(g)?r(g,u):g&&(typeof g=="number"||typeof g=="string"||g==null)&&(o[u]=g)})};r(t);const a={},l=n=>a[n]||(a[n]={}),m=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(o).forEach(n=>{const c=o[n];if(c==null)return;const h=n.split(".").pop(),g=[[/^(.*)_start_time$/,"start",u=>u[1]],[/^(.*)_end_time$/,"end",u=>u[1]],[/^(.*)_sent_time$/,"start",u=>u[1]],[/^(.*)_success_time$/,"end",u=>u[1]],[/^(.*)_time$/,"start",u=>u[1]]];for(const[u,S,C]of g){const M=h.match(u);if(M){const j=C(M),I=l(j);I[S]=m(c);break}}});const x=[];Object.entries(a).forEach(([n,{start:c,end:h}])=>{c!==void 0&&h!==void 0?x.push({name:n,start:c,end:h,duration:h-c}):c!==void 0&&x.push({name:n,start:c,end:c,duration:0,noEnd:!0})});let f=x;if(s&&s.length){const n=new Set(s);f=f.filter(c=>n.has(c.name))}return f.sort((n,c)=>n.start-c.start||n.name.localeCompare(c.name)),f}const oe=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],Qe=({json:t,focusNames:s,width:o,barHeight:r=18,rowGap:a=6,paddingX:l=50,paddingTop:m=20})=>{const x=d.useRef(null),[f,n]=d.useState(o||600);Ee(()=>{if(!o){const i=()=>{if(x.current){const p=x.current.clientWidth;n(Math.max(300,p))}};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}},[o]);const c=d.useMemo(()=>Ue(t,s),[t,s]),[h,g]=d.useState({}),u=d.useCallback(i=>h[i]!==!1,[h]),S=d.useCallback(i=>g(p=>O(T({},p),{[i]:p[i]===!1})),[]),C=d.useMemo(()=>c.filter(i=>u(i.name)),[c,u]),M=C.length>0,j=M?Math.min(...C.map(i=>i.start)):0,I=M?Math.max(...C.map(i=>i.end)):1,_=Math.max(I-j,1),w=m+c.length*(r+a)+a+32,xe=(c.length?Math.max(...c.map(i=>i.name.length)):0)*7+16+16,P=Math.max(l,xe),fe=l,W=(f-P-fe)/_,[pe,K]=d.useState(null),[F,H]=d.useState({visible:!1,x:0,y:0,lines:[]}),ee=(i,p)=>{if(!x.current)return;const v=x.current.getBoundingClientRect(),y=p.clientX-v.left,R=p.clientY-v.top,D=(i.start-j).toFixed(2),$=i.noEnd?void 0:(i.end-j).toFixed(2),z=$?["start: ".concat(D," ms"),"end: ".concat($," ms"),"dur: ".concat(i.duration.toFixed(2)," ms")]:["start: ".concat(D," ms")];H({visible:!0,x:y+10,y:R+10,lines:z})},he=()=>H(i=>O(T({},i),{visible:!1})),ge=d.useMemo(()=>{if(!M)return[0,_];const i=new Set;C.forEach(v=>{i.add(v.start-j),i.add(v.end-j)});const p=Array.from(i).sort((v,y)=>v-y);return p[0]!==0&&p.unshift(0),p[p.length-1]!==_&&p.push(_),p},[C,j,_,M]);return e.jsxs("div",{ref:x,className:"relative w-full",style:o?{width:"".concat(o,"px")}:void 0,children:[e.jsxs("svg",{width:f,height:w,className:"font-sans",children:[c.map((i,p)=>{const v=m+p*(r+a),y=u(i.name)?P+(i.start-j)*W:0,R=u(i.name)?Math.max(i.duration*W,1):0,D=oe[p%oe.length],$=pe===p?"opacity-80":"opacity-100",z=i.duration===0,te=!!i.noEnd,ve=k=>{u(i.name)&&(K(p),ee(i,k))},je=k=>{u(i.name)&&ee(i,k)},ye=()=>{K(null),he()};return e.jsxs("g",{onMouseEnter:ve,onMouseMove:je,onMouseLeave:ye,children:[e.jsx("foreignObject",{x:0,y:v,width:P-8,height:r,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:u(i.name),onChange:()=>S(i.name),className:"cursor-pointer"}),e.jsx("span",{children:i.name})]})})}),u(i.name)&&(te?(()=>{const k=v+r/2,B=r*.6/2,Ce=["".concat(y,",").concat(k-B),"".concat(y+B,",").concat(k),"".concat(y,",").concat(k+B),"".concat(y-B,",").concat(k)].join(" ");return e.jsx("polygon",{points:Ce,fill:"currentColor",className:"".concat(D," ").concat($)})})():z?e.jsx("line",{x1:y,x2:y,y1:v,y2:v+r,stroke:"currentColor",strokeWidth:2,className:D}):e.jsx("rect",{x:y,y:v,width:R,height:r,fill:"currentColor",className:"".concat(D," ").concat($)})),u(i.name)&&e.jsxs("text",{x:y+(te?r*.6:R)+4,y:v+r/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[i.duration.toFixed(2)," ms"]})]},i.name)}),ge.map(i=>{const p=P+i*W;return e.jsx("line",{x1:p,x2:p,y1:m-3,y2:w-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},i)}),e.jsx("text",{x:f/2,y:w-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),F.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:F.x,top:F.y},children:F.lines.map((i,p)=>e.jsx("div",{children:i},p))})]})};var Q,ae;function qe(){if(ae)return Q;ae=1;var t=We(),s=Te(),o=t(function(r,a,l){return r+(l?" ":"")+s(a)});return Q=o,Q}var Ye=qe();const Ge=ke(Ye),Je=A(()=>V(()=>import("./dzlsnt42nnmwuxsc.js").then(t=>t._),__vite__mapDeps([0,1])),{loading:t=>L(t)});function Xe({conversationId:t}){var l;const s=J(t),o=(l=X.getCurrentNode(Z(t)))==null?void 0:l.id,r=Oe();return Ve()?e.jsx(E,{conversationId:s!=null?s:t,parentMessageId:o,status:r}):null}function E(t){var n;const s=(n=t==null?void 0:t.status)==null?void 0:n.modes,[o,r]=d.useState(!1),[a,l]=d.useState(),m=d.useCallback(c=>{l(c),r(!0)},[]),x=Ne(),f=d.useCallback(()=>r(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{contentAlign:"center",triggerButton:e.jsx(E.Trigger,{}),children:s?s.map(c=>d.createElement(E.Item,O(T({},t),{key:c.display_name,voiceStatusMode:c,onShowModal:m}))):e.jsx("div",{role:"progressbar","aria-valuetext":x.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(ie,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(E.Modal,{conversationId:t.conversationId,disabledModeMetadata:a,isOpen:o,onClose:f})]})}E.Modal=function(s){var l,m,x,f;const o=(m=(l=s.disabledModeMetadata)==null?void 0:l.buttons)!=null?m:[],r=Be({buttons:o,conversationId:s.conversationId,onClick:s.onClose}),a=e.jsx(ze,{children:(x=s.disabledModeMetadata)==null?void 0:x.description_markdown});return e.jsx(re,{testId:"modal-voice-mode",title:(f=s.disabledModeMetadata)==null?void 0:f.title,description:a,isOpen:s.isOpen,onClose:s.onClose,type:"success",primaryButton:r.primary,secondaryButton:r.secondary})};E.Trigger=d.forwardRef(function(s,o){var a;const r=N(l=>l.voiceMode);return e.jsxs(Ae,O(T({ref:o},s),{children:[(a=Ge(r))!=null?a:e.jsx(ie,{}),e.jsx(Je,{className:"icon text-token-text-tertiary"})]}))});E.Item=function({conversationId:s,parentMessageId:o,voiceStatusMode:r,onShowModal:a}){const{disabled_mode_metadata:l,mode:m}=r,{startVoiceMode:x}=Pe(),f=J(s),n=d.useCallback(async()=>{l?a(l.disabled_message):x(Fe({serverThreadId:f,parentMessageId:o,isAdvancedMode:m==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:s,gizmoId:X.getGizmoId(Z(s)),skipCacheReason:"debug-button-clicked"}))},[s,l,m,a,o,f,x]);return e.jsx(De.Item,{onClick:n,children:e.jsxs("div",{children:[r.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:r.description})]})})};const Ze=A(()=>V(()=>import("./kwfwkvlmi7igryyh.js").then(t=>t._),__vite__mapDeps([2,1])),{loading:t=>L(t)}),Ke=A(()=>V(()=>import("./j0yo6uv6652vva62.js").then(t=>t.ys),__vite__mapDeps([3,1,4,5,6])),{loading:t=>L(t)}),Y=A(()=>V(()=>import("./j0yo6uv6652vva62.js").then(t=>t.yA),__vite__mapDeps([3,1,4,5,6])),{loading:t=>L(t)}),He=A(()=>V(()=>import("./nyiv7m02dbt9yeja.js").then(t=>t._),__vite__mapDeps([7,1])),{loading:t=>L(t)});function Nt({conversationId:t}){const s=N(a=>a.voiceSessionId),o=N(a=>{const{sessionCreateTime:l,sessionConnectedTime:m}=a.metrics;return l&&m?m.getTime()-l.getTime():null}),r=d.useCallback(a=>a>=1e3?"".concat((a/1e3).toFixed(2),"s"):"".concat(a.toFixed(0),"ms"),[]);return e.jsx("div",{className:"relative h-full",children:e.jsx(ce.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(le,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(Xe,{conversationId:t})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(b,{name:"Voice Session ID",text:s!=null?s:"n/a"}),e.jsx(et,{conversationId:t}),e.jsx(b,{name:"Connect Latency",text:o!==null?r(o):"n/a"}),e.jsx(tt,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(st,{}),e.jsx(nt,{})]})}),!1]})]})})})})}function et({conversationId:t}){var c,h,g;const s=J(t),o=s&&Z(s),r=X.getTree(o),a=N(u=>u.server.messages.findLast(S=>S.type===ue.ConversationUpdate)),l=a==null?void 0:a.payload.parent_message_id,m=l?r.findNode(u=>u.message.author.role==="assistant"&&$e.isMultimodalTextMessage(u.message),l):void 0,{model_definition_slug:x,model_definition_virtual_model_id:f}=(h=(c=m==null?void 0:m.message.metadata)==null?void 0:c.__internal)!=null?h:{},n=(g=[x,f].filter(Boolean).join(", "))!=null?g:"pending model response";return e.jsx(b,{name:"Model ID",text:n,allowWrap:!0})}function tt(){const[t,s]=d.useState(!1),[o,r]=d.useState({}),a=Le(),l=d.useCallback(()=>{s(m=>!m)},[]);return d.useEffect(()=>{t&&Re(a).then(r)},[t,a]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline",onClick:l,children:t?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(re,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:t,onClose:()=>s(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(Qe,{json:o}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(o,null,2)})]})]})}function st(){const[t,s]=d.useState("timestamp"),[o,r]=d.useState("asc"),a=N(n=>n.server.messages.filter(c=>c.type===ue.Performance)),l=a[a.length-1],m=d.useCallback(n=>n>=1e3?"".concat((n/1e3).toFixed(2),"s"):"".concat(n.toFixed(1),"ms"),[]),x=d.useMemo(()=>l?[...l.payload.metrics].sort((n,c)=>{const h=t==="name"?n.name.localeCompare(c.name):n.ms-c.ms;return o==="asc"?h:-h}):[],[l,t,o]);if(!l)return null;const f=n=>{n===t?r(o==="asc"?"desc":"asc"):(s(n),r("asc"))};return e.jsx(me,{title:"Performance",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(G,{text:"Metric"}),t==="name"?o==="asc"?e.jsx(q,{}):e.jsx(Y,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>f("timestamp"),children:[e.jsx(G,{text:"Timestamp"}),t==="timestamp"?o==="asc"?e.jsx(q,{}):e.jsx(Y,{}):null]}),x.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:m(n.ms)},n.name+n.ms)]}))]})})}function nt(){var x,f;const t=N(n=>n.server.connectionState),s=N(n=>n.dev.room),[o,r]=d.useState("Unknown"),a=s==null?void 0:s.localParticipant,l=(x=s==null?void 0:s.numParticipants)!=null?x:"Unknown",m=(f=s==null?void 0:s.activeSpeakers)!=null?f:[];return d.useEffect(()=>{if(a){const n=c=>{r(c)};return a.on("connectionQualityChanged",n),()=>{a.off("connectionQualityChanged",n)}}},[a]),e.jsxs(me,{title:"Room",open:!1,children:[e.jsx(b,{name:"Connection Quality",text:String(o)}),e.jsx(b,{name:"Connection State",text:String(t)}),e.jsx(b,{name:"Participants",text:l}),e.jsx(b,{name:"Speakers",text:m.length}),e.jsx(ot,{})]})}function ot(){const t=N(c=>c.dev.room),[s,o]=d.useState(null),[r,a]=d.useState(null),[l,m]=d.useState(null),x=t==null?void 0:t.getActiveDevice("audioinput"),f=t==null?void 0:t.getActiveDevice("audiooutput"),n=t==null?void 0:t.getActiveDevice("videoinput");return d.useEffect(()=>{async function c(){var j,I,_;const h=await U.getLocalDevices("audioinput"),g=await U.getLocalDevices("audiooutput"),u=await U.getLocalDevices("videoinput"),S=h.find(w=>w.deviceId===x),C=g.find(w=>w.deviceId===f),M=u.find(w=>w.deviceId===n);o((j=S==null?void 0:S.label)!=null?j:"Unknown"),a((I=C==null?void 0:C.label)!=null?I:"Unknown"),m((_=M==null?void 0:M.label)!=null?_:null)}c()},[x,f,n]),e.jsxs(e.Fragment,{children:[e.jsx(G,{text:"Devices"}),l?e.jsx(b,{icon:He,name:"Video Input",text:l}):null,e.jsx(b,{icon:Ke,name:"Audio Input",text:s!=null?s:"Unknown"}),e.jsx(b,{icon:Ze,name:"Audio Output",text:r!=null?r:"Unknown"})]})}function me({title:t,titleClassName:s,children:o,open:r}){const[a,l]=d.useState(r!=null?r:!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:de("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",s),onClick:()=>l(!a),children:[e.jsx("span",{children:t}),e.jsx("span",{className:"ms-2",children:a?e.jsx(Y,{className:"icon-sm"}):e.jsx(q,{className:"icon-sm"})})]}),e.jsx(le,{initial:!1,children:a&&e.jsx(ce.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:o},"content")})]})}function G({text:t}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:t})}function b(t){var s;return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:t.icon?e.jsx(t.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[t.name,":"]})}),(s=t.content)!=null?s:e.jsx("span",{className:de(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!t.allowWrap&&"line-clamp-1"]),children:t.text})]})}export{Nt as VoiceModeDevPanel};
//# sourceMappingURL=jgtw62b7q2zec3it.js.map
