var B=Object.defineProperty;var w=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var M=(e,n,o)=>n in e?B(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,A=(e,n)=>{for(var o in n||(n={}))_.call(n,o)&&M(e,o,n[o]);if(w)for(var o of w(n))$.call(n,o)&&M(e,o,n[o]);return e};var I=(e,n)=>{var o={};for(var r in e)_.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&w)for(var r of w(e))n.indexOf(r)<0&&$.call(e,r)&&(o[r]=e[r]);return o};import{j as h,r as a}from"./i8clt0mfz495j7ii.js";import{e_ as H,dd as U}from"./ghewn7l2ynbm32fm.js";import{p as s}from"./ecfi069fherkr66q.js";import"./joa8jajuiu4xqpzn.js";function W(o){var r=o,{drawingCanvasRef:e}=r,n=I(r,["drawingCanvasRef"]);return h.jsx(q,A({ref:e},n))}const q=a.forwardRef(function({color:n,dashedOutlineColor:o,cursorWidth:r,canvasWidth:d,canvasHeight:m,currentDrawnShape:i,onNewDrawnShape:z},N){const c=a.useRef(null),l=a.useRef(null),[C,x]=a.useState(),[X,T]=a.useState(!1);a.useImperativeHandle(N,()=>({getImageData:()=>{var f;const t=v(c);i!=null&&(F(i),s.view.update());const u=(f=t.getContext("2d"))==null?void 0:f.getImageData(0,0,t.width,t.height);if(u==null)throw new Error("Failed to get image data from canvas");return i!=null&&o!=null&&O(i,new s.Color(o)),u}}));const p=a.useMemo(()=>H(t=>{if(l.current!=null){const u=D(t.point,v(c)),f=J(l.current.prevPoint,u,r);if(l.current.shape!=null){const Y=l.current.shape;l.current.shape=l.current.shape.unite(f),Y.remove(),f.remove()}else l.current.shape=f;l.current.shape.fillColor=new s.Color(n),l.current.prevPoint=u}},50),[n,r]),P=a.useCallback(t=>p(t),[p]),E=a.useCallback(()=>{var t;if(p.cancel(),((t=l.current)==null?void 0:t.shape)!=null){const u=new s.Path.Rectangle({point:[0,0],size:s.view.size}),f=l.current.shape.intersect(u);f.fillColor=new s.Color(n),o!=null&&O(f,new s.Color(o)),z(f),l.current.shape.remove(),u.remove()}l.current=null,T(!1)},[p,n,o,z]),b=a.useCallback(t=>{let u=null;i!=null&&(u=i.clone(),F(u),i.remove()),l.current={shape:u,prevPoint:D(t.point,v(c))},T(!0)},[i]),k=a.useCallback(()=>{i!=null&&i.dashArray.length>0&&(i.dashOffset+=.2)},[i]),y=a.useCallback(t=>{t.preventDefault()},[]),L=a.useCallback(t=>{t.pointerType==="mouse"&&x(new s.Point([t.offsetX,t.offsetY]))},[]),R=a.useCallback(t=>{t.pointerType==="mouse"&&x(new s.Point([t.offsetX,t.offsetY]))},[]),j=a.useCallback(t=>{t.pointerType==="mouse"&&x(void 0)},[]);a.useEffect(()=>{s.setup(v(c)),s.view.viewSize=new s.Size(d,m)},[]),a.useEffect(()=>{s.project.activeLayer.removeChildren(),i!=null&&s.project.activeLayer.addChild(i)},[i]),a.useEffect(()=>{const t=v(c);return t.addEventListener("pointerover",L),t.addEventListener("pointermove",R),t.addEventListener("pointerout",j),t.addEventListener("touchstart",y),()=>{t.removeEventListener("pointerover",L),t.removeEventListener("pointermove",R),t.removeEventListener("pointerout",j),t.removeEventListener("touchstart",y)}},[L,R,j,y]),a.useEffect(()=>(s.view.on("mousedown",b),s.view.on("mousedrag",P),s.view.on("mouseup",E),s.view.on("frame",k),()=>{s.view.off("mousedown",b),s.view.off("mousedrag",P),s.view.off("mouseup",E),s.view.off("frame",k)}),[b,P,E,k]);const g=c.current?G(r,c.current):r;return h.jsxs("div",{className:"relative h-full w-full cursor-none",children:[h.jsx("canvas",{ref:c,width:d,height:m,className:"h-full w-full","data-paper-hidpi":"off"}),C&&h.jsx("div",{className:"pointer-events-none absolute start-0 top-0 rounded-full border-[3px] shadow-[0_2px_3px_0_rgba(0,0,0,0.25)]",style:{width:"".concat(g,"px"),height:"".concat(g,"px"),transform:"translate(".concat(C.x-g/2,"px, ").concat(C.y-g/2,"px) scale(").concat(X?1:1.05,")")}})]})});function v(e){return U(e.current)}function G(e,n){return e*n.offsetWidth/n.width}function D(e,n){return e.multiply(n.width/n.offsetWidth)}function J(e,n,o){const r=e.getDistance(n),d=new s.Rectangle(e.subtract([o/2,o/2]),new s.Size(r+o,o)),m=new s.Size(o/2,o/2),i=new s.Path.Rectangle(d,m);return i.rotate(n.subtract(e).angle,e),i}function O(e,n){e.strokeColor=n,e.strokeWidth=2,e.strokeCap="round",e.dashArray=[6,8],e.dashOffset=0}function F(e){e.strokeColor=null,e.strokeWidth=0,e.dashArray=[],e.dashOffset=0}export{W as DynamicDrawingCanvas};
//# sourceMappingURL=ctczlunu4ooifkvv.js.map
