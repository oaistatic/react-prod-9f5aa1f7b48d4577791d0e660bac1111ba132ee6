import{r as f,j as l,e as M}from"./i8clt0mfz495j7ii.js";import{cE as x,bb as d,bc as T,u as C,h as E,bX as _}from"./ghewn7l2ynbm32fm.js";import{CoTChunks as k}from"./ijctvkapujvvau9j.js";import{b$ as h}from"./j0yo6uv6652vva62.js";import"./gla0jqw9ed8nrnoj.js";import"./hk7ym2rzlomukbdz.js";import"./pbvsc3do5o365cxq.js";import"./owvt7s3ln6qx5fou.js";import"./ksuwacyo5m7qmkk7.js";import"./dwikchly7agkd2y3.js";import"./bbipyj9bituayr8q.js";import"./olrcssu7duieo6m7.js";import"./ivb8c1xam3e690hh.js";import"./o2ch1u40q6bs5ljp.js";import"./k1t8elp5z7nmkg2d.js";import"./gdq1l97elemowxcc.js";import"./pbl95wx6493wq92j.js";import"./o56jrqjpjpipvc65.js";import"./lktqd4c5dfo8cx5l.js";import"./ov015nmz1yxh95ok.js";const y=(o,t)=>{if(t<=1)return o.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return o.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return o.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),s=t%60;return"".concat(n,"m ").concat(s,"s")}return o.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},R=o=>{var n,s;let t=0;for(const e of o)t+=(s=(n=e.metadata)==null?void 0:n.finished_duration_sec)!=null?s:0;return t},I=(o,t,n)=>{var s,e,c;return t.length>1?o.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(o,n)}):(c=(e=(s=x(t))==null?void 0:s.metadata)==null?void 0:e.finished_text)!=null?c:""},S=(o,t,n=!1)=>{var m;const s=[];let e={type:h.Thought,thought:{summary:"",content:""}};const c=()=>{e.thought.content.trim()&&(s.push(e),e={type:h.Thought,thought:{summary:e.thought.summary,content:""}})},u=o.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!n&&u.length<2)return s;let a=!1;for(let i=0;i<u.length;i++){const r=u[i].trim();if(r.toLowerCase()==="none"){d.count(T.COT_SUMMARIZER,"num_none_chunks");continue}const p=r.match(/^\*\*(.*)\*\*$/);if(p)c(),e.thought.summary=(m=p[1])!=null?m:"";else if(r){if(r.startsWith("```")){if(a){e.thought.content+=e.thought.content?"\n".concat(r):r,c(),a=!1;continue}c(),a=!0}e.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!a&&c(),e.thought.content+=e.thought.content?"\n".concat(r):r}}return e!=null&&e.thought.content.trim()&&s.push(e),n&&t&&s.push({type:h.Recap,content:t}),s},N=(o,t,n)=>{const s=!n,e=f.useMemo(()=>S(o,t,s),[o,t,s]);return f.useEffect(()=>{s&&d.hist(T.COT_SUMMARIZER,"num_cot_chunks",void 0,e.length)},[s]),e},O=({conversation:o,isStreaming:t,finishedText:n,summaryText:s,isFinalAssistantTurn:e,turnIndex:c})=>{const u=N(s,n,t),[a,m]=f.useState(!1);return l.jsx(k,{conversation:o,isStreaming:t,isFinalAssistantTurn:e,chunks:u,isExpanded:a,setIsExpanded:m,turnIndex:c})},$=8,b="\n\n",Q=({conversation:o,messages:t,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})=>{const c=M(),u=C(),a=E(u,"1214379119"),m=R(t);let i="";return t.forEach(g=>{const r=_(g);i+=i?b+r:r}),a&&!n&&!i&&m<$?null:l.jsx(O,{conversation:o,finishedText:I(c,t,m),summaryText:i,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})};export{O as LegacyCoT,Q as LegacyCoTMessage};
//# sourceMappingURL=rsvoovjxegeq6fbx.js.map
