const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fobvway9e4v0s6vc.js","assets/i8clt0mfz495j7ii.js","assets/nju52ppu7cxhyzrm.js","assets/hkdu34erhu96s165.js","assets/bimaydywrdin6h6p.js"])))=>i.map(i=>d[i]);
import{_ as w,r as h,e as M,j as e,M as g,a as A}from"./i8clt0mfz495j7ii.js";import{o as y,L as I,B as S,C as U,e as D,$ as N,l$ as O,ep as x,e4 as b,d as V,b0 as z}from"./ghewn7l2ynbm32fm.js";import{o as T}from"./j0yo6uv6652vva62.js";const X=y(()=>w(()=>import("./fobvway9e4v0s6vc.js").then(s=>s._),__vite__mapDeps([0,1])),{loading:s=>I(s)}),q=y(()=>w(()=>import("./nju52ppu7cxhyzrm.js").then(s=>s._),__vite__mapDeps([2,1])),{loading:s=>I(s)}),K=y(()=>w(()=>import("./hkdu34erhu96s165.js").then(s=>s._),__vite__mapDeps([3,1])),{loading:s=>I(s)}),Q=y(()=>w(()=>import("./bimaydywrdin6h6p.js").then(s=>s._),__vite__mapDeps([4,1])),{loading:s=>I(s)});function se({accountId:s,connectionId:a,isOpen:n,objectType:t,onClose:r}){var R;const[l,o]=h.useState(null),[_,d]=h.useState([]),[m,f]=h.useState(!1),[i,u]=h.useState(!1),c=S(),k=M(),p=(R=c==null?void 0:c.isPersonalAccount())!=null?R:!1,j=async C=>{var L;f(!0),u(!1);try{const v=p?await x.user_connection_list_item_scopes(a,t,C):await x.admin_connection_list_item_scopes(s,a,t,C);o((L=v.page_token)!=null?L:null),d(F=>[...F,...v.object_selections.map(B=>B.object_handle)])}catch(v){u(!0)}finally{f(!1)}},P=()=>{o(null),f(!1),d([]),u(!1),j(null)},E=h.useRef(!1);return h.useEffect(()=>{E.current||(E.current=!0,P())},[]),e.jsx(U,{testId:"modal-connection-blocked-items",isOpen:n,onClose:r,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:k.formatMessage({id:"BVUVRc",defaultMessage:"Block items"}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(g,{id:"LYXIh1",defaultMessage:"Found something that shouldn't be synced? You can block items here to prevent them from being synced or shown in search results."})}),e.jsx(G,{accountId:s,connectionId:a,objectType:t,onItemBlocked:P}),e.jsx(Y,{accountId:s,connectionId:a,hasError:i,hasMoreItems:l!=null,isLoading:m,loadMoreItems:()=>j(l),objectHandles:_,objectType:t,onItemUnblocked:P})]})})}function Y({connectionId:s,accountId:a,objectHandles:n,isLoading:t,hasError:r,hasMoreItems:l,loadMoreItems:o,onItemUnblocked:_,objectType:d}){return e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-medium",children:e.jsx(g,{id:"gimLZo",defaultMessage:"Currently blocked items"})}),r?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(g,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(N,{color:"secondary",icon:K,onClick:o,children:e.jsx(g,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsxs(e.Fragment,{children:[n.length>0||t?e.jsx("ul",{className:"flex flex-col gap-1",children:n.map(m=>e.jsx(Z,{connectionId:s,accountId:a,objectType:d,objectHandle:m,onItemUnblocked:_},m))}):e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(g,{id:"IGg+fh",defaultMessage:"No items are currently being blocked."})}),t?e.jsx(O,{lines:1}):l&&e.jsx(N,{color:"ghost",icon:Q,onClick:o,children:e.jsx(g,{id:"g+Tw+y",defaultMessage:"See more"})})]})]})}function Z({connectionId:s,accountId:a,objectHandle:n,onItemUnblocked:t,objectType:r}){const l=D(),o=M();return e.jsx($,{scopeChangeIcon:X,scopeChangeLabel:o.formatMessage({id:"yaj/om",defaultMessage:"Unblock item"}),scopeChangeTarget:"include",objectHandle:n,objectType:r,onError:()=>{l.danger(o.formatMessage({id:"yRm6yX",defaultMessage:"Failed to unblock item. Please try again later."}),{loggingTitle:"Failed to unblock item. Please try again later.",toastId:"blocked_items_modal",loggingDescription:"Failed to unblock item"})},onScopeUpdated:()=>{l.success(o.formatMessage({id:"Xot/uQ",defaultMessage:"Item successfully unblocked."})),t()},connectionId:s,accountId:a})}function $({connectionId:s,accountId:a,objectType:n,objectHandle:t,scopeChangeTarget:r,scopeChangeLabel:l,scopeChangeIcon:o,onScopeUpdated:_,onError:d}){var p;const m=S(),f=(p=m==null?void 0:m.isPersonalAccount())!=null?p:!1,[i,u]=h.useState(!1),{isPending:c,mutate:k}=A({mutationFn:async()=>r==="exclude"?f?await x.user_connection_block_items(s,n,[t]):await x.admin_connection_block_items(a,s,n,[t]):f?await x.user_connection_unblock_items(s,n,[t]):await x.admin_connection_unblock_items(a,s,n,[t]),mutationKey:["admin_connection_update_item_scope",s,n,r,t],onSuccess:()=>{_(),u(!1)},onError:()=>{u(!1),d()}});return e.jsxs("li",{className:"group hover:bg-token-surface-hover flex w-full flex-row rounded-xl px-4 py-1 text-sm",children:[e.jsx("span",{className:"flex-1",children:t}),e.jsxs(b.Root,{open:i||c,onOpenChange:u,children:[e.jsx(b.Trigger,{className:V("h-6 flex-0 group-hover:visible",!i&&"invisible"),children:e.jsx(q,{className:"icon-sm"})}),e.jsx(b.Portal,{children:e.jsx(b.Content,{size:"small",children:e.jsx(b.Item,{icon:c?z:o,onSelect:()=>k(),disabled:c,children:l})})})]})]})}function G({accountId:s,connectionId:a,objectType:n,onItemBlocked:t}){const r=D(),l=M();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-medium",children:e.jsx(g,{id:"dU+IPT",defaultMessage:"Block an item"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(g,{id:"y6yn/t",defaultMessage:"Enter the ID or URL of the item you want to block."})}),e.jsx(W,{accountId:s,connectionId:a,objectType:n,onSuccess:()=>{r.success(l.formatMessage({id:"Q+KnAh",defaultMessage:"Item successfully blocked."})),t()},onError:()=>{r.danger(l.formatMessage({id:"UH92LU",defaultMessage:"Failed to block item. Please try again later."}),{toastId:"blocked_items_modal",loggingTitle:"Failed to block item. Please try again later.",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to block from syncing was unable to be blocked."})},targetScopeSelection:"exclude",buttonLabel:e.jsx(g,{id:"5FIVI9",defaultMessage:"Block"})})]})}function W({accountId:s,buttonLabel:a,connectionId:n,objectType:t,onError:r,onSuccess:l,placeholder:o,targetScopeSelection:_}){var p;const d=S(),m=M(),f=(p=d==null?void 0:d.isPersonalAccount())!=null?p:!1,[i,u]=h.useState(""),{isPending:c,mutate:k}=A({mutationFn:async()=>{if(i.trim())return _==="exclude"?f?await x.user_connection_block_items(n,t,[i]):await x.admin_connection_block_items(s,n,t,[i]):f?await x.user_connection_unblock_items(n,t,[i]):await x.admin_connection_unblock_items(s,n,t,[i])},mutationKey:["admin_connection_update_item_scope",n,t,_,i],onSuccess:()=>{l(),u("")},onError:r});return e.jsx("form",{onSubmit:j=>{j.preventDefault(),i.trim()&&k()},children:e.jsxs("div",{className:"flex w-full flex-row gap-2",children:[e.jsx(T,{type:"text",className:"flex-1",name:"objectHandle",ariaLabel:"object handle",value:i,onChange:j=>u(j.target.value),placeholder:o!=null?o:m.formatMessage({id:"sPUyj/",defaultMessage:"ID or URL"}),disabled:c}),e.jsx(N,{color:"primary",type:"button",onClick:()=>k(),loading:c,disabled:c||!i.trim(),className:"flex-0",children:a})]})})}export{se as C,$ as I,W as U};
//# sourceMappingURL=s7nhmyc9nrsk1i39.js.map
